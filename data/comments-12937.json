[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1245697351",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12937#issuecomment-1245697351",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12937",
        "id": 1245697351,
        "node_id": "IC_kwDOCVq1mM5KP9VH",
        "user": {
            "login": "yuslepukhin",
            "id": 11303988,
            "node_id": "MDQ6VXNlcjExMzAzOTg4",
            "avatar_url": "https://avatars.githubusercontent.com/u/11303988?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yuslepukhin",
            "html_url": "https://github.com/yuslepukhin",
            "followers_url": "https://api.github.com/users/yuslepukhin/followers",
            "following_url": "https://api.github.com/users/yuslepukhin/following{/other_user}",
            "gists_url": "https://api.github.com/users/yuslepukhin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yuslepukhin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yuslepukhin/subscriptions",
            "organizations_url": "https://api.github.com/users/yuslepukhin/orgs",
            "repos_url": "https://api.github.com/users/yuslepukhin/repos",
            "events_url": "https://api.github.com/users/yuslepukhin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yuslepukhin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-13T17:05:13Z",
        "updated_at": "2022-09-13T17:07:40Z",
        "author_association": "MEMBER",
        "body": "Somehow, I cannot gain access to your C# App. Also, would you like to file this issue with ML.NET first?\r\nJust to make sure I understand this right, you are measuring Onnxruntime C# API performance against Onnxruntime Python performance?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1245697351/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1245715083",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12937#issuecomment-1245715083",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12937",
        "id": 1245715083,
        "node_id": "IC_kwDOCVq1mM5KQBqL",
        "user": {
            "login": "kkulkarniMS",
            "id": 101832248,
            "node_id": "U_kgDOBhHWOA",
            "avatar_url": "https://avatars.githubusercontent.com/u/101832248?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/kkulkarniMS",
            "html_url": "https://github.com/kkulkarniMS",
            "followers_url": "https://api.github.com/users/kkulkarniMS/followers",
            "following_url": "https://api.github.com/users/kkulkarniMS/following{/other_user}",
            "gists_url": "https://api.github.com/users/kkulkarniMS/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/kkulkarniMS/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/kkulkarniMS/subscriptions",
            "organizations_url": "https://api.github.com/users/kkulkarniMS/orgs",
            "repos_url": "https://api.github.com/users/kkulkarniMS/repos",
            "events_url": "https://api.github.com/users/kkulkarniMS/events{/privacy}",
            "received_events_url": "https://api.github.com/users/kkulkarniMS/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-13T17:21:57Z",
        "updated_at": "2022-09-13T17:21:57Z",
        "author_association": "NONE",
        "body": "What's the error you are seeing? Can you share a screenshot?\n\nKedar Kulkarni\nSoftware Engineer\nUX & Foundation US\n***@***.******@***.***>\n\n[Microsoft Logo]\n\nFrom: Dmitri Smirnov ***@***.***>\nSent: Tuesday, September 13, 2022 10:05 AM\nTo: microsoft/onnxruntime ***@***.***>\nCc: Kedar Kulkarni ***@***.***>; Author ***@***.***>\nSubject: Re: [microsoft/onnxruntime] [Performance] .onnx Model runtime(using ORT Api) too high in C#(~30ms) but not in Python(<1ms) (Issue #12937)\n\n\nSomehow, I cannot gain access to your C# App.\n\n-\nReply to this email directly, view it on GitHub<https://nam06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fonnxruntime%2Fissues%2F12937%23issuecomment-1245697351&data=05%7C01%7Ckkulkarni%40microsoft.com%7C4881088f392f4996890a08da95aa264b%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C637986855266390256%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=On%2BqfHO5VhWsE9eZwfqvzKywT2%2FM1TdiMG7IBCQFCxQ%3D&reserved=0>, or unsubscribe<https://nam06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fnotifications%2Funsubscribe-auth%2FAYI5MOHDLY2AXHOXFYYTUS3V6CX5JANCNFSM6AAAAAAQK5TQBI&data=05%7C01%7Ckkulkarni%40microsoft.com%7C4881088f392f4996890a08da95aa264b%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C637986855266390256%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=m6y0zNfbQ0BP30NkFQfmt3edQ2tFiO%2BiD8jXMD%2FKIW0%3D&reserved=0>.\nYou are receiving this because you authored the thread.Message ID: ***@***.******@***.***>>\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1245715083/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1245719202",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12937#issuecomment-1245719202",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12937",
        "id": 1245719202,
        "node_id": "IC_kwDOCVq1mM5KQCqi",
        "user": {
            "login": "kkulkarniMS",
            "id": 101832248,
            "node_id": "U_kgDOBhHWOA",
            "avatar_url": "https://avatars.githubusercontent.com/u/101832248?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/kkulkarniMS",
            "html_url": "https://github.com/kkulkarniMS",
            "followers_url": "https://api.github.com/users/kkulkarniMS/followers",
            "following_url": "https://api.github.com/users/kkulkarniMS/following{/other_user}",
            "gists_url": "https://api.github.com/users/kkulkarniMS/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/kkulkarniMS/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/kkulkarniMS/subscriptions",
            "organizations_url": "https://api.github.com/users/kkulkarniMS/orgs",
            "repos_url": "https://api.github.com/users/kkulkarniMS/repos",
            "events_url": "https://api.github.com/users/kkulkarniMS/events{/privacy}",
            "received_events_url": "https://api.github.com/users/kkulkarniMS/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-13T17:25:53Z",
        "updated_at": "2022-09-13T17:26:21Z",
        "author_association": "NONE",
        "body": "> Just to make sure I understand this right, you are measuring Onnxruntime C# API performance against Onnxruntime Python performance?\r\n\r\nYes \r\n\r\n> Also, would you like to file this issue with ML.NET first? \r\n\r\nI talked to Cassie Breviu and Pranav Sharma about this and Pranav mentioned I should create a github issue for this. I am not sure which team would be appropriate for this. I will contact Microsoft.ML as well. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1245719202/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1245767898",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12937#issuecomment-1245767898",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12937",
        "id": 1245767898,
        "node_id": "IC_kwDOCVq1mM5KQOja",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-13T17:59:38Z",
        "updated_at": "2022-09-13T17:59:38Z",
        "author_association": "MEMBER",
        "body": "If you're using the ORT C# APIs directly, @yuslepukhin can help investigate. If you're using ML.NET, you're better off reaching out to them first. ML.NET uses the ORT C# APIs internally, but the inefficiencies could be at the ML.NET layer.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1245767898/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1246043290",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12937#issuecomment-1246043290",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12937",
        "id": 1246043290,
        "node_id": "IC_kwDOCVq1mM5KRRya",
        "user": {
            "login": "skottmckay",
            "id": 979079,
            "node_id": "MDQ6VXNlcjk3OTA3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/skottmckay",
            "html_url": "https://github.com/skottmckay",
            "followers_url": "https://api.github.com/users/skottmckay/followers",
            "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
            "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
            "organizations_url": "https://api.github.com/users/skottmckay/orgs",
            "repos_url": "https://api.github.com/users/skottmckay/repos",
            "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
            "received_events_url": "https://api.github.com/users/skottmckay/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-13T23:15:52Z",
        "updated_at": "2022-09-13T23:20:50Z",
        "author_association": "MEMBER",
        "body": "For one, don't create an InferenceSession for every request. Session creation is expensive. Do it once and re-use. It supports multiple requests and concurrent requests. Additionally the first request for a given input size will tend to be slower. We cache some info from that which makes following requests with that input size faster. \r\n\r\nNote that the exact same things apply to running via python though. The code that executes the model is exactly the same regardless of where the request came from.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1246043290/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1246085388",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12937#issuecomment-1246085388",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12937",
        "id": 1246085388,
        "node_id": "IC_kwDOCVq1mM5KRcEM",
        "user": {
            "login": "skottmckay",
            "id": 979079,
            "node_id": "MDQ6VXNlcjk3OTA3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/skottmckay",
            "html_url": "https://github.com/skottmckay",
            "followers_url": "https://api.github.com/users/skottmckay/followers",
            "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
            "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
            "organizations_url": "https://api.github.com/users/skottmckay/orgs",
            "repos_url": "https://api.github.com/users/skottmckay/repos",
            "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
            "received_events_url": "https://api.github.com/users/skottmckay/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-14T00:28:30Z",
        "updated_at": "2022-09-14T00:30:49Z",
        "author_association": "MEMBER",
        "body": "I added a loop calling Run with the same input, and saved the elapsed time in both milliseconds and microseconds. First call is 17ms. Subsequent calls are way less than 1ms. i.e. first call is slow, but that shouldn't be an issue as long as you re-use the InferenceSession.\r\n\r\n<img width=\"172\" alt=\"image\" src=\"https://user-images.githubusercontent.com/979079/190032286-2e25e065-f0ef-4ba2-b73b-db6be7dc2c77.png\">\r\n\r\n```c#\r\n            var results_millisecsc = new List<long>();\r\n            var results_microsecs = new List<double>();\r\n            for (int i = 0; i < 10; i++)\r\n            {\r\n                stopWatch.Start();\r\n                var output = session.Run(input);\r\n                stopWatch.Stop();\r\n                timerClock.modelRunningTimer = stopWatch.ElapsedMilliseconds;\r\n                results_millisecsc.Add(stopWatch.ElapsedMilliseconds);\r\n                results_microsecs.Add((Convert.ToDouble(stopWatch.ElapsedTicks) / Stopwatch.Frequency) * 1000 * 1000);\r\n                stopWatch.Reset();\r\n                var mapping = output.ToList().Last().AsEnumerable<NamedOnnxValue>();\r\n                var inferenceResult = mapping.First().AsDictionary<Int64, float>();\r\n                pred.Slow = inferenceResult.First().Value;\r\n                pred.Fast = inferenceResult.Last().Value;\r\n            }\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1246085388/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1246091071",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12937#issuecomment-1246091071",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12937",
        "id": 1246091071,
        "node_id": "IC_kwDOCVq1mM5KRdc_",
        "user": {
            "login": "kkulkarniMS",
            "id": 101832248,
            "node_id": "U_kgDOBhHWOA",
            "avatar_url": "https://avatars.githubusercontent.com/u/101832248?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/kkulkarniMS",
            "html_url": "https://github.com/kkulkarniMS",
            "followers_url": "https://api.github.com/users/kkulkarniMS/followers",
            "following_url": "https://api.github.com/users/kkulkarniMS/following{/other_user}",
            "gists_url": "https://api.github.com/users/kkulkarniMS/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/kkulkarniMS/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/kkulkarniMS/subscriptions",
            "organizations_url": "https://api.github.com/users/kkulkarniMS/orgs",
            "repos_url": "https://api.github.com/users/kkulkarniMS/repos",
            "events_url": "https://api.github.com/users/kkulkarniMS/events{/privacy}",
            "received_events_url": "https://api.github.com/users/kkulkarniMS/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-14T00:38:46Z",
        "updated_at": "2022-09-14T00:38:46Z",
        "author_association": "NONE",
        "body": "Yes, I tried the same after my chat with Dmitri in which the first couple of calls were expensive, but the later ones were <1ms. Thanks for the help, Dmitri and Scott. This issue can be closed. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1246091071/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]