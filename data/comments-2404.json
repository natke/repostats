[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/554276559",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2404#issuecomment-554276559",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2404",
        "id": 554276559,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDI3NjU1OQ==",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-11-15T09:10:59Z",
        "updated_at": "2019-11-15T09:23:40Z",
        "author_association": "MEMBER",
        "body": "If you set the logger severity level to verbose like this ```ort.set_default_logger_severity(0)```, you'll see that not all nodes have been placed on the GPU. See the following output\r\n\r\n```\r\n2019-11-14 23:25:25.3927876 [I:onnxruntime:Default, cuda_execution_provider.cc:1114 onnxruntime::CUDAExecutionProvider::GetCapability] Force fallback to CPU execution provider for Op type: Gather node name:\r\n2019-11-14 23:25:25.3929819 [I:onnxruntime:Default, cuda_execution_provider.cc:1114 onnxruntime::CUDAExecutionProvider::GetCapability] Force fallback to CPU execution provider for Op type: Unsqueeze node name:\r\n2019-11-14 23:25:25.3933796 [I:onnxruntime:Default, cuda_execution_provider.cc:1114 onnxruntime::CUDAExecutionProvider::GetCapability] Force fallback to CPU execution provider for Op type: Concat node name:\r\n2019-11-14 23:25:25.3939818 [V:onnxruntime:, inference_session.cc:438 onnxruntime::InferenceSession::TransformGraph] Node placements\r\n2019-11-14 23:25:25.3941451 [V:onnxruntime:, inference_session.cc:445 onnxruntime::InferenceSession::TransformGraph]  Provider: [CUDAExecutionProvider]: [Conv (), Relu (), MaxPool (), Conv (), Relu (), MaxPool (), Conv (), Relu (), MaxPool (), Conv (), Relu (), MaxPool (), Shape (), Reshape (), Gemm (), Relu (), Gemm (), Softmax (), ]\r\n2019-11-14 23:25:25.3945522 [V:onnxruntime:, inference_session.cc:445 onnxruntime::InferenceSession::TransformGraph]  Provider: [CPUExecutionProvider]: [Gather (), Unsqueeze (), Concat (), ]\r\n\r\n```\r\nThis is because of the Shape node which is [registered to produce an output on the CPU](https://github.com/microsoft/onnxruntime/blob/master/onnxruntime/core/providers/cuda/tensor/shape_op.cc#L16). This cascades to the following 3 nodes (Gather, Unsqueeze and Concat). The relevant piece of code is [here](https://github.com/microsoft/onnxruntime/blob/master/onnxruntime/core/providers/cuda/cuda_execution_provider.cc#L1253).",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/554276559/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/554281722",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2404#issuecomment-554281722",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2404",
        "id": 554281722,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDI4MTcyMg==",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-11-15T09:25:09Z",
        "updated_at": "2019-11-15T09:25:09Z",
        "author_association": "MEMBER",
        "body": "Other similar issues\r\n\r\nhttps://github.com/microsoft/onnxruntime/issues/1368\r\nhttps://github.com/microsoft/onnxruntime/issues/1246",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/554281722/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/554309790",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2404#issuecomment-554309790",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2404",
        "id": 554309790,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDMwOTc5MA==",
        "user": {
            "login": "TianzhongSong",
            "id": 23410197,
            "node_id": "MDQ6VXNlcjIzNDEwMTk3",
            "avatar_url": "https://avatars.githubusercontent.com/u/23410197?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TianzhongSong",
            "html_url": "https://github.com/TianzhongSong",
            "followers_url": "https://api.github.com/users/TianzhongSong/followers",
            "following_url": "https://api.github.com/users/TianzhongSong/following{/other_user}",
            "gists_url": "https://api.github.com/users/TianzhongSong/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TianzhongSong/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TianzhongSong/subscriptions",
            "organizations_url": "https://api.github.com/users/TianzhongSong/orgs",
            "repos_url": "https://api.github.com/users/TianzhongSong/repos",
            "events_url": "https://api.github.com/users/TianzhongSong/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TianzhongSong/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-11-15T10:42:32Z",
        "updated_at": "2019-11-15T10:46:39Z",
        "author_association": "NONE",
        "body": "@pranavsharma Thank you.\r\n\r\nI modified the model to avoid `view` operator,\r\n\r\n    self.classifier = nn.Sequential(\r\n        nn.MaxPool2d(kernel_size=7, stride=1),\r\n        nn.Conv2d(256, 1024, kernel_size=1),\r\n        nn.ReLU(inplace=True),\r\n        nn.Conv2d(1024, num_class, kernel_size=1),\r\n        nn.Softmax(dim=1)\r\n    )\r\n    .......\r\n    def forward(self, x):\r\n        x = self.backbone(x)\r\n        x = self.classifier(x)\r\n        return x\r\n\r\nNow, all nodes have been placed on GPU, however, the speed of onnxruntime is much slow than pytorch.\r\n\r\nPytorch average forward time: 1.614020ms\r\nonnxruntime average forward time: 3.353541ms\r\n\r\nThis is weird... \r\nAny idea?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/554309790/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/554593653",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2404#issuecomment-554593653",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2404",
        "id": 554593653,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDU5MzY1Mw==",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-11-16T02:09:18Z",
        "updated_at": "2019-11-16T02:12:08Z",
        "author_association": "MEMBER",
        "body": "The comparison is not apples to apples. In the pytorch script, you're making the input available on GPU (```input_tensor = input_tensor.cuda()```) before calling Run. The ORT python script doesn't have this capability. Hence the input is copied from CPU to GPU as part of the Run call. The same applies for output. In order to rule this out, I wrote a test using our internal C++ APIs where I made the input and output available on GPU apriori and measured only the Run call and found that this model takes about ~320 us. You can find the test [here](https://gist.github.com/pranavsharma/11a1468368a80d6b94a4d9f67b506861).",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/554593653/reactions",
            "total_count": 10,
            "+1": 10,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/555292029",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2404#issuecomment-555292029",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2404",
        "id": 555292029,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU1NTI5MjAyOQ==",
        "user": {
            "login": "TianzhongSong",
            "id": 23410197,
            "node_id": "MDQ6VXNlcjIzNDEwMTk3",
            "avatar_url": "https://avatars.githubusercontent.com/u/23410197?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TianzhongSong",
            "html_url": "https://github.com/TianzhongSong",
            "followers_url": "https://api.github.com/users/TianzhongSong/followers",
            "following_url": "https://api.github.com/users/TianzhongSong/following{/other_user}",
            "gists_url": "https://api.github.com/users/TianzhongSong/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TianzhongSong/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TianzhongSong/subscriptions",
            "organizations_url": "https://api.github.com/users/TianzhongSong/orgs",
            "repos_url": "https://api.github.com/users/TianzhongSong/repos",
            "events_url": "https://api.github.com/users/TianzhongSong/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TianzhongSong/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-11-19T01:40:50Z",
        "updated_at": "2019-11-19T01:40:50Z",
        "author_association": "NONE",
        "body": "Thank you for your answering!",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/555292029/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/583804342",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2404#issuecomment-583804342",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2404",
        "id": 583804342,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU4MzgwNDM0Mg==",
        "user": {
            "login": "xsacha",
            "id": 61218,
            "node_id": "MDQ6VXNlcjYxMjE4",
            "avatar_url": "https://avatars.githubusercontent.com/u/61218?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/xsacha",
            "html_url": "https://github.com/xsacha",
            "followers_url": "https://api.github.com/users/xsacha/followers",
            "following_url": "https://api.github.com/users/xsacha/following{/other_user}",
            "gists_url": "https://api.github.com/users/xsacha/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/xsacha/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/xsacha/subscriptions",
            "organizations_url": "https://api.github.com/users/xsacha/orgs",
            "repos_url": "https://api.github.com/users/xsacha/repos",
            "events_url": "https://api.github.com/users/xsacha/events{/privacy}",
            "received_events_url": "https://api.github.com/users/xsacha/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-02-09T04:43:23Z",
        "updated_at": "2020-02-09T04:44:11Z",
        "author_association": "NONE",
        "body": "@pranavsharma How are we meant to perform this in production? I notice you included test code to get this to work properly.\r\n\r\nMy data is already on GPU and I want to just use it in session.Run(..).\r\n\r\nNevermind, just found: https://github.com/microsoft/onnxruntime/issues/1621",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/583804342/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]