[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1217443943",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12609#issuecomment-1217443943",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12609",
        "id": 1217443943,
        "node_id": "IC_kwDOCVq1mM5IkLhn",
        "user": {
            "login": "yufengyao-lingoace",
            "id": 92853025,
            "node_id": "U_kgDOBYjTIQ",
            "avatar_url": "https://avatars.githubusercontent.com/u/92853025?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufengyao-lingoace",
            "html_url": "https://github.com/yufengyao-lingoace",
            "followers_url": "https://api.github.com/users/yufengyao-lingoace/followers",
            "following_url": "https://api.github.com/users/yufengyao-lingoace/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufengyao-lingoace/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufengyao-lingoace/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufengyao-lingoace/subscriptions",
            "organizations_url": "https://api.github.com/users/yufengyao-lingoace/orgs",
            "repos_url": "https://api.github.com/users/yufengyao-lingoace/repos",
            "events_url": "https://api.github.com/users/yufengyao-lingoace/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufengyao-lingoace/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-08-17T04:20:31Z",
        "updated_at": "2022-08-17T04:20:31Z",
        "author_association": "NONE",
        "body": "Anyone can help me?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1217443943/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1218520277",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12609#issuecomment-1218520277",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12609",
        "id": 1218520277,
        "node_id": "IC_kwDOCVq1mM5IoSTV",
        "user": {
            "login": "shalvamist",
            "id": 94086448,
            "node_id": "U_kgDOBZulMA",
            "avatar_url": "https://avatars.githubusercontent.com/u/94086448?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/shalvamist",
            "html_url": "https://github.com/shalvamist",
            "followers_url": "https://api.github.com/users/shalvamist/followers",
            "following_url": "https://api.github.com/users/shalvamist/following{/other_user}",
            "gists_url": "https://api.github.com/users/shalvamist/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/shalvamist/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/shalvamist/subscriptions",
            "organizations_url": "https://api.github.com/users/shalvamist/orgs",
            "repos_url": "https://api.github.com/users/shalvamist/repos",
            "events_url": "https://api.github.com/users/shalvamist/events{/privacy}",
            "received_events_url": "https://api.github.com/users/shalvamist/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-08-17T21:47:13Z",
        "updated_at": "2022-08-17T21:47:13Z",
        "author_association": "CONTRIBUTOR",
        "body": "Hey yufengyao,\r\n\r\nThanks for the details, can you please share a bit more info - \r\n1. The code looks like it's python - how are you deploying it to the browser ?\r\n2. Do you mind sharing the model so we could reproduce the issue and debug it ?\r\n3. Can you share the env set up and onnxruntime version used to produce this issue ?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1218520277/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1225358686",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12609#issuecomment-1225358686",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12609",
        "id": 1225358686,
        "node_id": "IC_kwDOCVq1mM5JCX1e",
        "user": {
            "login": "yufengyao-lingoace",
            "id": 92853025,
            "node_id": "U_kgDOBYjTIQ",
            "avatar_url": "https://avatars.githubusercontent.com/u/92853025?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufengyao-lingoace",
            "html_url": "https://github.com/yufengyao-lingoace",
            "followers_url": "https://api.github.com/users/yufengyao-lingoace/followers",
            "following_url": "https://api.github.com/users/yufengyao-lingoace/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufengyao-lingoace/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufengyao-lingoace/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufengyao-lingoace/subscriptions",
            "organizations_url": "https://api.github.com/users/yufengyao-lingoace/orgs",
            "repos_url": "https://api.github.com/users/yufengyao-lingoace/repos",
            "events_url": "https://api.github.com/users/yufengyao-lingoace/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufengyao-lingoace/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-08-24T08:18:03Z",
        "updated_at": "2022-08-24T08:37:05Z",
        "author_association": "NONE",
        "body": "> \r\nHello,\r\n       Thanks to you reply. It is easy to reproduce the issue. I create the model with pytorch, and then exported an onnx file, then use onnxruntime-web to run the onnx model. The pytorch code is as follow. Since hardsigmoid and hardwish is not supported by onnxruntime-web, I rewrite these two functions. It is normal to run using cpu or cuda, but very slow to run in chrome using either wasm or webgl. I guess that when I return f1,f2,f3,f4, actually it run f1 to get f1, and run f1,f2 to get f2, then f1,f2,f3 to get f3, finally, run f1,f2,f3,f4 to get f4 . So the f1 is calculated four times, f2 is calculated three times , f1 is calculated two times. Here is also a problem that :\r\n\r\ndef forward(self, x): //first model\r\n        f1 = self.b1(x)\r\n        f2 = self.b2(f1) \r\n        return f2\r\n\r\nis faster than\r\n\r\ndef forward(self, x): //second model\r\n        f1 = self.b1(x)\r\n        return f1\r\n\r\nThe calculation amount of the  first model is larger than the second, but the first model runs slower. So I think there is something wrong with our ort.js.  It does not work well with this model. \r\n\r\nBelow is my code:\r\n\r\nimport time\r\nfrom turtle import forward\r\nimport cv2\r\nimport onnx\r\nimport torch\r\nimport torchvision\r\nimport onnxruntime\r\nimport numpy as np\r\nimport torch.nn as nn\r\nfrom onnxsim import simplify\r\nimport torch.nn.functional as F\r\nfrom torchvision.transforms.functional import normalize\r\n\r\nclass MyModel(nn.Module):\r\n    def __init__(self):\r\n        super().__init__()\r\n        self.backbone = torchvision.models.mobilenet_v3_large()\r\n        del self.backbone.avgpool\r\n        del self.backbone.classifier\r\n        self.b1 = nn.Sequential(self.backbone.features[0],\r\n                                self.backbone.features[1])\r\n        self.b2 = nn.Sequential(self.backbone.features[2],\r\n                                self.backbone.features[3])\r\n        self.b3 = nn.Sequential(self.backbone.features[4],\r\n                                self.backbone.features[5], self.backbone.features[6])\r\n        self.b4 = nn.Sequential(self.backbone.features[7],\r\n                                self.backbone.features[8], self.backbone.features[9], self.backbone.features[10],\r\n                                self.backbone.features[11], self.backbone.features[12], self.backbone.features[13],\r\n                                self.backbone.features[14], self.backbone.features[15], self.backbone.features[16])\r\n\r\n    def forward(self, x):\r\n        f1 = self.b1(x)\r\n        f2 = self.b2(f1)  # 1, 24, 60, 80\r\n        f3 = self.b3(f2)  # 1,40,30,40\r\n        f4 = self.b4(f3)\r\n        return f1,f2,f3,f4\r\n\r\n\r\nclass MyHardswish(torch.nn.Module):\r\n    # @staticmethod\r\n    def forward(self, x):\r\n        return x * F.hardtanh(x + 3, 0., 6.) / 6.\r\n\r\n\r\nclass MyHardsigmoid(torch.nn.Module):\r\n    # @staticmethod\r\n    def forward(self, x):\r\n        return F.relu6(x + 3., inplace=True) / 6.\r\n\r\n\r\ndef _set_module(model, submodule_key, module):\r\n    tokens = submodule_key.split('.')\r\n    sub_tokens = tokens[:-1]\r\n    cur_mod = model\r\n\r\n    for s in sub_tokens:\r\n        cur_mod = getattr(cur_mod, s)\r\n    setattr(cur_mod, tokens[-1], module)\r\n\r\n\r\nmodel = MyModel()\r\nmodel.eval()\r\n\r\ninput = torch.randn(1, 3, 240, 360)\r\noutput = model(input)\r\n\r\n\r\nfor k, m in model.named_modules():\r\n    if isinstance(m, torch.nn.Hardswish):\r\n        _set_module(model, k, MyHardswish())\r\n    if isinstance(m, torch.nn.Hardsigmoid):\r\n        _set_module(model, k, MyHardsigmoid())\r\n\r\ntorch.onnx.export(\r\n    model,\r\n    (input),\r\n    f='test.onnx',\r\n    opset_version=12,\r\n    input_names=['input'],\r\n    output_names=['output'],\r\n)\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1225358686/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1229019523",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12609#issuecomment-1229019523",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12609",
        "id": 1229019523,
        "node_id": "IC_kwDOCVq1mM5JQVmD",
        "user": {
            "login": "shalvamist",
            "id": 94086448,
            "node_id": "U_kgDOBZulMA",
            "avatar_url": "https://avatars.githubusercontent.com/u/94086448?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/shalvamist",
            "html_url": "https://github.com/shalvamist",
            "followers_url": "https://api.github.com/users/shalvamist/followers",
            "following_url": "https://api.github.com/users/shalvamist/following{/other_user}",
            "gists_url": "https://api.github.com/users/shalvamist/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/shalvamist/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/shalvamist/subscriptions",
            "organizations_url": "https://api.github.com/users/shalvamist/orgs",
            "repos_url": "https://api.github.com/users/shalvamist/repos",
            "events_url": "https://api.github.com/users/shalvamist/events{/privacy}",
            "received_events_url": "https://api.github.com/users/shalvamist/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-08-26T22:42:26Z",
        "updated_at": "2022-08-26T22:42:26Z",
        "author_association": "CONTRIBUTOR",
        "body": "Hey,\r\n\r\nThanks for the update and details. Looks like I have enough info to start investigating the issue.\r\nI will try to reproduce the issue on my end and I will keep you posted with the results.\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1229019523/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1233403682",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12609#issuecomment-1233403682",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12609",
        "id": 1233403682,
        "node_id": "IC_kwDOCVq1mM5JhD8i",
        "user": {
            "login": "shalvamist",
            "id": 94086448,
            "node_id": "U_kgDOBZulMA",
            "avatar_url": "https://avatars.githubusercontent.com/u/94086448?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/shalvamist",
            "html_url": "https://github.com/shalvamist",
            "followers_url": "https://api.github.com/users/shalvamist/followers",
            "following_url": "https://api.github.com/users/shalvamist/following{/other_user}",
            "gists_url": "https://api.github.com/users/shalvamist/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/shalvamist/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/shalvamist/subscriptions",
            "organizations_url": "https://api.github.com/users/shalvamist/orgs",
            "repos_url": "https://api.github.com/users/shalvamist/repos",
            "events_url": "https://api.github.com/users/shalvamist/events{/privacy}",
            "received_events_url": "https://api.github.com/users/shalvamist/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-08-31T20:45:33Z",
        "updated_at": "2022-08-31T20:45:33Z",
        "author_association": "CONTRIBUTOR",
        "body": "Hey,\r\n\r\nSorry for the delay in response - I think I will need more info and maybe a updated script from your end to take this issue forward. \r\n\r\nI have been working on the script you shared trying to get it to run and generate the model you are using but I am having issues with running it. I had to change a few things to make it run but now it seems like there is an issue with the input/output expect dims. \r\n\r\nHere is my current version of the script - \r\nimport time\r\nfrom turtle import forward\r\nimport cv2\r\nimport onnx\r\nimport torch\r\nimport torchvision\r\nimport onnxruntime\r\nimport numpy as np\r\nimport torch.nn as nn\r\nfrom onnxsim import simplify\r\nimport torch.nn.functional as F\r\nfrom torchvision.transforms.functional import normalize\r\n\r\nclass MyModel(nn.Module):\r\n    def __init__(self):\r\n        super(MyModel,self).__init__()\r\n        self.backbone = torchvision.models.mobilenet_v3_large()\r\n        #del self.backbone.avgpool\r\n        #del self.backbone.classifier\r\n        self.b1 = nn.Sequential(self.backbone.features[0],self.backbone.features[1])\r\n        self.b2 = nn.Sequential(self.backbone.features[2],self.backbone.features[3])\r\n        self.b3 = nn.Sequential(self.backbone.features[4],self.backbone.features[5], self.backbone.features[6])\r\n        self.b4 = nn.Sequential(self.backbone.features[7],self.backbone.features[8], self.backbone.features[9], self.backbone.features[10],self.backbone.features[11], self.backbone.features[12], self.backbone.features[13],self.backbone.features[14], self.backbone.features[15], self.backbone.features[16])\r\n\r\n    def forward(self, x):\r\n        f1 = self.backbone(x)\r\n        f2 = self.b2(f1)  # 1, 24, 60, 80\r\n        f3 = self.b3(f2)  # 1,40,30,40\r\n        f4 = self.b4(f3)\r\n        return f1\r\n\r\nclass MyHardswish(torch.nn.Module):\r\n    # @staticmethod\r\n    def forward(self, x):\r\n        return x * F.hardtanh(x + 3, 0., 6.) / 6.\r\n\r\nclass MyHardsigmoid(torch.nn.Module):\r\n    # @staticmethod\r\n    def forward(self, x):\r\n        return F.relu6(x + 3., inplace=True) / 6.\r\n\r\ndef _set_module(model, submodule_key,   ):\r\n    tokens = submodule_key.split('.')\r\n    sub_tokens = tokens[:-1]\r\n    cur_mod = model\r\n\r\n    for s in sub_tokens:\r\n        cur_mod = getattr(cur_mod, s)\r\n        setattr(cur_mod, tokens[-1], module)\r\n\r\nmodel = MyModel()\r\nmodel.eval()\r\n\r\ninput = torch.randn(1, 3, 240, 360)\r\noutput = model(input)\r\n\r\nfor k, m in model.named_modules():\r\n    if isinstance(m, torch.nn.Hardswish):\r\n        _set_module(model, k, MyHardswish())\r\n    if isinstance(m, torch.nn.Hardsigmoid):\r\n        _set_module(model, k, MyHardsigmoid())\r\n\r\ntorch.onnx.export(\r\n    model,\r\n    (input),\r\n    f='test.onnx',\r\n    opset_version=12,\r\n    input_names=['input'],\r\n    output_names=['output'],\r\n)\r\n\r\nThe error I get is - \r\nRuntimeError: Expected 3D (unbatched) or 4D (batched) input to conv2d, but got input of size: [1, 1000]\r\n\r\nCan you please share the script and env you are using ? it might be torch version difference as well. Also if you can share the html file you are using for loading the model to the browser it will be best so I will have the means to follow your steps and reproduce the issue.\r\n\r\nThanks",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1233403682/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1234037585",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12609#issuecomment-1234037585",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12609",
        "id": 1234037585,
        "node_id": "IC_kwDOCVq1mM5JjetR",
        "user": {
            "login": "yufengyao-lingoace",
            "id": 92853025,
            "node_id": "U_kgDOBYjTIQ",
            "avatar_url": "https://avatars.githubusercontent.com/u/92853025?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufengyao-lingoace",
            "html_url": "https://github.com/yufengyao-lingoace",
            "followers_url": "https://api.github.com/users/yufengyao-lingoace/followers",
            "following_url": "https://api.github.com/users/yufengyao-lingoace/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufengyao-lingoace/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufengyao-lingoace/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufengyao-lingoace/subscriptions",
            "organizations_url": "https://api.github.com/users/yufengyao-lingoace/orgs",
            "repos_url": "https://api.github.com/users/yufengyao-lingoace/repos",
            "events_url": "https://api.github.com/users/yufengyao-lingoace/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufengyao-lingoace/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-01T09:50:15Z",
        "updated_at": "2022-09-01T11:27:56Z",
        "author_association": "NONE",
        "body": "Thanks for your reply, below is my  javascript code. The main function is detect().:\r\n\r\n<!DOCTYPE html>\r\n<html>\r\n<meta http-equiv=Content-Type content=\"text/html; charset=utf-8\">\r\n\r\n<head>\r\n    <title>test</title>\r\n    <style>\r\n        body {\r\n            background-color: rgb(40, 40, 40);\r\n            padding-top: 100px;\r\n        }\r\n\r\n        #main_canvas {\r\n            display: block;\r\n            margin: 0 auto;\r\n            border: 1px solid red;\r\n        }\r\n\r\n        #btn-div {\r\n            padding-top: 10px;\r\n            width: 170px;\r\n            display: block;\r\n            margin: 0 auto;\r\n        }\r\n    </style>\r\n</head>\r\n\r\n<body>\r\n    <video width=\"640\" height=\"480\" hidden></video>\r\n    <canvas width=\"320\" height=\"240\" hidden></canvas>\r\n    <canvas id=\"main_canvas\" width=\"320\" height=\"240\"></canvas>\r\n    <div id=\"btn-div\">\r\n        <button id=\"start\" style=\"width:80px;height:25px;\">open</button>\r\n        <button id=\"snap\" style=\"width:80px;height:25px;\" hidden>clip</button>\r\n        <button id=\"close\" style=\"width:80px;height:25px;\">close</button>\r\n    </div>\r\n\r\n    <script src=\"https://cdn.bootcdn.net/ajax/libs/onnxruntime-web/1.12.1/ort.js\"></script>\r\n    \r\n    <script src=\"js/opencv.js\"></script>\r\n    <script>\r\n        var canvas = document.getElementsByTagName('canvas')[0],\r\n            canvas1 = document.getElementsByTagName('canvas')[1],\r\n            context = canvas.getContext('2d'),\r\n            video = document.getElementsByTagName(\"video\")[0],\r\n            snap = document.getElementById(\"snap\"),\r\n            close = document.getElementById(\"close\"),\r\n            start = document.getElementById(\"start\"),\r\n            MediaStreamTrack,\r\n            session_face,\r\n            session_facepoints98,\r\n            cv2;\r\n\r\n        var scaled_size = [320, 240];\r\n\r\n        var init_model = async function () {\r\n            options = {\r\n                executionProviders: ['wasm'],\r\n                // executionProviders: ['webgl'],\r\n\r\n            };\r\n            session = await ort.InferenceSession.create('./weights/test.onnx', options); \r\n            cv2 = await cv; //加载opencv\r\n        }\r\n\r\n\r\n        var detect = async function () {\r\n            let imgData = context.getImageData(0, 0, 320, 240);\r\n            var frame = cv2.matFromImageData(imgData);\r\n\r\n            let dsize = new cv2.Size(320, 240);\r\n            let frame_rgba = new cv2.Mat();\r\n\r\n            cv2.resize(frame, frame_rgba, dsize, 0, 0, cv2.INTER_CUBIC);\r\n            frame.delete();\r\n            let frame_rgb = new cv2.Mat();\r\n            cv2.cvtColor(frame_rgba, frame_rgb, cv2.COLOR_RGBA2RGB); \r\n            let data = frame_rgb.data;\r\n            let new_Data = new Float32Array(3 * scaled_size[0] * scaled_size[1]);\r\n            let index = 0;\r\n            for (let i = 0; i < data.length; i += 3) { \r\n                new_Data[index] = data[i] / 255;\r\n                index++;\r\n            }\r\n            for (let i = 1; i < data.length; i += 3) {\r\n                new_Data[index] = data[i] / 255;\r\n                index++;\r\n            }\r\n            for (let i = 2; i < data.length; i += 3) {\r\n                new_Data[index] = data[i] / 255;\r\n                index++;\r\n            }\r\n\r\n            let input = new ort.Tensor('float32', new_Data, [1, 3, scaled_size[1], scaled_size[0]]);\r\n\r\n            let feeds = {\r\n                \"input\": input,\r\n            }\r\n            var old_date = new Date();\r\n            const results = await session.run(feeds); \r\n            var new_date = new Date();\r\n            let fps = (1000 / (new_date - old_date)).toFixed(4);\r\n            cv2.putText(frame_rgba, \"fps: \" + fps.toString(), new cv2.Point(10, 20), cv2.FONT_HERSHEY_PLAIN, 1, new cv2.Scalar(255, 0, 0, 255), 2);\r\n            cv2.imshow(canvas1, frame_rgba);\r\n            frame_rgb.delete();\r\n            frame_back.delete();\r\n            frame_rgba.delete();\r\n        }\r\n\r\n\r\n        window.onload = function () {\r\n            init_model(); \r\n\r\n            start.addEventListener('click', function () {\r\n                if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n                    navigator.mediaDevices.getUserMedia({\r\n                        video: true,\r\n                        audio: false\r\n                    }).then(function (stream) {\r\n                        MediaStreamTrack = typeof stream.stop === 'function' ? stream : stream.getTracks()[1];\r\n                        video.srcObject = stream;\r\n                        video.play();\r\n\r\n                        setInterval(function () {\r\n                            try {\r\n                                context.drawImage(video, 0, 0, 640, 480, 0, 0, 320, 240);\r\n                                detect();\r\n                            }\r\n                            catch (ex) {\r\n                                console.log(ex);\r\n                            }\r\n                        }, 10);\r\n                    }).catch(function (err) {\r\n                        console.log(err);\r\n                    });\r\n\r\n\r\n\r\n                }\r\n            });\r\n            close.addEventListener('click', function () {\r\n                MediaStreamTrack && MediaStreamTrack.stop();\r\n            });\r\n        }\r\n\r\n    </script>\r\n</body>\r\n\r\n</html>\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1234037585/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1234088490",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12609#issuecomment-1234088490",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12609",
        "id": 1234088490,
        "node_id": "IC_kwDOCVq1mM5JjrIq",
        "user": {
            "login": "yufengyao-lingoace",
            "id": 92853025,
            "node_id": "U_kgDOBYjTIQ",
            "avatar_url": "https://avatars.githubusercontent.com/u/92853025?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufengyao-lingoace",
            "html_url": "https://github.com/yufengyao-lingoace",
            "followers_url": "https://api.github.com/users/yufengyao-lingoace/followers",
            "following_url": "https://api.github.com/users/yufengyao-lingoace/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufengyao-lingoace/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufengyao-lingoace/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufengyao-lingoace/subscriptions",
            "organizations_url": "https://api.github.com/users/yufengyao-lingoace/orgs",
            "repos_url": "https://api.github.com/users/yufengyao-lingoace/repos",
            "events_url": "https://api.github.com/users/yufengyao-lingoace/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufengyao-lingoace/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-01T10:37:10Z",
        "updated_at": "2022-09-01T10:43:20Z",
        "author_association": "NONE",
        "body": "Hi, I tried your code, and found a difference(the problem is not related to the environment of pyhton or torch ):\r\n\r\nthe right code is:\r\ndef forward(self, x):\r\n    f1 = self.b1(x)\r\n\r\nbut yours is:\r\ndef forward(self, x):\r\n    f1 = self.backbone(x)\r\n\r\njust change self.backbone to self.b1 and then can export the onnx file. The above is my javascript code, you can try to use that. Thanks very much!\r\n\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1234088490/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1241313665",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12609#issuecomment-1241313665",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12609",
        "id": 1241313665,
        "node_id": "IC_kwDOCVq1mM5J_PGB",
        "user": {
            "login": "shalvamist",
            "id": 94086448,
            "node_id": "U_kgDOBZulMA",
            "avatar_url": "https://avatars.githubusercontent.com/u/94086448?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/shalvamist",
            "html_url": "https://github.com/shalvamist",
            "followers_url": "https://api.github.com/users/shalvamist/followers",
            "following_url": "https://api.github.com/users/shalvamist/following{/other_user}",
            "gists_url": "https://api.github.com/users/shalvamist/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/shalvamist/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/shalvamist/subscriptions",
            "organizations_url": "https://api.github.com/users/shalvamist/orgs",
            "repos_url": "https://api.github.com/users/shalvamist/repos",
            "events_url": "https://api.github.com/users/shalvamist/events{/privacy}",
            "received_events_url": "https://api.github.com/users/shalvamist/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-08T22:51:30Z",
        "updated_at": "2022-09-08T22:54:50Z",
        "author_association": "CONTRIBUTOR",
        "body": "Hey,\r\n\r\nThanks for the response - I was able to generate the two models and test them with random inputs.\r\nHere is the code - \r\n\r\n```\r\n<script` src=\"https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js\"></script>\r\n<script>\r\n   // use an async context to call onnxruntime functions.\r\n   async function main() {\r\n        try{\r\n            document.write(`init model`);\r\n            session = await ort.InferenceSession.create('./test_fast.onnx'); \r\n            console.log(session);\r\n\r\n            // prepare inputs. a tensor need its corresponding TypedArray as data\r\n            var scaled_size = [360, 240];\r\n            let fps=0;\r\n            for (let i = 0; i < 50; i++) {\r\n\r\n                let new_Data = new Float32Array(3 * scaled_size[0] * scaled_size[1],() => Math.floor(Math.random() * 256));\r\n                \r\n                let input = new ort.Tensor('float32', new_Data, [1, 3, scaled_size[1], scaled_size[0]]);\r\n\r\n                let feeds = {\r\n                    \"input\": input,\r\n                }\r\n                // prepare feeds. use model input names as keys.\r\n\r\n                // feed inputs and run\r\n                var old_date = new Date();\r\n                const results = await session.run(feeds); \r\n                var new_date = new Date();\r\n\r\n                fps = fps+(new_date - old_date);\r\n\r\n            }\r\n            \r\n            document.write(`FPS: ${(1000 / (fps/50)).toFixed(4)}`);\r\n\r\n        } catch (e) {\r\n\r\n            console.log(e);\r\n            document.write(`failed to inference ONNX model: ${e}.`);\r\n        }\r\n    }\r\n    main();\r\n</script>\r\n```\r\n\r\nThe two versions of the models were able to get about the same amount of FPS for a 50 inference run - ~17 FPS. I couldn't see any major difference between them. Can you please try this on your end ?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1241313665/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1244838021",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12609#issuecomment-1244838021",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12609",
        "id": 1244838021,
        "node_id": "IC_kwDOCVq1mM5KMriF",
        "user": {
            "login": "yufengyao-lingoace",
            "id": 92853025,
            "node_id": "U_kgDOBYjTIQ",
            "avatar_url": "https://avatars.githubusercontent.com/u/92853025?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufengyao-lingoace",
            "html_url": "https://github.com/yufengyao-lingoace",
            "followers_url": "https://api.github.com/users/yufengyao-lingoace/followers",
            "following_url": "https://api.github.com/users/yufengyao-lingoace/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufengyao-lingoace/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufengyao-lingoace/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufengyao-lingoace/subscriptions",
            "organizations_url": "https://api.github.com/users/yufengyao-lingoace/orgs",
            "repos_url": "https://api.github.com/users/yufengyao-lingoace/repos",
            "events_url": "https://api.github.com/users/yufengyao-lingoace/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufengyao-lingoace/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-13T03:07:08Z",
        "updated_at": "2022-09-15T01:50:11Z",
        "author_association": "NONE",
        "body": "Hi, Thank you for you test. I tried my code again, and when use **wasm** mode,  I get 17fps for the two models as the same as you. But when I use **webgl** mode,  the model(return f1,f2,f3,f4) got only 8 fps, and the model(return f4) got 30fps. It seems that this problem is only shown in webgl mode.  Return f4 is four times faster than return f1,f2,f3,f4. Please try this code again. Thanks very much!\r\noptions = {\r\n                executionProviders: ['webgl'],\r\n            };\r\n            session = await ort.InferenceSession.create('./weights/test-fast.onnx', options);\r\nMy test computer is :\r\nMacBook Pro (13-inch, 2020, Four Thunderbolt 3 ports) \r\nIntel Iris Plus Graphics 1536 MB\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1244838021/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1247134763",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12609#issuecomment-1247134763",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12609",
        "id": 1247134763,
        "node_id": "IC_kwDOCVq1mM5KVcQr",
        "user": {
            "login": "shalvamist",
            "id": 94086448,
            "node_id": "U_kgDOBZulMA",
            "avatar_url": "https://avatars.githubusercontent.com/u/94086448?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/shalvamist",
            "html_url": "https://github.com/shalvamist",
            "followers_url": "https://api.github.com/users/shalvamist/followers",
            "following_url": "https://api.github.com/users/shalvamist/following{/other_user}",
            "gists_url": "https://api.github.com/users/shalvamist/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/shalvamist/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/shalvamist/subscriptions",
            "organizations_url": "https://api.github.com/users/shalvamist/orgs",
            "repos_url": "https://api.github.com/users/shalvamist/repos",
            "events_url": "https://api.github.com/users/shalvamist/events{/privacy}",
            "received_events_url": "https://api.github.com/users/shalvamist/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-14T18:12:52Z",
        "updated_at": "2022-09-14T18:12:52Z",
        "author_association": "CONTRIBUTOR",
        "body": "Hey,\r\n\r\nThanks for pointing this out - Indeed I see a big difference between the two models under webgl.\r\nOn the \"fast model\" I can get ~11-12 FPS\r\nOn the \"slow\" model I am getting ~6 FPS\r\n\r\nI will investigate a bit more and update you with my findings.\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1247134763/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1252911984",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12609#issuecomment-1252911984",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12609",
        "id": 1252911984,
        "node_id": "IC_kwDOCVq1mM5Kretw",
        "user": {
            "login": "shalvamist",
            "id": 94086448,
            "node_id": "U_kgDOBZulMA",
            "avatar_url": "https://avatars.githubusercontent.com/u/94086448?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/shalvamist",
            "html_url": "https://github.com/shalvamist",
            "followers_url": "https://api.github.com/users/shalvamist/followers",
            "following_url": "https://api.github.com/users/shalvamist/following{/other_user}",
            "gists_url": "https://api.github.com/users/shalvamist/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/shalvamist/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/shalvamist/subscriptions",
            "organizations_url": "https://api.github.com/users/shalvamist/orgs",
            "repos_url": "https://api.github.com/users/shalvamist/repos",
            "events_url": "https://api.github.com/users/shalvamist/events{/privacy}",
            "received_events_url": "https://api.github.com/users/shalvamist/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-20T21:06:06Z",
        "updated_at": "2022-09-20T21:06:06Z",
        "author_association": "CONTRIBUTOR",
        "body": "Hi,\r\n\r\nSorry for a long wait on this issue. We had a few discussions on the topic and it looks like the performance degradation is due to the data transfer from GPU <-> CPU. This also coincides with the analysis we performed, we found that the more outputs are defined the more performance degradation we see. There are a few ways we can mitigate this performance loss but it will require some effort and most likely an output stacking feature to be implemented. \r\n\r\nAs of now we don't have this feature planned on our road map but we took note and once resources free-up (or demand for this feature will increased) we'll revisit the implementation plan.\r\n\r\nHope this answer is suitable for you as of now. Please let me know if you have any comments.\r\n\r\nThanks",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1252911984/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1255829119",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12609#issuecomment-1255829119",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12609",
        "id": 1255829119,
        "node_id": "IC_kwDOCVq1mM5K2m5_",
        "user": {
            "login": "yufengyao-lingoace",
            "id": 92853025,
            "node_id": "U_kgDOBYjTIQ",
            "avatar_url": "https://avatars.githubusercontent.com/u/92853025?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufengyao-lingoace",
            "html_url": "https://github.com/yufengyao-lingoace",
            "followers_url": "https://api.github.com/users/yufengyao-lingoace/followers",
            "following_url": "https://api.github.com/users/yufengyao-lingoace/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufengyao-lingoace/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufengyao-lingoace/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufengyao-lingoace/subscriptions",
            "organizations_url": "https://api.github.com/users/yufengyao-lingoace/orgs",
            "repos_url": "https://api.github.com/users/yufengyao-lingoace/repos",
            "events_url": "https://api.github.com/users/yufengyao-lingoace/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufengyao-lingoace/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-23T06:04:06Z",
        "updated_at": "2022-09-23T06:04:15Z",
        "author_association": "NONE",
        "body": "Thanks very much. With the problem found out, I will try a stacking feature in my model. Thanks again. With best wishes.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1255829119/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1330034808",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12609#issuecomment-1330034808",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12609",
        "id": 1330034808,
        "node_id": "IC_kwDOCVq1mM5PRrh4",
        "user": {
            "login": "liuyingbin123",
            "id": 40049781,
            "node_id": "MDQ6VXNlcjQwMDQ5Nzgx",
            "avatar_url": "https://avatars.githubusercontent.com/u/40049781?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/liuyingbin123",
            "html_url": "https://github.com/liuyingbin123",
            "followers_url": "https://api.github.com/users/liuyingbin123/followers",
            "following_url": "https://api.github.com/users/liuyingbin123/following{/other_user}",
            "gists_url": "https://api.github.com/users/liuyingbin123/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/liuyingbin123/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/liuyingbin123/subscriptions",
            "organizations_url": "https://api.github.com/users/liuyingbin123/orgs",
            "repos_url": "https://api.github.com/users/liuyingbin123/repos",
            "events_url": "https://api.github.com/users/liuyingbin123/events{/privacy}",
            "received_events_url": "https://api.github.com/users/liuyingbin123/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-11-29T03:43:29Z",
        "updated_at": "2022-11-29T03:43:29Z",
        "author_association": "NONE",
        "body": "same problem,i have 5 outputs for my model,wasm is much faster than webgl",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1330034808/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]