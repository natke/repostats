[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/961697707",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9667#issuecomment-961697707",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9667",
        "id": 961697707,
        "node_id": "IC_kwDOCVq1mM45Uler",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-11-05T08:07:37Z",
        "updated_at": "2021-11-05T08:07:37Z",
        "author_association": "MEMBER",
        "body": "@asr-pub, what OS and python environment are you using?\r\n\r\nI guess time.sleep behavior might be different in different python environment (like Jupyter notebook) or OS. The only explanation is that the sleep will notify OS to suspend current process, but there is some delay that OS actually suspend current process. Sometime, the line of t_start is executed when ort_sess.run is suspended. That will cause part of sleep time is included in elapsed time.\r\n\r\nI tried add an option --sleep to benchmark.py (see https://github.com/microsoft/onnxruntime/tree/tlwu/benchmark_sleep_time). Example command line to run:\r\n```\r\npython benchmark.py -m bert-base-cased -e onnxruntime -g -p fp32 -o -i 3 -t 100 -b 1 -s 32 -n 6 --sleep 5\r\n```\r\n\r\nIn Windows, sleep causes PyTorch average latency on bert base model increased from 18.49 => 59.54 ms (variance from 0.02 => 0.45), and OnnxRuntime average latency increased from 9.00 => 35.41 ms (variance from 0 => 0.24). We can see that PyTorch and OnnxRuntime has similar trend, and variance is small.\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/961697707/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/962613292",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9667#issuecomment-962613292",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9667",
        "id": 962613292,
        "node_id": "IC_kwDOCVq1mM45YFAs",
        "user": {
            "login": "asr-pub",
            "id": 22003430,
            "node_id": "MDQ6VXNlcjIyMDAzNDMw",
            "avatar_url": "https://avatars.githubusercontent.com/u/22003430?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/asr-pub",
            "html_url": "https://github.com/asr-pub",
            "followers_url": "https://api.github.com/users/asr-pub/followers",
            "following_url": "https://api.github.com/users/asr-pub/following{/other_user}",
            "gists_url": "https://api.github.com/users/asr-pub/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/asr-pub/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/asr-pub/subscriptions",
            "organizations_url": "https://api.github.com/users/asr-pub/orgs",
            "repos_url": "https://api.github.com/users/asr-pub/repos",
            "events_url": "https://api.github.com/users/asr-pub/events{/privacy}",
            "received_events_url": "https://api.github.com/users/asr-pub/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-11-07T13:45:46Z",
        "updated_at": "2021-11-07T13:45:46Z",
        "author_association": "NONE",
        "body": "> @asr-pub, what OS and python environment are you using?\r\n> \r\n> I guess time.sleep behavior might be different in different python environment (like Jupyter notebook) or OS. The only explanation is that the sleep will notify OS to suspend current process, but there is some delay that OS actually suspend current process. Sometime, the line of t_start is executed when ort_sess.run is suspended. That will cause part of sleep time is included in elapsed time.\r\n> \r\n> I tried add an option --sleep to benchmark.py (see https://github.com/microsoft/onnxruntime/tree/tlwu/benchmark_sleep_time). Example command line to run:\r\n> \r\n> ```\r\n> python benchmark.py -m bert-base-cased -e onnxruntime -g -p fp32 -o -i 3 -t 100 -b 1 -s 32 -n 6 --sleep 5\r\n> ```\r\n> \r\n> In Windows, sleep causes PyTorch average latency on bert base model increased from 18.49 => 59.54 ms (variance from 0.02 => 0.45), and OnnxRuntime average latency increased from 9.00 => 35.41 ms (variance from 0 => 0.24). We can see that PyTorch and OnnxRuntime has similar trend, and variance is small.\r\n\r\nHello tianleiwu, Thank u for replying.\r\nMy OS and Python env is:\r\n```shell\r\nCentOS Linux release 7.6.1810 (Core)\r\nPython 3.9.6 (default, Aug 18 2021, 19:38:01)\r\n[GCC 7.5.0] :: Anaconda, Inc. on linux\r\n```\r\n\r\nWith out time.sleep(), do you have any other method to measure the inference time ? Maybe I can use the Flask app to server the onnx model, measure the inference time in the client side.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/962613292/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1000526256",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9667#issuecomment-1000526256",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9667",
        "id": 1000526256,
        "node_id": "IC_kwDOCVq1mM47otGw",
        "user": {
            "login": "CarlPoirier",
            "id": 5577772,
            "node_id": "MDQ6VXNlcjU1Nzc3NzI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5577772?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/CarlPoirier",
            "html_url": "https://github.com/CarlPoirier",
            "followers_url": "https://api.github.com/users/CarlPoirier/followers",
            "following_url": "https://api.github.com/users/CarlPoirier/following{/other_user}",
            "gists_url": "https://api.github.com/users/CarlPoirier/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/CarlPoirier/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/CarlPoirier/subscriptions",
            "organizations_url": "https://api.github.com/users/CarlPoirier/orgs",
            "repos_url": "https://api.github.com/users/CarlPoirier/repos",
            "events_url": "https://api.github.com/users/CarlPoirier/events{/privacy}",
            "received_events_url": "https://api.github.com/users/CarlPoirier/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-12-23T21:14:14Z",
        "updated_at": "2021-12-23T21:15:32Z",
        "author_association": "CONTRIBUTOR",
        "body": "@asr-pub Which execution provider are you using? Did you try to profile the execution?\r\n\r\nI have a similar problem myself with another model and the CUDA execution provider. In some cases, I see the execution launch is delayed by as much as its entire runtime!\r\n\r\n![image](https://user-images.githubusercontent.com/5577772/147291931-98d1eb9a-0d55-43f1-bf14-e08c79616d6b.png)\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1000526256/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1100834455",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9667#issuecomment-1100834455",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9667",
        "id": 1100834455,
        "node_id": "IC_kwDOCVq1mM5BnWaX",
        "user": {
            "login": "stale[bot]",
            "id": 26384082,
            "node_id": "MDM6Qm90MjYzODQwODI=",
            "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stale%5Bbot%5D",
            "html_url": "https://github.com/apps/stale",
            "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
            "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
            "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
            "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
            "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
            "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
            "type": "Bot",
            "site_admin": false
        },
        "created_at": "2022-04-17T08:54:04Z",
        "updated_at": "2022-04-17T08:54:04Z",
        "author_association": "NONE",
        "body": "This issue has been automatically marked as stale due to inactivity and will be closed in 7 days if no further activity occurs. If further support is needed, please provide an update and/or more details.\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1100834455/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]