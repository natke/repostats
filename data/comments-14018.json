[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1357805007",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14018#issuecomment-1357805007",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14018",
        "id": 1357805007,
        "node_id": "IC_kwDOCVq1mM5Q7nXP",
        "user": {
            "login": "wejoncy",
            "id": 9417365,
            "node_id": "MDQ6VXNlcjk0MTczNjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/9417365?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/wejoncy",
            "html_url": "https://github.com/wejoncy",
            "followers_url": "https://api.github.com/users/wejoncy/followers",
            "following_url": "https://api.github.com/users/wejoncy/following{/other_user}",
            "gists_url": "https://api.github.com/users/wejoncy/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/wejoncy/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/wejoncy/subscriptions",
            "organizations_url": "https://api.github.com/users/wejoncy/orgs",
            "repos_url": "https://api.github.com/users/wejoncy/repos",
            "events_url": "https://api.github.com/users/wejoncy/events{/privacy}",
            "received_events_url": "https://api.github.com/users/wejoncy/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-12-19T15:05:53Z",
        "updated_at": "2022-12-19T15:05:53Z",
        "author_association": "MEMBER",
        "body": "HI. Would you mind sharing the model file? so we can reproduce this. Thanks",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1357805007/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1359031795",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14018#issuecomment-1359031795",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14018",
        "id": 1359031795,
        "node_id": "IC_kwDOCVq1mM5RAS3z",
        "user": {
            "login": "wizardk",
            "id": 20595052,
            "node_id": "MDQ6VXNlcjIwNTk1MDUy",
            "avatar_url": "https://avatars.githubusercontent.com/u/20595052?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/wizardk",
            "html_url": "https://github.com/wizardk",
            "followers_url": "https://api.github.com/users/wizardk/followers",
            "following_url": "https://api.github.com/users/wizardk/following{/other_user}",
            "gists_url": "https://api.github.com/users/wizardk/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/wizardk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/wizardk/subscriptions",
            "organizations_url": "https://api.github.com/users/wizardk/orgs",
            "repos_url": "https://api.github.com/users/wizardk/repos",
            "events_url": "https://api.github.com/users/wizardk/events{/privacy}",
            "received_events_url": "https://api.github.com/users/wizardk/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-12-20T09:01:03Z",
        "updated_at": "2022-12-20T09:01:03Z",
        "author_association": "NONE",
        "body": "Hi @wejoncy , there are 6 models executed sequentially. If I test each model separately, there is no problem. If I call each model in the process order for testing, problems will occur.\r\n\r\nI'll try and see if I can provide you with reproducible minimum code.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1359031795/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1371370923",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14018#issuecomment-1371370923",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14018",
        "id": 1371370923,
        "node_id": "IC_kwDOCVq1mM5RvXWr",
        "user": {
            "login": "RandySheriffH",
            "id": 48490400,
            "node_id": "MDQ6VXNlcjQ4NDkwNDAw",
            "avatar_url": "https://avatars.githubusercontent.com/u/48490400?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/RandySheriffH",
            "html_url": "https://github.com/RandySheriffH",
            "followers_url": "https://api.github.com/users/RandySheriffH/followers",
            "following_url": "https://api.github.com/users/RandySheriffH/following{/other_user}",
            "gists_url": "https://api.github.com/users/RandySheriffH/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/RandySheriffH/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/RandySheriffH/subscriptions",
            "organizations_url": "https://api.github.com/users/RandySheriffH/orgs",
            "repos_url": "https://api.github.com/users/RandySheriffH/repos",
            "events_url": "https://api.github.com/users/RandySheriffH/events{/privacy}",
            "received_events_url": "https://api.github.com/users/RandySheriffH/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-04T20:12:15Z",
        "updated_at": "2023-01-04T20:14:44Z",
        "author_association": "MEMBER",
        "body": "@wizardk: in your case you might well wish to use global instead of session thread pool. \r\nWith the latter you will have 6 thread pools created with each has 1 thread - further since u explicitly set the intra thread number, ort will not set thread affinity, so os are freely switching them among all your 4 cores causing higher cache miss rate.\r\nHere's sample [usage](https://github.com/microsoft/onnxruntime/blob/821baa5b839b04581ab9b7a8b8cd44bb5b002c5a/onnxruntime/test/global_thread_pools/test_main.cc#L73) for global thread pool.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1371370923/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1375199050",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14018#issuecomment-1375199050",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14018",
        "id": 1375199050,
        "node_id": "IC_kwDOCVq1mM5R999K",
        "user": {
            "login": "wizardk",
            "id": 20595052,
            "node_id": "MDQ6VXNlcjIwNTk1MDUy",
            "avatar_url": "https://avatars.githubusercontent.com/u/20595052?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/wizardk",
            "html_url": "https://github.com/wizardk",
            "followers_url": "https://api.github.com/users/wizardk/followers",
            "following_url": "https://api.github.com/users/wizardk/following{/other_user}",
            "gists_url": "https://api.github.com/users/wizardk/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/wizardk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/wizardk/subscriptions",
            "organizations_url": "https://api.github.com/users/wizardk/orgs",
            "repos_url": "https://api.github.com/users/wizardk/repos",
            "events_url": "https://api.github.com/users/wizardk/events{/privacy}",
            "received_events_url": "https://api.github.com/users/wizardk/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-09T07:20:18Z",
        "updated_at": "2023-01-09T07:20:39Z",
        "author_association": "NONE",
        "body": "> \r\n\r\n\r\n\r\n> @wizardk: in your case you might well wish to use global instead of session thread pool. With the latter you will have 6 thread pools created with each has 1 thread - further since u explicitly set the intra thread number, ort will not set thread affinity, so os are freely switching them among all your 4 cores causing higher cache miss rate. Here's sample [usage](https://github.com/microsoft/onnxruntime/blob/821baa5b839b04581ab9b7a8b8cd44bb5b002c5a/onnxruntime/test/global_thread_pools/test_main.cc#L73) for global thread pool.\r\n\r\nHi @RandySheriffH , should the code be like this?\r\n```\r\n// set env\r\nstd::unique_ptr<Ort::Env> env;\r\nconst OrtApi* g_ort = OrtGetApiBase()->GetApi(ORT_API_VERSION);\r\nstd::unique_ptr<OrtStatus, decltype(OrtApi::ReleaseStatus)> st_ptr(nullptr, g_ort->ReleaseStatus);\r\nOrtThreadingOptions* tp_options;\r\nst_ptr.reset(g_ort->CreateThreadingOptions(&tp_options));\r\nst_ptr.reset(g_ort->SetGlobalSpinControl(tp_options, 0));\r\nst_ptr.reset(g_ort->SetGlobalIntraOpNumThreads(tp_options, 2));\r\nst_ptr.reset(g_ort->SetGlobalCustomCreateThreadFn(tp_options, CreateThreadCustomized));\r\nst_ptr.reset(g_ort->SetGlobalCustomThreadCreationOptions(tp_options, &custom_thread_creation_options));\r\nst_ptr.reset(g_ort->SetGlobalCustomJoinThreadFn(tp_options, JoinThreadCustomized));\r\nst_ptr.reset(g_ort->SetGlobalInterOpNumThreads(tp_options, 2));\r\nst_ptr.reset(g_ort->SetGlobalDenormalAsZero(tp_options));\r\nenv.reset(new Ort::Env(tp_options, ORT_LOGGING_LEVEL_FATAL, \"Default\"));\r\ng_ort->ReleaseThreadingOptions(tp_options);\r\n\r\n// create sessions\r\nOrt::SessionOptions sess_opt;\r\nOrt::Session* sess_mdl_0 = new Ort::Session(env, mdl_0_data, mdl_0_size, sess_opt);\r\nOrt::Session* sess_mdl_1 = new Ort::Session(env, mdl_1_data, mdl_1_size, sess_opt);\r\nOrt::Session* sess_mdl_2 = new Ort::Session(env, mdl_2_data, mdl_2_size, sess_opt);\r\nOrt::Session* sess_mdl_3 = new Ort::Session(env, mdl_3_data, mdl_3_size, sess_opt);\r\nOrt::Session* sess_mdl_4 = new Ort::Session(env, mdl_4_data, mdl_4_size, sess_opt);\r\nOrt::Session* sess_mdl_5 = new Ort::Session(env, mdl_5_data, mdl_5_size, sess_opt);\r\n\r\n// call sessions sequentially\r\n... = sess_mdl_0->Run(...);\r\n... = sess_mdl_1->Run(...);\r\n... = sess_mdl_2->Run(...);\r\n... = sess_mdl_3->Run(...);\r\n... = sess_mdl_4->Run(...);\r\n... = sess_mdl_5->Run(...);\r\n```\r\n\r\nI did this, but it didn't work.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1375199050/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378004010",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14018#issuecomment-1378004010",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14018",
        "id": 1378004010,
        "node_id": "IC_kwDOCVq1mM5SIqwq",
        "user": {
            "login": "RandySheriffH",
            "id": 48490400,
            "node_id": "MDQ6VXNlcjQ4NDkwNDAw",
            "avatar_url": "https://avatars.githubusercontent.com/u/48490400?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/RandySheriffH",
            "html_url": "https://github.com/RandySheriffH",
            "followers_url": "https://api.github.com/users/RandySheriffH/followers",
            "following_url": "https://api.github.com/users/RandySheriffH/following{/other_user}",
            "gists_url": "https://api.github.com/users/RandySheriffH/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/RandySheriffH/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/RandySheriffH/subscriptions",
            "organizations_url": "https://api.github.com/users/RandySheriffH/orgs",
            "repos_url": "https://api.github.com/users/RandySheriffH/repos",
            "events_url": "https://api.github.com/users/RandySheriffH/events{/privacy}",
            "received_events_url": "https://api.github.com/users/RandySheriffH/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-10T22:58:17Z",
        "updated_at": "2023-01-10T23:01:27Z",
        "author_association": "MEMBER",
        "body": "@wizardk: \r\nfor the session option you need to:\r\n\r\n```c++\r\nsess_opt.DisablePerSessionThreads()\r\n```\r\n\r\nAnd for global thread pool, you should be fine to only do:\r\n\r\n```c++\r\nst_ptr.reset(g_ort->CreateThreadingOptions(&tp_options));\r\nst_ptr.reset(g_ort->SetGlobalIntraOpNumThreads(tp_options, <num of thread you like>));\r\n```\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378004010/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378143517",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14018#issuecomment-1378143517",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14018",
        "id": 1378143517,
        "node_id": "IC_kwDOCVq1mM5SJM0d",
        "user": {
            "login": "wizardk",
            "id": 20595052,
            "node_id": "MDQ6VXNlcjIwNTk1MDUy",
            "avatar_url": "https://avatars.githubusercontent.com/u/20595052?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/wizardk",
            "html_url": "https://github.com/wizardk",
            "followers_url": "https://api.github.com/users/wizardk/followers",
            "following_url": "https://api.github.com/users/wizardk/following{/other_user}",
            "gists_url": "https://api.github.com/users/wizardk/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/wizardk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/wizardk/subscriptions",
            "organizations_url": "https://api.github.com/users/wizardk/orgs",
            "repos_url": "https://api.github.com/users/wizardk/repos",
            "events_url": "https://api.github.com/users/wizardk/events{/privacy}",
            "received_events_url": "https://api.github.com/users/wizardk/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-11T01:55:59Z",
        "updated_at": "2023-01-11T01:55:59Z",
        "author_association": "NONE",
        "body": "@RandySheriffH thanks a lot. I have a few more questions.\r\n\r\n1. `env.reset(new Ort::Env(tp_options, ORT_LOGGING_LEVEL_FATAL, \"Default\"));`\r\nIn this line, how can I just close the log?\r\n\r\n2. Is the session created through the global thread pool thread safe？\r\n\r\n3. In one process, can I create different global thread pools for different groups of models?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378143517/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]