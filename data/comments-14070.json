[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1366933457",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14070#issuecomment-1366933457",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14070",
        "id": 1366933457,
        "node_id": "IC_kwDOCVq1mM5Reb_R",
        "user": {
            "login": "wschin",
            "id": 3524474,
            "node_id": "MDQ6VXNlcjM1MjQ0NzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3524474?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/wschin",
            "html_url": "https://github.com/wschin",
            "followers_url": "https://api.github.com/users/wschin/followers",
            "following_url": "https://api.github.com/users/wschin/following{/other_user}",
            "gists_url": "https://api.github.com/users/wschin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/wschin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/wschin/subscriptions",
            "organizations_url": "https://api.github.com/users/wschin/orgs",
            "repos_url": "https://api.github.com/users/wschin/repos",
            "events_url": "https://api.github.com/users/wschin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/wschin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-12-28T21:49:33Z",
        "updated_at": "2022-12-28T21:49:33Z",
        "author_association": "MEMBER",
        "body": "It's a scalar so putting it on CPU is more reasonable. Say,\r\n```\r\nfloat cpu_float = 2.0;\r\nfloat* cpu_ptr = &cpu_float;\r\ncudaMalloc(&gpu_ptr, sizeof(float));\r\ncudaMemcpy(&gpu_ptr, &cpu_ptr, cudaMemcpyHostToDevice);\r\ncuda_resize(..., gpu_ptr, ...);\r\n```\r\n\r\nis way more expensive than\r\n\r\n```\r\nfloat cpu_float = 2.0;\r\ncuda_resize<<<...>>>(..., cpu_float, ...);\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1366933457/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1366933688",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14070#issuecomment-1366933688",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14070",
        "id": 1366933688,
        "node_id": "IC_kwDOCVq1mM5RecC4",
        "user": {
            "login": "wschin",
            "id": 3524474,
            "node_id": "MDQ6VXNlcjM1MjQ0NzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3524474?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/wschin",
            "html_url": "https://github.com/wschin",
            "followers_url": "https://api.github.com/users/wschin/followers",
            "following_url": "https://api.github.com/users/wschin/following{/other_user}",
            "gists_url": "https://api.github.com/users/wschin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/wschin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/wschin/subscriptions",
            "organizations_url": "https://api.github.com/users/wschin/orgs",
            "repos_url": "https://api.github.com/users/wschin/repos",
            "events_url": "https://api.github.com/users/wschin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/wschin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-12-28T21:50:12Z",
        "updated_at": "2022-12-28T21:50:12Z",
        "author_association": "MEMBER",
        "body": "Feel free to reopen if any concerns.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1366933688/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1396595231",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14070#issuecomment-1396595231",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14070",
        "id": 1396595231,
        "node_id": "IC_kwDOCVq1mM5TPlof",
        "user": {
            "login": "DennisJcy",
            "id": 106725464,
            "node_id": "U_kgDOBlyAWA",
            "avatar_url": "https://avatars.githubusercontent.com/u/106725464?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/DennisJcy",
            "html_url": "https://github.com/DennisJcy",
            "followers_url": "https://api.github.com/users/DennisJcy/followers",
            "following_url": "https://api.github.com/users/DennisJcy/following{/other_user}",
            "gists_url": "https://api.github.com/users/DennisJcy/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/DennisJcy/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/DennisJcy/subscriptions",
            "organizations_url": "https://api.github.com/users/DennisJcy/orgs",
            "repos_url": "https://api.github.com/users/DennisJcy/repos",
            "events_url": "https://api.github.com/users/DennisJcy/events{/privacy}",
            "received_events_url": "https://api.github.com/users/DennisJcy/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-19T08:16:56Z",
        "updated_at": "2023-01-19T08:16:56Z",
        "author_association": "NONE",
        "body": "Sorry,i may understand a little.But is there a way to binding data to cuda with ONNX API?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1396595231/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1398879328",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14070#issuecomment-1398879328",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14070",
        "id": 1398879328,
        "node_id": "IC_kwDOCVq1mM5TYTRg",
        "user": {
            "login": "natke",
            "id": 3302433,
            "node_id": "MDQ6VXNlcjMzMDI0MzM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3302433?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/natke",
            "html_url": "https://github.com/natke",
            "followers_url": "https://api.github.com/users/natke/followers",
            "following_url": "https://api.github.com/users/natke/following{/other_user}",
            "gists_url": "https://api.github.com/users/natke/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/natke/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/natke/subscriptions",
            "organizations_url": "https://api.github.com/users/natke/orgs",
            "repos_url": "https://api.github.com/users/natke/repos",
            "events_url": "https://api.github.com/users/natke/events{/privacy}",
            "received_events_url": "https://api.github.com/users/natke/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-20T20:12:06Z",
        "updated_at": "2023-01-20T20:12:06Z",
        "author_association": "MEMBER",
        "body": "Yes, there is. Please have a look at the IO Binding API documentation: \nhttps://onnxruntime.ai/docs/api/python/api_summary.html#data-on-device\nhttps://onnxruntime.ai/docs/api/python/api_summary.html#iobinding\n\nAnd samples here: https://github.com/microsoft/onnxruntime-inference-examples/blob/main/python/api/onnxruntime-python-api.py\n\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1398879328/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1464949518",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14070#issuecomment-1464949518",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14070",
        "id": 1464949518,
        "node_id": "IC_kwDOCVq1mM5XUVsO",
        "user": {
            "login": "DennisJcy",
            "id": 106725464,
            "node_id": "U_kgDOBlyAWA",
            "avatar_url": "https://avatars.githubusercontent.com/u/106725464?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/DennisJcy",
            "html_url": "https://github.com/DennisJcy",
            "followers_url": "https://api.github.com/users/DennisJcy/followers",
            "following_url": "https://api.github.com/users/DennisJcy/following{/other_user}",
            "gists_url": "https://api.github.com/users/DennisJcy/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/DennisJcy/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/DennisJcy/subscriptions",
            "organizations_url": "https://api.github.com/users/DennisJcy/orgs",
            "repos_url": "https://api.github.com/users/DennisJcy/repos",
            "events_url": "https://api.github.com/users/DennisJcy/events{/privacy}",
            "received_events_url": "https://api.github.com/users/DennisJcy/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-11T16:41:30Z",
        "updated_at": "2023-03-11T16:41:30Z",
        "author_association": "NONE",
        "body": "Thank you for your guide!  @natke \r\nI have two question on the samples and API you given me:\r\n1.why the sample set the output to a constant value?`np.float32([1.0, 2.0, 3.0, 4.0, 5.0])`\r\nFor example, actually the model result may be an unsure resullt? I cant understand that\r\n\r\n2.the sample replace `InferenceSession.run()` with `InferenceSession.run_with_iobinding()`,and use `io_binding.bind_input()`\r\n`bind_output()` to binding the input and output to a Specific device(may be cuda).\r\nSo,will the Intermediate data binding to cuda too?,because i still want to solve the time which cost by the converting time between cuda and cpu \r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1464949518/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1464997993",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14070#issuecomment-1464997993",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14070",
        "id": 1464997993,
        "node_id": "IC_kwDOCVq1mM5XUhhp",
        "user": {
            "login": "natke",
            "id": 3302433,
            "node_id": "MDQ6VXNlcjMzMDI0MzM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3302433?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/natke",
            "html_url": "https://github.com/natke",
            "followers_url": "https://api.github.com/users/natke/followers",
            "following_url": "https://api.github.com/users/natke/following{/other_user}",
            "gists_url": "https://api.github.com/users/natke/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/natke/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/natke/subscriptions",
            "organizations_url": "https://api.github.com/users/natke/orgs",
            "repos_url": "https://api.github.com/users/natke/repos",
            "events_url": "https://api.github.com/users/natke/events{/privacy}",
            "received_events_url": "https://api.github.com/users/natke/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-11T19:48:57Z",
        "updated_at": "2023-03-11T19:48:57Z",
        "author_association": "MEMBER",
        "body": "Hi @DennisJcy \r\nThe constant value in the sample is for demonstration purposes. For your own application, you can set these to the inputs of your model.\r\n\r\nAnd yes, the intermediate data will remain on device.\r\n\r\nLet us know if this helps!",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1464997993/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1465358415",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14070#issuecomment-1465358415",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14070",
        "id": 1465358415,
        "node_id": "IC_kwDOCVq1mM5XV5hP",
        "user": {
            "login": "DennisJcy",
            "id": 106725464,
            "node_id": "U_kgDOBlyAWA",
            "avatar_url": "https://avatars.githubusercontent.com/u/106725464?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/DennisJcy",
            "html_url": "https://github.com/DennisJcy",
            "followers_url": "https://api.github.com/users/DennisJcy/followers",
            "following_url": "https://api.github.com/users/DennisJcy/following{/other_user}",
            "gists_url": "https://api.github.com/users/DennisJcy/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/DennisJcy/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/DennisJcy/subscriptions",
            "organizations_url": "https://api.github.com/users/DennisJcy/orgs",
            "repos_url": "https://api.github.com/users/DennisJcy/repos",
            "events_url": "https://api.github.com/users/DennisJcy/events{/privacy}",
            "received_events_url": "https://api.github.com/users/DennisJcy/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-13T01:06:28Z",
        "updated_at": "2023-03-13T01:06:28Z",
        "author_association": "NONE",
        "body": "Thank you for your precious time! @natke \r\nI make an easy cost time test between `InferenceSession.run()` and `io_binding.bind_input()` .But i see no improvement.Following is my test code.\r\n```python\r\ndef cuda_binding():\r\n    img_path = 'data/images/test.jpg'\r\n    model = ort.InferenceSession('best.onnx', providers=['CUDAExecutionProvider'])\r\n    io_binding = model.io_binding()\r\n    input = cv2.imread(img_path)\r\n    input = cv2.resize(input, (640, 640)) / 255.\r\n    input = np.transpose(input, (2, 0, 1))[np.newaxis, ...].astype(np.float32)\r\n    t=0\r\n    for i in range(100):\r\n        t1=time.time()\r\n        x_ortvalue = ort.OrtValue.ortvalue_from_numpy(input,'cuda',0)\r\n        io_binding.bind_input('images','cuda',0,input.dtype,x_ortvalue.shape(),x_ortvalue.data_ptr())\r\n        io_binding.bind_output('output')\r\n        model.run_with_iobinding(io_binding)\r\n        output = io_binding.copy_outputs_to_cpu()[0]\r\n        t2=time.time()\r\n        if i == 0:\r\n            continue# cuda warm up\r\n        else:\r\n            t+=round((t2-t1)*1000,3)\r\n    print(\"average time = {}\".format(t/99))\r\n``` \r\n__average time = 32.175474747474745ms__\r\n\r\n```python\r\ndef cuda_no_binding():\r\n    img_path = 'data/images/test.jpg'\r\n    model = ort.InferenceSession('best.onnx', providers=['CUDAExecutionProvider'])\r\n    input = cv2.imread(img_path)\r\n    input = cv2.resize(input, (640, 640)) / 255.\r\n    input = np.transpose(input, (2, 0, 1))[np.newaxis, ...].astype(np.float32)\r\n    t=0\r\n    for i in range(100):\r\n        t1=time.time()\r\n\r\n        output = model.run(None, {'images': input.astype(np.float32)})[0]\r\n        t2=time.time()\r\n        if i == 0:\r\n            continue# cuda warm up\r\n        else:\r\n            t+=round((t2-t1)*1000,3)\r\n    print(\"average time = {}\".format(t/99))  \r\n```\r\n__average time = 34.20883838383838__\r\n\r\n__Whats important, two function output the same Log:__\r\n```\r\n[W:onnxruntime:, session_state.cc:1136 onnxruntime::VerifyEachNodeIsAssignedToAnEp] Some nodes were not assigned to the preferred execution providers which may or may not have an negative impact on performance. e.g. ORT explicitly assigns shape related ops to CPU to improve perf.\r\n[W:onnxruntime:, session_state.cc:1138 onnxruntime::VerifyEachNodeIsAssignedToAnEp] Rerunning with verbose output on a non-minimal build will show node assignments.\r\n```\r\n\r\n\r\nThe time of the two methods is almost equal, and does it have something to do with the way I export? Because some operators in verbose are labeled __cpu__\r\n![image](https://user-images.githubusercontent.com/106725464/224586254-0780e187-2c4e-45e6-a0c4-d02b11a55b1c.png)\r\n\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1465358415/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]