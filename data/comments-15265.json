[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1488117742",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15265#issuecomment-1488117742",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15265",
        "id": 1488117742,
        "node_id": "IC_kwDOCVq1mM5Yst_u",
        "user": {
            "login": "JiaYK",
            "id": 18151889,
            "node_id": "MDQ6VXNlcjE4MTUxODg5",
            "avatar_url": "https://avatars.githubusercontent.com/u/18151889?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/JiaYK",
            "html_url": "https://github.com/JiaYK",
            "followers_url": "https://api.github.com/users/JiaYK/followers",
            "following_url": "https://api.github.com/users/JiaYK/following{/other_user}",
            "gists_url": "https://api.github.com/users/JiaYK/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/JiaYK/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/JiaYK/subscriptions",
            "organizations_url": "https://api.github.com/users/JiaYK/orgs",
            "repos_url": "https://api.github.com/users/JiaYK/repos",
            "events_url": "https://api.github.com/users/JiaYK/events{/privacy}",
            "received_events_url": "https://api.github.com/users/JiaYK/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-29T08:00:19Z",
        "updated_at": "2023-03-29T08:00:19Z",
        "author_association": "NONE",
        "body": "And only when there are a lot of requests that are calculated at the same time will the result be incorrect. Just starting multiple processes will not cause a calculation error. From the perspective of the result, it feels like Cuda is executing in disorder",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1488117742/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1489357047",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15265#issuecomment-1489357047",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15265",
        "id": 1489357047,
        "node_id": "IC_kwDOCVq1mM5Yxcj3",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-29T21:32:17Z",
        "updated_at": "2023-03-29T21:32:17Z",
        "author_association": "MEMBER",
        "body": "Can you describe the issue in more detail and steps to repro this? You've 2 processes each creating a session for a different model and each targeting a different device id and this doesn't work?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1489357047/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1489862539",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15265#issuecomment-1489862539",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15265",
        "id": 1489862539,
        "node_id": "IC_kwDOCVq1mM5YzX-L",
        "user": {
            "login": "JiaYK",
            "id": 18151889,
            "node_id": "MDQ6VXNlcjE4MTUxODg5",
            "avatar_url": "https://avatars.githubusercontent.com/u/18151889?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/JiaYK",
            "html_url": "https://github.com/JiaYK",
            "followers_url": "https://api.github.com/users/JiaYK/followers",
            "following_url": "https://api.github.com/users/JiaYK/following{/other_user}",
            "gists_url": "https://api.github.com/users/JiaYK/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/JiaYK/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/JiaYK/subscriptions",
            "organizations_url": "https://api.github.com/users/JiaYK/orgs",
            "repos_url": "https://api.github.com/users/JiaYK/repos",
            "events_url": "https://api.github.com/users/JiaYK/events{/privacy}",
            "received_events_url": "https://api.github.com/users/JiaYK/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-30T07:58:45Z",
        "updated_at": "2023-03-30T07:58:45Z",
        "author_association": "NONE",
        "body": "Hello! Thank you for your reply.\r\n\r\nI have two processes, each of which creates one session. There are two sessions in total, and the models running in the two sessions are exactly the same. They are both placed in the same device (an A40 graphics card) and run on a Flask web service started using Gunicorn. There is no problem when accessing the web service at low frequencies. However, when I run a load test (using Siege), if I access the service at the same time, the results of the model are incorrect (with some probability correct, with some probability slightly off, and with some probability completely wrong). I have used fp16 quantization to optimize speed. According to the nvidia-smi display, the GPU usage is 100% when the errors occur.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1489862539/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1489875167",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15265#issuecomment-1489875167",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15265",
        "id": 1489875167,
        "node_id": "IC_kwDOCVq1mM5YzbDf",
        "user": {
            "login": "JiaYK",
            "id": 18151889,
            "node_id": "MDQ6VXNlcjE4MTUxODg5",
            "avatar_url": "https://avatars.githubusercontent.com/u/18151889?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/JiaYK",
            "html_url": "https://github.com/JiaYK",
            "followers_url": "https://api.github.com/users/JiaYK/followers",
            "following_url": "https://api.github.com/users/JiaYK/following{/other_user}",
            "gists_url": "https://api.github.com/users/JiaYK/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/JiaYK/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/JiaYK/subscriptions",
            "organizations_url": "https://api.github.com/users/JiaYK/orgs",
            "repos_url": "https://api.github.com/users/JiaYK/repos",
            "events_url": "https://api.github.com/users/JiaYK/events{/privacy}",
            "received_events_url": "https://api.github.com/users/JiaYK/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-30T08:07:49Z",
        "updated_at": "2023-03-30T08:14:10Z",
        "author_association": "NONE",
        "body": "Below, I will briefly describe using pseudocode\r\n# flask.py\r\nimport onnxruntime as ort\r\nfrom flask import Flask, jsonify, render_template, redirect\r\napp = Flask(__name__)\r\n\r\nclass Model:\r\n    def __init__(self):\r\n        providers = [('CUDAExecutionProvider', {\r\n                      \"cudnn_conv_algo_search\": 'DEFAULT',\r\n                      'do_copy_in_default_stream': True,\r\n                      'cudnn_conv_use_max_workspace': 1,\r\n                      'cudnn_conv1d_pad_to_nc1d': 1, }), 'CPUExecutionProvider']\r\n        self.sess = ort.InferenceSession(f'{model_dir}/model.onnx', sess_options=options, providers=providers)\r\n        self.io_binding = self.sess.io_binding()\r\n    def __call__(self, args):\r\n        # binding fisrt (data from pytorch:cuda)\r\n        self.sess.run_with_iobinding(self.io_binding)\r\n        return result\r\n\r\nmodel = Model()\r\n\r\n@app.route('/')\r\ndef index():\r\n    # get some args\r\n    result = model(args)\r\n    return jsonify(result=result)\r\n\r\n# run command (5 workers)\r\ngunicorn -b 0.0.0.0:8000 -w 5 -timeout 0 flask:app\r\n\r\n# stress testing\r\nsiege -c 10 -r 300 'http://127.0.0.1/someargs'\r\n\r\n# accessing in a browser and result is wrong.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1489875167/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1489900660",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15265#issuecomment-1489900660",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15265",
        "id": 1489900660,
        "node_id": "IC_kwDOCVq1mM5YzhR0",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-30T08:26:59Z",
        "updated_at": "2023-03-30T08:26:59Z",
        "author_association": "MEMBER",
        "body": "Since you don't have device id in your config, the default device id is 0. This means you're sharing the same device between 2 processes. This may introduce context switching and you may not see concurrent execution. You mentioned that this doesn't occur with 1.14.0 which is a bit surprising since this is general GPU behavior, not related to ORT ver. Are you able to use 2 different devices to keep things separate?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1489900660/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1489920580",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15265#issuecomment-1489920580",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15265",
        "id": 1489920580,
        "node_id": "IC_kwDOCVq1mM5YzmJE",
        "user": {
            "login": "JiaYK",
            "id": 18151889,
            "node_id": "MDQ6VXNlcjE4MTUxODg5",
            "avatar_url": "https://avatars.githubusercontent.com/u/18151889?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/JiaYK",
            "html_url": "https://github.com/JiaYK",
            "followers_url": "https://api.github.com/users/JiaYK/followers",
            "following_url": "https://api.github.com/users/JiaYK/following{/other_user}",
            "gists_url": "https://api.github.com/users/JiaYK/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/JiaYK/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/JiaYK/subscriptions",
            "organizations_url": "https://api.github.com/users/JiaYK/orgs",
            "repos_url": "https://api.github.com/users/JiaYK/repos",
            "events_url": "https://api.github.com/users/JiaYK/events{/privacy}",
            "received_events_url": "https://api.github.com/users/JiaYK/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-30T08:41:30Z",
        "updated_at": "2023-03-30T08:41:30Z",
        "author_association": "NONE",
        "body": "Yes, two processes share a single GPU, but different processes have their own independent memory space. This should be quite common. For example, training two models simultaneously on a single GPU. I put multiple processes on the same device because the models are relatively small. If I only use one process, the GPU utilization rate may be as low as 15%. Multiple processes can complete more requests per second.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1489920580/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]