[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/896305124",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8675#issuecomment-896305124",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8675",
        "id": 896305124,
        "node_id": "IC_kwDOCVq1mM41bIfk",
        "user": {
            "login": "ytaous",
            "id": 4484531,
            "node_id": "MDQ6VXNlcjQ0ODQ1MzE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4484531?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ytaous",
            "html_url": "https://github.com/ytaous",
            "followers_url": "https://api.github.com/users/ytaous/followers",
            "following_url": "https://api.github.com/users/ytaous/following{/other_user}",
            "gists_url": "https://api.github.com/users/ytaous/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ytaous/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ytaous/subscriptions",
            "organizations_url": "https://api.github.com/users/ytaous/orgs",
            "repos_url": "https://api.github.com/users/ytaous/repos",
            "events_url": "https://api.github.com/users/ytaous/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ytaous/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-08-10T20:46:03Z",
        "updated_at": "2021-08-10T20:46:03Z",
        "author_association": "MEMBER",
        "body": "Hi, have you checked out the example? https://github.com/microsoft/onnxruntime/blob/master/onnxruntime/python/tools/transformers/notebooks/Inference_GPT2_with_OnnxRuntime_on_CPU.ipynb\r\nper notebook example, looks like outputs[0] is what you are looking for, and you can compare it with torch's loss",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/896305124/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/896324395",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8675#issuecomment-896324395",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8675",
        "id": 896324395,
        "node_id": "IC_kwDOCVq1mM41bNMr",
        "user": {
            "login": "SachJbp",
            "id": 30142468,
            "node_id": "MDQ6VXNlcjMwMTQyNDY4",
            "avatar_url": "https://avatars.githubusercontent.com/u/30142468?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/SachJbp",
            "html_url": "https://github.com/SachJbp",
            "followers_url": "https://api.github.com/users/SachJbp/followers",
            "following_url": "https://api.github.com/users/SachJbp/following{/other_user}",
            "gists_url": "https://api.github.com/users/SachJbp/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/SachJbp/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/SachJbp/subscriptions",
            "organizations_url": "https://api.github.com/users/SachJbp/orgs",
            "repos_url": "https://api.github.com/users/SachJbp/repos",
            "events_url": "https://api.github.com/users/SachJbp/events{/privacy}",
            "received_events_url": "https://api.github.com/users/SachJbp/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-08-10T21:21:55Z",
        "updated_at": "2021-08-10T21:21:55Z",
        "author_association": "NONE",
        "body": "Hi, \r\n\r\nI did see that link but that is just comparing the loss incurred due to quantization in ONNX when compared to torch model inference.\r\n\r\nI want the per-token (average) or total log-likelihood for all tokens of a given text to be returned as the loss, in other way a measure of how predictable a sentence is for the language model. Eg, if the sentence is \"This looks good\", it would be **log(P(This)*P(looks|This)*P(good|This Looks))** . It is also called the \"Grammar Score\" for traditional language models. https://huggingface.co/transformers/perplexity.html describes it as well and its usage for calculating perplexity. They return a per token (average) log-likelihood. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/896324395/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/896336017",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8675#issuecomment-896336017",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8675",
        "id": 896336017,
        "node_id": "IC_kwDOCVq1mM41bQCR",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-08-10T21:48:11Z",
        "updated_at": "2021-08-10T21:48:11Z",
        "author_association": "MEMBER",
        "body": "@SachJbp, \r\nI think it is because the exported onnx model does not have labels in input and loss in the onnx output. You can modify the export script to achieve that. \r\n\r\nThe places to add labels to input:\r\nhttps://github.com/microsoft/onnxruntime/blob/064a385b59598419c287a4b897afca376227d3bd/onnxruntime/python/tools/transformers/gpt2_helper.py#L84-L88\r\n\r\nYou will need update the export_onnx function to have labels in dummy inputs and loss in output:\r\nhttps://github.com/microsoft/onnxruntime/blob/064a385b59598419c287a4b897afca376227d3bd/onnxruntime/python/tools/transformers/gpt2_helper.py#L265\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/896336017/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/902128813",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8675#issuecomment-902128813",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8675",
        "id": 902128813,
        "node_id": "IC_kwDOCVq1mM41xWSt",
        "user": {
            "login": "SachJbp",
            "id": 30142468,
            "node_id": "MDQ6VXNlcjMwMTQyNDY4",
            "avatar_url": "https://avatars.githubusercontent.com/u/30142468?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/SachJbp",
            "html_url": "https://github.com/SachJbp",
            "followers_url": "https://api.github.com/users/SachJbp/followers",
            "following_url": "https://api.github.com/users/SachJbp/following{/other_user}",
            "gists_url": "https://api.github.com/users/SachJbp/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/SachJbp/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/SachJbp/subscriptions",
            "organizations_url": "https://api.github.com/users/SachJbp/orgs",
            "repos_url": "https://api.github.com/users/SachJbp/repos",
            "events_url": "https://api.github.com/users/SachJbp/events{/privacy}",
            "received_events_url": "https://api.github.com/users/SachJbp/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-08-19T18:05:41Z",
        "updated_at": "2021-08-19T18:10:29Z",
        "author_association": "NONE",
        "body": "Thanks a lot for the assistance. I was able to make the above changes to make it work and get the \"loss\" in Colab. But, when trying to build an image using python3.7 base image utilising edited onnxruntime package, I get this error \"cannot import name 'get_all_providers' from 'onnxruntime.capi._pybind_state' \" when trying to import 'from onnxruntime.transformers.gpt2_helper import Gpt2Helper, MyGPT2LMHeadMode'. Any suggestions ?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/902128813/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1096777215",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8675#issuecomment-1096777215",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8675",
        "id": 1096777215,
        "node_id": "IC_kwDOCVq1mM5BX33_",
        "user": {
            "login": "TDehaene",
            "id": 22496343,
            "node_id": "MDQ6VXNlcjIyNDk2MzQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/22496343?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TDehaene",
            "html_url": "https://github.com/TDehaene",
            "followers_url": "https://api.github.com/users/TDehaene/followers",
            "following_url": "https://api.github.com/users/TDehaene/following{/other_user}",
            "gists_url": "https://api.github.com/users/TDehaene/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TDehaene/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TDehaene/subscriptions",
            "organizations_url": "https://api.github.com/users/TDehaene/orgs",
            "repos_url": "https://api.github.com/users/TDehaene/repos",
            "events_url": "https://api.github.com/users/TDehaene/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TDehaene/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-12T14:06:48Z",
        "updated_at": "2022-04-12T14:06:48Z",
        "author_association": "NONE",
        "body": "@SachJbp : could you please post your code snippet to calculate the perplexity of onnx models using onnxruntime? I'm stuck in the same situation.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1096777215/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1209293355",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8675#issuecomment-1209293355",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8675",
        "id": 1209293355,
        "node_id": "IC_kwDOCVq1mM5IFFor",
        "user": {
            "login": "OriAlpha",
            "id": 41699212,
            "node_id": "MDQ6VXNlcjQxNjk5MjEy",
            "avatar_url": "https://avatars.githubusercontent.com/u/41699212?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/OriAlpha",
            "html_url": "https://github.com/OriAlpha",
            "followers_url": "https://api.github.com/users/OriAlpha/followers",
            "following_url": "https://api.github.com/users/OriAlpha/following{/other_user}",
            "gists_url": "https://api.github.com/users/OriAlpha/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/OriAlpha/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/OriAlpha/subscriptions",
            "organizations_url": "https://api.github.com/users/OriAlpha/orgs",
            "repos_url": "https://api.github.com/users/OriAlpha/repos",
            "events_url": "https://api.github.com/users/OriAlpha/events{/privacy}",
            "received_events_url": "https://api.github.com/users/OriAlpha/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-08-09T12:05:17Z",
        "updated_at": "2022-08-09T12:05:17Z",
        "author_association": "NONE",
        "body": "I am also facing same issue, is there any updates regarding this issue??",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1209293355/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1209575890",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8675#issuecomment-1209575890",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8675",
        "id": 1209575890,
        "node_id": "IC_kwDOCVq1mM5IGKnS",
        "user": {
            "login": "SachJbp",
            "id": 30142468,
            "node_id": "MDQ6VXNlcjMwMTQyNDY4",
            "avatar_url": "https://avatars.githubusercontent.com/u/30142468?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/SachJbp",
            "html_url": "https://github.com/SachJbp",
            "followers_url": "https://api.github.com/users/SachJbp/followers",
            "following_url": "https://api.github.com/users/SachJbp/following{/other_user}",
            "gists_url": "https://api.github.com/users/SachJbp/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/SachJbp/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/SachJbp/subscriptions",
            "organizations_url": "https://api.github.com/users/SachJbp/orgs",
            "repos_url": "https://api.github.com/users/SachJbp/repos",
            "events_url": "https://api.github.com/users/SachJbp/events{/privacy}",
            "received_events_url": "https://api.github.com/users/SachJbp/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-08-09T15:59:59Z",
        "updated_at": "2022-08-09T16:00:32Z",
        "author_association": "NONE",
        "body": "I was able to make a change locally in GPTLMHeadModel's forward() method to send `labels = input_ids` which returned `loss` as the first output and it helped solve my problem. Do not have the code accessible to me right now.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1209575890/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1209589376",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8675#issuecomment-1209589376",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8675",
        "id": 1209589376,
        "node_id": "IC_kwDOCVq1mM5IGN6A",
        "user": {
            "login": "OriAlpha",
            "id": 41699212,
            "node_id": "MDQ6VXNlcjQxNjk5MjEy",
            "avatar_url": "https://avatars.githubusercontent.com/u/41699212?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/OriAlpha",
            "html_url": "https://github.com/OriAlpha",
            "followers_url": "https://api.github.com/users/OriAlpha/followers",
            "following_url": "https://api.github.com/users/OriAlpha/following{/other_user}",
            "gists_url": "https://api.github.com/users/OriAlpha/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/OriAlpha/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/OriAlpha/subscriptions",
            "organizations_url": "https://api.github.com/users/OriAlpha/orgs",
            "repos_url": "https://api.github.com/users/OriAlpha/repos",
            "events_url": "https://api.github.com/users/OriAlpha/events{/privacy}",
            "received_events_url": "https://api.github.com/users/OriAlpha/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-08-09T16:12:31Z",
        "updated_at": "2022-08-09T16:12:31Z",
        "author_association": "NONE",
        "body": "Will try to compute, thanks",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1209589376/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]