[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1336490019",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13833#issuecomment-1336490019",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13833",
        "id": 1336490019,
        "node_id": "IC_kwDOCVq1mM5PqTgj",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-12-04T18:51:22Z",
        "updated_at": "2022-12-04T19:06:31Z",
        "author_association": "MEMBER",
        "body": "Use torch.onnx.export to export models to onnx. See related documents:\r\nhttps://github.com/onnx/tutorials#converting-to-onnx-format\r\nhttps://pytorch.org/docs/stable/onnx.html\r\n\r\nFile an issue to pytorch (https://github.com/pytorch/pytorch) if it is not working as expected.\r\n\r\nI suggest to try two ways: (1) directly export half model (2) load torch model as fp32 (make sure the modeling script use fp32 in computation), export it to onnx, then optimize the model (If your model is transformers, try https://github.com/microsoft/onnxruntime/blob/main/onnxruntime/python/tools/transformers/README.md), finally convert fp32 onnx model to fp16 (or mixed precision) using https://github.com/microsoft/onnxconverter-common/blob/master/onnxconverter_common/float16.py. In this step, you might specify some operators to compute in fp32 for precision purpose (or other reason like some operator does not support fp16).\r\n\r\nSometime, the second way could get better performance and precision.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1336490019/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1336977028",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13833#issuecomment-1336977028",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13833",
        "id": 1336977028,
        "node_id": "IC_kwDOCVq1mM5PsKaE",
        "user": {
            "login": "FrancescoSaverioZuppichini",
            "id": 15908060,
            "node_id": "MDQ6VXNlcjE1OTA4MDYw",
            "avatar_url": "https://avatars.githubusercontent.com/u/15908060?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/FrancescoSaverioZuppichini",
            "html_url": "https://github.com/FrancescoSaverioZuppichini",
            "followers_url": "https://api.github.com/users/FrancescoSaverioZuppichini/followers",
            "following_url": "https://api.github.com/users/FrancescoSaverioZuppichini/following{/other_user}",
            "gists_url": "https://api.github.com/users/FrancescoSaverioZuppichini/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/FrancescoSaverioZuppichini/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/FrancescoSaverioZuppichini/subscriptions",
            "organizations_url": "https://api.github.com/users/FrancescoSaverioZuppichini/orgs",
            "repos_url": "https://api.github.com/users/FrancescoSaverioZuppichini/repos",
            "events_url": "https://api.github.com/users/FrancescoSaverioZuppichini/events{/privacy}",
            "received_events_url": "https://api.github.com/users/FrancescoSaverioZuppichini/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-12-05T08:55:28Z",
        "updated_at": "2022-12-05T08:55:28Z",
        "author_association": "NONE",
        "body": "hey @tianleiwu thanks for your reply. \r\n\r\nI have found a way to convert the model directly to torch, do you think I can PR a little addition to the doc? \r\n\r\nPasting here, basically, as you said one can export the model in float16 directly\r\n\r\n\r\n```python\r\nimport clip\r\nimport onnxruntime as ort\r\nimport torch\r\n\r\n\r\nmodel_name = \"MODEL_NAME.onnx\"\r\nmodel = ....\r\n\r\nwith torch.autocast(\"cuda\", dtype=torch.float16):\r\n    x = torch.randn(1, 3, 224, 224, device=\"cuda\")\r\n    # # Export the model\r\n    torch.onnx.export(\r\n        model,  # model being run\r\n        x,  # model input (or a tuple for multiple inputs)\r\n        model_name,  # where to save the model (can be a file or file-like object)\r\n        opset_version=16,\r\n        export_params=True,  # store the trained parameter weights inside the model file\r\n        do_constant_folding=True,  # whether to execute constant folding for optimization\r\n        input_names=[\"image\"],  # the model's input names\r\n        output_names=[\"output\"],  # the model's output names\r\n        dynamic_axes={\r\n            \"image\": {0: \"batch_size\"},  # variable length axes\r\n            \"output\": {0: \"batch_size\"},\r\n        },\r\n    )\r\n    ```",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1336977028/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1337874840",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13833#issuecomment-1337874840",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13833",
        "id": 1337874840,
        "node_id": "IC_kwDOCVq1mM5PvlmY",
        "user": {
            "login": "natke",
            "id": 3302433,
            "node_id": "MDQ6VXNlcjMzMDI0MzM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3302433?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/natke",
            "html_url": "https://github.com/natke",
            "followers_url": "https://api.github.com/users/natke/followers",
            "following_url": "https://api.github.com/users/natke/following{/other_user}",
            "gists_url": "https://api.github.com/users/natke/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/natke/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/natke/subscriptions",
            "organizations_url": "https://api.github.com/users/natke/orgs",
            "repos_url": "https://api.github.com/users/natke/repos",
            "events_url": "https://api.github.com/users/natke/events{/privacy}",
            "received_events_url": "https://api.github.com/users/natke/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-12-05T18:06:41Z",
        "updated_at": "2022-12-05T18:06:41Z",
        "author_association": "MEMBER",
        "body": "@FrancescoSaverioZuppichini Yes please create a PR against the docs!",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1337874840/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]