[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1462486752",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14985#issuecomment-1462486752",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14985",
        "id": 1462486752,
        "node_id": "IC_kwDOCVq1mM5XK8bg",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-09T17:42:39Z",
        "updated_at": "2023-03-09T17:46:57Z",
        "author_association": "MEMBER",
        "body": "Try random inputs to see whether it could reproduce. Could you share all parameters (attributes) of the Conv_553 node and also the Reshape node before it (so that we know the input shape)?\r\n\r\nconv in CUDA does not seem have safeint: https://github.com/microsoft/onnxruntime/blob/main/onnxruntime/core/providers/cuda/nn/conv.cc\r\nThe CPU version of conv has.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1462486752/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1462548643",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14985#issuecomment-1462548643",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14985",
        "id": 1462548643,
        "node_id": "IC_kwDOCVq1mM5XLLij",
        "user": {
            "login": "dashesy",
            "id": 873905,
            "node_id": "MDQ6VXNlcjg3MzkwNQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/873905?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/dashesy",
            "html_url": "https://github.com/dashesy",
            "followers_url": "https://api.github.com/users/dashesy/followers",
            "following_url": "https://api.github.com/users/dashesy/following{/other_user}",
            "gists_url": "https://api.github.com/users/dashesy/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/dashesy/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/dashesy/subscriptions",
            "organizations_url": "https://api.github.com/users/dashesy/orgs",
            "repos_url": "https://api.github.com/users/dashesy/repos",
            "events_url": "https://api.github.com/users/dashesy/events{/privacy}",
            "received_events_url": "https://api.github.com/users/dashesy/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-09T18:15:47Z",
        "updated_at": "2023-03-09T18:15:47Z",
        "author_association": "NONE",
        "body": "I could not find it either. So far I cannot repro the issue with random inputs, all zeros, ... The input is fixed size too.\r\nWill share the model with you offline\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1462548643/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1467352597",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14985#issuecomment-1467352597",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14985",
        "id": 1467352597,
        "node_id": "IC_kwDOCVq1mM5XdgYV",
        "user": {
            "login": "skottmckay",
            "id": 979079,
            "node_id": "MDQ6VXNlcjk3OTA3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/skottmckay",
            "html_url": "https://github.com/skottmckay",
            "followers_url": "https://api.github.com/users/skottmckay/followers",
            "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
            "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
            "organizations_url": "https://api.github.com/users/skottmckay/orgs",
            "repos_url": "https://api.github.com/users/skottmckay/repos",
            "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
            "received_events_url": "https://api.github.com/users/skottmckay/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-14T04:47:33Z",
        "updated_at": "2023-03-14T04:47:33Z",
        "author_association": "MEMBER",
        "body": "The main potential place SafeInt comes into play is `TensorShape::SizeHelper` which is used by `TensorShape::Size()`.\r\n\r\nhttps://github.com/microsoft/onnxruntime/blob/538d64891ac8e43c1faf7846635c3a1bf7b6b6c5/onnxruntime/core/framework/tensor_shape.cc#L109-L117\r\n\r\n`TensorShape::Size` is called in a few places.\r\n\r\ne.g.\r\nhttps://github.com/microsoft/onnxruntime/blob/538d64891ac8e43c1faf7846635c3a1bf7b6b6c5/onnxruntime/core/providers/cuda/nn/conv.cc#L200\r\n\r\nhttps://github.com/microsoft/onnxruntime/blob/538d64891ac8e43c1faf7846635c3a1bf7b6b6c5/onnxruntime/core/providers/cuda/nn/conv.cc#L256\r\n\r\n`TensorShape::Size` exits with -1 for all values < 0 so you'd probably need an extremely large value, possibly from a bad conversion between signed and unsigned, to get in there somehow. Didn't see any obvious places where that could happen.\r\n\r\n`s_.Y->Shape().Size()` is a shape coming from the cached state variable. If some other request modified that concurrently you could maybe get garbage in the shape and Size() would throw. Assuming that's not possible due to locking but maybe worth double checking.\r\n\r\nThe path where `SliceOutUnwantedOutputSection` is called due to asymmetric padding also calls TensorShape::Size in SliceImpCore for `output_shape`.\r\n\r\nhttps://github.com/microsoft/onnxruntime/blob/538d64891ac8e43c1faf7846635c3a1bf7b6b6c5/onnxruntime/core/providers/cuda/tensor/slice.cc#L149\r\n\r\nSafeInt is also present in [IAllocator::CalcMemSizeForArrayWithAlignment](https://github.com/microsoft/onnxruntime/blob/538d64891ac8e43c1faf7846635c3a1bf7b6b6c5/onnxruntime/core/framework/allocator.cc#L22-L26) . That's used by `CalcMemSizeForArray` in `IAllocator::MakeUniquePtr<T>` which is called from GetScratchBuffer/GetTransientScratchBuffer. The SafeInt there is only relevant if T != `void` and all the usages I can see in CUDA conv.cc involve `void`.\r\n\r\nIf it's possible to do a custom build and enabling the stack trace when there's an exception thrown that could be helpful. In general we wouldn't expect exceptions to be thrown at runtime if the model is good and model input is validated, so performance wise that _should_ be ok.\r\n\r\nhttps://github.com/microsoft/onnxruntime/blob/538d64891ac8e43c1faf7846635c3a1bf7b6b6c5/onnxruntime/core/platform/windows/stacktrace.cc#L33-L44",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1467352597/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1523808944",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14985#issuecomment-1523808944",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14985",
        "id": 1523808944,
        "node_id": "IC_kwDOCVq1mM5a03qw",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-26T17:37:34Z",
        "updated_at": "2023-04-26T17:37:34Z",
        "author_association": "MEMBER",
        "body": "@dashesy, any finding using custom build with call stack enabled?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1523808944/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]