[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/580584882",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2940#issuecomment-580584882",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2940",
        "id": 580584882,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU4MDU4NDg4Mg==",
        "user": {
            "login": "skottmckay",
            "id": 979079,
            "node_id": "MDQ6VXNlcjk3OTA3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/skottmckay",
            "html_url": "https://github.com/skottmckay",
            "followers_url": "https://api.github.com/users/skottmckay/followers",
            "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
            "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
            "organizations_url": "https://api.github.com/users/skottmckay/orgs",
            "repos_url": "https://api.github.com/users/skottmckay/repos",
            "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
            "received_events_url": "https://api.github.com/users/skottmckay/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-01-31T05:10:55Z",
        "updated_at": "2020-01-31T05:10:55Z",
        "author_association": "MEMBER",
        "body": "Given that the code in question is constantly exercised in the CI tests on many different windows machines, and on many different developers' boxes, it's a bit strange for it to fail for you. \r\n\r\nIt seems to be calling the TypeConstraint constructor correctly for the Affine contrib op. It's trying to register the 3 type constraints in the 'd.insert' line at the end of this code:\r\n\r\n```\r\nOpSchema& OpSchema::TypeConstraint(\r\n    std::string type_str,\r\n    std::vector<std::string> constraints,\r\n    std::string description) {\r\n  if (type_constraints_.end() != type_constraints_.find(type_str)) {\r\n    fail_schema(\"Duplicate type constraint name\");\r\n  }\r\n\r\n  DataTypeSet d;\r\n  for (const auto& t : constraints) {\r\n    d.insert(Utils::DataTypeUtils::ToType(t));\r\n  }\r\n```\r\n\r\nDataTypeSet is std::unordered_set<const std::string*> and it's a brand new instance.\r\n\r\nIt's failing inserting the first constraint, and the string that is being passed to emplace from d.insert looks perfectly valid:\r\n<_Vals_0> | 0x00000136303b04c0 \"tensor(float16)\" | const std::string * &&\r\n\r\nThe crash is in the following function that's called from std::_Hash<_Traits>::emplace (essentially std::unordered_set::insert calls this), but this is all STL code and is using no values that onnxruntime has passed to it. The _Oldsize is 0, _Newsize is 1, and it crashes on the 'return' line. \r\n\r\n```\r\n    bool _Check_rehash_required_1() const noexcept {\r\n        const size_type _Oldsize = _List._Mypair._Myval2._Mysize;\r\n        const auto _Newsize      = _Oldsize + 1;\r\n        return max_load_factor() < static_cast<float>(_Newsize) / static_cast<float>(bucket_count());\r\n    }\r\n```\r\n\r\nThe disassembly for this is:\r\n\r\n```\r\n            if (_Check_rehash_required_1()) {\r\n00007FFA1699B2F1  mov         rdx,qword ptr [rsi+10h]  \r\n00007FFA1699B2F5  inc         rdx  \r\n00007FFA1699B2F8  vxorps      xmm1,xmm1,xmm1  \r\n00007FFA1699B2FC  vcvtusi2ss  xmm1,xmm1,rdx                      <<<<------- fails here\r\n00007FFA1699B302  vxorps      xmm0,xmm0,xmm0  \r\n00007FFA1699B306  vcvtusi2ss  xmm0,xmm0,qword ptr [rsi+38h]  \r\n00007FFA1699B30D  vdivss      xmm1,xmm1,xmm0  \r\n00007FFA1699B311  vcomiss     xmm1,dword ptr [rsi]  \r\n00007FFA1699B315  seta        al  \r\n00007FFA1699B318  test        al,al  \r\n```\r\n\r\nThe vcvtusi2ss instruction is only available on AVX-512: https://software.intel.com/sites/landingpage/IntrinsicsGuide/#text=vcvtusi2ss\r\n\r\nAnd whilst the Xeon 2133 supports that: https://ark.intel.com/content/www/us/en/ark/products/125040/intel-xeon-w-2133-processor-8-25m-cache-3-60-ghz.html\r\n\r\nThe other cpus don't: https://ark.intel.com/content/www/us/en/ark/products/88184/intel-core-i5-6500-processor-6m-cache-up-to-3-60-ghz.html\r\n\r\nSo you need to compile your application with settings that are valid for all the machines you want to run it on. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/580584882/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null,
        "event": "commented",
        "actor": {
            "login": "skottmckay",
            "id": 979079,
            "node_id": "MDQ6VXNlcjk3OTA3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/skottmckay",
            "html_url": "https://github.com/skottmckay",
            "followers_url": "https://api.github.com/users/skottmckay/followers",
            "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
            "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
            "organizations_url": "https://api.github.com/users/skottmckay/orgs",
            "repos_url": "https://api.github.com/users/skottmckay/repos",
            "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
            "received_events_url": "https://api.github.com/users/skottmckay/received_events",
            "type": "User",
            "site_admin": false
        }
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/580849862",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2940#issuecomment-580849862",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2940",
        "id": 580849862,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU4MDg0OTg2Mg==",
        "user": {
            "login": "Rocheng",
            "id": 38086196,
            "node_id": "MDQ6VXNlcjM4MDg2MTk2",
            "avatar_url": "https://avatars.githubusercontent.com/u/38086196?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Rocheng",
            "html_url": "https://github.com/Rocheng",
            "followers_url": "https://api.github.com/users/Rocheng/followers",
            "following_url": "https://api.github.com/users/Rocheng/following{/other_user}",
            "gists_url": "https://api.github.com/users/Rocheng/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/Rocheng/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/Rocheng/subscriptions",
            "organizations_url": "https://api.github.com/users/Rocheng/orgs",
            "repos_url": "https://api.github.com/users/Rocheng/repos",
            "events_url": "https://api.github.com/users/Rocheng/events{/privacy}",
            "received_events_url": "https://api.github.com/users/Rocheng/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-01-31T18:21:03Z",
        "updated_at": "2020-01-31T18:21:03Z",
        "author_association": "NONE",
        "body": "Thanks Scott.  I thought we had passed the /arch:AVX2 flag, but evidently it did not take effect.  Let me check again.\r\n\r\nI'll go ahead close this bug.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/580849862/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null,
        "event": "commented",
        "actor": {
            "login": "Rocheng",
            "id": 38086196,
            "node_id": "MDQ6VXNlcjM4MDg2MTk2",
            "avatar_url": "https://avatars.githubusercontent.com/u/38086196?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Rocheng",
            "html_url": "https://github.com/Rocheng",
            "followers_url": "https://api.github.com/users/Rocheng/followers",
            "following_url": "https://api.github.com/users/Rocheng/following{/other_user}",
            "gists_url": "https://api.github.com/users/Rocheng/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/Rocheng/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/Rocheng/subscriptions",
            "organizations_url": "https://api.github.com/users/Rocheng/orgs",
            "repos_url": "https://api.github.com/users/Rocheng/repos",
            "events_url": "https://api.github.com/users/Rocheng/events{/privacy}",
            "received_events_url": "https://api.github.com/users/Rocheng/received_events",
            "type": "User",
            "site_admin": false
        }
    },
    {
        "id": 2998042926,
        "node_id": "MDExOkNsb3NlZEV2ZW50Mjk5ODA0MjkyNg==",
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/events/2998042926",
        "actor": {
            "login": "Rocheng",
            "id": 38086196,
            "node_id": "MDQ6VXNlcjM4MDg2MTk2",
            "avatar_url": "https://avatars.githubusercontent.com/u/38086196?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Rocheng",
            "html_url": "https://github.com/Rocheng",
            "followers_url": "https://api.github.com/users/Rocheng/followers",
            "following_url": "https://api.github.com/users/Rocheng/following{/other_user}",
            "gists_url": "https://api.github.com/users/Rocheng/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/Rocheng/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/Rocheng/subscriptions",
            "organizations_url": "https://api.github.com/users/Rocheng/orgs",
            "repos_url": "https://api.github.com/users/Rocheng/repos",
            "events_url": "https://api.github.com/users/Rocheng/events{/privacy}",
            "received_events_url": "https://api.github.com/users/Rocheng/received_events",
            "type": "User",
            "site_admin": false
        },
        "event": "closed",
        "commit_id": null,
        "commit_url": null,
        "created_at": "2020-01-31T18:21:04Z",
        "state_reason": null,
        "performed_via_github_app": null
    }
]