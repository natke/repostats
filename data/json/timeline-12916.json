[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1243105145",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12916#issuecomment-1243105145",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12916",
        "id": 1243105145,
        "node_id": "IC_kwDOCVq1mM5KGEd5",
        "user": {
            "login": "skottmckay",
            "id": 979079,
            "node_id": "MDQ6VXNlcjk3OTA3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/skottmckay",
            "html_url": "https://github.com/skottmckay",
            "followers_url": "https://api.github.com/users/skottmckay/followers",
            "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
            "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
            "organizations_url": "https://api.github.com/users/skottmckay/orgs",
            "repos_url": "https://api.github.com/users/skottmckay/repos",
            "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
            "received_events_url": "https://api.github.com/users/skottmckay/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-12T01:23:33Z",
        "updated_at": "2022-09-12T01:23:33Z",
        "author_association": "MEMBER",
        "body": "The 'Add' operator had some additional types added in opset 14. Those types aren't relevant here, so the existing implementation should work as is.\r\n\r\nCan you try updating the supported opset versions for Add in all places where it has '{7, 13}' to be '{7, 13, 14}'?\r\n\r\ne.g.\r\nhttps://github.com/microsoft/onnxruntime/blob/1e34440c370d40085fad5fd1b1002b4a04c5991d/onnxruntime/core/optimizer/skip_layer_norm_fusion.cc#L165-L167\r\n\r\n\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1243105145/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null,
        "event": "commented",
        "actor": {
            "login": "skottmckay",
            "id": 979079,
            "node_id": "MDQ6VXNlcjk3OTA3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/skottmckay",
            "html_url": "https://github.com/skottmckay",
            "followers_url": "https://api.github.com/users/skottmckay/followers",
            "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
            "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
            "organizations_url": "https://api.github.com/users/skottmckay/orgs",
            "repos_url": "https://api.github.com/users/skottmckay/repos",
            "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
            "received_events_url": "https://api.github.com/users/skottmckay/received_events",
            "type": "User",
            "site_admin": false
        }
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1244593626",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12916#issuecomment-1244593626",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12916",
        "id": 1244593626,
        "node_id": "IC_kwDOCVq1mM5KLv3a",
        "user": {
            "login": "sunnyshu-intel",
            "id": 102830081,
            "node_id": "U_kgDOBiEQAQ",
            "avatar_url": "https://avatars.githubusercontent.com/u/102830081?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sunnyshu-intel",
            "html_url": "https://github.com/sunnyshu-intel",
            "followers_url": "https://api.github.com/users/sunnyshu-intel/followers",
            "following_url": "https://api.github.com/users/sunnyshu-intel/following{/other_user}",
            "gists_url": "https://api.github.com/users/sunnyshu-intel/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/sunnyshu-intel/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/sunnyshu-intel/subscriptions",
            "organizations_url": "https://api.github.com/users/sunnyshu-intel/orgs",
            "repos_url": "https://api.github.com/users/sunnyshu-intel/repos",
            "events_url": "https://api.github.com/users/sunnyshu-intel/events{/privacy}",
            "received_events_url": "https://api.github.com/users/sunnyshu-intel/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-12T22:17:59Z",
        "updated_at": "2022-09-12T22:17:59Z",
        "author_association": "CONTRIBUTOR",
        "body": "> The 'Add' operator had some additional types added in opset 14. Those types aren't relevant here, so the existing implementation should work as is.\r\n> \r\n> Can you try updating the supported opset versions for Add in all places where it has '{7, 13}' to be '{7, 13, 14}'?\r\n> \r\n> e.g.\r\n> \r\n> https://github.com/microsoft/onnxruntime/blob/1e34440c370d40085fad5fd1b1002b4a04c5991d/onnxruntime/core/optimizer/skip_layer_norm_fusion.cc#L165-L167\r\n\r\nI applied changes as follow, recompiled and reinstalled the ort, but it is giving me the same results.\r\n\r\n```bash\r\ndiff --git a/onnxruntime/core/optimizer/skip_layer_norm_fusion.cc b/onnxruntime/core/optimizer/skip_layer_norm_fusion.cc\r\nindex a81ca6705..c980905d8 100644\r\n--- a/onnxruntime/core/optimizer/skip_layer_norm_fusion.cc\r\n+++ b/onnxruntime/core/optimizer/skip_layer_norm_fusion.cc\r\n@@ -163,8 +163,8 @@ Status SkipLayerNormFusion::ApplyImpl(Graph& graph, bool& modified, int graph_le\r\n\r\n     // Format 1\r\n     std::vector<graph_utils::EdgeEndToMatch> format1_parent_path{\r\n-        {0, 0, \"Add\", {7, 13}, kOnnxDomain},\r\n-        {0, 0, \"Add\", {7, 13}, kOnnxDomain}};\r\n+        {0, 0, \"Add\", {7, 13, 14}, kOnnxDomain},\r\n+        {0, 0, \"Add\", {7, 13, 14}, kOnnxDomain}};\r\n\r\n     std::vector<const Node::EdgeEnd*> edges;\r\n     if (graph_utils::FindPath(ln_node, true, format1_parent_path, edges, logger)) {\r\n@@ -182,8 +182,8 @@ Status SkipLayerNormFusion::ApplyImpl(Graph& graph, bool& modified, int graph_le\r\n     if (matched_format == Format::None) {\r\n       // Format 2\r\n       std::vector<graph_utils::EdgeEndToMatch> format2_parent_path{\r\n-          {0, 0, \"Add\", {7, 13}, kOnnxDomain},\r\n-          {0, 1, \"Add\", {7, 13}, kOnnxDomain}};\r\n+          {0, 0, \"Add\", {7, 13, 14}, kOnnxDomain},\r\n+          {0, 1, \"Add\", {7, 13, 14}, kOnnxDomain}};\r\n\r\n       if (graph_utils::FindPath(ln_node, true, format2_parent_path, edges, logger)) {\r\n         p_add1 = const_cast<Node*>(&edges[0]->GetNode());\r\n@@ -201,7 +201,7 @@ Status SkipLayerNormFusion::ApplyImpl(Graph& graph, bool& modified, int graph_le\r\n     if (matched_format == Format::None) {\r\n       // Format 3\r\n       std::vector<graph_utils::EdgeEndToMatch> format3_parent_path{\r\n-          {0, 0, \"Add\", {7, 13}, kOnnxDomain}};\r\n+          {0, 0, \"Add\", {7, 13, 14}, kOnnxDomain}};\r\n\r\n       if (graph_utils::FindPath(ln_node, true, format3_parent_path, edges, logger)) {\r\n         p_add1 = const_cast<Node*>(&edges[0]->GetNode());\r\n```\r\n\r\nOne more thing when I checked graph optimization with **CPUExecutionProvider**, for both the cases the desired and undesired results was exactly as described in the question. But when I changed execution provider to **DnnlExecutionProvider** in **_ort.InferenceSession_**, for both the  cases I get the following error.\r\n\r\n```bash\r\nonnxruntime.capi.onnxruntime_pybind11_state.Fail: [ONNXRuntimeError] : 1 : FAIL : Unable to serialize model as it contains compiled nodes. Please disable any execution providers which generate compiled nodes.\r\n```\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1244593626/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null,
        "event": "commented",
        "actor": {
            "login": "sunnyshu-intel",
            "id": 102830081,
            "node_id": "U_kgDOBiEQAQ",
            "avatar_url": "https://avatars.githubusercontent.com/u/102830081?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sunnyshu-intel",
            "html_url": "https://github.com/sunnyshu-intel",
            "followers_url": "https://api.github.com/users/sunnyshu-intel/followers",
            "following_url": "https://api.github.com/users/sunnyshu-intel/following{/other_user}",
            "gists_url": "https://api.github.com/users/sunnyshu-intel/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/sunnyshu-intel/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/sunnyshu-intel/subscriptions",
            "organizations_url": "https://api.github.com/users/sunnyshu-intel/orgs",
            "repos_url": "https://api.github.com/users/sunnyshu-intel/repos",
            "events_url": "https://api.github.com/users/sunnyshu-intel/events{/privacy}",
            "received_events_url": "https://api.github.com/users/sunnyshu-intel/received_events",
            "type": "User",
            "site_admin": false
        }
    },
    {
        "actor": {
            "login": "skottmckay",
            "id": 979079,
            "node_id": "MDQ6VXNlcjk3OTA3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/skottmckay",
            "html_url": "https://github.com/skottmckay",
            "followers_url": "https://api.github.com/users/skottmckay/followers",
            "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
            "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
            "organizations_url": "https://api.github.com/users/skottmckay/orgs",
            "repos_url": "https://api.github.com/users/skottmckay/repos",
            "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
            "received_events_url": "https://api.github.com/users/skottmckay/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-15T10:33:32Z",
        "updated_at": "2022-09-15T10:33:32Z",
        "source": {
            "type": "issue",
            "issue": {
                "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12978",
                "repository_url": "https://api.github.com/repos/microsoft/onnxruntime",
                "labels_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12978/labels{/name}",
                "comments_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12978/comments",
                "events_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12978/events",
                "html_url": "https://github.com/microsoft/onnxruntime/pull/12978",
                "id": 1374306659,
                "node_id": "PR_kwDOCVq1mM4_A5Kb",
                "number": 12978,
                "title": "Add ONNX LayerNormalization(17) ",
                "user": {
                    "login": "skottmckay",
                    "id": 979079,
                    "node_id": "MDQ6VXNlcjk3OTA3OQ==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/skottmckay",
                    "html_url": "https://github.com/skottmckay",
                    "followers_url": "https://api.github.com/users/skottmckay/followers",
                    "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
                    "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
                    "organizations_url": "https://api.github.com/users/skottmckay/orgs",
                    "repos_url": "https://api.github.com/users/skottmckay/repos",
                    "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/skottmckay/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "labels": [],
                "state": "closed",
                "locked": false,
                "assignee": null,
                "assignees": [],
                "milestone": null,
                "comments": 6,
                "created_at": "2022-09-15T10:33:32Z",
                "updated_at": "2022-09-22T23:49:29Z",
                "closed_at": "2022-09-22T23:49:28Z",
                "author_association": "MEMBER",
                "active_lock_reason": null,
                "draft": false,
                "repository": {
                    "id": 156939672,
                    "node_id": "MDEwOlJlcG9zaXRvcnkxNTY5Mzk2NzI=",
                    "name": "onnxruntime",
                    "full_name": "microsoft/onnxruntime",
                    "private": false,
                    "owner": {
                        "login": "microsoft",
                        "id": 6154722,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjYxNTQ3MjI=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/6154722?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/microsoft",
                        "html_url": "https://github.com/microsoft",
                        "followers_url": "https://api.github.com/users/microsoft/followers",
                        "following_url": "https://api.github.com/users/microsoft/following{/other_user}",
                        "gists_url": "https://api.github.com/users/microsoft/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/microsoft/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/microsoft/subscriptions",
                        "organizations_url": "https://api.github.com/users/microsoft/orgs",
                        "repos_url": "https://api.github.com/users/microsoft/repos",
                        "events_url": "https://api.github.com/users/microsoft/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/microsoft/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "html_url": "https://github.com/microsoft/onnxruntime",
                    "description": "ONNX Runtime: cross-platform, high performance ML inferencing and training accelerator",
                    "fork": false,
                    "url": "https://api.github.com/repos/microsoft/onnxruntime",
                    "forks_url": "https://api.github.com/repos/microsoft/onnxruntime/forks",
                    "keys_url": "https://api.github.com/repos/microsoft/onnxruntime/keys{/key_id}",
                    "collaborators_url": "https://api.github.com/repos/microsoft/onnxruntime/collaborators{/collaborator}",
                    "teams_url": "https://api.github.com/repos/microsoft/onnxruntime/teams",
                    "hooks_url": "https://api.github.com/repos/microsoft/onnxruntime/hooks",
                    "issue_events_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/events{/number}",
                    "events_url": "https://api.github.com/repos/microsoft/onnxruntime/events",
                    "assignees_url": "https://api.github.com/repos/microsoft/onnxruntime/assignees{/user}",
                    "branches_url": "https://api.github.com/repos/microsoft/onnxruntime/branches{/branch}",
                    "tags_url": "https://api.github.com/repos/microsoft/onnxruntime/tags",
                    "blobs_url": "https://api.github.com/repos/microsoft/onnxruntime/git/blobs{/sha}",
                    "git_tags_url": "https://api.github.com/repos/microsoft/onnxruntime/git/tags{/sha}",
                    "git_refs_url": "https://api.github.com/repos/microsoft/onnxruntime/git/refs{/sha}",
                    "trees_url": "https://api.github.com/repos/microsoft/onnxruntime/git/trees{/sha}",
                    "statuses_url": "https://api.github.com/repos/microsoft/onnxruntime/statuses/{sha}",
                    "languages_url": "https://api.github.com/repos/microsoft/onnxruntime/languages",
                    "stargazers_url": "https://api.github.com/repos/microsoft/onnxruntime/stargazers",
                    "contributors_url": "https://api.github.com/repos/microsoft/onnxruntime/contributors",
                    "subscribers_url": "https://api.github.com/repos/microsoft/onnxruntime/subscribers",
                    "subscription_url": "https://api.github.com/repos/microsoft/onnxruntime/subscription",
                    "commits_url": "https://api.github.com/repos/microsoft/onnxruntime/commits{/sha}",
                    "git_commits_url": "https://api.github.com/repos/microsoft/onnxruntime/git/commits{/sha}",
                    "comments_url": "https://api.github.com/repos/microsoft/onnxruntime/comments{/number}",
                    "issue_comment_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments{/number}",
                    "contents_url": "https://api.github.com/repos/microsoft/onnxruntime/contents/{+path}",
                    "compare_url": "https://api.github.com/repos/microsoft/onnxruntime/compare/{base}...{head}",
                    "merges_url": "https://api.github.com/repos/microsoft/onnxruntime/merges",
                    "archive_url": "https://api.github.com/repos/microsoft/onnxruntime/{archive_format}{/ref}",
                    "downloads_url": "https://api.github.com/repos/microsoft/onnxruntime/downloads",
                    "issues_url": "https://api.github.com/repos/microsoft/onnxruntime/issues{/number}",
                    "pulls_url": "https://api.github.com/repos/microsoft/onnxruntime/pulls{/number}",
                    "milestones_url": "https://api.github.com/repos/microsoft/onnxruntime/milestones{/number}",
                    "notifications_url": "https://api.github.com/repos/microsoft/onnxruntime/notifications{?since,all,participating}",
                    "labels_url": "https://api.github.com/repos/microsoft/onnxruntime/labels{/name}",
                    "releases_url": "https://api.github.com/repos/microsoft/onnxruntime/releases{/id}",
                    "deployments_url": "https://api.github.com/repos/microsoft/onnxruntime/deployments",
                    "created_at": "2018-11-10T02:22:53Z",
                    "updated_at": "2022-12-20T19:02:34Z",
                    "pushed_at": "2022-12-20T19:11:59Z",
                    "git_url": "git://github.com/microsoft/onnxruntime.git",
                    "ssh_url": "git@github.com:microsoft/onnxruntime.git",
                    "clone_url": "https://github.com/microsoft/onnxruntime.git",
                    "svn_url": "https://github.com/microsoft/onnxruntime",
                    "homepage": "https://www.onnxruntime.ai",
                    "size": 1018648,
                    "stargazers_count": 7949,
                    "watchers_count": 7949,
                    "language": "C++",
                    "has_issues": true,
                    "has_projects": true,
                    "has_downloads": true,
                    "has_wiki": true,
                    "has_pages": true,
                    "has_discussions": true,
                    "forks_count": 1862,
                    "mirror_url": null,
                    "archived": false,
                    "disabled": false,
                    "open_issues_count": 1453,
                    "license": {
                        "key": "mit",
                        "name": "MIT License",
                        "spdx_id": "MIT",
                        "url": "https://api.github.com/licenses/mit",
                        "node_id": "MDc6TGljZW5zZTEz"
                    },
                    "allow_forking": true,
                    "is_template": false,
                    "web_commit_signoff_required": false,
                    "topics": [
                        "ai-framework",
                        "deep-learning",
                        "hacktoberfest",
                        "hardware-acceleration",
                        "machine-learning",
                        "neural-networks",
                        "onnx",
                        "pytorch",
                        "scikit-learn",
                        "tensorflow"
                    ],
                    "visibility": "public",
                    "forks": 1862,
                    "open_issues": 1453,
                    "watchers": 7949,
                    "default_branch": "main",
                    "permissions": {
                        "admin": false,
                        "maintain": true,
                        "push": true,
                        "triage": true,
                        "pull": true
                    }
                },
                "pull_request": {
                    "url": "https://api.github.com/repos/microsoft/onnxruntime/pulls/12978",
                    "html_url": "https://github.com/microsoft/onnxruntime/pull/12978",
                    "diff_url": "https://github.com/microsoft/onnxruntime/pull/12978.diff",
                    "patch_url": "https://github.com/microsoft/onnxruntime/pull/12978.patch",
                    "merged_at": "2022-09-22T23:49:28Z"
                },
                "body": "**Description**: LayerNormalization is now part of the ONNX spec as of opset 17.\r\nWe had a LayerNormalization contrib op, which (incorrectly) was registered in the ONNX domain. Use that implementation for the ONNX operator.\r\n\r\nTODO: Check the ONNX spec matches the contrib op implementation to validate we can re-use it. \r\n\r\nUpdate skip_layer_norm_fusion.cc. There are other optimizers that use LayerNormalization that need updates as well.\r\n\r\n**Motivation and Context**\r\n#12916 ",
                "reactions": {
                    "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12978/reactions",
                    "total_count": 1,
                    "+1": 1,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "timeline_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12978/timeline",
                "performed_via_github_app": null,
                "state_reason": null
            }
        },
        "event": "cross-referenced"
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1247913027",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12916#issuecomment-1247913027",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12916",
        "id": 1247913027,
        "node_id": "IC_kwDOCVq1mM5KYaRD",
        "user": {
            "login": "skottmckay",
            "id": 979079,
            "node_id": "MDQ6VXNlcjk3OTA3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/skottmckay",
            "html_url": "https://github.com/skottmckay",
            "followers_url": "https://api.github.com/users/skottmckay/followers",
            "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
            "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
            "organizations_url": "https://api.github.com/users/skottmckay/orgs",
            "repos_url": "https://api.github.com/users/skottmckay/repos",
            "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
            "received_events_url": "https://api.github.com/users/skottmckay/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-15T10:34:01Z",
        "updated_at": "2022-09-15T10:34:01Z",
        "author_association": "MEMBER",
        "body": "Couple of factors here. \r\n\r\nOriginally LayerNormalization was an ORT internal operator. Unfortunately when it was created it was defined as using the ONNX domain which slightly confuses things as it's using the ONNX opset instead of the ORT domain's opset to match a kernel.\r\n\r\nThe latest version of ONNX adds an official LayerNormalization operator, and because the internal operator is using the ONNX domain instead of our internal domain, it now matches the ONNX operator in opset 17. The ONNX LayerNormalization is defined as a function. As there's no kernel registered for ONNX opset 17 in ORT to handle LayerNormalization the function gets expanded into the nodes that you see, which happens prior to fusion.\r\n\r\nQuickest option would be to use opset 16 for your model (would still require the update to add opset 14 of 'Add' to the optimizer).\r\n\r\nThis draft PR (#12978) will do the fusion as expected, but I haven't verified that there are no diffs between the ONNX spec and what the contrib op does.\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1247913027/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null,
        "event": "commented",
        "actor": {
            "login": "skottmckay",
            "id": 979079,
            "node_id": "MDQ6VXNlcjk3OTA3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/skottmckay",
            "html_url": "https://github.com/skottmckay",
            "followers_url": "https://api.github.com/users/skottmckay/followers",
            "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
            "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
            "organizations_url": "https://api.github.com/users/skottmckay/orgs",
            "repos_url": "https://api.github.com/users/skottmckay/repos",
            "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
            "received_events_url": "https://api.github.com/users/skottmckay/received_events",
            "type": "User",
            "site_admin": false
        }
    },
    {
        "id": 7398938565,
        "node_id": "RTE_lADOCVq1mM5Rj1PkzwAAAAG5AtfF",
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/events/7398938565",
        "actor": {
            "login": "sunnyshu-intel",
            "id": 102830081,
            "node_id": "U_kgDOBiEQAQ",
            "avatar_url": "https://avatars.githubusercontent.com/u/102830081?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sunnyshu-intel",
            "html_url": "https://github.com/sunnyshu-intel",
            "followers_url": "https://api.github.com/users/sunnyshu-intel/followers",
            "following_url": "https://api.github.com/users/sunnyshu-intel/following{/other_user}",
            "gists_url": "https://api.github.com/users/sunnyshu-intel/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/sunnyshu-intel/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/sunnyshu-intel/subscriptions",
            "organizations_url": "https://api.github.com/users/sunnyshu-intel/orgs",
            "repos_url": "https://api.github.com/users/sunnyshu-intel/repos",
            "events_url": "https://api.github.com/users/sunnyshu-intel/events{/privacy}",
            "received_events_url": "https://api.github.com/users/sunnyshu-intel/received_events",
            "type": "User",
            "site_admin": false
        },
        "event": "renamed",
        "commit_id": null,
        "commit_url": null,
        "created_at": "2022-09-15T23:22:32Z",
        "rename": {
            "from": "Graph Optimization which converts SkipLayerNorm to Add + LayerNorm doesn't work with onnx models generated using newer version of onnx and onnxruntime.",
            "to": "Graph Optimization which converts SkipLayerNorm from Add + LayerNorm doesn't work with onnx models generated using newer version of onnx and onnxruntime."
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1252725055",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12916#issuecomment-1252725055",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12916",
        "id": 1252725055,
        "node_id": "IC_kwDOCVq1mM5KqxE_",
        "user": {
            "login": "sunnyshu-intel",
            "id": 102830081,
            "node_id": "U_kgDOBiEQAQ",
            "avatar_url": "https://avatars.githubusercontent.com/u/102830081?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sunnyshu-intel",
            "html_url": "https://github.com/sunnyshu-intel",
            "followers_url": "https://api.github.com/users/sunnyshu-intel/followers",
            "following_url": "https://api.github.com/users/sunnyshu-intel/following{/other_user}",
            "gists_url": "https://api.github.com/users/sunnyshu-intel/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/sunnyshu-intel/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/sunnyshu-intel/subscriptions",
            "organizations_url": "https://api.github.com/users/sunnyshu-intel/orgs",
            "repos_url": "https://api.github.com/users/sunnyshu-intel/repos",
            "events_url": "https://api.github.com/users/sunnyshu-intel/events{/privacy}",
            "received_events_url": "https://api.github.com/users/sunnyshu-intel/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-09-20T18:08:59Z",
        "updated_at": "2022-09-20T20:59:01Z",
        "author_association": "CONTRIBUTOR",
        "body": "This issue is taken care of by the draft PR (#12978). I have checked it with the latest [patch](https://patch-diff.githubusercontent.com/raw/microsoft/onnxruntime/pull/12978.patch). The method I used to check is described in this [reply](https://github.com/microsoft/onnxruntime/pull/12978#issuecomment-1248743483) to the draft PR (#12978) which is the same as the [start](https://github.com/microsoft/onnxruntime/issues/12916#issue-1368347620) of the current issue (#12916). It seems to work and give the desired results.\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1252725055/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null,
        "event": "commented",
        "actor": {
            "login": "sunnyshu-intel",
            "id": 102830081,
            "node_id": "U_kgDOBiEQAQ",
            "avatar_url": "https://avatars.githubusercontent.com/u/102830081?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sunnyshu-intel",
            "html_url": "https://github.com/sunnyshu-intel",
            "followers_url": "https://api.github.com/users/sunnyshu-intel/followers",
            "following_url": "https://api.github.com/users/sunnyshu-intel/following{/other_user}",
            "gists_url": "https://api.github.com/users/sunnyshu-intel/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/sunnyshu-intel/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/sunnyshu-intel/subscriptions",
            "organizations_url": "https://api.github.com/users/sunnyshu-intel/orgs",
            "repos_url": "https://api.github.com/users/sunnyshu-intel/repos",
            "events_url": "https://api.github.com/users/sunnyshu-intel/events{/privacy}",
            "received_events_url": "https://api.github.com/users/sunnyshu-intel/received_events",
            "type": "User",
            "site_admin": false
        }
    },
    {
        "id": 7424593601,
        "node_id": "CE_lADOCVq1mM5Rj1PkzwAAAAG6ik7B",
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/events/7424593601",
        "actor": {
            "login": "sunnyshu-intel",
            "id": 102830081,
            "node_id": "U_kgDOBiEQAQ",
            "avatar_url": "https://avatars.githubusercontent.com/u/102830081?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sunnyshu-intel",
            "html_url": "https://github.com/sunnyshu-intel",
            "followers_url": "https://api.github.com/users/sunnyshu-intel/followers",
            "following_url": "https://api.github.com/users/sunnyshu-intel/following{/other_user}",
            "gists_url": "https://api.github.com/users/sunnyshu-intel/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/sunnyshu-intel/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/sunnyshu-intel/subscriptions",
            "organizations_url": "https://api.github.com/users/sunnyshu-intel/orgs",
            "repos_url": "https://api.github.com/users/sunnyshu-intel/repos",
            "events_url": "https://api.github.com/users/sunnyshu-intel/events{/privacy}",
            "received_events_url": "https://api.github.com/users/sunnyshu-intel/received_events",
            "type": "User",
            "site_admin": false
        },
        "event": "closed",
        "commit_id": null,
        "commit_url": null,
        "created_at": "2022-09-20T18:09:00Z",
        "state_reason": null,
        "performed_via_github_app": null
    },
    {
        "id": 7443612492,
        "node_id": "REFE_lADOCVq1mM5Rj1PkzwAAAAG7rINM",
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/events/7443612492",
        "actor": {
            "login": "skottmckay",
            "id": 979079,
            "node_id": "MDQ6VXNlcjk3OTA3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/skottmckay",
            "html_url": "https://github.com/skottmckay",
            "followers_url": "https://api.github.com/users/skottmckay/followers",
            "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
            "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
            "organizations_url": "https://api.github.com/users/skottmckay/orgs",
            "repos_url": "https://api.github.com/users/skottmckay/repos",
            "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
            "received_events_url": "https://api.github.com/users/skottmckay/received_events",
            "type": "User",
            "site_admin": false
        },
        "event": "referenced",
        "commit_id": "394c249c7cd2634a74f1eef55a108a6f5a1bff54",
        "commit_url": "https://api.github.com/repos/microsoft/onnxruntime/commits/394c249c7cd2634a74f1eef55a108a6f5a1bff54",
        "created_at": "2022-09-22T23:49:29Z",
        "performed_via_github_app": null
    },
    {
        "id": 7498494678,
        "node_id": "REFE_lADOCVq1mM5Rj1PkzwAAAAG-8fLW",
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/events/7498494678",
        "actor": {
            "login": "linnealovespie",
            "id": 5448665,
            "node_id": "MDQ6VXNlcjU0NDg2NjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5448665?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/linnealovespie",
            "html_url": "https://github.com/linnealovespie",
            "followers_url": "https://api.github.com/users/linnealovespie/followers",
            "following_url": "https://api.github.com/users/linnealovespie/following{/other_user}",
            "gists_url": "https://api.github.com/users/linnealovespie/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/linnealovespie/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/linnealovespie/subscriptions",
            "organizations_url": "https://api.github.com/users/linnealovespie/orgs",
            "repos_url": "https://api.github.com/users/linnealovespie/repos",
            "events_url": "https://api.github.com/users/linnealovespie/events{/privacy}",
            "received_events_url": "https://api.github.com/users/linnealovespie/received_events",
            "type": "User",
            "site_admin": false
        },
        "event": "referenced",
        "commit_id": "277796a2ca8ef3d8a2386c1dfc381be978e83006",
        "commit_url": "https://api.github.com/repos/microsoft/onnxruntime/commits/277796a2ca8ef3d8a2386c1dfc381be978e83006",
        "created_at": "2022-09-30T20:31:49Z",
        "performed_via_github_app": null
    }
]