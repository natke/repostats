[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1040693027",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10564#issuecomment-1040693027",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10564",
        "id": 1040693027,
        "node_id": "IC_kwDOCVq1mM4-B7cj",
        "user": {
            "login": "RyanUnderhill",
            "id": 38674843,
            "node_id": "MDQ6VXNlcjM4Njc0ODQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/38674843?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/RyanUnderhill",
            "html_url": "https://github.com/RyanUnderhill",
            "followers_url": "https://api.github.com/users/RyanUnderhill/followers",
            "following_url": "https://api.github.com/users/RyanUnderhill/following{/other_user}",
            "gists_url": "https://api.github.com/users/RyanUnderhill/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/RyanUnderhill/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/RyanUnderhill/subscriptions",
            "organizations_url": "https://api.github.com/users/RyanUnderhill/orgs",
            "repos_url": "https://api.github.com/users/RyanUnderhill/repos",
            "events_url": "https://api.github.com/users/RyanUnderhill/events{/privacy}",
            "received_events_url": "https://api.github.com/users/RyanUnderhill/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-02-15T19:19:59Z",
        "updated_at": "2022-02-15T19:19:59Z",
        "author_association": "MEMBER",
        "body": "For the alternative you tried, you should be able to pass an Ort::Session to any C API function that takes an OrtSession* without accessing the p_ member. There are conversion operators in every C++ type to return the C type to make this automatic (https://github.com/microsoft/onnxruntime/blob/0c3e88944d789a6779f3722eb0cf67710b3dab3f/include/onnxruntime/core/session/onnxruntime_cxx_api.h#L205). Does that help?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1040693027/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1040694010",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10564#issuecomment-1040694010",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10564",
        "id": 1040694010,
        "node_id": "IC_kwDOCVq1mM4-B7r6",
        "user": {
            "login": "guoyu-wang",
            "id": 62914304,
            "node_id": "MDQ6VXNlcjYyOTE0MzA0",
            "avatar_url": "https://avatars.githubusercontent.com/u/62914304?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/guoyu-wang",
            "html_url": "https://github.com/guoyu-wang",
            "followers_url": "https://api.github.com/users/guoyu-wang/followers",
            "following_url": "https://api.github.com/users/guoyu-wang/following{/other_user}",
            "gists_url": "https://api.github.com/users/guoyu-wang/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/guoyu-wang/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/guoyu-wang/subscriptions",
            "organizations_url": "https://api.github.com/users/guoyu-wang/orgs",
            "repos_url": "https://api.github.com/users/guoyu-wang/repos",
            "events_url": "https://api.github.com/users/guoyu-wang/events{/privacy}",
            "received_events_url": "https://api.github.com/users/guoyu-wang/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-02-15T19:21:06Z",
        "updated_at": "2022-02-15T19:21:06Z",
        "author_association": "CONTRIBUTOR",
        "body": "In reality, it is not feasible to convert C++ API and all the internal code from throwing exception to returning status, plus `abort()` can happen on external code ORT are referencing.\r\n\r\nYou may try our C API, to create session with a return status.\r\n\r\nhttps://github.com/microsoft/onnxruntime/blob/0c3e88944d789a6779f3722eb0cf67710b3dab3f/include/onnxruntime/core/session/onnxruntime_c_api.h#L666-L667",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1040694010/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1041143005",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10564#issuecomment-1041143005",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10564",
        "id": 1041143005,
        "node_id": "IC_kwDOCVq1mM4-DpTd",
        "user": {
            "login": "leandro-gracia-gil",
            "id": 8785797,
            "node_id": "MDQ6VXNlcjg3ODU3OTc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8785797?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/leandro-gracia-gil",
            "html_url": "https://github.com/leandro-gracia-gil",
            "followers_url": "https://api.github.com/users/leandro-gracia-gil/followers",
            "following_url": "https://api.github.com/users/leandro-gracia-gil/following{/other_user}",
            "gists_url": "https://api.github.com/users/leandro-gracia-gil/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/leandro-gracia-gil/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/leandro-gracia-gil/subscriptions",
            "organizations_url": "https://api.github.com/users/leandro-gracia-gil/orgs",
            "repos_url": "https://api.github.com/users/leandro-gracia-gil/repos",
            "events_url": "https://api.github.com/users/leandro-gracia-gil/events{/privacy}",
            "received_events_url": "https://api.github.com/users/leandro-gracia-gil/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-02-16T06:08:37Z",
        "updated_at": "2022-02-16T07:31:15Z",
        "author_association": "CONTRIBUTOR",
        "body": "@RyanUnderhill\r\nThanks for the suggestion, but that does not seem to work in my case. I'm trying to call this (minus the ThrowOnError):\r\n\r\nhttps://github.com/microsoft/onnxruntime/blob/0c3e88944d789a6779f3722eb0cf67710b3dab3f/include/onnxruntime/core/session/onnxruntime_cxx_inline.h#L561\r\n\r\nDespite `Ort::Session` being covertible to `OrtSession*`, what I need is to pass a `OrtSession**` to receive the result, and for that I'd need direct access to the underlying pointer. Similarly, there's currently no way to create a `Ort::Session` from a `OrtSession*`, which could also solve the issue. Though I understand that this latter approach can be unsafe if you don't effectively transfer management of the pointer.\r\n\r\n@gwang-msft \r\nUsing the C API might be possible, but then I'll end mixing C and C++ APIs to workaround design limitations. In fact, because of the issue I just described above, this wouldn't affect just session creation but it would force me to use C APIs for anything related to sessions.\r\n\r\nWould it be reasonable to create something like a GetLastStatus function combined with some way to disable automatic `abort()` in `ORT_CXX_API_THROW` when exceptions are disabled? The last status could then be simply set by `ThrowOnError`.\r\n\r\nUsing a GetLastStatus-like function brings in thread safety issues, although I don't know if the current C++ API is thread-safe or not. If it is, maybe storing this status information in thread-local variables could help, although I'm not familiar enough with the inner implementation details to say this confidently.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1041143005/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1042476628",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10564#issuecomment-1042476628",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10564",
        "id": 1042476628,
        "node_id": "IC_kwDOCVq1mM4-Iu5U",
        "user": {
            "login": "RyanUnderhill",
            "id": 38674843,
            "node_id": "MDQ6VXNlcjM4Njc0ODQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/38674843?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/RyanUnderhill",
            "html_url": "https://github.com/RyanUnderhill",
            "followers_url": "https://api.github.com/users/RyanUnderhill/followers",
            "following_url": "https://api.github.com/users/RyanUnderhill/following{/other_user}",
            "gists_url": "https://api.github.com/users/RyanUnderhill/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/RyanUnderhill/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/RyanUnderhill/subscriptions",
            "organizations_url": "https://api.github.com/users/RyanUnderhill/orgs",
            "repos_url": "https://api.github.com/users/RyanUnderhill/repos",
            "events_url": "https://api.github.com/users/RyanUnderhill/events{/privacy}",
            "received_events_url": "https://api.github.com/users/RyanUnderhill/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-02-17T01:26:44Z",
        "updated_at": "2022-02-17T01:26:44Z",
        "author_association": "MEMBER",
        "body": "Ah, I see what you mean. Since the C++ wrapper classes are just holding the individual pointers, you could reinterpret_cast<OrtSession **>(&session) but that would be dangerous if you want long term safety.\r\n\r\nWe do have this in some classes: https://github.com/microsoft/onnxruntime/blob/4f76c386862bfe6dcba5a427969f0071b95a9ab9/include/onnxruntime/core/session/onnxruntime_cxx_api.h#L326\r\n\r\nAnd we could certainly add that to the other classes to be consistent, but it won't solve your general problem of a C++ API that doesn't throw exceptions.\r\n\r\nSince the C++ headers are simply a wrapper around the C API, you could just make a local copy of them and do a small modification to do a SetLastError approach like you mention above. Looks like all you need to do is have your own version of this macro: #define ORT_CXX_API_THROW(string, code).\r\n\r\nWe could probably modify the code so that if the user has already defined ORT_CXX_API_THROW that we won't use our own macro. To allow custom exception creation (or not using exceptions) in the client for special cases like this.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1042476628/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1042642740",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10564#issuecomment-1042642740",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10564",
        "id": 1042642740,
        "node_id": "IC_kwDOCVq1mM4-JXc0",
        "user": {
            "login": "leandro-gracia-gil",
            "id": 8785797,
            "node_id": "MDQ6VXNlcjg3ODU3OTc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8785797?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/leandro-gracia-gil",
            "html_url": "https://github.com/leandro-gracia-gil",
            "followers_url": "https://api.github.com/users/leandro-gracia-gil/followers",
            "following_url": "https://api.github.com/users/leandro-gracia-gil/following{/other_user}",
            "gists_url": "https://api.github.com/users/leandro-gracia-gil/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/leandro-gracia-gil/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/leandro-gracia-gil/subscriptions",
            "organizations_url": "https://api.github.com/users/leandro-gracia-gil/orgs",
            "repos_url": "https://api.github.com/users/leandro-gracia-gil/repos",
            "events_url": "https://api.github.com/users/leandro-gracia-gil/events{/privacy}",
            "received_events_url": "https://api.github.com/users/leandro-gracia-gil/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-02-17T07:16:57Z",
        "updated_at": "2022-02-17T07:16:57Z",
        "author_association": "CONTRIBUTOR",
        "body": "> Since the C++ headers are simply a wrapper around the C API, you could just make a local copy of them and do a small modification to do a SetLastError approach like you mention above. Looks like all you need to do is have your own version of this macro: #define ORT_CXX_API_THROW(string, code).\r\n\r\nActually, that doesn't fully work either because `ORT_CXX_API_THROW` is only used in case of error, so it wouldn't catch the cases where things worked fine. Fixing that would require also changing `ThrowOnError`.\r\nhttps://github.com/microsoft/onnxruntime/blob/4f76c386862bfe6dcba5a427969f0071b95a9ab9/include/onnxruntime/core/session/onnxruntime_cxx_inline.h#L12\r\n\r\nI could probably hack my way out of the headers, but if possible I'd prefer to avoid it since this adds the task of merging local changes on library updates. It's not a big task to do, but it is error-prone in the long term.\r\n\r\nWould it be possible to figure out a good approach for this and push it upstream?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1042642740/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1043861748",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10564#issuecomment-1043861748",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10564",
        "id": 1043861748,
        "node_id": "IC_kwDOCVq1mM4-OBD0",
        "user": {
            "login": "RyanUnderhill",
            "id": 38674843,
            "node_id": "MDQ6VXNlcjM4Njc0ODQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/38674843?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/RyanUnderhill",
            "html_url": "https://github.com/RyanUnderhill",
            "followers_url": "https://api.github.com/users/RyanUnderhill/followers",
            "following_url": "https://api.github.com/users/RyanUnderhill/following{/other_user}",
            "gists_url": "https://api.github.com/users/RyanUnderhill/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/RyanUnderhill/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/RyanUnderhill/subscriptions",
            "organizations_url": "https://api.github.com/users/RyanUnderhill/orgs",
            "repos_url": "https://api.github.com/users/RyanUnderhill/repos",
            "events_url": "https://api.github.com/users/RyanUnderhill/events{/privacy}",
            "received_events_url": "https://api.github.com/users/RyanUnderhill/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-02-18T04:12:34Z",
        "updated_at": "2022-02-18T04:12:54Z",
        "author_association": "MEMBER",
        "body": "I was expecting the errors to be sticky, in that it's not clearing the error when no error happens, that's something you as the user would do. So when your client code handles an error, you then clear it, then it's ready for the next error.\r\n\r\nSo, hypothetically:\r\n\r\n```\r\nstruct OrtError { std::string error; OrtErrorCode error_code };\r\n\r\nvoid SetLastOrtError(std::string error, OrtErrorCode error_code) { /* Store the error, generate an error if one is already set*/ }\r\nOrtError GetLastOrtError() { /* Retreive the last error, and clear the error storage */ }\r\n\r\n#define ORT_CXX_API_THROW(string, code) SetLastOrtError(string, code)\r\n```\r\n\r\n**Disclaimer**\r\n\r\nThis could run into cases where you'll be forced to call abort() or use some other mechanism like setjmp/etc.. to avoid having the code set an error, then instead of throwing and leaving the scope of execution, it would then call the next method which would fail/crash on the output of the previous failed function. For example, the Env::Env constructors.\r\n\r\nSo... with that said\r\n\r\nI could probably justify doing the simple change for #ifdef ORT_CXX_API_THROW inside the ORT_NO_EXCEPTIONS block, but going beyond that would surely get pushback to just use the C API.\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1043861748/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1044166429",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10564#issuecomment-1044166429",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10564",
        "id": 1044166429,
        "node_id": "IC_kwDOCVq1mM4-PLcd",
        "user": {
            "login": "leandro-gracia-gil",
            "id": 8785797,
            "node_id": "MDQ6VXNlcjg3ODU3OTc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8785797?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/leandro-gracia-gil",
            "html_url": "https://github.com/leandro-gracia-gil",
            "followers_url": "https://api.github.com/users/leandro-gracia-gil/followers",
            "following_url": "https://api.github.com/users/leandro-gracia-gil/following{/other_user}",
            "gists_url": "https://api.github.com/users/leandro-gracia-gil/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/leandro-gracia-gil/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/leandro-gracia-gil/subscriptions",
            "organizations_url": "https://api.github.com/users/leandro-gracia-gil/orgs",
            "repos_url": "https://api.github.com/users/leandro-gracia-gil/repos",
            "events_url": "https://api.github.com/users/leandro-gracia-gil/events{/privacy}",
            "received_events_url": "https://api.github.com/users/leandro-gracia-gil/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-02-18T08:55:13Z",
        "updated_at": "2022-02-18T09:07:25Z",
        "author_association": "CONTRIBUTOR",
        "body": "I see, so then using the API would be something like...\r\n\r\n```c++\r\n// Clear last error.\r\nGetLastOrtError();\r\n\r\nOrt::Env env{ORT_LOGGING_LEVEL_WARNING, \"test\"};\r\nOrtError last_error = GetLastOrtError();\r\nif (last_error.error_code) { ... }\r\n\r\nOrt::Session session{env, L\"model.onnx\", Ort::SessionOptions{nullptr}};\r\nlast_error = GetLastOrtError();\r\nif (last_error.error_code) { ... }\r\n```\r\n\r\nSounds reasonable and simple enough.\r\n\r\nHowever, my current use case is not just a piece of code where I can define these extra functions before including `onnxruntime_cxx_api.h`. Rather, it's part of building a plugin that enables using ORT in a much bigger codebase and exposes its headers to other code that is not necessarily under my control. So, while I can easily add global definitions like `ORT_CXX_API_THROW` that would affect everywhere, I cannot implement these extra functions without changing the API headers or adding additional headers that should be used instead of it.\r\n\r\nSo, it would be great if these extra functions could also be added to the API, but I understand there might be pushback beyond not redefining `ORT_CXX_API_THROW`if it already exists.\r\n\r\nAlso, there's a subtle catch in the implementation of your proposal. Having `GetLastOrtError` and `SetLastOrtError` as separate functions requires a global static `OrtError` object that will run the `std::string` constructor on static initialization, which might be undesirable in some situations involving dynamic libraries that my use case also happens to hit (I'm aware of `ORT_API_MANUAL_INIT`). To avoid this an extra function would be needed:\r\n\r\n```c++\r\nnamespace Ort {\r\n\r\n    struct Error {\r\n        std::string error_message;\r\n        OrtErrorCode error_code{ ORT_OK };\r\n    };\r\n\r\n    inline Error& GetStoredError() {\r\n        static thread_local Error stored_error;\r\n        return stored_error;\r\n    }\r\n\r\n    inline void SetLastError(std::string error_message, OrtErrorCode error_code) {\r\n        GetStoredError() = Error{ std::move(error_message), error_code };\r\n    }\r\n\r\n    inline Error GetLastError() {\r\n        Error last_error = std::move(GetStoredError());\r\n        GetStoredError() = Error{};\r\n        return last_error;\r\n    }\r\n}\r\n```\r\n\r\nThis way `stored_error` is allocated when loading the code, but its constructor does not run until `GetStoredError()` is called for the first time.\r\n\r\nUsing the API would just look like `Ort::Error last_error = Ort::GetLastError()`. Then an external `#define ORT_CXX_API_THROW(string, code) Ort::SetLastError(string, code)` would indeed fix the problem. But I guess adding all that might be too much to ask.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1044166429/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1048277388",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10564#issuecomment-1048277388",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10564",
        "id": 1048277388,
        "node_id": "IC_kwDOCVq1mM4-e3GM",
        "user": {
            "login": "RyanUnderhill",
            "id": 38674843,
            "node_id": "MDQ6VXNlcjM4Njc0ODQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/38674843?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/RyanUnderhill",
            "html_url": "https://github.com/RyanUnderhill",
            "followers_url": "https://api.github.com/users/RyanUnderhill/followers",
            "following_url": "https://api.github.com/users/RyanUnderhill/following{/other_user}",
            "gists_url": "https://api.github.com/users/RyanUnderhill/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/RyanUnderhill/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/RyanUnderhill/subscriptions",
            "organizations_url": "https://api.github.com/users/RyanUnderhill/orgs",
            "repos_url": "https://api.github.com/users/RyanUnderhill/repos",
            "events_url": "https://api.github.com/users/RyanUnderhill/events{/privacy}",
            "received_events_url": "https://api.github.com/users/RyanUnderhill/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-02-22T22:35:36Z",
        "updated_at": "2022-02-22T22:35:36Z",
        "author_association": "MEMBER",
        "body": "Yeah, adding all of that would be harder to justify. Plus it would assume a more specific behavior when this sounds like a very custom requirement.\r\n\r\nI figured you'd probably want to use thread local errors (unless you know you're only using it from one thread at a time), but that's all on how you want to handle things on your side.\r\n\r\nWhy would the functions need to be inline in the header? I imagined you'd just define prototypes for them, and implement them in your cpp file. Or you could make a third header where you define your functions, #define ORT_CXX_API_THROW, and then #include onnxruntime_cxx_api.h.\r\n\r\nIf you would like the one line #ifndef change (where we will use your `ORT_CXX_API_THROW`), let us know.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1048277388/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1048474618",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10564#issuecomment-1048474618",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10564",
        "id": 1048474618,
        "node_id": "IC_kwDOCVq1mM4-fnP6",
        "user": {
            "login": "leandro-gracia-gil",
            "id": 8785797,
            "node_id": "MDQ6VXNlcjg3ODU3OTc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8785797?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/leandro-gracia-gil",
            "html_url": "https://github.com/leandro-gracia-gil",
            "followers_url": "https://api.github.com/users/leandro-gracia-gil/followers",
            "following_url": "https://api.github.com/users/leandro-gracia-gil/following{/other_user}",
            "gists_url": "https://api.github.com/users/leandro-gracia-gil/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/leandro-gracia-gil/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/leandro-gracia-gil/subscriptions",
            "organizations_url": "https://api.github.com/users/leandro-gracia-gil/orgs",
            "repos_url": "https://api.github.com/users/leandro-gracia-gil/repos",
            "events_url": "https://api.github.com/users/leandro-gracia-gil/events{/privacy}",
            "received_events_url": "https://api.github.com/users/leandro-gracia-gil/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-02-23T06:08:22Z",
        "updated_at": "2022-02-23T06:29:20Z",
        "author_association": "CONTRIBUTOR",
        "body": "I think I'll go the third header route where I'll define my functions, then `ORT_CXX_API_THROW`, then include onnxruntime_cxx_api.h. So, if you could make the #ifndef change so I can use my own `ORT_CXX_API_THROW` that would be great. Thank you very much for your help.\r\n\r\nBy the way, if you allow me a side question, is there any particular reason why all of this...\r\n\r\n```c++\r\n// This is used internally by the C++ API. This class holds the global variable that points to the OrtApi, it's in a template so that we can define a global variable in a header and make\r\n// it transparent to the users of the API.\r\ntemplate <typename T>\r\nstruct Global {\r\n  static const OrtApi* api_;\r\n};\r\n\r\n// If macro ORT_API_MANUAL_INIT is defined, no static initialization will be performed. Instead, user must call InitApi() before using it.\r\ntemplate <typename T>\r\n#ifdef ORT_API_MANUAL_INIT\r\nconst OrtApi* Global<T>::api_{};\r\ninline void InitApi() { Global<void>::api_ = OrtGetApiBase()->GetApi(ORT_API_VERSION); }\r\n#else\r\n#if defined(_MSC_VER) && !defined(__clang__)\r\n#pragma warning(push)\r\n// \"Global initializer calls a non-constexpr function.\" Therefore you can't use ORT APIs in the other global initializers.\r\n// Please define ORT_API_MANUAL_INIT if it conerns you.\r\n#pragma warning(disable : 26426)\r\n#endif\r\nconst OrtApi* Global<T>::api_ = OrtGetApiBase()->GetApi(ORT_API_VERSION);\r\n#if defined(_MSC_VER) && !defined(__clang__)\r\n#pragma warning(pop)\r\n#endif\r\n#endif\r\n\r\n/// This returns a reference to the OrtApi interface in use\r\ninline const OrtApi& GetApi() { return *Global<void>::api_; }\r\n```\r\n\r\n... isn't just replaced by this?\r\n\r\n```c++\r\ninline const OrtApi& GetApi() {\r\n  static const OrtApi* api = OrtGetApiBase()->GetApi(ORT_API_VERSION);\r\n  return *api;\r\n}\r\n```\r\n\r\nAs far as I know this should still behave like a singleton shared by any source files including this header, but instead of doing static initialization it would be initialized on the first call to `GetApi()`, making `ORT_API_MANUAL_INIT` and `Ort::InitApi()` not required. Initialization should also be [thread safe](https://stackoverflow.com/questions/8102125/is-local-static-variable-initialization-thread-safe-in-c11) according to the C++11 standard.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1048474618/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1050332020",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10564#issuecomment-1050332020",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10564",
        "id": 1050332020,
        "node_id": "IC_kwDOCVq1mM4-mst0",
        "user": {
            "login": "RyanUnderhill",
            "id": 38674843,
            "node_id": "MDQ6VXNlcjM4Njc0ODQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/38674843?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/RyanUnderhill",
            "html_url": "https://github.com/RyanUnderhill",
            "followers_url": "https://api.github.com/users/RyanUnderhill/followers",
            "following_url": "https://api.github.com/users/RyanUnderhill/following{/other_user}",
            "gists_url": "https://api.github.com/users/RyanUnderhill/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/RyanUnderhill/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/RyanUnderhill/subscriptions",
            "organizations_url": "https://api.github.com/users/RyanUnderhill/orgs",
            "repos_url": "https://api.github.com/users/RyanUnderhill/repos",
            "events_url": "https://api.github.com/users/RyanUnderhill/events{/privacy}",
            "received_events_url": "https://api.github.com/users/RyanUnderhill/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-02-24T22:39:19Z",
        "updated_at": "2022-02-24T22:40:08Z",
        "author_association": "MEMBER",
        "body": "Sounds like a plan. Here's the change I'll make to onnxruntime_cxx_api.h. Does that work?\r\n\r\n```#ifndef ORT_CXX_API_THROW\r\n#define ORT_CXX_API_THROW(string, code) \\\r\n  throw Ort::Exception(string, code)\r\n#endif \r\n```\r\n\r\nTo explain the preprocessor blob, we initially didn't use a magic static because we wanted the 'GetApi()' method to inline away into nothing. The magic static would require a check on every call. So that's just due to wanting zero overhead for the C++ API wrappers.\r\n\r\nThe 'ORT_API_MANUAL_INIT' was due to the static initializer happening too soon for some cases. The magic static would have avoided this, but then isn't zero overhead.\r\n\r\n\r\nT",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1050332020/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1050687139",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10564#issuecomment-1050687139",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10564",
        "id": 1050687139,
        "node_id": "IC_kwDOCVq1mM4-oDaj",
        "user": {
            "login": "leandro-gracia-gil",
            "id": 8785797,
            "node_id": "MDQ6VXNlcjg3ODU3OTc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8785797?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/leandro-gracia-gil",
            "html_url": "https://github.com/leandro-gracia-gil",
            "followers_url": "https://api.github.com/users/leandro-gracia-gil/followers",
            "following_url": "https://api.github.com/users/leandro-gracia-gil/following{/other_user}",
            "gists_url": "https://api.github.com/users/leandro-gracia-gil/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/leandro-gracia-gil/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/leandro-gracia-gil/subscriptions",
            "organizations_url": "https://api.github.com/users/leandro-gracia-gil/orgs",
            "repos_url": "https://api.github.com/users/leandro-gracia-gil/repos",
            "events_url": "https://api.github.com/users/leandro-gracia-gil/events{/privacy}",
            "received_events_url": "https://api.github.com/users/leandro-gracia-gil/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-02-25T09:31:26Z",
        "updated_at": "2022-02-25T09:31:26Z",
        "author_association": "CONTRIBUTOR",
        "body": "I think you missed the initial `#ifndef ORT_CXX_API_THROW`, but yes, that should be it. Thank you very much!",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1050687139/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1051192109",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10564#issuecomment-1051192109",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10564",
        "id": 1051192109,
        "node_id": "IC_kwDOCVq1mM4-p-st",
        "user": {
            "login": "RyanUnderhill",
            "id": 38674843,
            "node_id": "MDQ6VXNlcjM4Njc0ODQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/38674843?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/RyanUnderhill",
            "html_url": "https://github.com/RyanUnderhill",
            "followers_url": "https://api.github.com/users/RyanUnderhill/followers",
            "following_url": "https://api.github.com/users/RyanUnderhill/following{/other_user}",
            "gists_url": "https://api.github.com/users/RyanUnderhill/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/RyanUnderhill/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/RyanUnderhill/subscriptions",
            "organizations_url": "https://api.github.com/users/RyanUnderhill/orgs",
            "repos_url": "https://api.github.com/users/RyanUnderhill/repos",
            "events_url": "https://api.github.com/users/RyanUnderhill/events{/privacy}",
            "received_events_url": "https://api.github.com/users/RyanUnderhill/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-02-25T20:10:49Z",
        "updated_at": "2022-02-25T20:10:49Z",
        "author_association": "MEMBER",
        "body": "Haha, how weird, it's in there if I edit the comment, but looks like made the markup invalid by putting it after the ``` vs on the next line. I'll make a pr and mention you then.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1051192109/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1054686913",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10564#issuecomment-1054686913",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10564",
        "id": 1054686913,
        "node_id": "IC_kwDOCVq1mM4-3T7B",
        "user": {
            "login": "RyanUnderhill",
            "id": 38674843,
            "node_id": "MDQ6VXNlcjM4Njc0ODQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/38674843?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/RyanUnderhill",
            "html_url": "https://github.com/RyanUnderhill",
            "followers_url": "https://api.github.com/users/RyanUnderhill/followers",
            "following_url": "https://api.github.com/users/RyanUnderhill/following{/other_user}",
            "gists_url": "https://api.github.com/users/RyanUnderhill/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/RyanUnderhill/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/RyanUnderhill/subscriptions",
            "organizations_url": "https://api.github.com/users/RyanUnderhill/orgs",
            "repos_url": "https://api.github.com/users/RyanUnderhill/repos",
            "events_url": "https://api.github.com/users/RyanUnderhill/events{/privacy}",
            "received_events_url": "https://api.github.com/users/RyanUnderhill/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-02-28T21:34:42Z",
        "updated_at": "2022-02-28T21:34:42Z",
        "author_association": "MEMBER",
        "body": "The PR is merged, so closing this issue.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1054686913/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1059933296",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10564#issuecomment-1059933296",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10564",
        "id": 1059933296,
        "node_id": "IC_kwDOCVq1mM4_LUxw",
        "user": {
            "login": "leandro-gracia-gil",
            "id": 8785797,
            "node_id": "MDQ6VXNlcjg3ODU3OTc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8785797?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/leandro-gracia-gil",
            "html_url": "https://github.com/leandro-gracia-gil",
            "followers_url": "https://api.github.com/users/leandro-gracia-gil/followers",
            "following_url": "https://api.github.com/users/leandro-gracia-gil/following{/other_user}",
            "gists_url": "https://api.github.com/users/leandro-gracia-gil/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/leandro-gracia-gil/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/leandro-gracia-gil/subscriptions",
            "organizations_url": "https://api.github.com/users/leandro-gracia-gil/orgs",
            "repos_url": "https://api.github.com/users/leandro-gracia-gil/repos",
            "events_url": "https://api.github.com/users/leandro-gracia-gil/events{/privacy}",
            "received_events_url": "https://api.github.com/users/leandro-gracia-gil/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-03-06T10:15:12Z",
        "updated_at": "2022-03-06T10:23:03Z",
        "author_association": "CONTRIBUTOR",
        "body": "@RyanUnderhill \r\nSorry to reopen this, but the way the patch is implemented is in fact preventing me from defining my own `ORT_CXX_API_THROW`.\r\n\r\nThe issue is that I also define `ORT_NO_EXCEPTIONS` (which is the very reason I need to customize error management, because I cannot use exceptions), but as it is now you can only redefine `ORT_CXX_API_THROW` when `ORT_NO_EXCEPTIONS` is not defined.\r\n\r\nThis is how it looks like now.\r\n\r\n```c++\r\n#ifdef ORT_NO_EXCEPTIONS\r\n#define ORT_CXX_API_THROW(string, code)       \\\r\n  do {                                        \\\r\n    std::cerr << Ort::Exception(string, code) \\\r\n                     .what()                  \\\r\n              << std::endl;                   \\\r\n    abort();                                  \\\r\n  } while (false)\r\n#else\r\n// The #ifndef is for the very special case where the user of this library wants to define their own way of handling errors.\r\n// NOTE: This header expects control flow to not continue after calling ORT_CXX_API_THROW\r\n#ifndef ORT_CXX_API_THROW\r\n#define ORT_CXX_API_THROW(string, code) \\\r\n  throw Ort::Exception(string, code)\r\n#endif\r\n#endif\r\n```\r\n\r\nInstead, it should be something like this:\r\n```c++\r\n#ifdef ORT_NO_EXCEPTIONS\r\n// The #ifndef is for the very special case where the user of this library wants to define their own way of handling errors.\r\n// NOTE: This header expects control flow to not continue after calling ORT_CXX_API_THROW\r\n#ifndef ORT_CXX_API_THROW\r\n#define ORT_CXX_API_THROW(string, code)       \\\r\n  do {                                        \\\r\n    std::cerr << Ort::Exception(string, code) \\\r\n                     .what()                  \\\r\n              << std::endl;                   \\\r\n    abort();                                  \\\r\n  } while (false)\r\n#endif\r\n#else\r\n#define ORT_CXX_API_THROW(string, code) \\\r\n  throw Ort::Exception(string, code)\r\n#endif\r\n```\r\n\r\nOr alternatively, allow redefinition in both cases if you think that's more appropriate. My use case only needs to allow redefinition when `ORT_NO_EXCEPTIONS` is defined.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1059933296/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1062729897",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10564#issuecomment-1062729897",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10564",
        "id": 1062729897,
        "node_id": "IC_kwDOCVq1mM4_V_ip",
        "user": {
            "login": "leandro-gracia-gil",
            "id": 8785797,
            "node_id": "MDQ6VXNlcjg3ODU3OTc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8785797?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/leandro-gracia-gil",
            "html_url": "https://github.com/leandro-gracia-gil",
            "followers_url": "https://api.github.com/users/leandro-gracia-gil/followers",
            "following_url": "https://api.github.com/users/leandro-gracia-gil/following{/other_user}",
            "gists_url": "https://api.github.com/users/leandro-gracia-gil/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/leandro-gracia-gil/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/leandro-gracia-gil/subscriptions",
            "organizations_url": "https://api.github.com/users/leandro-gracia-gil/orgs",
            "repos_url": "https://api.github.com/users/leandro-gracia-gil/repos",
            "events_url": "https://api.github.com/users/leandro-gracia-gil/events{/privacy}",
            "received_events_url": "https://api.github.com/users/leandro-gracia-gil/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-03-09T09:36:44Z",
        "updated_at": "2022-03-09T09:36:44Z",
        "author_association": "CONTRIBUTOR",
        "body": "@RyanUnderhill \r\nSorry to ping you directly. I'm in no hurry about this, but I'd like to make sure saw my last comment since it's possible that with the issue already closed you didn't get any notification. I tried to ping you in the previous comment too, but as an edit instead of the first post, so I don't know if you were really notified.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1062729897/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]