[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/577436436",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2889#issuecomment-577436436",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2889",
        "id": 577436436,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU3NzQzNjQzNg==",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-01-22T23:34:47Z",
        "updated_at": "2020-01-22T23:34:47Z",
        "author_association": "MEMBER",
        "body": "The error message indicates that the tool fused some reshape nodes incorrectly. The tool has tested on the bert model in ONNX model zoo that exported from TF1.*, but not on models from TF 2.1.\r\n\r\n@EthanPhan, \r\nCould you share the model or the script that exporting TF model to ONNX? Currently, I am working on the tool to support BERT models from TF2.1. I could take a look and provide a fix.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/577436436/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/577450136",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2889#issuecomment-577450136",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2889",
        "id": 577450136,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU3NzQ1MDEzNg==",
        "user": {
            "login": "EthanPhan",
            "id": 21288521,
            "node_id": "MDQ6VXNlcjIxMjg4NTIx",
            "avatar_url": "https://avatars.githubusercontent.com/u/21288521?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/EthanPhan",
            "html_url": "https://github.com/EthanPhan",
            "followers_url": "https://api.github.com/users/EthanPhan/followers",
            "following_url": "https://api.github.com/users/EthanPhan/following{/other_user}",
            "gists_url": "https://api.github.com/users/EthanPhan/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/EthanPhan/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/EthanPhan/subscriptions",
            "organizations_url": "https://api.github.com/users/EthanPhan/orgs",
            "repos_url": "https://api.github.com/users/EthanPhan/repos",
            "events_url": "https://api.github.com/users/EthanPhan/events{/privacy}",
            "received_events_url": "https://api.github.com/users/EthanPhan/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-01-23T00:27:12Z",
        "updated_at": "2020-01-23T00:27:12Z",
        "author_association": "NONE",
        "body": "@tianleiwu This is the model definition in tf2.1:\r\n\r\n```\r\nclass Wrapped_DistilBert(tf.keras.layers.Layer):\r\n    \"\"\" Wrap the distiled bert model into a custom keras layer\r\n    for easy manipulation.\r\n\r\n    \"\"\"\r\n\r\n    def __init__(self, n_fine_tune_layers=1, **kwargs):\r\n        \"\"\"Initialize the custom layer.\r\n\r\n        Arguments:\r\n        n_fine_tune_layers: Number of layer of distilbert we want to fine-tune\r\n        \"\"\"\r\n\r\n        self.n_fine_tune_layers = n_fine_tune_layers\r\n        self.output_size = 768\r\n        self.bert = TFDistilBertModel.from_pretrained(\r\n            'distilbert-base-uncased')\r\n        self.layers = [self.bert.distilbert.embeddings] + \\\r\n            self.bert.distilbert.transformer.layer\r\n\r\n        super(Wrapped_DistilBert, self).__init__(**kwargs)\r\n\r\n    def build(self, input_shape):\r\n        \"\"\"Build the layer. This function will be call to construct the layer\r\n        on the first call.\r\n\r\n        Arguments:\r\n        input_shape: Shape(s) of the input(s) to this layer. If this layer get\r\n        multiple inputs, `input_shape` will be in form of tuple.\r\n        \"\"\"\r\n\r\n        for l in self.layers:\r\n            l.trainable = False\r\n\r\n        # Select how many layers to fine tune\r\n        if self.n_fine_tune_layers < 0:\r\n            # dont fine-tune anything\r\n            for l in self.layers:\r\n                l.trainable = False\r\n        else:\r\n            for l in self.layers[-self.n_fine_tune_layers:]:\r\n                l.trainable = True\r\n\r\n        super(Wrapped_DistilBert, self).build(input_shape)\r\n\r\n    def call(self, inputs, training=False):\r\n        result = self.bert(inputs, training=training)\r\n        return result\r\n\r\n    def compute_output_shape(self, input_shape):\r\n        return (input_shape[0], self.output_size)\r\n\r\n    def get_config(self):\r\n        \"\"\"Helper function needed for loading the layer frm h5 or \r\n        tf file without the code for model definiton.\r\n        \"\"\"\r\n\r\n        return {'n_fine_tune_layers': self.n_fine_tune_layers}\r\n\r\n\r\ndef distilbert_classifier(seq_len=512,\r\n                          num_class=20,\r\n                          dropout=.5,\r\n                          pre_class_dim=128,\r\n                          num_finetune_bert_layers=0):\r\n    \"\"\"Construct a model for text classification using pretrained DistilBert.\r\n\r\n    :param seq_len: Maximum sequence length the model can take.\r\n    :param num_class: Number of classes of the output.\r\n    :param dropout: dropout rate\r\n    :param num_finetune_bert_layers: Number of transformer layers to fine-tune. 0: fine-tune all layers;\r\n    -1: fine-tune no layer; n > 0: fine-tune the last n layer of the bert model.\r\n\r\n    \"\"\"\r\n    distilbert_layer = Wrapped_DistilBert(\r\n        n_fine_tune_layers=num_finetune_bert_layers)\r\n\r\n    in_id = Input(shape=(seq_len,), name=\"input_text\", dtype=tf.int32)\r\n\r\n    # Instantiate the custom DistilBert Layer defined above\r\n    bert_output = distilbert_layer(in_id)\r\n\r\n    x = Dense(pre_class_dim,\r\n              kernel_initializer=TruncatedNormal(stddev=0.02),\r\n              activation='relu',\r\n              name=\"pre_classifier\")(bert_output[0][:, 0])\r\n\r\n    x = Dropout(dropout)(x)\r\n\r\n    out = Dense(num_class,\r\n                kernel_initializer=TruncatedNormal(stddev=0.02),\r\n                activation='sigmoid',\r\n                name=\"classifier\")(x)\r\n\r\n    model = Model(in_id, out)\r\n\r\n    return model\r\n```\r\n\r\nBasically, I wrapped the TFDistilBertModel from the hugging face in a tf.keras layer and use it to build the model. I converted in into ONNX format using tf2onnx package from here: https://github.com/onnx/tensorflow-onnx.git@gs/tf20",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/577450136/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/583560841",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2889#issuecomment-583560841",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2889",
        "id": 583560841,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU4MzU2MDg0MQ==",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-02-07T19:13:48Z",
        "updated_at": "2020-02-07T19:13:48Z",
        "author_association": "MEMBER",
        "body": "I updated the script ([#2957](https://github.com/microsoft/onnxruntime/pull/2957)) to support keras model using Tensorflow 2.1.\r\n\r\nI got a TFDistilBert onnx model that converted using [Keras2ONNX](https://github.com/onnx/keras-onnx/blob/master/applications/nightly_build/test_transformers.py).\r\n\r\nNow, the model got partial optimization, and model can run in onnxruntime. I am still working on adding the remaining optimization, and after that TFDistilBert could get full optimization.\r\n\r\n@EthanPhan,\r\nCould you try Keras2ONNX for conversion? ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/583560841/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/585578688",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2889#issuecomment-585578688",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2889",
        "id": 585578688,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU4NTU3ODY4OA==",
        "user": {
            "login": "EthanPhan",
            "id": 21288521,
            "node_id": "MDQ6VXNlcjIxMjg4NTIx",
            "avatar_url": "https://avatars.githubusercontent.com/u/21288521?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/EthanPhan",
            "html_url": "https://github.com/EthanPhan",
            "followers_url": "https://api.github.com/users/EthanPhan/followers",
            "following_url": "https://api.github.com/users/EthanPhan/following{/other_user}",
            "gists_url": "https://api.github.com/users/EthanPhan/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/EthanPhan/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/EthanPhan/subscriptions",
            "organizations_url": "https://api.github.com/users/EthanPhan/orgs",
            "repos_url": "https://api.github.com/users/EthanPhan/repos",
            "events_url": "https://api.github.com/users/EthanPhan/events{/privacy}",
            "received_events_url": "https://api.github.com/users/EthanPhan/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-02-13T06:49:54Z",
        "updated_at": "2020-02-13T06:49:54Z",
        "author_association": "NONE",
        "body": "Thanks a lot. Will try and keep you updated",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/585578688/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/586526585",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2889#issuecomment-586526585",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2889",
        "id": 586526585,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU4NjUyNjU4NQ==",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-02-15T00:06:33Z",
        "updated_at": "2020-02-15T00:51:01Z",
        "author_association": "MEMBER",
        "body": "@EthanPhan,\r\nA new PR [3014](https://github.com/microsoft/onnxruntime/pull/3014) can help TFDistilBert to get full optimization.\r\n\r\nExample command line is like the following:\r\n```\r\npython bert_model_optimization.py --input distil_bert_shape_opt.onnx --output distil_bert_opt.onnx --model_type bert_keras\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/586526585/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/653347600",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2889#issuecomment-653347600",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2889",
        "id": 653347600,
        "node_id": "MDEyOklzc3VlQ29tbWVudDY1MzM0NzYwMA==",
        "user": {
            "login": "stale[bot]",
            "id": 26384082,
            "node_id": "MDM6Qm90MjYzODQwODI=",
            "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stale%5Bbot%5D",
            "html_url": "https://github.com/apps/stale",
            "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
            "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
            "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
            "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
            "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
            "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
            "type": "Bot",
            "site_admin": false
        },
        "created_at": "2020-07-03T04:58:10Z",
        "updated_at": "2020-07-03T04:58:10Z",
        "author_association": "NONE",
        "body": "This issue has been automatically marked as stale due to inactivity and will be closed in 7 days if no further activity occurs. If further support is needed, please provide an update and/or more details.\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/653347600/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/656971865",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2889#issuecomment-656971865",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2889",
        "id": 656971865,
        "node_id": "MDEyOklzc3VlQ29tbWVudDY1Njk3MTg2NQ==",
        "user": {
            "login": "stale[bot]",
            "id": 26384082,
            "node_id": "MDM6Qm90MjYzODQwODI=",
            "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stale%5Bbot%5D",
            "html_url": "https://github.com/apps/stale",
            "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
            "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
            "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
            "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
            "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
            "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
            "type": "Bot",
            "site_admin": false
        },
        "created_at": "2020-07-11T02:39:29Z",
        "updated_at": "2020-07-11T02:39:29Z",
        "author_association": "NONE",
        "body": "This issue has been automatically closed due to inactivity. Please reactivate if further support is needed.\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/656971865/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]