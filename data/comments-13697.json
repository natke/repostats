[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1320380327",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13697#issuecomment-1320380327",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13697",
        "id": 1320380327,
        "node_id": "IC_kwDOCVq1mM5Os2en",
        "user": {
            "login": "Nazukixv",
            "id": 20610262,
            "node_id": "MDQ6VXNlcjIwNjEwMjYy",
            "avatar_url": "https://avatars.githubusercontent.com/u/20610262?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Nazukixv",
            "html_url": "https://github.com/Nazukixv",
            "followers_url": "https://api.github.com/users/Nazukixv/followers",
            "following_url": "https://api.github.com/users/Nazukixv/following{/other_user}",
            "gists_url": "https://api.github.com/users/Nazukixv/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/Nazukixv/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/Nazukixv/subscriptions",
            "organizations_url": "https://api.github.com/users/Nazukixv/orgs",
            "repos_url": "https://api.github.com/users/Nazukixv/repos",
            "events_url": "https://api.github.com/users/Nazukixv/events{/privacy}",
            "received_events_url": "https://api.github.com/users/Nazukixv/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-11-18T18:23:47Z",
        "updated_at": "2022-11-18T18:23:47Z",
        "author_association": "NONE",
        "body": "And here is my code of setting GPU id in C++:\r\n\r\n```cpp\r\n// 1. create session\r\ntry {\r\n  if (device_id >= 0) {\r\n    OrtCUDAProviderOptions cuda_options;\r\n    cuda_options.device_id = device_id;\r\n    _session_options.AppendExecutionProvider_CUDA(cuda_options);\r\n  } else {\r\n    _session_options.SetGraphOptimizationLevel(\r\n        GraphOptimizationLevel::ORT_ENABLE_EXTENDED);\r\n    _session_options.SetExecutionMode(ExecutionMode::ORT_PARALLEL);\r\n  }\r\n  _encoder_session = std::make_shared<Ort::Session>(\r\n      _env, encoder_path.c_str(), _session_options);\r\n  _decoder_session = std::make_shared<Ort::Session>(\r\n      _env, decoder_path.c_str(), _session_options);\r\n} catch (const std::exception& e) {\r\n  std::cerr << e.what() << '\\n';\r\n}\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1320380327/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1320421534",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13697#issuecomment-1320421534",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13697",
        "id": 1320421534,
        "node_id": "IC_kwDOCVq1mM5OtAie",
        "user": {
            "login": "yuslepukhin",
            "id": 11303988,
            "node_id": "MDQ6VXNlcjExMzAzOTg4",
            "avatar_url": "https://avatars.githubusercontent.com/u/11303988?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yuslepukhin",
            "html_url": "https://github.com/yuslepukhin",
            "followers_url": "https://api.github.com/users/yuslepukhin/followers",
            "following_url": "https://api.github.com/users/yuslepukhin/following{/other_user}",
            "gists_url": "https://api.github.com/users/yuslepukhin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yuslepukhin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yuslepukhin/subscriptions",
            "organizations_url": "https://api.github.com/users/yuslepukhin/orgs",
            "repos_url": "https://api.github.com/users/yuslepukhin/repos",
            "events_url": "https://api.github.com/users/yuslepukhin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yuslepukhin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-11-18T19:07:34Z",
        "updated_at": "2022-11-18T19:07:34Z",
        "author_association": "MEMBER",
        "body": "It is interesting that neither this nor the referenced issues actually mention the error message or any specifics of CUDA(?) behavior?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1320421534/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1320725505",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13697#issuecomment-1320725505",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13697",
        "id": 1320725505,
        "node_id": "IC_kwDOCVq1mM5OuKwB",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-11-19T01:21:13Z",
        "updated_at": "2022-11-19T01:21:13Z",
        "author_association": "MEMBER",
        "body": "1. Can you run nvidia-smi to see if there's any process already using device id 0?\r\n2. Also, it's not clear from the desc what is it that you're trying to do. Is using a device id other than 0 not an option?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1320725505/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1320859761",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13697#issuecomment-1320859761",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13697",
        "id": 1320859761,
        "node_id": "IC_kwDOCVq1mM5Ourhx",
        "user": {
            "login": "Nazukixv",
            "id": 20610262,
            "node_id": "MDQ6VXNlcjIwNjEwMjYy",
            "avatar_url": "https://avatars.githubusercontent.com/u/20610262?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Nazukixv",
            "html_url": "https://github.com/Nazukixv",
            "followers_url": "https://api.github.com/users/Nazukixv/followers",
            "following_url": "https://api.github.com/users/Nazukixv/following{/other_user}",
            "gists_url": "https://api.github.com/users/Nazukixv/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/Nazukixv/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/Nazukixv/subscriptions",
            "organizations_url": "https://api.github.com/users/Nazukixv/orgs",
            "repos_url": "https://api.github.com/users/Nazukixv/repos",
            "events_url": "https://api.github.com/users/Nazukixv/events{/privacy}",
            "received_events_url": "https://api.github.com/users/Nazukixv/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-11-19T11:00:36Z",
        "updated_at": "2022-11-23T07:08:18Z",
        "author_association": "NONE",
        "body": "@pranavsharma\r\n\r\n> 1. Can you run nvidia-smi to see if there's any process already using device id 0?\r\n> 2. Also, it's not clear from the desc what is it that you're trying to do. Is using a device id other than 0 not an option?\r\n\r\n1. For example, when I set `device_id` to 2, I can see from the `nvidia-smi` that both GPU 0 and 2 were occupied by the same process 6393. The utility of GPU 2 is 60-70% which means I think it was using GPU 2 to do the model inference, and that of GPU 0 is always 0% which seems that it was not doing anything(?).\r\n2. So what I expected is when I specified the device id to 2, only the GPU 2 would be occupied. I don't know why GPU 0 is also occupied. Is it normal?\r\n\r\n```\r\nSat Nov 19 18:47:10 2022       \r\n+-----------------------------------------------------------------------------+\r\n| NVIDIA-SMI 470.129.06   Driver Version: 470.129.06   CUDA Version: 11.4     |\r\n|-------------------------------+----------------------+----------------------+\r\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\r\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\r\n|                               |                      |               MIG M. |\r\n|===============================+======================+======================|\r\n|   0  NVIDIA GeForce ...  On   | 00000000:04:00.0 Off |                  N/A |\r\n| 23%   29C    P2    56W / 250W |    157MiB / 11178MiB |      0%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n|   1  NVIDIA GeForce ...  On   | 00000000:05:00.0 Off |                  N/A |\r\n| 23%   23C    P8     9W / 250W |      2MiB / 11178MiB |      0%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n|   2  NVIDIA GeForce ...  On   | 00000000:08:00.0 Off |                  N/A |\r\n| 23%   40C    P2   119W / 250W |    815MiB / 11178MiB |     72%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n|   3  NVIDIA GeForce ...  On   | 00000000:09:00.0 Off |                  N/A |\r\n| 23%   19C    P8     9W / 250W |      2MiB / 11178MiB |      0%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n|   4  NVIDIA GeForce ...  On   | 00000000:84:00.0 Off |                  N/A |\r\n| 23%   19C    P8     8W / 250W |      2MiB / 11178MiB |      0%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n|   5  NVIDIA GeForce ...  On   | 00000000:85:00.0 Off |                  N/A |\r\n| 23%   22C    P8     8W / 250W |      2MiB / 11178MiB |      0%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n|   6  NVIDIA GeForce ...  On   | 00000000:88:00.0 Off |                  N/A |\r\n| 23%   19C    P8     8W / 250W |      2MiB / 11178MiB |      0%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n|   7  NVIDIA GeForce ...  On   | 00000000:89:00.0 Off |                  N/A |\r\n| 23%   19C    P8     8W / 250W |      2MiB / 11178MiB |      0%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n                                                                               \r\n+-----------------------------------------------------------------------------+\r\n| Processes:                                                                  |\r\n|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |\r\n|        ID   ID                                                   Usage      |\r\n|=============================================================================|\r\n|    0   N/A  N/A      6393      C   ./main                            155MiB |\r\n|    2   N/A  N/A      6393      C   ./main                            813MiB |\r\n+-----------------------------------------------------------------------------+\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1320859761/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1418128088",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13697#issuecomment-1418128088",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13697",
        "id": 1418128088,
        "node_id": "IC_kwDOCVq1mM5UhurY",
        "user": {
            "login": "arch1902",
            "id": 53364992,
            "node_id": "MDQ6VXNlcjUzMzY0OTky",
            "avatar_url": "https://avatars.githubusercontent.com/u/53364992?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/arch1902",
            "html_url": "https://github.com/arch1902",
            "followers_url": "https://api.github.com/users/arch1902/followers",
            "following_url": "https://api.github.com/users/arch1902/following{/other_user}",
            "gists_url": "https://api.github.com/users/arch1902/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/arch1902/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/arch1902/subscriptions",
            "organizations_url": "https://api.github.com/users/arch1902/orgs",
            "repos_url": "https://api.github.com/users/arch1902/repos",
            "events_url": "https://api.github.com/users/arch1902/events{/privacy}",
            "received_events_url": "https://api.github.com/users/arch1902/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-02-05T16:36:43Z",
        "updated_at": "2023-02-05T16:36:43Z",
        "author_association": "NONE",
        "body": "Facing same problem. Any insights ?\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1418128088/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1487026357",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13697#issuecomment-1487026357",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13697",
        "id": 1487026357,
        "node_id": "IC_kwDOCVq1mM5Yoji1",
        "user": {
            "login": "Honzys",
            "id": 9163018,
            "node_id": "MDQ6VXNlcjkxNjMwMTg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/9163018?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Honzys",
            "html_url": "https://github.com/Honzys",
            "followers_url": "https://api.github.com/users/Honzys/followers",
            "following_url": "https://api.github.com/users/Honzys/following{/other_user}",
            "gists_url": "https://api.github.com/users/Honzys/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/Honzys/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/Honzys/subscriptions",
            "organizations_url": "https://api.github.com/users/Honzys/orgs",
            "repos_url": "https://api.github.com/users/Honzys/repos",
            "events_url": "https://api.github.com/users/Honzys/events{/privacy}",
            "received_events_url": "https://api.github.com/users/Honzys/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-28T14:42:35Z",
        "updated_at": "2023-03-28T14:42:35Z",
        "author_association": "NONE",
        "body": "We're having the same exact problems. But I would rephrase the statement. The device_id that is always occupied depends on the `CUDA_VISIBLE_DEVICES` variable. If it's unset, then the `device_id=0` is occupied.\r\nIf it's set, then the first device id is occupied.\r\n\r\nThis is an issue if we want to create a lot of onnxruntime sessions which are distributed across all possible gpu devices, we get OOM errors because gpu 0 memory usage exceeds it's limits.\r\n\r\n@pranavsharma You exatly reproduced it here - https://github.com/microsoft/onnxruntime/issues/9645#issuecomment-960418320\r\nThis is `nvidia-smi` output as you've posted in that issue:\r\n```\r\n+-----------------------------------------------------------------------------+\r\n| NVIDIA-SMI 465.19.01    Driver Version: 465.19.01    CUDA Version: 11.3     |\r\n|-------------------------------+----------------------+----------------------+\r\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\r\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\r\n|                               |                      |               MIG M. |\r\n|===============================+======================+======================|\r\n|   0  NVIDIA Tesla V1...  Off  | 00000001:00:00.0 Off |                    0 |\r\n| N/A   31C    P0    35W / 250W |    497MiB / 16160MiB |      0%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n|   1  NVIDIA Tesla V1...  Off  | 00000002:00:00.0 Off |                    0 |\r\n| N/A   30C    P0    40W / 250W |    657MiB / 16160MiB |     48%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n|   2  NVIDIA Tesla V1...  Off  | 00000003:00:00.0 Off |                    0 |\r\n| N/A   29C    P0    26W / 250W |      4MiB / 16160MiB |      0%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n|   3  NVIDIA Tesla V1...  Off  | 00000004:00:00.0 Off |                    0 |\r\n| N/A   29C    P0    24W / 250W |      4MiB / 16160MiB |      0%      Default |\r\n|                               |                      |                  N/A |\r\n+-------------------------------+----------------------+----------------------+\r\n\r\n+-----------------------------------------------------------------------------+\r\n| Processes:                                                                  |\r\n|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |\r\n|        ID   ID                                                   Usage      |\r\n|=============================================================================|\r\n|    0   N/A  N/A     13009      C   python                            493MiB |\r\n|    1   N/A  N/A     13009      C   python                            653MiB |\r\n+-----------------------------------------------------------------------------+\r\n```\r\nYou can see here, that there's a process on gpu 0 despite that you've specified the device_id=1.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1487026357/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1621945601",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13697#issuecomment-1621945601",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13697",
        "id": 1621945601,
        "node_id": "IC_kwDOCVq1mM5grO0B",
        "user": {
            "login": "yujunlhz",
            "id": 11738510,
            "node_id": "MDQ6VXNlcjExNzM4NTEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/11738510?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yujunlhz",
            "html_url": "https://github.com/yujunlhz",
            "followers_url": "https://api.github.com/users/yujunlhz/followers",
            "following_url": "https://api.github.com/users/yujunlhz/following{/other_user}",
            "gists_url": "https://api.github.com/users/yujunlhz/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yujunlhz/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yujunlhz/subscriptions",
            "organizations_url": "https://api.github.com/users/yujunlhz/orgs",
            "repos_url": "https://api.github.com/users/yujunlhz/repos",
            "events_url": "https://api.github.com/users/yujunlhz/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yujunlhz/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-07-05T15:02:08Z",
        "updated_at": "2023-07-05T15:02:08Z",
        "author_association": "NONE",
        "body": "I come across the same issue. Any solutions?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1621945601/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]