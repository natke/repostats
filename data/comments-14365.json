[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1397887466",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14365#issuecomment-1397887466",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14365",
        "id": 1397887466,
        "node_id": "IC_kwDOCVq1mM5TUhHq",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-20T03:42:28Z",
        "updated_at": "2023-01-20T03:42:28Z",
        "author_association": "MEMBER",
        "body": "You are implementing a Contrib op and you can refer to this PR https://github.com/microsoft/onnxruntime/pull/8124 as an example. The steps are:\r\n- define the Op. Refer to the change in core/graph/contrib_ops/contrib_defs.cc\r\n- implement the Op kernel. Refer to the change in contrib_ops/cpu/bert/qembed_layer_norm.*\r\n- define the function to create kernelOp. The \"#define REGISTER_KERNEL_TYPED\" section in contrib_ops/cpu/bert/qembed_layer_norm.cc\r\n- register the kernel. contrib_ops/cpu/cpu_contrib_kernels.cc\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1397887466/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1398610186",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14365#issuecomment-1398610186",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14365",
        "id": 1398610186,
        "node_id": "IC_kwDOCVq1mM5TXRkK",
        "user": {
            "login": "TaoDatakalab",
            "id": 123090074,
            "node_id": "U_kgDOB1Y0mg",
            "avatar_url": "https://avatars.githubusercontent.com/u/123090074?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TaoDatakalab",
            "html_url": "https://github.com/TaoDatakalab",
            "followers_url": "https://api.github.com/users/TaoDatakalab/followers",
            "following_url": "https://api.github.com/users/TaoDatakalab/following{/other_user}",
            "gists_url": "https://api.github.com/users/TaoDatakalab/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TaoDatakalab/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TaoDatakalab/subscriptions",
            "organizations_url": "https://api.github.com/users/TaoDatakalab/orgs",
            "repos_url": "https://api.github.com/users/TaoDatakalab/repos",
            "events_url": "https://api.github.com/users/TaoDatakalab/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TaoDatakalab/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-20T16:10:12Z",
        "updated_at": "2023-01-20T16:10:12Z",
        "author_association": "NONE",
        "body": "Hi YuFeng @yufenglee ,\r\n\r\nThanks for your post. \r\nIf I understand well, I'm not need to implement a contrib op, but also need to modify the optimizer to take my op into account.\r\nDo you have any refer for this part of modification, to keep some other conv op besides the original conv->QlinearConv QDQ optimization?\r\n\r\nBests,\r\nTao",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1398610186/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1398722362",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14365#issuecomment-1398722362",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14365",
        "id": 1398722362,
        "node_id": "IC_kwDOCVq1mM5TXs86",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-20T17:32:55Z",
        "updated_at": "2023-01-20T17:32:55Z",
        "author_association": "MEMBER",
        "body": "You can do it like this:\r\n- define a QDQ selector https://github.com/microsoft/onnxruntime/blob/d7d932c1c223d8749f1962d5bab8af2fcee5b634/onnxruntime/core/optimizer/qdq_transformer/selectors_actions/qdq_selectors.h#L208\r\n- define a QDQ action https://github.com/microsoft/onnxruntime/blob/47780b7f3b55a2518b694be5eaf8c20119272432/onnxruntime/core/optimizer/qdq_transformer/selectors_actions/qdq_actions.h#L59\r\n- connect the selector and action and register it: https://github.com/microsoft/onnxruntime/blob/d7d932c1c223d8749f1962d5bab8af2fcee5b634/onnxruntime/core/optimizer/qdq_transformer/selectors_actions/qdq_selector_action_transformer.cc#L146\r\nhttps://github.com/microsoft/onnxruntime/blob/d7d932c1c223d8749f1962d5bab8af2fcee5b634/onnxruntime/core/optimizer/qdq_transformer/selectors_actions/qdq_selector_action_transformer.cc#L229",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1398722362/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1404010969",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14365#issuecomment-1404010969",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14365",
        "id": 1404010969,
        "node_id": "IC_kwDOCVq1mM5Tr4HZ",
        "user": {
            "login": "TaoDatakalab",
            "id": 123090074,
            "node_id": "U_kgDOB1Y0mg",
            "avatar_url": "https://avatars.githubusercontent.com/u/123090074?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TaoDatakalab",
            "html_url": "https://github.com/TaoDatakalab",
            "followers_url": "https://api.github.com/users/TaoDatakalab/followers",
            "following_url": "https://api.github.com/users/TaoDatakalab/following{/other_user}",
            "gists_url": "https://api.github.com/users/TaoDatakalab/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TaoDatakalab/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TaoDatakalab/subscriptions",
            "organizations_url": "https://api.github.com/users/TaoDatakalab/orgs",
            "repos_url": "https://api.github.com/users/TaoDatakalab/repos",
            "events_url": "https://api.github.com/users/TaoDatakalab/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TaoDatakalab/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-25T17:55:11Z",
        "updated_at": "2023-01-25T17:56:56Z",
        "author_association": "NONE",
        "body": "Hi @yufenglee ,\r\n\r\nCurrently I can modify the QlinearConv class to simulate my QlinearXXX, which takes into account vector instead of scale for  Y_scale and W_scale.\r\nHowever, in the optimizer level, firstly I wanna convert a node \"Conv\" of QDQ to \"QlineearXXX\", I do follow your past post, but the result is still QlinearConv.\r\n![image](https://user-images.githubusercontent.com/123090074/214643571-f5e204f2-909c-4c22-8940-0a4bacb515eb.png)\r\n**Fig.1 QDQ with y_scale as vector**\r\n\r\n![image](https://user-images.githubusercontent.com/123090074/214643221-c8be0b13-a735-4c59-9698-d524aef9c8b4.png)\r\n**Fig.2 convert to qlinearconv with vector (by modify oprimizer and qlinearconv)**\r\n\r\nThen I modified the onnx model, rename \"Conv\" to \"XXX\", and then convert the QDQ mode, this time, the result is \"Error No Op registered for XXX with domain_version of 16.\r\n\r\n![image](https://user-images.githubusercontent.com/123090074/214643094-8118f643-93ed-4a6b-afa4-78fa6b02c776.png)\r\n**Fig.3 QDQ with node \"Spiq\", obtain above error**\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1404010969/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1404300649",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14365#issuecomment-1404300649",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14365",
        "id": 1404300649,
        "node_id": "IC_kwDOCVq1mM5Ts-1p",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-25T22:16:31Z",
        "updated_at": "2023-01-25T22:17:25Z",
        "author_association": "MEMBER",
        "body": "@TaoDatakalab, the QLinearConv fusion logic assumes the input is quantized per-tensor. Adding a filter to only select per-tensor quantization for input/activation for QLinearConv here should fix the issue.\r\nhttps://github.com/microsoft/onnxruntime/blob/d7d932c1c223d8749f1962d5bab8af2fcee5b634/onnxruntime/core/optimizer/qdq_transformer/selectors_actions/qdq_selectors.cc#L214\r\n\r\nSample code:\r\n```\r\n  auto get_const_initializer = [&graph_viewer](const std::string& initializer_name) {\r\n    return graph_viewer.GetConstantInitializer(initializer_name, true);\r\n  };\r\n\r\n  if(!IsDQSupported(dq_nodes[0], get_const_initializer)) return false; // only fuse to QLinearConv if activation is quantized per-tensor\r\n```\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1404300649/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1404816860",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14365#issuecomment-1404816860",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14365",
        "id": 1404816860,
        "node_id": "IC_kwDOCVq1mM5Tu83c",
        "user": {
            "login": "LucasFischer123",
            "id": 31936304,
            "node_id": "MDQ6VXNlcjMxOTM2MzA0",
            "avatar_url": "https://avatars.githubusercontent.com/u/31936304?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/LucasFischer123",
            "html_url": "https://github.com/LucasFischer123",
            "followers_url": "https://api.github.com/users/LucasFischer123/followers",
            "following_url": "https://api.github.com/users/LucasFischer123/following{/other_user}",
            "gists_url": "https://api.github.com/users/LucasFischer123/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/LucasFischer123/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/LucasFischer123/subscriptions",
            "organizations_url": "https://api.github.com/users/LucasFischer123/orgs",
            "repos_url": "https://api.github.com/users/LucasFischer123/repos",
            "events_url": "https://api.github.com/users/LucasFischer123/events{/privacy}",
            "received_events_url": "https://api.github.com/users/LucasFischer123/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-26T10:34:06Z",
        "updated_at": "2023-01-26T10:35:15Z",
        "author_association": "NONE",
        "body": "HI @yufenglee, I am working with @TaoDatakalab \r\n\r\nWe have done how you asked but I think it doesn't do what we are looking for.\r\n\r\nWe have managed to change classical QLINEARCONV to a QlinearXXX where the math are modified correctly (while keeping qlinearconv name)\r\n\r\n\r\nThe end goal is to make the QLINEARCONV and QLINEARXXX available at the same time.\r\n\r\nThe things we have trying to do now ( and what we have done) are the following.\r\n\r\n- [x] Create a new operation QlinearXXX\r\n- [x] Add the new QLINEARXXX.cc  under /onnxruntime/core/providers/cpu/quantization and in cmake.\r\n- [x] add the ClinearXXXConv op in register\r\n- [x] Compile correctly with the new Qlinear ops and create  QLINEARXXX.cc.o \r\n- [ ] Register the new QLINEARXXX in order to be able to infer with it : error is in @TaoDatakalab first post\r\n- [ ] Create an optimizer that transform a QDQ with the XXX op to QLINEARXXX\r\n- [ ] Run our new model \r\n\r\nI can jump into a call to explain what we have tried if it's simpler for you.\r\n\r\nReally looking forward to have this new Quantized conv working\r\n\r\nThanks",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1404816860/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]