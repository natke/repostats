[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1448761601",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14853#issuecomment-1448761601",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14853",
        "id": 1448761601,
        "node_id": "IC_kwDOCVq1mM5WWlkB",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-02-28T19:44:31Z",
        "updated_at": "2023-02-28T19:44:31Z",
        "author_association": "MEMBER",
        "body": "Create a session per model and call Run() on each session in separate threads. You can also choose to use multiple processes to do the same.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1448761601/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1449223820",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14853#issuecomment-1449223820",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14853",
        "id": 1449223820,
        "node_id": "IC_kwDOCVq1mM5WYWaM",
        "user": {
            "login": "WANG-XIN-EE",
            "id": 64546671,
            "node_id": "MDQ6VXNlcjY0NTQ2Njcx",
            "avatar_url": "https://avatars.githubusercontent.com/u/64546671?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/WANG-XIN-EE",
            "html_url": "https://github.com/WANG-XIN-EE",
            "followers_url": "https://api.github.com/users/WANG-XIN-EE/followers",
            "following_url": "https://api.github.com/users/WANG-XIN-EE/following{/other_user}",
            "gists_url": "https://api.github.com/users/WANG-XIN-EE/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/WANG-XIN-EE/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/WANG-XIN-EE/subscriptions",
            "organizations_url": "https://api.github.com/users/WANG-XIN-EE/orgs",
            "repos_url": "https://api.github.com/users/WANG-XIN-EE/repos",
            "events_url": "https://api.github.com/users/WANG-XIN-EE/events{/privacy}",
            "received_events_url": "https://api.github.com/users/WANG-XIN-EE/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-01T02:21:57Z",
        "updated_at": "2023-03-01T02:21:57Z",
        "author_association": "NONE",
        "body": "> Create a session per model and call Run() on each session in separate threads. You can also choose to use multiple processes to do the same.\r\n\r\nThanks for your replyï¼I will have a try",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1449223820/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1449494183",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14853#issuecomment-1449494183",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14853",
        "id": 1449494183,
        "node_id": "IC_kwDOCVq1mM5WZYan",
        "user": {
            "login": "WANG-XIN-EE",
            "id": 64546671,
            "node_id": "MDQ6VXNlcjY0NTQ2Njcx",
            "avatar_url": "https://avatars.githubusercontent.com/u/64546671?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/WANG-XIN-EE",
            "html_url": "https://github.com/WANG-XIN-EE",
            "followers_url": "https://api.github.com/users/WANG-XIN-EE/followers",
            "following_url": "https://api.github.com/users/WANG-XIN-EE/following{/other_user}",
            "gists_url": "https://api.github.com/users/WANG-XIN-EE/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/WANG-XIN-EE/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/WANG-XIN-EE/subscriptions",
            "organizations_url": "https://api.github.com/users/WANG-XIN-EE/orgs",
            "repos_url": "https://api.github.com/users/WANG-XIN-EE/repos",
            "events_url": "https://api.github.com/users/WANG-XIN-EE/events{/privacy}",
            "received_events_url": "https://api.github.com/users/WANG-XIN-EE/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-01T07:42:11Z",
        "updated_at": "2023-03-01T07:42:11Z",
        "author_association": "NONE",
        "body": "> Create a session per model and call Run() on each session in separate threads. You can also choose to use multiple processes to do the same.\r\n\r\nI have try to create a session per model and use openmp for parallel running, but the results are not satisfying. When I use \"#pragma omp parallel num_threads(1)\", the time use is 4.7ms, but when i use \"#pragma omp parallel num_threads(10)\", the time use is 8.3ms. It means that when i use multi-threads for parallel, there is no improvement in time-consuming. The codes are as follows:\r\n\r\nint main()\r\n{\r\n    int Num_LSTM = 100;\r\n\r\n    Ort::Env env(ORT_LOGGING_LEVEL_WARNING, \"test\");\r\n    Ort::SessionOptions session_options;\r\n    session_options.SetIntraOpNumThreads(1);\r\n  \r\n    session_options.SetGraphOptimizationLevel(GraphOptimizationLevel::ORT_ENABLE_EXTENDED);\r\n\r\n    const char* model_path = \"../net_LSTM_IEEE2383_20220820_G0V4_gpu_static.onnx\";\r\n    Ort::Session session_template(env, model_path, session_options);\r\n    \r\n    void *p = operator new(Num_LSTM*sizeof(Ort::Session));\r\n    Ort::Session* session_ = static_cast<Ort::Session*>(p);\r\n    for(int i = 0; i <= Num_LSTM - 1; i++)\r\n    {\r\n        new(session_ + i) Ort::Session(env, model_path, session_options);\r\n    }\r\n    // session_.resize(Num_LSTM);\r\n    // print model input layer (node names, types, shape etc.)\r\n    Ort::AllocatorWithDefaultOptions allocator;\r\n\r\n    // // print number of model input nodes\r\n    // std::vector<const char*> input_node_names = {\"input\",\"h0\",\"c0\"};\r\n    // std::vector<const char*> output_node_names = {\"output,hn,cn\"}; \r\n    // /*********input**********/\r\n    std::vector<int64_t> input_node_dims = {1, 1, 6};\r\n    size_t input_tensor_size = 6; \r\n    // /*********h0**********/\r\n    std::vector<int64_t> input_h0_node_dims = {3, 1, 32};\r\n    size_t input_h0_tensor_size = 3 * 1 * 32; \r\n    // /*********c0**********/\r\n    std::vector<int64_t> input_c0_node_dims = {3, 1, 32};\r\n    size_t input_c0_tensor_size = 3 * 1 * 32; \r\n    \r\n    double t_1;\r\n    \r\n      auto start1_1 = std::chrono::steady_clock::now();\r\n      #pragma omp parallel num_threads(10)\r\n      for (int i = 0;i <= Num_LSTM - 1;i++)\r\n      {\r\n          size_t num_input_nodes = session_[i].GetInputCount();\r\n          \r\n          /*********input**********/\r\n          std::vector<float> input_tensor_values(input_tensor_size);\r\n          for (unsigned int i = 0; i < input_tensor_size; i++)\r\n              input_tensor_values[i] = (float)1;\r\n          // create input tensor object from data values\r\n          auto memory_info = Ort::MemoryInfo::CreateCpu(OrtArenaAllocator, OrtMemTypeDefault);\r\n          Ort::Value input_tensor = Ort::Value::CreateTensor<float>(memory_info, input_tensor_values.data(), input_tensor_size, input_node_dims.data(), 3);\r\n          assert(input_tensor.IsTensor());\r\n          \r\n          /*********h0**********/\r\n          std::vector<float> input_h0_tensor_values(input_h0_tensor_size);\r\n          for (unsigned int i = 0; i < input_h0_tensor_size; i++)\r\n              input_h0_tensor_values[i] = (float)0;\r\n          // create input tensor object from data values\r\n          auto h0_memory_info = Ort::MemoryInfo::CreateCpu(OrtArenaAllocator, OrtMemTypeDefault);\r\n          Ort::Value input_h0_tensor = Ort::Value::CreateTensor<float>(h0_memory_info, input_h0_tensor_values.data(), input_h0_tensor_size, input_h0_node_dims.data(), 3);\r\n          assert(input_h0_tensor.IsTensor());\r\n\r\n          /*********c0**********/\r\n          std::vector<float> input_c0_tensor_values(input_c0_tensor_size);\r\n          for (unsigned int i = 0; i < input_c0_tensor_size; i++)\r\n              input_c0_tensor_values[i] = (float)0;\r\n          // create input tensor object from data values\r\n          auto c0_memory_info = Ort::MemoryInfo::CreateCpu(OrtArenaAllocator, OrtMemTypeDefault);\r\n          Ort::Value input_c0_tensor = Ort::Value::CreateTensor<float>(c0_memory_info, input_c0_tensor_values.data(), input_c0_tensor_size, input_c0_node_dims.data(), 3);\r\n          assert(input_c0_tensor.IsTensor());\r\n\r\n          std::vector<Ort::Value> ort_inputs;\r\n          ort_inputs.push_back(std::move(input_tensor));        \r\n          ort_inputs.push_back(std::move(input_h0_tensor));\r\n          ort_inputs.push_back(std::move(input_c0_tensor));\r\n\r\n          std::vector<const char*> input_node_names = {\"input\",\"h0\",\"c0\"};\r\n          std::vector<const char*> output_node_names = {\"output,hn,cn\"}; \r\n          std::vector<Ort::Value> output_tensors = (*(session_ + i)).Run(Ort::RunOptions{nullptr}, input_node_names.data(), ort_inputs.data(), ort_inputs.size(), output_node_names.data(), 1);\r\n      }\r\n      auto end1_1 = std::chrono::steady_clock::now();\r\n      std::chrono::duration<double, std::milli> elapsed_temptui_1 = end1_1 - start1_1;\r\n      t_1 = elapsed_temptui_1.count();\r\n \r\n    cout<<t_1<<\"ms\"<<endl;\r\n\r\n    std::cout<<\"ok\"<<endl;\r\n    printf(\"Done!\\n\");\r\n    return 0;\r\n}\r\n\r\ncould you give me a help for this? Thanks",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1449494183/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1454980586",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14853#issuecomment-1454980586",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14853",
        "id": 1454980586,
        "node_id": "IC_kwDOCVq1mM5WuT3q",
        "user": {
            "login": "RandySheriffH",
            "id": 48490400,
            "node_id": "MDQ6VXNlcjQ4NDkwNDAw",
            "avatar_url": "https://avatars.githubusercontent.com/u/48490400?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/RandySheriffH",
            "html_url": "https://github.com/RandySheriffH",
            "followers_url": "https://api.github.com/users/RandySheriffH/followers",
            "following_url": "https://api.github.com/users/RandySheriffH/following{/other_user}",
            "gists_url": "https://api.github.com/users/RandySheriffH/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/RandySheriffH/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/RandySheriffH/subscriptions",
            "organizations_url": "https://api.github.com/users/RandySheriffH/orgs",
            "repos_url": "https://api.github.com/users/RandySheriffH/repos",
            "events_url": "https://api.github.com/users/RandySheriffH/events{/privacy}",
            "received_events_url": "https://api.github.com/users/RandySheriffH/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-05T03:41:03Z",
        "updated_at": "2023-03-05T03:41:03Z",
        "author_association": "MEMBER",
        "body": "@WANG-XIN-EE: how many physical cores are there on your system? The first thing to debug such an observation is to make sure you are not over-subscribing.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1454980586/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1454981846",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14853#issuecomment-1454981846",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14853",
        "id": 1454981846,
        "node_id": "IC_kwDOCVq1mM5WuULW",
        "user": {
            "login": "WANG-XIN-EE",
            "id": 64546671,
            "node_id": "MDQ6VXNlcjY0NTQ2Njcx",
            "avatar_url": "https://avatars.githubusercontent.com/u/64546671?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/WANG-XIN-EE",
            "html_url": "https://github.com/WANG-XIN-EE",
            "followers_url": "https://api.github.com/users/WANG-XIN-EE/followers",
            "following_url": "https://api.github.com/users/WANG-XIN-EE/following{/other_user}",
            "gists_url": "https://api.github.com/users/WANG-XIN-EE/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/WANG-XIN-EE/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/WANG-XIN-EE/subscriptions",
            "organizations_url": "https://api.github.com/users/WANG-XIN-EE/orgs",
            "repos_url": "https://api.github.com/users/WANG-XIN-EE/repos",
            "events_url": "https://api.github.com/users/WANG-XIN-EE/events{/privacy}",
            "received_events_url": "https://api.github.com/users/WANG-XIN-EE/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-05T03:51:04Z",
        "updated_at": "2023-03-05T03:51:04Z",
        "author_association": "NONE",
        "body": "@RandySheriffH thanks for your attention. the problem has been solved. there is a mistake in \"openmp\" programming syntax. it is sovled by change \" #pragma omp parallel num_threads(10)\" to \" **#pragma omp parallel for num_threads(10)**\".  unforgettable experience",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1454981846/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]