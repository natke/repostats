[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1466653954",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15024#issuecomment-1466653954",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15024",
        "id": 1466653954,
        "node_id": "IC_kwDOCVq1mM5Xa10C",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-13T18:06:49Z",
        "updated_at": "2023-03-13T18:06:49Z",
        "author_association": "MEMBER",
        "body": "A C API for this already exists. Does this work for you? https://github.com/microsoft/onnxruntime/blob/c6074f3a4b09cb44b46ca4422717deb067015bfa/include/onnxruntime/core/session/onnxruntime_c_api.h#L3399-L3401",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1466653954/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1466995307",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15024#issuecomment-1466995307",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15024",
        "id": 1466995307,
        "node_id": "IC_kwDOCVq1mM5XcJJr",
        "user": {
            "login": "ssube",
            "id": 451959,
            "node_id": "MDQ6VXNlcjQ1MTk1OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/451959?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ssube",
            "html_url": "https://github.com/ssube",
            "followers_url": "https://api.github.com/users/ssube/followers",
            "following_url": "https://api.github.com/users/ssube/following{/other_user}",
            "gists_url": "https://api.github.com/users/ssube/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ssube/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ssube/subscriptions",
            "organizations_url": "https://api.github.com/users/ssube/orgs",
            "repos_url": "https://api.github.com/users/ssube/repos",
            "events_url": "https://api.github.com/users/ssube/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ssube/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-13T21:34:23Z",
        "updated_at": "2023-03-13T22:03:01Z",
        "author_association": "NONE",
        "body": "I think that could work, but I'm currently working in Python. Is that function exposed in the C binding module at all (I've been looking, but have not found it)? If not, would that be a good PR?\r\n\r\nEdit: it looks like that method is available as `onnxruntime.SessionOptions().add_external_initializers()`. I just need to figure out how to use it :smile: ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1466995307/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1467045595",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15024#issuecomment-1467045595",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15024",
        "id": 1467045595,
        "node_id": "IC_kwDOCVq1mM5XcVbb",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-13T22:17:11Z",
        "updated_at": "2023-03-13T22:17:11Z",
        "author_association": "MEMBER",
        "body": "Here's an example https://github.com/microsoft/onnxruntime/blob/8d87fdcfa19a6b5932c88137b9cd6a43a658c7f3/onnxruntime/test/python/onnxruntime_test_python.py#L1017-L1028",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1467045595/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1469230530",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15024#issuecomment-1469230530",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15024",
        "id": 1469230530,
        "node_id": "IC_kwDOCVq1mM5Xkq3C",
        "user": {
            "login": "ssube",
            "id": 451959,
            "node_id": "MDQ6VXNlcjQ1MTk1OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/451959?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ssube",
            "html_url": "https://github.com/ssube",
            "followers_url": "https://api.github.com/users/ssube/followers",
            "following_url": "https://api.github.com/users/ssube/following{/other_user}",
            "gists_url": "https://api.github.com/users/ssube/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ssube/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ssube/subscriptions",
            "organizations_url": "https://api.github.com/users/ssube/orgs",
            "repos_url": "https://api.github.com/users/ssube/repos",
            "events_url": "https://api.github.com/users/ssube/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ssube/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-15T02:52:23Z",
        "updated_at": "2023-03-15T02:54:11Z",
        "author_association": "NONE",
        "body": "Thanks, that works. I have been able to build and run models without ever writing them to disk, which is excellent, but there is one part I'm not sure about. I wrote a function to convert the initializers with external data to bytes:\r\n\r\n```python\r\ndef buffer_external_data_tensors(model: ModelProto) -> Tuple[ModelProto, List[Tuple[str, OrtValue]]]:\r\n    external_data = []\r\n    for tensor in model.graph.initializer:\r\n        name = tensor.name\r\n\r\n        logger.info(\"externalizing tensor: %s\", name)\r\n        if tensor.HasField(\"raw_data\"):\r\n            npt = numpy_helper.to_array(tensor)\r\n            orv = OrtValue.ortvalue_from_numpy(npt)\r\n            external_data.append((name, orv))\r\n            # mimic set_external_data\r\n            set_external_data(tensor, location=\"foo.bin\")\r\n            tensor.name = name\r\n            tensor.ClearField(\"raw_data\")\r\n\r\n    return (model, external_data)\r\n\r\ndef main():\r\n    # loading and blending multiple models...\r\n    (bare_model, external_data) = buffer_external_data_tensors(blend_model)\r\n    logger.info(\"saved external data for %s nodes\", len(external_data))\r\n\r\n    external_names, external_values = zip(*external_data)\r\n    opts = SessionOptions()\r\n    opts.add_external_initializers(list(external_names), list(external_values))\r\n\r\n    sess = InferenceSession(bare_model.SerializeToString(), sess_options=opts, providers=[\"CPUExecutionProvider\"])\r\n    logger.info(\"successfully loaded blended model: %s\", [i.name for i in sess.get_inputs()])\r\n```\r\n\r\nbut that conversion through numpy is not ideal: `OrtValue.ortvalue_from_numpy(numpy_helper.to_array(tensor))`.\r\n\r\nIs there a way I can create an `OrtValue` directly from the `TensorProto`? It looks like that used to exist, but might have been removed: https://github.com/microsoft/onnxruntime/issues/1640#issuecomment-522196462 . \r\n\r\nThis method only takes a few seconds on a 3GB model (SD v1.5 Unet), so that's still pretty good.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1469230530/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]