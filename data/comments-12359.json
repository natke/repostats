[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1197719376",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12359#issuecomment-1197719376",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12359",
        "id": 1197719376,
        "node_id": "IC_kwDOCVq1mM5HY79Q",
        "user": {
            "login": "michaelroyzen",
            "id": 45830328,
            "node_id": "MDQ6VXNlcjQ1ODMwMzI4",
            "avatar_url": "https://avatars.githubusercontent.com/u/45830328?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/michaelroyzen",
            "html_url": "https://github.com/michaelroyzen",
            "followers_url": "https://api.github.com/users/michaelroyzen/followers",
            "following_url": "https://api.github.com/users/michaelroyzen/following{/other_user}",
            "gists_url": "https://api.github.com/users/michaelroyzen/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/michaelroyzen/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/michaelroyzen/subscriptions",
            "organizations_url": "https://api.github.com/users/michaelroyzen/orgs",
            "repos_url": "https://api.github.com/users/michaelroyzen/repos",
            "events_url": "https://api.github.com/users/michaelroyzen/events{/privacy}",
            "received_events_url": "https://api.github.com/users/michaelroyzen/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-28T06:28:09Z",
        "updated_at": "2022-07-28T06:28:09Z",
        "author_association": "NONE",
        "body": "I suspect that the issue is that \r\n\r\n> /opt/conda/lib/python3.8/site-packages/onnxruntime/transformers/models/gpt2/../../onnx_model.py\r\n\r\nis an outdated file -- it seems that the onnx_model.py path needs to be fixed somewhere, seemingly in this import:\r\n\r\n> from onnxruntime.transformers.optimizer import optimize_model\r\n\r\nas that is where _save_model_to_file_ is imported, which than calls onnx_model.py at the above path.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1197719376/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1198710532",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12359#issuecomment-1198710532",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12359",
        "id": 1198710532,
        "node_id": "IC_kwDOCVq1mM5Hct8E",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-28T23:07:05Z",
        "updated_at": "2022-07-28T23:10:41Z",
        "author_association": "MEMBER",
        "body": "@michaelroyzen, could you uninstall onnxruntime-gpu, then install the nightly build\r\n``\r\npip install -i https://test.pypi.org/simple/ ort-nightly-gpu\r\n``\r\nI guess the issue is resolved in the master branch as it changes that part: https://github.com/microsoft/onnxruntime/blob/0e85af6990ac41b8925722d4aee990909421a729/onnxruntime/python/tools/transformers/onnx_model.py#L914-L917>\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1198710532/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1198731078",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12359#issuecomment-1198731078",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12359",
        "id": 1198731078,
        "node_id": "IC_kwDOCVq1mM5Hcy9G",
        "user": {
            "login": "michaelroyzen",
            "id": 45830328,
            "node_id": "MDQ6VXNlcjQ1ODMwMzI4",
            "avatar_url": "https://avatars.githubusercontent.com/u/45830328?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/michaelroyzen",
            "html_url": "https://github.com/michaelroyzen",
            "followers_url": "https://api.github.com/users/michaelroyzen/followers",
            "following_url": "https://api.github.com/users/michaelroyzen/following{/other_user}",
            "gists_url": "https://api.github.com/users/michaelroyzen/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/michaelroyzen/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/michaelroyzen/subscriptions",
            "organizations_url": "https://api.github.com/users/michaelroyzen/orgs",
            "repos_url": "https://api.github.com/users/michaelroyzen/repos",
            "events_url": "https://api.github.com/users/michaelroyzen/events{/privacy}",
            "received_events_url": "https://api.github.com/users/michaelroyzen/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-28T23:48:08Z",
        "updated_at": "2022-07-28T23:48:08Z",
        "author_association": "NONE",
        "body": "Thanks for your response, but using the nightly build did not solve this issue @tianleiwu. The issue is that the `from onnxruntime.transformers.optimizer import optimize_model` seems to load some legacy file:\r\n\r\n> /opt/conda/lib/python3.8/site-packages/onnxruntime/transformers/models/gpt2/../../onnx_model.py",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1198731078/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1198734052",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12359#issuecomment-1198734052",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12359",
        "id": 1198734052,
        "node_id": "IC_kwDOCVq1mM5Hczrk",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-28T23:55:41Z",
        "updated_at": "2022-07-28T23:56:40Z",
        "author_association": "MEMBER",
        "body": "@michaelroyzen, I think the onnx_model.py file shall be updated to be the one in master branch when you install nightly build.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1198734052/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1198759722",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12359#issuecomment-1198759722",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12359",
        "id": 1198759722,
        "node_id": "IC_kwDOCVq1mM5Hc58q",
        "user": {
            "login": "michaelroyzen",
            "id": 45830328,
            "node_id": "MDQ6VXNlcjQ1ODMwMzI4",
            "avatar_url": "https://avatars.githubusercontent.com/u/45830328?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/michaelroyzen",
            "html_url": "https://github.com/michaelroyzen",
            "followers_url": "https://api.github.com/users/michaelroyzen/followers",
            "following_url": "https://api.github.com/users/michaelroyzen/following{/other_user}",
            "gists_url": "https://api.github.com/users/michaelroyzen/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/michaelroyzen/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/michaelroyzen/subscriptions",
            "organizations_url": "https://api.github.com/users/michaelroyzen/orgs",
            "repos_url": "https://api.github.com/users/michaelroyzen/repos",
            "events_url": "https://api.github.com/users/michaelroyzen/events{/privacy}",
            "received_events_url": "https://api.github.com/users/michaelroyzen/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-29T00:43:57Z",
        "updated_at": "2022-07-29T00:46:38Z",
        "author_association": "NONE",
        "body": "@tianleiwu You're right that onnx_model.py is updated, but model saving is still broken. I added a sanity check in `save_model_to_file`:\r\n\r\n`print(use_external_data_format)\r\nOnnxModel.save(self.model, output_path, use_external_data_format, all_tensors_to_one_file)`\r\n\r\nwhich correctly prints True, and yet I still get \r\n\r\n> True\r\nTraceback (most recent call last):\r\n  File \"examples/onnxruntime/optimization/question-answering/run_qa.py\", line 525, in <module>\r\n    main()\r\n  File \"examples/onnxruntime/optimization/question-answering/run_qa.py\", line 311, in main\r\n    optimizer.export(\r\n  File \"/home/mroyzen/train_files/optimum/optimum/onnxruntime/optimization.py\", line 150, in export\r\n    optimizer.save_model_to_file(onnx_optimized_model_output_path, use_external_data_format=True)\r\n  File \"/opt/conda/lib/python3.8/site-packages/onnxruntime/transformers/models/gpt2/../../onnx_model.py\", line 938, in save_model_to_file\r\n    OnnxModel.save(self.model, output_path, use_external_data_format, all_tensors_to_one_file)\r\n  File \"/opt/conda/lib/python3.8/site-packages/onnxruntime/transformers/models/gpt2/../../onnx_model.py\", line 914, in save\r\n    save_model(\r\n  File \"/opt/conda/lib/python3.8/site-packages/onnx/__init__.py\", line 202, in save_model\r\n    s = _serialize(proto)\r\n  File \"/opt/conda/lib/python3.8/site-packages/onnx/__init__.py\", line 71, in _serialize\r\n    result = proto.SerializeToString()\r\nValueError: Message onnx.ModelProto exceeds maximum protobuf size of 2GB: 2215158447\r\n\r\nFor some reason, it's failing on \r\n```\r\nsave_model(\r\n                model,\r\n                output_path,\r\n                save_as_external_data=True,\r\n                all_tensors_to_one_file=all_tensors_to_one_file,\r\n                location=location,\r\n                size_threshold=size_threshold,\r\n                convert_attribute=convert_attribute,\r\n            )\r\n``` \r\n(line 914) despite  save_as_external_data=True",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1198759722/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1199855386",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12359#issuecomment-1199855386",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12359",
        "id": 1199855386,
        "node_id": "IC_kwDOCVq1mM5HhFca",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-29T18:55:35Z",
        "updated_at": "2022-07-29T19:02:04Z",
        "author_association": "MEMBER",
        "body": "@michaelroyzen, I think you are using older verison of onnx. Try upgrade onnx to the latest version \r\n`pip install onnx==1.12.0 protobuf==3.20.0`\r\nIf it reproduces with latest onnx version, file an issue in https://github.com/onnx/onnx.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1199855386/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1199864614",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12359#issuecomment-1199864614",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12359",
        "id": 1199864614,
        "node_id": "IC_kwDOCVq1mM5HhHsm",
        "user": {
            "login": "michaelroyzen",
            "id": 45830328,
            "node_id": "MDQ6VXNlcjQ1ODMwMzI4",
            "avatar_url": "https://avatars.githubusercontent.com/u/45830328?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/michaelroyzen",
            "html_url": "https://github.com/michaelroyzen",
            "followers_url": "https://api.github.com/users/michaelroyzen/followers",
            "following_url": "https://api.github.com/users/michaelroyzen/following{/other_user}",
            "gists_url": "https://api.github.com/users/michaelroyzen/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/michaelroyzen/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/michaelroyzen/subscriptions",
            "organizations_url": "https://api.github.com/users/michaelroyzen/orgs",
            "repos_url": "https://api.github.com/users/michaelroyzen/repos",
            "events_url": "https://api.github.com/users/michaelroyzen/events{/privacy}",
            "received_events_url": "https://api.github.com/users/michaelroyzen/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-29T19:08:08Z",
        "updated_at": "2022-07-29T19:08:08Z",
        "author_association": "NONE",
        "body": "Tried with those dependencies @tianleiwu and still the same error. Will open up an issue in onnx.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1199864614/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]