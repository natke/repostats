[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378611057",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14233#issuecomment-1378611057",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14233",
        "id": 1378611057,
        "node_id": "IC_kwDOCVq1mM5SK-9x",
        "user": {
            "login": "xadupre",
            "id": 22452781,
            "node_id": "MDQ6VXNlcjIyNDUyNzgx",
            "avatar_url": "https://avatars.githubusercontent.com/u/22452781?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/xadupre",
            "html_url": "https://github.com/xadupre",
            "followers_url": "https://api.github.com/users/xadupre/followers",
            "following_url": "https://api.github.com/users/xadupre/following{/other_user}",
            "gists_url": "https://api.github.com/users/xadupre/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/xadupre/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/xadupre/subscriptions",
            "organizations_url": "https://api.github.com/users/xadupre/orgs",
            "repos_url": "https://api.github.com/users/xadupre/repos",
            "events_url": "https://api.github.com/users/xadupre/events{/privacy}",
            "received_events_url": "https://api.github.com/users/xadupre/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-11T11:30:18Z",
        "updated_at": "2023-01-11T11:30:18Z",
        "author_association": "MEMBER",
        "body": "Did you try a dynamic quantization?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378611057/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378625700",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14233#issuecomment-1378625700",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14233",
        "id": 1378625700,
        "node_id": "IC_kwDOCVq1mM5SLCik",
        "user": {
            "login": "AbdelsalamHaa",
            "id": 35866217,
            "node_id": "MDQ6VXNlcjM1ODY2MjE3",
            "avatar_url": "https://avatars.githubusercontent.com/u/35866217?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/AbdelsalamHaa",
            "html_url": "https://github.com/AbdelsalamHaa",
            "followers_url": "https://api.github.com/users/AbdelsalamHaa/followers",
            "following_url": "https://api.github.com/users/AbdelsalamHaa/following{/other_user}",
            "gists_url": "https://api.github.com/users/AbdelsalamHaa/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/AbdelsalamHaa/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/AbdelsalamHaa/subscriptions",
            "organizations_url": "https://api.github.com/users/AbdelsalamHaa/orgs",
            "repos_url": "https://api.github.com/users/AbdelsalamHaa/repos",
            "events_url": "https://api.github.com/users/AbdelsalamHaa/events{/privacy}",
            "received_events_url": "https://api.github.com/users/AbdelsalamHaa/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-11T11:43:34Z",
        "updated_at": "2023-01-11T11:44:13Z",
        "author_association": "NONE",
        "body": "> Did you try a dynamic quantization?\n\nThank you for your reply. \n\nYes I did try. But I had to set the weightType to be QUInt8 which cause the model to be slower. But the detection and the confidence is normal this way.\n\nIf I use weightType =QInt8 I would get some error during inference time",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378625700/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378782061",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14233#issuecomment-1378782061",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14233",
        "id": 1378782061,
        "node_id": "IC_kwDOCVq1mM5SLott",
        "user": {
            "login": "xadupre",
            "id": 22452781,
            "node_id": "MDQ6VXNlcjIyNDUyNzgx",
            "avatar_url": "https://avatars.githubusercontent.com/u/22452781?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/xadupre",
            "html_url": "https://github.com/xadupre",
            "followers_url": "https://api.github.com/users/xadupre/followers",
            "following_url": "https://api.github.com/users/xadupre/following{/other_user}",
            "gists_url": "https://api.github.com/users/xadupre/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/xadupre/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/xadupre/subscriptions",
            "organizations_url": "https://api.github.com/users/xadupre/orgs",
            "repos_url": "https://api.github.com/users/xadupre/repos",
            "events_url": "https://api.github.com/users/xadupre/events{/privacy}",
            "received_events_url": "https://api.github.com/users/xadupre/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-11T13:50:21Z",
        "updated_at": "2023-01-11T13:50:21Z",
        "author_association": "MEMBER",
        "body": "The quantization done by onnxruntime is basic. Did you try to quantize before converting your model into ONNX?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378782061/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378913543",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14233#issuecomment-1378913543",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14233",
        "id": 1378913543,
        "node_id": "IC_kwDOCVq1mM5SMI0H",
        "user": {
            "login": "AbdelsalamHaa",
            "id": 35866217,
            "node_id": "MDQ6VXNlcjM1ODY2MjE3",
            "avatar_url": "https://avatars.githubusercontent.com/u/35866217?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/AbdelsalamHaa",
            "html_url": "https://github.com/AbdelsalamHaa",
            "followers_url": "https://api.github.com/users/AbdelsalamHaa/followers",
            "following_url": "https://api.github.com/users/AbdelsalamHaa/following{/other_user}",
            "gists_url": "https://api.github.com/users/AbdelsalamHaa/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/AbdelsalamHaa/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/AbdelsalamHaa/subscriptions",
            "organizations_url": "https://api.github.com/users/AbdelsalamHaa/orgs",
            "repos_url": "https://api.github.com/users/AbdelsalamHaa/repos",
            "events_url": "https://api.github.com/users/AbdelsalamHaa/events{/privacy}",
            "received_events_url": "https://api.github.com/users/AbdelsalamHaa/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-11T15:12:34Z",
        "updated_at": "2023-01-11T15:12:34Z",
        "author_association": "NONE",
        "body": "No, I didn't try doing quantization before converting to onnx. Do you have any suggestions or some links on where I can do that for yolov5. Looks like the official GitHub page of yolov5 has not add that yet. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378913543/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378921593",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14233#issuecomment-1378921593",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14233",
        "id": 1378921593,
        "node_id": "IC_kwDOCVq1mM5SMKx5",
        "user": {
            "login": "xadupre",
            "id": 22452781,
            "node_id": "MDQ6VXNlcjIyNDUyNzgx",
            "avatar_url": "https://avatars.githubusercontent.com/u/22452781?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/xadupre",
            "html_url": "https://github.com/xadupre",
            "followers_url": "https://api.github.com/users/xadupre/followers",
            "following_url": "https://api.github.com/users/xadupre/following{/other_user}",
            "gists_url": "https://api.github.com/users/xadupre/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/xadupre/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/xadupre/subscriptions",
            "organizations_url": "https://api.github.com/users/xadupre/orgs",
            "repos_url": "https://api.github.com/users/xadupre/repos",
            "events_url": "https://api.github.com/users/xadupre/events{/privacy}",
            "received_events_url": "https://api.github.com/users/xadupre/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-11T15:16:04Z",
        "updated_at": "2023-01-11T15:16:04Z",
        "author_association": "MEMBER",
        "body": "torch documentation is usually a good starting point: https://pytorch.org/docs/stable/quantization.html.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378921593/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378984077",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14233#issuecomment-1378984077",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14233",
        "id": 1378984077,
        "node_id": "IC_kwDOCVq1mM5SMaCN",
        "user": {
            "login": "AbdelsalamHaa",
            "id": 35866217,
            "node_id": "MDQ6VXNlcjM1ODY2MjE3",
            "avatar_url": "https://avatars.githubusercontent.com/u/35866217?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/AbdelsalamHaa",
            "html_url": "https://github.com/AbdelsalamHaa",
            "followers_url": "https://api.github.com/users/AbdelsalamHaa/followers",
            "following_url": "https://api.github.com/users/AbdelsalamHaa/following{/other_user}",
            "gists_url": "https://api.github.com/users/AbdelsalamHaa/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/AbdelsalamHaa/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/AbdelsalamHaa/subscriptions",
            "organizations_url": "https://api.github.com/users/AbdelsalamHaa/orgs",
            "repos_url": "https://api.github.com/users/AbdelsalamHaa/repos",
            "events_url": "https://api.github.com/users/AbdelsalamHaa/events{/privacy}",
            "received_events_url": "https://api.github.com/users/AbdelsalamHaa/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-11T15:42:53Z",
        "updated_at": "2023-01-11T15:42:53Z",
        "author_association": "NONE",
        "body": "@xadupre \r\nOkay noted, thank you very much for your reply. Just curious, what could have caused my static quantization implementation to behave this way( all output confidence are zeros )? Any ideas or thoughts on that? \r\n\r\nIn terms of speed, the model became 2x faster but all confidence values are zero\r\n\r\nThanks again for your help. \r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378984077/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1379009216",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14233#issuecomment-1379009216",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14233",
        "id": 1379009216,
        "node_id": "IC_kwDOCVq1mM5SMgLA",
        "user": {
            "login": "xadupre",
            "id": 22452781,
            "node_id": "MDQ6VXNlcjIyNDUyNzgx",
            "avatar_url": "https://avatars.githubusercontent.com/u/22452781?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/xadupre",
            "html_url": "https://github.com/xadupre",
            "followers_url": "https://api.github.com/users/xadupre/followers",
            "following_url": "https://api.github.com/users/xadupre/following{/other_user}",
            "gists_url": "https://api.github.com/users/xadupre/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/xadupre/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/xadupre/subscriptions",
            "organizations_url": "https://api.github.com/users/xadupre/orgs",
            "repos_url": "https://api.github.com/users/xadupre/repos",
            "events_url": "https://api.github.com/users/xadupre/events{/privacy}",
            "received_events_url": "https://api.github.com/users/xadupre/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-11T15:53:40Z",
        "updated_at": "2023-01-11T15:53:40Z",
        "author_association": "MEMBER",
        "body": "I'm not sure. I would compare the quantized model in torch with the original torch model. If there is no discrepancies, that means the quantization done by onnxruntime is different from what torch is doing. The onnxruntime quantization is basic so I would not be surprised. The quantization may impact a different set of nodes and the parameter may be different.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1379009216/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1379234672",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14233#issuecomment-1379234672",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14233",
        "id": 1379234672,
        "node_id": "IC_kwDOCVq1mM5SNXNw",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-11T17:26:38Z",
        "updated_at": "2023-01-11T17:27:38Z",
        "author_association": "MEMBER",
        "body": "@AbdelsalamHaa, the quantization of nodes at the end of yolov5 model causes the accuracy drop because their tensor range is very large. Please exclude them from quantization. (You can also exclude the ones that are marked by blue). I think **nodes_to_exclude=** in your script doesn't work is because your model has different names for those nodes:\r\n```\r\n quantize_static(\r\n      model_fp32,\r\n      model_quant,\r\n      calibration_data_reader=dr,\r\n      activation_type=QuantType.QUInt8,\r\n      weight_type=QuantType.QInt8,\r\n      **nodes_to_exclude=['Mul_214', 'Mul_225', 'Mul_249', 'Mul_260', 'Mul_284', 'Mul_295', 'Concat_231', 'Concat_266', 'Concat_301', 'Concat_303'],**\r\n      per_channel=True,\r\n      reduce_range=True,\r\n          )\r\n```\r\n\r\n\r\n![image](https://user-images.githubusercontent.com/30486710/211874423-bf6951b1-f085-4b05-b7dc-cf371f0f4c8b.png)\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1379234672/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1379743531",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14233#issuecomment-1379743531",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14233",
        "id": 1379743531,
        "node_id": "IC_kwDOCVq1mM5SPTcr",
        "user": {
            "login": "AbdelsalamHaa",
            "id": 35866217,
            "node_id": "MDQ6VXNlcjM1ODY2MjE3",
            "avatar_url": "https://avatars.githubusercontent.com/u/35866217?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/AbdelsalamHaa",
            "html_url": "https://github.com/AbdelsalamHaa",
            "followers_url": "https://api.github.com/users/AbdelsalamHaa/followers",
            "following_url": "https://api.github.com/users/AbdelsalamHaa/following{/other_user}",
            "gists_url": "https://api.github.com/users/AbdelsalamHaa/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/AbdelsalamHaa/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/AbdelsalamHaa/subscriptions",
            "organizations_url": "https://api.github.com/users/AbdelsalamHaa/orgs",
            "repos_url": "https://api.github.com/users/AbdelsalamHaa/repos",
            "events_url": "https://api.github.com/users/AbdelsalamHaa/events{/privacy}",
            "received_events_url": "https://api.github.com/users/AbdelsalamHaa/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-12T02:48:39Z",
        "updated_at": "2023-01-12T02:58:11Z",
        "author_association": "NONE",
        "body": "@yufenglee \r\nThank you very much for your help. That worked but I had to put `per_channel=False`. the model now is 2x faster. Next is for me to check the accuracy and see if I can compromise a bit of that. \r\n\r\nIt would be very helpful if you can share with me some links on how to debug this kind of issue in coming future. \r\n\r\n@xadupre \r\nThank you for your reply I will take note of that :). ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1379743531/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1381268596",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14233#issuecomment-1381268596",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14233",
        "id": 1381268596,
        "node_id": "IC_kwDOCVq1mM5SVHx0",
        "user": {
            "login": "AbdelsalamHaa",
            "id": 35866217,
            "node_id": "MDQ6VXNlcjM1ODY2MjE3",
            "avatar_url": "https://avatars.githubusercontent.com/u/35866217?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/AbdelsalamHaa",
            "html_url": "https://github.com/AbdelsalamHaa",
            "followers_url": "https://api.github.com/users/AbdelsalamHaa/followers",
            "following_url": "https://api.github.com/users/AbdelsalamHaa/following{/other_user}",
            "gists_url": "https://api.github.com/users/AbdelsalamHaa/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/AbdelsalamHaa/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/AbdelsalamHaa/subscriptions",
            "organizations_url": "https://api.github.com/users/AbdelsalamHaa/orgs",
            "repos_url": "https://api.github.com/users/AbdelsalamHaa/repos",
            "events_url": "https://api.github.com/users/AbdelsalamHaa/events{/privacy}",
            "received_events_url": "https://api.github.com/users/AbdelsalamHaa/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-13T03:27:36Z",
        "updated_at": "2023-01-13T03:27:36Z",
        "author_association": "NONE",
        "body": "I will close this issue since it has been resolved, @yufenglee I will be delighted if you still can comment and give me some advice on how to debug and over come this kind of issue in the future. thanks",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1381268596/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]