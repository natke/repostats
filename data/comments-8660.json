[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/895456468",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8660#issuecomment-895456468",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8660",
        "id": 895456468,
        "node_id": "IC_kwDOCVq1mM41X5TU",
        "user": {
            "login": "faxu",
            "id": 20780999,
            "node_id": "MDQ6VXNlcjIwNzgwOTk5",
            "avatar_url": "https://avatars.githubusercontent.com/u/20780999?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/faxu",
            "html_url": "https://github.com/faxu",
            "followers_url": "https://api.github.com/users/faxu/followers",
            "following_url": "https://api.github.com/users/faxu/following{/other_user}",
            "gists_url": "https://api.github.com/users/faxu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/faxu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/faxu/subscriptions",
            "organizations_url": "https://api.github.com/users/faxu/orgs",
            "repos_url": "https://api.github.com/users/faxu/repos",
            "events_url": "https://api.github.com/users/faxu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/faxu/received_events",
            "type": "User",
            "site_admin": true
        },
        "created_at": "2021-08-09T18:49:18Z",
        "updated_at": "2021-08-09T18:49:18Z",
        "author_association": "MEMBER",
        "body": "A few questions to help us debug:\r\n- Can you share the model that's resulting in incorrect predictions? \r\n- Which version of PyTorch did you use to export the model?  \r\n- What steps did you use for quantization? \r\n- Do you see the same issues using a CPU build of ORT? ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/895456468/reactions",
            "total_count": 2,
            "+1": 2,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/895740949",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8660#issuecomment-895740949",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8660",
        "id": 895740949,
        "node_id": "IC_kwDOCVq1mM41Y-wV",
        "user": {
            "login": "mayank-nference",
            "id": 86949680,
            "node_id": "MDQ6VXNlcjg2OTQ5Njgw",
            "avatar_url": "https://avatars.githubusercontent.com/u/86949680?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mayank-nference",
            "html_url": "https://github.com/mayank-nference",
            "followers_url": "https://api.github.com/users/mayank-nference/followers",
            "following_url": "https://api.github.com/users/mayank-nference/following{/other_user}",
            "gists_url": "https://api.github.com/users/mayank-nference/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mayank-nference/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mayank-nference/subscriptions",
            "organizations_url": "https://api.github.com/users/mayank-nference/orgs",
            "repos_url": "https://api.github.com/users/mayank-nference/repos",
            "events_url": "https://api.github.com/users/mayank-nference/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mayank-nference/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-08-10T05:30:27Z",
        "updated_at": "2021-08-10T12:44:41Z",
        "author_association": "NONE",
        "body": " A few questions to help us debug:\r\n\r\n* Can you share the model that's resulting in incorrect predictions?\r\n    * yes I have attached here - [onnx_model](https://drive.google.com/file/d/1F5Tdwpt_q0yFKUCVkPE6_GfqaLBOI22g/view?usp=sharing)\r\n*  Which version of PyTorch did you use to export the model?\r\n     * I have used PyTorch stable (1.9.0) \r\n* What steps did you use for quantization?\r\n    * This is how I have exported my model - \r\n* `def convert_to_onnx(model, tokenizer):`\r\n    `model_inputs = GetModelInputs(tokenizer, model_config, onnx_config.SENTENCE)`\r\n    `input_ids,input_mask,segment_ids=model_inputs[\"input_ids\"],model_inputs[\"input_mask\"],model_inputs[\"segment_ids\"]`\r\n    `torch.onnx.export(`\r\n        `model,`\r\n        `(input_ids, input_mask, segment_ids),`\r\n        `\"./onnx_models/model.onnx\",`\r\n         `export_params=True,`\r\n        `opset_version=11,`  \r\n        `do_constant_folding=True,`\r\n        `input_names=[\"input_ids\", \"input_mask\", \"segment_ids\"],`\r\n        `output_names=[\"logits\", \"pooled_output_drop\"],`\r\n        `dynamic_axes={`\r\n            `\"input_ids\" : {0 : \"batch_size\"},`\r\n            `\"input_mask\" : {0 : \"batch_size\"},`\r\n            `\"segment_ids\" : {0 : \"batch_size\"},`\r\n         `}`\r\n    `)` \r\n\r\n* Do you see the same issues using a CPU build of ORT?\r\n    * YES\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/895740949/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/896175894",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8660#issuecomment-896175894",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8660",
        "id": 896175894,
        "node_id": "IC_kwDOCVq1mM41ao8W",
        "user": {
            "login": "YUNQIUGUO",
            "id": 35738743,
            "node_id": "MDQ6VXNlcjM1NzM4NzQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/35738743?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/YUNQIUGUO",
            "html_url": "https://github.com/YUNQIUGUO",
            "followers_url": "https://api.github.com/users/YUNQIUGUO/followers",
            "following_url": "https://api.github.com/users/YUNQIUGUO/following{/other_user}",
            "gists_url": "https://api.github.com/users/YUNQIUGUO/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/YUNQIUGUO/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/YUNQIUGUO/subscriptions",
            "organizations_url": "https://api.github.com/users/YUNQIUGUO/orgs",
            "repos_url": "https://api.github.com/users/YUNQIUGUO/repos",
            "events_url": "https://api.github.com/users/YUNQIUGUO/events{/privacy}",
            "received_events_url": "https://api.github.com/users/YUNQIUGUO/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-08-10T17:28:54Z",
        "updated_at": "2021-08-10T17:28:54Z",
        "author_association": "MEMBER",
        "body": "Thanks for sharing the model.\r\n\r\n@garymm Hi, is this accuracy issue likely to be associated with the conversion? any comments?\r\n If yes, I can close the issue and open a new issue on pytorch-onnx repo. If not, I can tag the inference team to take a look",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/896175894/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/896331474",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8660#issuecomment-896331474",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8660",
        "id": 896331474,
        "node_id": "IC_kwDOCVq1mM41bO7S",
        "user": {
            "login": "garymm",
            "id": 421339,
            "node_id": "MDQ6VXNlcjQyMTMzOQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/421339?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/garymm",
            "html_url": "https://github.com/garymm",
            "followers_url": "https://api.github.com/users/garymm/followers",
            "following_url": "https://api.github.com/users/garymm/following{/other_user}",
            "gists_url": "https://api.github.com/users/garymm/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/garymm/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/garymm/subscriptions",
            "organizations_url": "https://api.github.com/users/garymm/orgs",
            "repos_url": "https://api.github.com/users/garymm/repos",
            "events_url": "https://api.github.com/users/garymm/events{/privacy}",
            "received_events_url": "https://api.github.com/users/garymm/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-08-10T21:37:37Z",
        "updated_at": "2021-08-10T21:37:37Z",
        "author_association": "CONTRIBUTOR",
        "body": "Possible it's due to conversion, but I wouldn't say \"likely\". Someone needs to debug the issue to find the root cause. My team is unlikely to have time to do that any time soon. If it is root-caused to a converter issue, please open an issue in pytorch/pytorch with label `module: onnx`. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/896331474/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/898262262",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8660#issuecomment-898262262",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8660",
        "id": 898262262,
        "node_id": "IC_kwDOCVq1mM41imT2",
        "user": {
            "login": "mayank-nference",
            "id": 86949680,
            "node_id": "MDQ6VXNlcjg2OTQ5Njgw",
            "avatar_url": "https://avatars.githubusercontent.com/u/86949680?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mayank-nference",
            "html_url": "https://github.com/mayank-nference",
            "followers_url": "https://api.github.com/users/mayank-nference/followers",
            "following_url": "https://api.github.com/users/mayank-nference/following{/other_user}",
            "gists_url": "https://api.github.com/users/mayank-nference/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mayank-nference/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mayank-nference/subscriptions",
            "organizations_url": "https://api.github.com/users/mayank-nference/orgs",
            "repos_url": "https://api.github.com/users/mayank-nference/repos",
            "events_url": "https://api.github.com/users/mayank-nference/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mayank-nference/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-08-13T07:52:00Z",
        "updated_at": "2021-08-13T07:52:00Z",
        "author_association": "NONE",
        "body": "@YUNQIUGUO @garymm any updates?? How much time will it take to get this resolve? Any rough idea?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/898262262/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/898662195",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8660#issuecomment-898662195",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8660",
        "id": 898662195,
        "node_id": "IC_kwDOCVq1mM41kH8z",
        "user": {
            "login": "ytaous",
            "id": 4484531,
            "node_id": "MDQ6VXNlcjQ0ODQ1MzE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4484531?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ytaous",
            "html_url": "https://github.com/ytaous",
            "followers_url": "https://api.github.com/users/ytaous/followers",
            "following_url": "https://api.github.com/users/ytaous/following{/other_user}",
            "gists_url": "https://api.github.com/users/ytaous/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ytaous/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ytaous/subscriptions",
            "organizations_url": "https://api.github.com/users/ytaous/orgs",
            "repos_url": "https://api.github.com/users/ytaous/repos",
            "events_url": "https://api.github.com/users/ytaous/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ytaous/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-08-13T19:02:51Z",
        "updated_at": "2021-08-13T19:02:51Z",
        "author_association": "MEMBER",
        "body": "Hi, @mayank-nference, \r\n\r\nTo help us to root cause it, can u pls provide more details on reproducible steps:\r\n1. the sample torch code and inputs that run thru the model to generate outputs (make it small and simple like unit test will be great)\r\n2. the onnxruntime/inference code with (the same) inputs that run thru the converted model to generate outputs\r\n3. the outputs comparison for the sample inputs above (which you might have already) shows decreasing accuracy\r\n\r\nThanks.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/898662195/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1124098806",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8660#issuecomment-1124098806",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8660",
        "id": 1124098806,
        "node_id": "IC_kwDOCVq1mM5DAGL2",
        "user": {
            "login": "ujjawalcse",
            "id": 32773256,
            "node_id": "MDQ6VXNlcjMyNzczMjU2",
            "avatar_url": "https://avatars.githubusercontent.com/u/32773256?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ujjawalcse",
            "html_url": "https://github.com/ujjawalcse",
            "followers_url": "https://api.github.com/users/ujjawalcse/followers",
            "following_url": "https://api.github.com/users/ujjawalcse/following{/other_user}",
            "gists_url": "https://api.github.com/users/ujjawalcse/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ujjawalcse/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ujjawalcse/subscriptions",
            "organizations_url": "https://api.github.com/users/ujjawalcse/orgs",
            "repos_url": "https://api.github.com/users/ujjawalcse/repos",
            "events_url": "https://api.github.com/users/ujjawalcse/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ujjawalcse/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-05-11T18:00:28Z",
        "updated_at": "2022-05-11T18:00:28Z",
        "author_association": "NONE",
        "body": "Hey @mayank-nference ,\r\nI'm facing the same. But I'm converting the fine-tuned model differently.\r\n\r\n```\r\nimport torch\r\nfrom transformers import BertTokenizerFast, BertForTokenClassification\r\nfrom transformers.convert_graph_to_onnx import convert\r\nfrom pathlib import Path\r\n\r\nRESUME_NUM_LABELS = 14\r\nresume_labels = [\"O\", \"Name\", \"Degree\", \"Technical Skill\", \"Soft Skill\", \"College\",\r\n                 \"Designation\", \"Companies worked at\", \"Graduation Year\", \"Years of Experience\", \"Location\",\r\n                   \"Working Period\", \"Major\", \"Personal_Address\"]\r\nDEVICE = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\r\nMODEL_PATH =  'BertBaseUncased'                              #'YituTech/conv-bert-base'          #'bert-base-uncased'\r\n\r\nRESUME_STATE_DICT = torch.load(\"models/model-state-resume_14342_chunks_02-02.bin\", map_location=DEVICE)\r\nTOKENIZER = BertTokenizerFast.from_pretrained('C:\\\\Users\\\\Ujjawal\\\\Downloads\\\\docker_util\\\\BertBaseUncased')\r\nMAX_LEN = 512\r\n\r\nresume_model = BertForTokenClassification.from_pretrained(\r\n    MODEL_PATH, state_dict=RESUME_STATE_DICT['model_state_dict'], num_labels=RESUME_NUM_LABELS)\r\n# resume_model.to(DEVICE)\r\n# resume_model.eval()\r\noutput=Path('C:\\\\Users\\\\Ujjawal\\\\Downloads\\\\docker_util\\\\output\\\\onnx\\\\ner_model_v2.onnx').absolute()\r\nconvert(pipeline='ner',\r\n\t\tframework=\"pt\",\r\n        model=resume_model,\r\n        tokenizer=TOKENIZER,\r\n        output=output,\r\n        opset=11)\r\n```\r\n\r\nBut prediction is not like I get from original model. it's inaccurate in most of the cases.\r\nAny suggestion ?\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1124098806/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]