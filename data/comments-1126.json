[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/496764525",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/1126#issuecomment-496764525",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/1126",
        "id": 496764525,
        "node_id": "MDEyOklzc3VlQ29tbWVudDQ5Njc2NDUyNQ==",
        "user": {
            "login": "bitnick10",
            "id": 5828028,
            "node_id": "MDQ6VXNlcjU4MjgwMjg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5828028?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/bitnick10",
            "html_url": "https://github.com/bitnick10",
            "followers_url": "https://api.github.com/users/bitnick10/followers",
            "following_url": "https://api.github.com/users/bitnick10/following{/other_user}",
            "gists_url": "https://api.github.com/users/bitnick10/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/bitnick10/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/bitnick10/subscriptions",
            "organizations_url": "https://api.github.com/users/bitnick10/orgs",
            "repos_url": "https://api.github.com/users/bitnick10/repos",
            "events_url": "https://api.github.com/users/bitnick10/events{/privacy}",
            "received_events_url": "https://api.github.com/users/bitnick10/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-05-29T02:59:17Z",
        "updated_at": "2019-05-29T04:51:23Z",
        "author_association": "NONE",
        "body": "keras python code:\r\n```\r\nimport keras\r\nfrom keras.models import Sequential\r\nfrom keras.layers import Dense, Dropout, Activation\r\nfrom keras.optimizers import SGD\r\nimport keras.engine.saving\r\nimport keras.models\r\nimport math\r\nimport numpy as np\r\nimport stopwatch\r\nimport onnxmltools\r\ndata_size = 16000\r\nx_train = np.array(np.random.rand(data_size,39),dtype='float32')\r\ny_train = np.zeros(shape=(data_size,2),dtype='float32')\r\n\r\nmodel = Sequential()\r\nmodel.add(Dense(units=22,input_shape=(39,), activation='tanh'))\r\nmodel.add(Dense(units=22, activation='tanh'))\r\nmodel.add(Dense(units=2, activation='tanh'))\r\nsgd = SGD(lr=0.01, momentum=0.9)\r\nmodel.compile(loss='categorical_crossentropy',optimizer=sgd,)\r\n\r\nsw = stopwatch.Stopwatch()\r\nsws=[]\r\nfor i in range(2):\r\n    sw = stopwatch.Stopwatch()\r\n    sw.reset();\r\n    sw.stop();\r\n    sws.append(sw)\r\n\r\nfor i in range(100):\r\n    sws[0].start()\r\n    model.train_on_batch(x_train, y_train)\r\n    sws[0].stop()\r\n    sws[1].start()\r\n    y_predict=model.predict(x_train,batch_size=len(x_train))\r\n    sws[1].stop()\r\n    print(\"{0} {1:.3f} {2:.3f} \".format(i,sws[0].duration/(i+1),sws[1].duration/(i+1)))\r\n\r\nonnx_model = onnxmltools.convert_keras(model, target_opset=7)\r\nonnxmltools.save_model(onnx_model,\"model.onnx\")\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/496764525/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/497210902",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/1126#issuecomment-497210902",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/1126",
        "id": 497210902,
        "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NzIxMDkwMg==",
        "user": {
            "login": "ke1337",
            "id": 22626095,
            "node_id": "MDQ6VXNlcjIyNjI2MDk1",
            "avatar_url": "https://avatars.githubusercontent.com/u/22626095?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ke1337",
            "html_url": "https://github.com/ke1337",
            "followers_url": "https://api.github.com/users/ke1337/followers",
            "following_url": "https://api.github.com/users/ke1337/following{/other_user}",
            "gists_url": "https://api.github.com/users/ke1337/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ke1337/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ke1337/subscriptions",
            "organizations_url": "https://api.github.com/users/ke1337/orgs",
            "repos_url": "https://api.github.com/users/ke1337/repos",
            "events_url": "https://api.github.com/users/ke1337/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ke1337/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-05-30T05:44:09Z",
        "updated_at": "2019-05-30T06:16:27Z",
        "author_association": "CONTRIBUTOR",
        "body": "It is not an apple-to-apple comparison. In your Keras model, the batch size is 16000, while in ORT the batch size is 1, with 16000 iterations. \r\n@wenbingl can you check if the converter is able to generate model with batch dimension? This model has output with symbolic batch dim, but input batch size is 1...\r\n\r\nAs a workaround, you can manually edit model.onnx to add a symbolic batch dimension. My test shows ORT is ~30% faster than Keras after the edit (6.9ms vs 9ms in Keras)\r\n```\r\nimport onnx\r\nmp = onnx.load_model('model.onnx')\r\nmp.graph.input[0].type.tensor_type.shape.dim[0].dim_param = 'None'\r\nonnx.save(mp, 'model_mod.onnx')\r\n\r\nimport onnxruntime\r\nsess = onnxruntime.InferenceSession('model_mod.onnx')\r\nimport numpy as np\r\nimport time\r\ndata = np.random.rand(16000,39).astype(np.float32)\r\nt = time.time()\r\nresults = sess.run([], {'dense_1_input_01':data})\r\nt2 = time.time()\r\nprint(t2 - t)\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/497210902/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/497216219",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/1126#issuecomment-497216219",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/1126",
        "id": 497216219,
        "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NzIxNjIxOQ==",
        "user": {
            "login": "bitnick10",
            "id": 5828028,
            "node_id": "MDQ6VXNlcjU4MjgwMjg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5828028?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/bitnick10",
            "html_url": "https://github.com/bitnick10",
            "followers_url": "https://api.github.com/users/bitnick10/followers",
            "following_url": "https://api.github.com/users/bitnick10/following{/other_user}",
            "gists_url": "https://api.github.com/users/bitnick10/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/bitnick10/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/bitnick10/subscriptions",
            "organizations_url": "https://api.github.com/users/bitnick10/orgs",
            "repos_url": "https://api.github.com/users/bitnick10/repos",
            "events_url": "https://api.github.com/users/bitnick10/events{/privacy}",
            "received_events_url": "https://api.github.com/users/bitnick10/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-05-30T06:09:58Z",
        "updated_at": "2019-05-30T06:09:58Z",
        "author_association": "NONE",
        "body": "So it is still the \"batch\" predict problem that I asked at #853 ! ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/497216219/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/497218006",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/1126#issuecomment-497218006",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/1126",
        "id": 497218006,
        "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NzIxODAwNg==",
        "user": {
            "login": "ke1337",
            "id": 22626095,
            "node_id": "MDQ6VXNlcjIyNjI2MDk1",
            "avatar_url": "https://avatars.githubusercontent.com/u/22626095?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ke1337",
            "html_url": "https://github.com/ke1337",
            "followers_url": "https://api.github.com/users/ke1337/followers",
            "following_url": "https://api.github.com/users/ke1337/following{/other_user}",
            "gists_url": "https://api.github.com/users/ke1337/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ke1337/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ke1337/subscriptions",
            "organizations_url": "https://api.github.com/users/ke1337/orgs",
            "repos_url": "https://api.github.com/users/ke1337/repos",
            "events_url": "https://api.github.com/users/ke1337/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ke1337/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-05-30T06:18:16Z",
        "updated_at": "2019-05-30T06:18:16Z",
        "author_association": "CONTRIBUTOR",
        "body": "If the ask is to use C api to edit model to have batch dimension, you could do that too, with ONNX protobuf directly. However that is beyond the scope of ONNXRuntime's C api..",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/497218006/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/497218933",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/1126#issuecomment-497218933",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/1126",
        "id": 497218933,
        "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NzIxODkzMw==",
        "user": {
            "login": "bitnick10",
            "id": 5828028,
            "node_id": "MDQ6VXNlcjU4MjgwMjg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5828028?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/bitnick10",
            "html_url": "https://github.com/bitnick10",
            "followers_url": "https://api.github.com/users/bitnick10/followers",
            "following_url": "https://api.github.com/users/bitnick10/following{/other_user}",
            "gists_url": "https://api.github.com/users/bitnick10/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/bitnick10/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/bitnick10/subscriptions",
            "organizations_url": "https://api.github.com/users/bitnick10/orgs",
            "repos_url": "https://api.github.com/users/bitnick10/repos",
            "events_url": "https://api.github.com/users/bitnick10/events{/privacy}",
            "received_events_url": "https://api.github.com/users/bitnick10/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-05-30T06:22:37Z",
        "updated_at": "2019-05-30T06:22:37Z",
        "author_association": "NONE",
        "body": "I want to know how to predict like\r\n `y_predict=model.predict(x_train,batch_size=len(x_train)` in C or C++",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/497218933/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/497221034",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/1126#issuecomment-497221034",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/1126",
        "id": 497221034,
        "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NzIyMTAzNA==",
        "user": {
            "login": "ke1337",
            "id": 22626095,
            "node_id": "MDQ6VXNlcjIyNjI2MDk1",
            "avatar_url": "https://avatars.githubusercontent.com/u/22626095?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ke1337",
            "html_url": "https://github.com/ke1337",
            "followers_url": "https://api.github.com/users/ke1337/followers",
            "following_url": "https://api.github.com/users/ke1337/following{/other_user}",
            "gists_url": "https://api.github.com/users/ke1337/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ke1337/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ke1337/subscriptions",
            "organizations_url": "https://api.github.com/users/ke1337/orgs",
            "repos_url": "https://api.github.com/users/ke1337/repos",
            "events_url": "https://api.github.com/users/ke1337/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ke1337/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-05-30T06:32:14Z",
        "updated_at": "2019-05-30T06:32:14Z",
        "author_association": "CONTRIBUTOR",
        "body": "ONNXRuntime currently do not have that kind of C api, and batch dimension needs to be specified as symbolic instead of fixed size in the onnx model to allow batched predict.\r\n\r\nI understand the usefulness of the proposed API, but there are ambiguities if the API is not carefully designed. In the case of 1 input, it's easy to replace 1 at dim0 with symbolic dimension, but we should also consider models with more than one inputs, and which dim of 1 in the inputs corresponds to batch is hard to guess.\r\n\r\nFor now, I think you need to manually edit the model to have symbolic batch dimension as the example code above. You may edit the model offline with Python, then run inference in C/C++ by feeding data with actual batch dimensions.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/497221034/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/497222703",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/1126#issuecomment-497222703",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/1126",
        "id": 497222703,
        "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NzIyMjcwMw==",
        "user": {
            "login": "bitnick10",
            "id": 5828028,
            "node_id": "MDQ6VXNlcjU4MjgwMjg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5828028?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/bitnick10",
            "html_url": "https://github.com/bitnick10",
            "followers_url": "https://api.github.com/users/bitnick10/followers",
            "following_url": "https://api.github.com/users/bitnick10/following{/other_user}",
            "gists_url": "https://api.github.com/users/bitnick10/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/bitnick10/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/bitnick10/subscriptions",
            "organizations_url": "https://api.github.com/users/bitnick10/orgs",
            "repos_url": "https://api.github.com/users/bitnick10/repos",
            "events_url": "https://api.github.com/users/bitnick10/events{/privacy}",
            "received_events_url": "https://api.github.com/users/bitnick10/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-05-30T06:39:48Z",
        "updated_at": "2019-05-30T06:39:48Z",
        "author_association": "NONE",
        "body": "@KeDengMS Thanks for your patient answers.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/497222703/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]