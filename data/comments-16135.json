[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1567741996",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/16135#issuecomment-1567741996",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/16135",
        "id": 1567741996,
        "node_id": "IC_kwDOCVq1mM5dcdgs",
        "user": {
            "login": "juliandewit",
            "id": 8937693,
            "node_id": "MDQ6VXNlcjg5Mzc2OTM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8937693?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/juliandewit",
            "html_url": "https://github.com/juliandewit",
            "followers_url": "https://api.github.com/users/juliandewit/followers",
            "following_url": "https://api.github.com/users/juliandewit/following{/other_user}",
            "gists_url": "https://api.github.com/users/juliandewit/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/juliandewit/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/juliandewit/subscriptions",
            "organizations_url": "https://api.github.com/users/juliandewit/orgs",
            "repos_url": "https://api.github.com/users/juliandewit/repos",
            "events_url": "https://api.github.com/users/juliandewit/events{/privacy}",
            "received_events_url": "https://api.github.com/users/juliandewit/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-05-30T04:33:57Z",
        "updated_at": "2023-05-30T04:37:11Z",
        "author_association": "NONE",
        "body": "The problem also manifests itself when using the pyton runtime. Using the same model file as in the zip file for the c# version.\r\nNote that this problem is independent of model AND runtime. I was also able to reproduce on other computers. (different timings but significant)\r\n\r\nimport numpy\r\nimport onnxruntime as ort\r\nimport datetime\r\nimport time\r\n\r\nort_sess = ort.InferenceSession('testnet.onnx', providers=['CUDAExecutionProvider', 'CPUExecutionProvider'])\r\nprint(\"Device: \", ort.get_device())\r\nx = numpy.zeros((2, 3, 384, 512), dtype=numpy.float32)\r\n\r\nprint(\"Warmup\")\r\nms_list = []\r\nfor i in range(5):\r\n    start_time = datetime.datetime.now()\r\n    outputs = ort_sess.run(None, {'images': x})\r\n    ms_list.append(int(round((datetime.datetime.now() - start_time).total_seconds() * 1000, 2)))\r\nprint(\"Ms per run: \", ms_list)\r\n\r\nprint(\"Fast 4 ms per run\")\r\nms_list = []\r\nfor i in range(100):\r\n    start_time = datetime.datetime.now()\r\n    outputs = ort_sess.run(None, {'images': x})\r\n    end_time = datetime.datetime.now()\r\n    ms_list.append(int(round((datetime.datetime.now() - start_time).total_seconds() * 1000, 2)))\r\nprint(\"Ms per run: \", ms_list)\r\n\r\n\r\nprint(\"Delay between runs,  20-100 ms per run\")\r\nms_list = []\r\nfor i in range(100):\r\n    start_time = datetime.datetime.now()\r\n    outputs = ort_sess.run(None, {'images': x})\r\n    end_time = datetime.datetime.now()\r\n    ms_list.append(int(round((datetime.datetime.now() - start_time).total_seconds() * 1000, 2)))\r\n    time.sleep(0.2)\r\nprint(\"ms per run: \", ms_list)\r\n\r\nprint(\"No delay anymore fast again\")\r\nms_list = []\r\nfor i in range(100):\r\n    start_time = datetime.datetime.now()\r\n    outputs = ort_sess.run(None, {'images': x})\r\n    end_time = datetime.datetime.now()\r\n    ms_list.append(int(round((datetime.datetime.now() - start_time).total_seconds() * 1000, 2)))\r\n\r\nprint(\"ms per run: \", ms_list)\r\n\r\n--------------------------------------------------------------------------------------------------------\r\nDevice:  GPU\r\nWarmup\r\nMs per run:  [1178, 4, 3, 4, 3]\r\nFast 4 ms per run\r\nMs per run:  [4, 3, 3, 3, 4, 3, 3, 4, 3, 3, 4, 4, 3, 3, 3, 4, 3, 3, 3, 4, 4, 3, 3, 3, 4, 3, 3, 4, 3, 3, 4, 3, 3, 3, 4, 3, 3, 4, 3, 3, 4, 3, 3, 4, 3, 3, 4, 3, 3, 4, 3, 3, 4, 3, 3, 3, 4, 3, 4, 3, 3, 4, 3, 3, 4, 3, 3, 4, 3, 3, 4, 3, 3, 3, 4, 3, 4, 3, 4, 3, 3, 3, 4, 3, 3, 4, 3, 3, 4, 3, 4, 3, 3, 4, 3, 3, 4, 3, 3, 4]\r\nDelay between runs,  20-100 ms per run\r\nms per run:  [3, 3, 3, 3, 3, 4, 4, 3, 3, 4, 4, 3, 5, 3, 3, 4, 4, 4, 3, 4, 3, 10, 16, 17, 17, 25, 25, 22, 23, 21, 23, 31, 32, 32, 32, 32, 32, 32, 32, 36, 40, 33, 35, 46, 37, 40, 46, 38, 38, 37, 32, 36, 32, 37, 32, 38, 54, 36, 49, 37, 32, 38, 32, 32, 32, 32, 37, 32, 37, 37, 32, 55, 32, 37, 32, 36, 32, 36, 37, 36, 52, 38, 45, 39, 39, 32, 48, 32, 38, 32, 36, 46, 40, 40, 32, 32, 37, 37, 35, 39]\r\nNo delay anymore fast again\r\nms per run:  [32, 32, 48, 31, 36, 11, 3, 4, 3, 4, 4, 4, 3, 4, 3, 4, 3, 4, 3, 4, 3, 4, 3, 3, 4, 3, 4, 4, 3, 4, 3, 3, 4, 3, 4, 3, 4, 3, 3, 4, 3, 4, 3, 4, 3, 3, 4, 3, 4, 3, 4, 3, 4, 3, 3, 4, 4, 3, 4, 3, 4, 3, 3, 4, 3, 3, 4, 3, 3, 3, 4, 3, 3, 4, 3, 4, 3, 3, 3, 4, 3, 3, 4, 3, 3, 4, 3, 4, 3, 3, 4, 3, 3, 4, 3, 3, 4, 3, 4, 3]\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1567741996/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1583004276",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/16135#issuecomment-1583004276",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/16135",
        "id": 1583004276,
        "node_id": "IC_kwDOCVq1mM5eWrp0",
        "user": {
            "login": "simonjub",
            "id": 78098752,
            "node_id": "MDQ6VXNlcjc4MDk4NzUy",
            "avatar_url": "https://avatars.githubusercontent.com/u/78098752?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/simonjub",
            "html_url": "https://github.com/simonjub",
            "followers_url": "https://api.github.com/users/simonjub/followers",
            "following_url": "https://api.github.com/users/simonjub/following{/other_user}",
            "gists_url": "https://api.github.com/users/simonjub/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/simonjub/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/simonjub/subscriptions",
            "organizations_url": "https://api.github.com/users/simonjub/orgs",
            "repos_url": "https://api.github.com/users/simonjub/repos",
            "events_url": "https://api.github.com/users/simonjub/events{/privacy}",
            "received_events_url": "https://api.github.com/users/simonjub/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-06-08T16:36:05Z",
        "updated_at": "2023-06-08T16:36:05Z",
        "author_association": "NONE",
        "body": "I've seen similar behavior and I believe it is the GPU entering a lower power state (and lower clock speed) when it is seeing lower usage.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1583004276/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1612692511",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/16135#issuecomment-1612692511",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/16135",
        "id": 1612692511,
        "node_id": "IC_kwDOCVq1mM5gH7wf",
        "user": {
            "login": "juliandewit",
            "id": 8937693,
            "node_id": "MDQ6VXNlcjg5Mzc2OTM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8937693?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/juliandewit",
            "html_url": "https://github.com/juliandewit",
            "followers_url": "https://api.github.com/users/juliandewit/followers",
            "following_url": "https://api.github.com/users/juliandewit/following{/other_user}",
            "gists_url": "https://api.github.com/users/juliandewit/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/juliandewit/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/juliandewit/subscriptions",
            "organizations_url": "https://api.github.com/users/juliandewit/orgs",
            "repos_url": "https://api.github.com/users/juliandewit/repos",
            "events_url": "https://api.github.com/users/juliandewit/events{/privacy}",
            "received_events_url": "https://api.github.com/users/juliandewit/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-06-29T09:19:34Z",
        "updated_at": "2023-06-29T09:19:34Z",
        "author_association": "NONE",
        "body": "Yes that was it.. In the GPU config settings we could turn it off and the test worked fine.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1612692511/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]