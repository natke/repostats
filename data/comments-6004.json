[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/737453222",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6004#issuecomment-737453222",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6004",
        "id": 737453222,
        "node_id": "MDEyOklzc3VlQ29tbWVudDczNzQ1MzIyMg==",
        "user": {
            "login": "snnn",
            "id": 856316,
            "node_id": "MDQ6VXNlcjg1NjMxNg==",
            "avatar_url": "https://avatars.githubusercontent.com/u/856316?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/snnn",
            "html_url": "https://github.com/snnn",
            "followers_url": "https://api.github.com/users/snnn/followers",
            "following_url": "https://api.github.com/users/snnn/following{/other_user}",
            "gists_url": "https://api.github.com/users/snnn/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/snnn/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/snnn/subscriptions",
            "organizations_url": "https://api.github.com/users/snnn/orgs",
            "repos_url": "https://api.github.com/users/snnn/repos",
            "events_url": "https://api.github.com/users/snnn/events{/privacy}",
            "received_events_url": "https://api.github.com/users/snnn/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-12-02T19:42:51Z",
        "updated_at": "2020-12-02T19:42:51Z",
        "author_association": "MEMBER",
        "body": "Hi @jaroslavgratz , would you please give us a unit test or model with test data to repro the issue?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/737453222/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/737550036",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6004#issuecomment-737550036",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6004",
        "id": 737550036,
        "node_id": "MDEyOklzc3VlQ29tbWVudDczNzU1MDAzNg==",
        "user": {
            "login": "snnn",
            "id": 856316,
            "node_id": "MDQ6VXNlcjg1NjMxNg==",
            "avatar_url": "https://avatars.githubusercontent.com/u/856316?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/snnn",
            "html_url": "https://github.com/snnn",
            "followers_url": "https://api.github.com/users/snnn/followers",
            "following_url": "https://api.github.com/users/snnn/following{/other_user}",
            "gists_url": "https://api.github.com/users/snnn/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/snnn/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/snnn/subscriptions",
            "organizations_url": "https://api.github.com/users/snnn/orgs",
            "repos_url": "https://api.github.com/users/snnn/repos",
            "events_url": "https://api.github.com/users/snnn/events{/privacy}",
            "received_events_url": "https://api.github.com/users/snnn/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-12-02T23:07:25Z",
        "updated_at": "2020-12-02T23:07:25Z",
        "author_association": "MEMBER",
        "body": "I tried to run all our unit test on a machine with AVX2(but without AVX512), then I searched \"DynamicQuantizeLinear\", I didn't find the similar thing.  So maybe we don't have a unit test to cover it, or it only shows up in some special software environments. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/737550036/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/737595295",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6004#issuecomment-737595295",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6004",
        "id": 737595295,
        "node_id": "MDEyOklzc3VlQ29tbWVudDczNzU5NTI5NQ==",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-12-03T01:16:09Z",
        "updated_at": "2020-12-03T01:16:09Z",
        "author_association": "MEMBER",
        "body": "@snnn, we have unit test for DynamicQuantizeLinear: https://github.com/microsoft/onnxruntime/blob/9ec1ed42a809170b87474f5822c4557101812399/onnxruntime/test/providers/cpu/tensor/dynamic_quantize_linear_test.cc . ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/737595295/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/737694005",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6004#issuecomment-737694005",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6004",
        "id": 737694005,
        "node_id": "MDEyOklzc3VlQ29tbWVudDczNzY5NDAwNQ==",
        "user": {
            "login": "jaroslavgratz",
            "id": 30615894,
            "node_id": "MDQ6VXNlcjMwNjE1ODk0",
            "avatar_url": "https://avatars.githubusercontent.com/u/30615894?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jaroslavgratz",
            "html_url": "https://github.com/jaroslavgratz",
            "followers_url": "https://api.github.com/users/jaroslavgratz/followers",
            "following_url": "https://api.github.com/users/jaroslavgratz/following{/other_user}",
            "gists_url": "https://api.github.com/users/jaroslavgratz/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jaroslavgratz/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jaroslavgratz/subscriptions",
            "organizations_url": "https://api.github.com/users/jaroslavgratz/orgs",
            "repos_url": "https://api.github.com/users/jaroslavgratz/repos",
            "events_url": "https://api.github.com/users/jaroslavgratz/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jaroslavgratz/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-12-03T06:22:51Z",
        "updated_at": "2020-12-03T06:22:51Z",
        "author_association": "NONE",
        "body": "See please int8 quantized model in attachement. Code to reproduce:\r\n```\r\n#include <onnxruntime/core/session/onnxruntime_cxx_api.h>\r\n#include <iostream>\r\n\r\nint main(int argc, char** argv)\r\n{\r\n    Ort::Env env(ORT_LOGGING_LEVEL_WARNING, \"onnxruntime\");\r\n\r\n    Ort::SessionOptions options;\r\n    options.SetIntraOpNumThreads(1);\r\n    options.SetInterOpNumThreads(1);\r\n    Ort::Session session(env, \"model.onnx\", options);\r\n\r\n    std::vector<const char*> inputNames = {\"input_ids\", \"attention_mask\", \"token_type_ids\" };\r\n    std::vector<const char*> outputNames = {\"output\"};\r\n\r\n    // dummy input\r\n    std::vector<int64_t> ids(128, 1);\r\n    std::vector<int64_t> attention_mask(128, 1);\r\n    std::vector<int64_t> type_ids(128, 1);\r\n\r\n    int64_t ids_dims[2] = {1, static_cast<int64_t>(ids.size())};\r\n    int64_t type_ids_dims[2] = {1, static_cast<int64_t>(type_ids.size())};\r\n    int64_t attention_mask_dims[2] = {1, static_cast<int64_t>(attention_mask.size())};\r\n\r\n    auto memory_info = Ort::MemoryInfo::CreateCpu(OrtArenaAllocator, OrtMemTypeDefault);\r\n\r\n    std::vector<Ort::Value> inputs;\r\n    inputs.emplace_back(Ort::Value::CreateTensor<int64_t>(memory_info, ids.data(), ids.size(), ids_dims, 2));\r\n    inputs.emplace_back(Ort::Value::CreateTensor<int64_t>(memory_info, attention_mask.data(), attention_mask.size(), attention_mask_dims, 2));\r\n    inputs.emplace_back(Ort::Value::CreateTensor<int64_t>(memory_info, type_ids.data(), type_ids.size(), type_ids_dims, 2));\r\n\r\n    auto result = session.Run(Ort::RunOptions{nullptr}, inputNames.data(), inputs.data(), inputNames.size(), outputNames.data(), outputNames.size());\r\n\r\n    std::cout << \"RESULT: \" << *result.front().GetTensorData<float>() << std::endl;\r\n\r\n    return 0;\r\n}\r\n```\r\nResult on Xeon(R) Silver 4210 CPU (AVX-512 including VNNI): 1.34879\r\nResult on AMD EPYC 7401P (no AVX-512): 1.43256\r\nResult under valgrind (no AVX-512): 1.43256\r\n\r\nPlease note that I don't see valgrind errors about access to uninitialized data in this simplified test, however inference results are different on AVX2 and AVX-512 CPUs.\r\n[model.zip](https://github.com/microsoft/onnxruntime/files/5634050/model.zip)\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/737694005/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/738177667",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6004#issuecomment-738177667",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6004",
        "id": 738177667,
        "node_id": "MDEyOklzc3VlQ29tbWVudDczODE3NzY2Nw==",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-12-03T17:54:03Z",
        "updated_at": "2020-12-03T17:54:03Z",
        "author_association": "MEMBER",
        "body": "@jaroslavgratz , your issue is caused by saturation that is explained in another thread: https://github.com/microsoft/onnxruntime/issues/5849#issuecomment-733178450. Could you please try the reduce_range option when quantizing your model to see if the issue is resolved?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/738177667/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/738648230",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6004#issuecomment-738648230",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6004",
        "id": 738648230,
        "node_id": "MDEyOklzc3VlQ29tbWVudDczODY0ODIzMA==",
        "user": {
            "login": "jaroslavgratz",
            "id": 30615894,
            "node_id": "MDQ6VXNlcjMwNjE1ODk0",
            "avatar_url": "https://avatars.githubusercontent.com/u/30615894?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jaroslavgratz",
            "html_url": "https://github.com/jaroslavgratz",
            "followers_url": "https://api.github.com/users/jaroslavgratz/followers",
            "following_url": "https://api.github.com/users/jaroslavgratz/following{/other_user}",
            "gists_url": "https://api.github.com/users/jaroslavgratz/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jaroslavgratz/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jaroslavgratz/subscriptions",
            "organizations_url": "https://api.github.com/users/jaroslavgratz/orgs",
            "repos_url": "https://api.github.com/users/jaroslavgratz/repos",
            "events_url": "https://api.github.com/users/jaroslavgratz/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jaroslavgratz/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-12-04T08:42:07Z",
        "updated_at": "2020-12-04T08:42:07Z",
        "author_association": "NONE",
        "body": "Thank you for your explanation. In fact, different prediction on non-VNNI hardware is not an issue for me. I can ensure a model will run on VNNI machines in production. However, model accuracy loss can be quite high on non-VNNI hardware and that can be confusing for users not familiar with AVX instuction sets differences. Please consider use of a 32-bit accumulator for 8-bit multiply results for non-VNNI algorithm, that can improve user experience significantly.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/738648230/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]