[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/531051778",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/1800#issuecomment-531051778",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/1800",
        "id": 531051778,
        "node_id": "MDEyOklzc3VlQ29tbWVudDUzMTA1MTc3OA==",
        "user": {
            "login": "skottmckay",
            "id": 979079,
            "node_id": "MDQ6VXNlcjk3OTA3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/skottmckay",
            "html_url": "https://github.com/skottmckay",
            "followers_url": "https://api.github.com/users/skottmckay/followers",
            "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
            "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
            "organizations_url": "https://api.github.com/users/skottmckay/orgs",
            "repos_url": "https://api.github.com/users/skottmckay/repos",
            "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
            "received_events_url": "https://api.github.com/users/skottmckay/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-09-13T00:06:59Z",
        "updated_at": "2019-09-13T00:06:59Z",
        "author_association": "MEMBER",
        "body": "Not sure what you mean by 'proper userdata parameter'. malloc/free/new/delete don't specify such a thing afaik. What would provide this parameter? The general ORT code or the allocator implementation that calls malloc/free/new/delete? Same question with something providing the size to the Free call - I would assume tracking such a thing was internal to the allocator implementation. \r\n\r\nWhat the basis is for 'usually alloc functions have alignment passed to them as a parameter'. Why is that required to track usage? \r\n\r\nThe IAllocator implementation could track allocation sizes and when they're freed. It could retrieve the stack of a call making an allocation if desired. It could add bytes to the requested size in which to store bookkeeping info. However that's not going to capture calls to 'new', so depending on what you're trying to measure that may be insufficient.\r\n\r\nWhat platform are you trying to do this on? There are different tools on different platforms such as tcmalloc and https://gperftools.github.io/gperftools/heapprofile.html on linux).\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/531051778/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/531054404",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/1800#issuecomment-531054404",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/1800",
        "id": 531054404,
        "node_id": "MDEyOklzc3VlQ29tbWVudDUzMTA1NDQwNA==",
        "user": {
            "login": "RandyGaul",
            "id": 1919825,
            "node_id": "MDQ6VXNlcjE5MTk4MjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1919825?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/RandyGaul",
            "html_url": "https://github.com/RandyGaul",
            "followers_url": "https://api.github.com/users/RandyGaul/followers",
            "following_url": "https://api.github.com/users/RandyGaul/following{/other_user}",
            "gists_url": "https://api.github.com/users/RandyGaul/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/RandyGaul/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/RandyGaul/subscriptions",
            "organizations_url": "https://api.github.com/users/RandyGaul/orgs",
            "repos_url": "https://api.github.com/users/RandyGaul/repos",
            "events_url": "https://api.github.com/users/RandyGaul/events{/privacy}",
            "received_events_url": "https://api.github.com/users/RandyGaul/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-09-13T00:21:11Z",
        "updated_at": "2019-09-13T00:33:19Z",
        "author_association": "NONE",
        "body": "> Not sure what you mean by 'proper userdata parameter'. malloc/free/new/delete don't specify such a thing afaik. What would provide this parameter?\r\n\r\nIt would provide the ability to use a custom allocator with a userdata parameter. For example, a pointer to some allocator state. Here's a quick example.\r\n\r\n```cpp\r\nstruct Allocator\r\n{\r\n\tvoid* (*Alloc)(void* param, size_t size, size_t alignment);\r\n\tvoid (*Free)(void* param, void* allocation);\r\n\tvoid* param;\r\n};\r\n\r\nstruct my_allocation_t\r\n{\r\n\tsize_t size;\r\n\tvoid* user_pointer;\r\n};\r\n\r\nstatic void* wrapper_alloc(void* param, size_t size, size_t alignment)\r\n{\r\n\tmy_allocator_t* allocator = (my_allocator_t*)param;\r\n\tmy_allocation_t* allocation = my_alloc(allocator, size, alignment);\r\n\treturn allocation->user_pointer;\r\n}\r\n```\r\n\r\nIn this example it is trivial for the user to use an OrtAllocator inside of `my_alloc`. `my_alloc` would allocate the user's returned pointer on an alignment boundary, but also store the size of the allocation. However, with the way you have implemented OrtAllocator, there is no `param` (meaning a global allocator context would be required), and the alignment is determined inside of the ONNX runtime, making it impossible to track memory usage this way (track how much memory is used in the `my_alloc` function). It is not possible to allocate a little extra book-keeping space and return a properly aligned pointer, right? As a user I don't know what alignment a particular allocation would require.\r\n\r\nInstead, if an alignment parameter was used all the way at the top level of the alloc function, then a user's custom allocator could specify alignment (they could, for example, call `MlasGetPreferredBufferAlignment`).\r\n\r\n> What the basis is for 'usually alloc functions have alignment passed to them as a parameter'. Why is that required to track usage?\r\n\r\nThat way a user can create a custom allocator to track, for example, the size of the allocation, without using a global/static variable.\r\n\r\n> Same question with something providing the size to the Free call - I would assume tracking such a thing was internal to the allocator implementation.\r\n\r\nYes, but that's not possible with an ORT custom allocator, since the alignment is determined at runtime, like I described above.\r\n\r\n> IAllocator\r\n\r\nI'm using the C interface.\r\n\r\n> However that's not going to capture calls to 'new', so depending on what you're trying to measure that may be insufficient.\r\n\r\nAh okay, so you guys didn't implement std allocators and pass those along to all your internal data structures, such as `std::vector`?\r\n\r\n> What platform are you trying to do this on?\r\n\r\nAny, but Windows in particular. I imagine tracking memory consumption wouldn't rely on platform specifics.\r\n\r\n---\r\n\r\nIt sounds like since you guys use `new` all over the place, and didn't override `std::allocator`, it would be quite difficult to track allocations and memory consumption without using an external tool.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/531054404/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/653367012",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/1800#issuecomment-653367012",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/1800",
        "id": 653367012,
        "node_id": "MDEyOklzc3VlQ29tbWVudDY1MzM2NzAxMg==",
        "user": {
            "login": "stale[bot]",
            "id": 26384082,
            "node_id": "MDM6Qm90MjYzODQwODI=",
            "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stale%5Bbot%5D",
            "html_url": "https://github.com/apps/stale",
            "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
            "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
            "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
            "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
            "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
            "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
            "type": "Bot",
            "site_admin": false
        },
        "created_at": "2020-07-03T05:58:07Z",
        "updated_at": "2020-07-03T05:58:07Z",
        "author_association": "NONE",
        "body": "This issue has been automatically marked as stale due to inactivity and will be closed in 7 days if no further activity occurs. If further support is needed, please provide an update and/or more details.\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/653367012/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/656962756",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/1800#issuecomment-656962756",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/1800",
        "id": 656962756,
        "node_id": "MDEyOklzc3VlQ29tbWVudDY1Njk2Mjc1Ng==",
        "user": {
            "login": "stale[bot]",
            "id": 26384082,
            "node_id": "MDM6Qm90MjYzODQwODI=",
            "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stale%5Bbot%5D",
            "html_url": "https://github.com/apps/stale",
            "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
            "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
            "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
            "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
            "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
            "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
            "type": "Bot",
            "site_admin": false
        },
        "created_at": "2020-07-11T01:40:40Z",
        "updated_at": "2020-07-11T01:40:40Z",
        "author_association": "NONE",
        "body": "This issue has been automatically closed due to inactivity. Please reactivate if further support is needed.\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/656962756/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]