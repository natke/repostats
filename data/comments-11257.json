[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1104518390",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11257#issuecomment-1104518390",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11257",
        "id": 1104518390,
        "node_id": "IC_kwDOCVq1mM5B1Zz2",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-20T22:27:05Z",
        "updated_at": "2022-04-20T22:27:05Z",
        "author_association": "MEMBER",
        "body": "Can you attach the onnx model?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1104518390/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1104625470",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11257#issuecomment-1104625470",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11257",
        "id": 1104625470,
        "node_id": "IC_kwDOCVq1mM5B1z8-",
        "user": {
            "login": "lzhin",
            "id": 17926066,
            "node_id": "MDQ6VXNlcjE3OTI2MDY2",
            "avatar_url": "https://avatars.githubusercontent.com/u/17926066?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/lzhin",
            "html_url": "https://github.com/lzhin",
            "followers_url": "https://api.github.com/users/lzhin/followers",
            "following_url": "https://api.github.com/users/lzhin/following{/other_user}",
            "gists_url": "https://api.github.com/users/lzhin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/lzhin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/lzhin/subscriptions",
            "organizations_url": "https://api.github.com/users/lzhin/orgs",
            "repos_url": "https://api.github.com/users/lzhin/repos",
            "events_url": "https://api.github.com/users/lzhin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/lzhin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-21T01:51:04Z",
        "updated_at": "2022-04-21T01:51:04Z",
        "author_association": "NONE",
        "body": "> Can you attach the onnx model?\r\n\r\nok, this is the onnx model url :  https://athena-genieopen-gz-1253539814.cos.ap-guangzhou.myqcloud.com/athena-wenet/encoder.onnx",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1104625470/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1107706552",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11257#issuecomment-1107706552",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11257",
        "id": 1107706552,
        "node_id": "IC_kwDOCVq1mM5CBkK4",
        "user": {
            "login": "Mddct",
            "id": 4906435,
            "node_id": "MDQ6VXNlcjQ5MDY0MzU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4906435?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Mddct",
            "html_url": "https://github.com/Mddct",
            "followers_url": "https://api.github.com/users/Mddct/followers",
            "following_url": "https://api.github.com/users/Mddct/following{/other_user}",
            "gists_url": "https://api.github.com/users/Mddct/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/Mddct/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/Mddct/subscriptions",
            "organizations_url": "https://api.github.com/users/Mddct/orgs",
            "repos_url": "https://api.github.com/users/Mddct/repos",
            "events_url": "https://api.github.com/users/Mddct/events{/privacy}",
            "received_events_url": "https://api.github.com/users/Mddct/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-24T04:22:07Z",
        "updated_at": "2022-04-24T04:25:30Z",
        "author_association": "NONE",
        "body": "<img width=\"855\" alt=\"Screen Shot 2022-04-24 at 12 18 53\" src=\"https://user-images.githubusercontent.com/4906435/164956443-8a048b3c-90c8-4ae4-ac38-2c623e2e2926.png\">\r\noffset is not a 1-d tensor in export_onnx ,  but use a \"1-d array\" tensor\" in your c++ code , an then use a \"unseqeze\" to become a 2-d tensor",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1107706552/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1107820697",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11257#issuecomment-1107820697",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11257",
        "id": 1107820697,
        "node_id": "IC_kwDOCVq1mM5CCACZ",
        "user": {
            "login": "lzhin",
            "id": 17926066,
            "node_id": "MDQ6VXNlcjE3OTI2MDY2",
            "avatar_url": "https://avatars.githubusercontent.com/u/17926066?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/lzhin",
            "html_url": "https://github.com/lzhin",
            "followers_url": "https://api.github.com/users/lzhin/followers",
            "following_url": "https://api.github.com/users/lzhin/following{/other_user}",
            "gists_url": "https://api.github.com/users/lzhin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/lzhin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/lzhin/subscriptions",
            "organizations_url": "https://api.github.com/users/lzhin/orgs",
            "repos_url": "https://api.github.com/users/lzhin/repos",
            "events_url": "https://api.github.com/users/lzhin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/lzhin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-24T11:23:07Z",
        "updated_at": "2022-04-24T11:28:21Z",
        "author_association": "NONE",
        "body": "> <img alt=\"Screen Shot 2022-04-24 at 12 18 53\" width=\"855\" src=\"https://user-images.githubusercontent.com/4906435/164956443-8a048b3c-90c8-4ae4-ac38-2c623e2e2926.png\">\r\n> \r\n> offset is not a 1-d tensor in export_onnx , but use a \"1-d array\" tensor\" in your c++ code , an then use a \"unseqeze\" to become a 2-d tensor\r\n\r\n\r\n\r\n**this is the code that slice by offset :**\r\n        assert offset + x.size(1) < self.max_len\r\n        self.pe = self.pe.to(x.device)\r\n        pos_emb = self.pe[:, offset:offset + x.size(1)]\r\n        x = x * self.xscale + pos_emb`\r\n\r\n\r\n**I don't find the unsqueeze operation.**\r\n\r\n**The fucntion to export the onnx model is :**\r\ndef forward_chunk(\r\n        self,\r\n        xs: torch.Tensor,\r\n        offset: int,\r\n        required_cache_size: int,\r\n        att_cache: torch.Tensor = torch.zeros(0, 0, 0, 0),\r\n        cnn_cache: torch.Tensor = torch.zeros(0, 0, 0, 0),\r\n        att_mask: torch.Tensor = torch.ones((0, 0, 0), dtype=torch.bool),\r\n    ) -> Tuple[torch.Tensor, torch.Tensor, torch.Tensor]:\r\n        assert xs.size(0) == 1\r\n        # tmp_masks is just for interface compatibility\r\n        tmp_masks = torch.ones(1,\r\n                               xs.size(1),\r\n                               device=xs.device,\r\n                               dtype=torch.bool)\r\n        tmp_masks = tmp_masks.unsqueeze(1)\r\n        if self.global_cmvn is not None:\r\n            xs = self.global_cmvn(xs)\r\n        # NOTE(xcsong): Before embed, shape(xs) is (b=1, time, mel-dim)\r\n        xs, pos_emb, _ = self.embed(xs, tmp_masks, offset)\r\n............\r\n\r\n\r\n\r\n**I know the parameter offset should not be create by createtensor function as the offset is int in python.\r\nBut I don't know what fucntion to create the offset value in c++ runtime.\r\nCould you give me some advices about how to create the offset value? Thanks.**\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1107820697/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1107823091",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11257#issuecomment-1107823091",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11257",
        "id": 1107823091,
        "node_id": "IC_kwDOCVq1mM5CCAnz",
        "user": {
            "login": "Mddct",
            "id": 4906435,
            "node_id": "MDQ6VXNlcjQ5MDY0MzU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4906435?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Mddct",
            "html_url": "https://github.com/Mddct",
            "followers_url": "https://api.github.com/users/Mddct/followers",
            "following_url": "https://api.github.com/users/Mddct/following{/other_user}",
            "gists_url": "https://api.github.com/users/Mddct/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/Mddct/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/Mddct/subscriptions",
            "organizations_url": "https://api.github.com/users/Mddct/orgs",
            "repos_url": "https://api.github.com/users/Mddct/repos",
            "events_url": "https://api.github.com/users/Mddct/events{/privacy}",
            "received_events_url": "https://api.github.com/users/Mddct/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-24T11:38:07Z",
        "updated_at": "2022-04-24T11:38:07Z",
        "author_association": "NONE",
        "body": "firstly torch slice will be converted to unsequeze and slice operation。\n\nsecondly，create a tensor with a empty shape  like this\n\nint64_t offset = ……\n\nOrt::Value offset_tensor = Ort::Value::CreateTensor<int64_t>( memory_info_, &offset, 1, std::vector<int>{}.data()，0);",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1107823091/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1107828654",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11257#issuecomment-1107828654",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11257",
        "id": 1107828654,
        "node_id": "IC_kwDOCVq1mM5CCB-u",
        "user": {
            "login": "lzhin",
            "id": 17926066,
            "node_id": "MDQ6VXNlcjE3OTI2MDY2",
            "avatar_url": "https://avatars.githubusercontent.com/u/17926066?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/lzhin",
            "html_url": "https://github.com/lzhin",
            "followers_url": "https://api.github.com/users/lzhin/followers",
            "following_url": "https://api.github.com/users/lzhin/following{/other_user}",
            "gists_url": "https://api.github.com/users/lzhin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/lzhin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/lzhin/subscriptions",
            "organizations_url": "https://api.github.com/users/lzhin/orgs",
            "repos_url": "https://api.github.com/users/lzhin/repos",
            "events_url": "https://api.github.com/users/lzhin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/lzhin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-24T12:11:26Z",
        "updated_at": "2022-04-24T12:11:26Z",
        "author_association": "NONE",
        "body": "\r\n> firstly torch slice will be converted to unsequeze and slice operation。\r\n> \r\n> secondly，create a tensor with a empty shape like this\r\n> \r\n> int64_t offset = ……\r\n> \r\n> Ort::Value offset_tensor = Ort::Value::CreateTensor<int64_t>( memory_info_, &offset, 1, std::vector{}.data()，0);\r\n\r\n**Thanks for your advices. Now the slice error has been eliminated.\r\nBut the another error appears:**\r\n2022-04-24 20:07:18.419115816 [E:onnxruntime:, sequential_executor.cc:346 Execute] Non-zero status code returned while running Add node. Name:'Add_99' Status Message: /onnxruntime_src/onnxruntime/core/providers/cpu/math/element_wise_ops.h:583 onnxruntime::Broadcaster::Broadcaster(const std::vector<long int>&, const std::vector<long int>&) largest <= 1 was false. Can broadcast 0 by 0 or 1. 64 is invalid.\r\n\r\nterminate called after throwing an instance of 'Ort::Exception'\r\n  what():  Non-zero status code returned while running Add node. Name:'Add_99' Status Message: /onnxruntime_src/onnxruntime/core/providers/cpu/math/element_wise_ops.h:583 onnxruntime::Broadcaster::Broadcaster(const std::vector<long int>&, const std::vector<long int>&) largest <= 1 was false. Can broadcast 0 by 0 or 1. 64 is invalid.\r\n\r\nI don't know how to deal with it. Do you know what's the problem?\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1107828654/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1107829036",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11257#issuecomment-1107829036",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11257",
        "id": 1107829036,
        "node_id": "IC_kwDOCVq1mM5CCCEs",
        "user": {
            "login": "Mddct",
            "id": 4906435,
            "node_id": "MDQ6VXNlcjQ5MDY0MzU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4906435?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Mddct",
            "html_url": "https://github.com/Mddct",
            "followers_url": "https://api.github.com/users/Mddct/followers",
            "following_url": "https://api.github.com/users/Mddct/following{/other_user}",
            "gists_url": "https://api.github.com/users/Mddct/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/Mddct/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/Mddct/subscriptions",
            "organizations_url": "https://api.github.com/users/Mddct/orgs",
            "repos_url": "https://api.github.com/users/Mddct/repos",
            "events_url": "https://api.github.com/users/Mddct/events{/privacy}",
            "received_events_url": "https://api.github.com/users/Mddct/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-24T12:13:58Z",
        "updated_at": "2022-04-24T12:13:58Z",
        "author_association": "NONE",
        "body": "you may need to rewrite required cache size tensor in same way",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1107829036/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1107829983",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11257#issuecomment-1107829983",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11257",
        "id": 1107829983,
        "node_id": "IC_kwDOCVq1mM5CCCTf",
        "user": {
            "login": "lzhin",
            "id": 17926066,
            "node_id": "MDQ6VXNlcjE3OTI2MDY2",
            "avatar_url": "https://avatars.githubusercontent.com/u/17926066?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/lzhin",
            "html_url": "https://github.com/lzhin",
            "followers_url": "https://api.github.com/users/lzhin/followers",
            "following_url": "https://api.github.com/users/lzhin/following{/other_user}",
            "gists_url": "https://api.github.com/users/lzhin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/lzhin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/lzhin/subscriptions",
            "organizations_url": "https://api.github.com/users/lzhin/orgs",
            "repos_url": "https://api.github.com/users/lzhin/repos",
            "events_url": "https://api.github.com/users/lzhin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/lzhin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-24T12:20:01Z",
        "updated_at": "2022-04-24T12:20:01Z",
        "author_association": "NONE",
        "body": "> you may need to rewrite required cache size tensor in same way\r\n\r\n**I have changed the offset and requried_cache_size before. And the above error occurred.**\r\n\r\n  Ort::Value offset_tensor = Ort::Value::CreateTensor<int64_t>(\r\n      memory_info_, &offset_, 1,  std::vector<int64_t>{}.data(), 0);\r\n\r\n  Ort::Value requried_cache_size_tensor = Ort::Value::CreateTensor<int64_t>(\r\n      memory_info_, &requried_cache_size, 1,\r\n      std::vector<int64_t>{}.data(), 0);",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1107829983/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1107831557",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11257#issuecomment-1107831557",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11257",
        "id": 1107831557,
        "node_id": "IC_kwDOCVq1mM5CCCsF",
        "user": {
            "login": "Mddct",
            "id": 4906435,
            "node_id": "MDQ6VXNlcjQ5MDY0MzU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4906435?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Mddct",
            "html_url": "https://github.com/Mddct",
            "followers_url": "https://api.github.com/users/Mddct/followers",
            "following_url": "https://api.github.com/users/Mddct/following{/other_user}",
            "gists_url": "https://api.github.com/users/Mddct/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/Mddct/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/Mddct/subscriptions",
            "organizations_url": "https://api.github.com/users/Mddct/orgs",
            "repos_url": "https://api.github.com/users/Mddct/repos",
            "events_url": "https://api.github.com/users/Mddct/events{/privacy}",
            "received_events_url": "https://api.github.com/users/Mddct/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-24T12:29:37Z",
        "updated_at": "2022-04-24T12:29:37Z",
        "author_association": "NONE",
        "body": "offset= ? cache size =？ maybe you have a wrong value and cause you have a bad position embedding\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1107831557/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1107837134",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11257#issuecomment-1107837134",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11257",
        "id": 1107837134,
        "node_id": "IC_kwDOCVq1mM5CCEDO",
        "user": {
            "login": "lzhin",
            "id": 17926066,
            "node_id": "MDQ6VXNlcjE3OTI2MDY2",
            "avatar_url": "https://avatars.githubusercontent.com/u/17926066?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/lzhin",
            "html_url": "https://github.com/lzhin",
            "followers_url": "https://api.github.com/users/lzhin/followers",
            "following_url": "https://api.github.com/users/lzhin/following{/other_user}",
            "gists_url": "https://api.github.com/users/lzhin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/lzhin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/lzhin/subscriptions",
            "organizations_url": "https://api.github.com/users/lzhin/orgs",
            "repos_url": "https://api.github.com/users/lzhin/repos",
            "events_url": "https://api.github.com/users/lzhin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/lzhin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-24T13:00:25Z",
        "updated_at": "2022-04-24T13:00:25Z",
        "author_association": "NONE",
        "body": "> offset= ? cache size =？ maybe you have a wrong value and cause you have a bad position embedding\r\n\r\n**this is the encoder forword:**\r\n\r\nvoid OnnxAsrModel::ForwardEncoderFunc(\r\n    const std::vector<std::vector<float>>& chunk_feats,\r\n    std::vector<std::vector<float>>* out_prob) {\r\n  int num_frames = cached_feature_.size() + chunk_feats.size();\r\n  const int feature_dim = chunk_feats[0].size();\r\n  int requried_cache_size = chunk_size_ * num_left_chunks_;\r\n  std::vector<float> model_input;\r\n  for (size_t i = 0; i < cached_feature_.size(); ++i) {\r\n    for (int j = 0; j < feature_dim; j++) {\r\n      model_input.emplace_back(cached_feature_[i][j]);\r\n    }\r\n  }\r\n  for (size_t i = 0; i < chunk_feats.size(); ++i) {\r\n    for (int j = 0; j < feature_dim; j++) {\r\n      model_input.emplace_back(chunk_feats[i][j]);\r\n    }\r\n  }\r\n  const int64_t input_shape[3] = {1, num_frames, feature_dim};\r\n\r\n  // std::vector<int64_t> offset{offset_};\r\n  const int64_t offset_shape[0];\r\n  int64_t offset=offset_;\r\n\r\n  std::vector<int64_t> requried_cache_size_vec{requried_cache_size};\r\n  const int64_t requried_cache_size_shape[1] = {1};\r\n\r\n  Ort::Value input_tensor = Ort::Value::CreateTensor<float>(\r\n      memory_info_, model_input.data(), model_input.size(), input_shape, 3);\r\n  Ort::Value offset_tensor = Ort::Value::CreateTensor<int64_t>(\r\n      memory_info_, &offset_, 1, offset_shape, 0);\r\n\r\n  Ort::Value requried_cache_size_tensor = Ort::Value::CreateTensor<int64_t>(\r\n      memory_info_, requried_cache_size_vec.data(), 1,\r\n      requried_cache_size_shape, 1);\r\n\r\n  std::vector<Ort::Value> tensors;\r\n  tensors.emplace_back(std::move(input_tensor));\r\n  tensors.emplace_back(std::move(offset_tensor));\r\n  tensors.emplace_back(std::move(requried_cache_size_tensor));\r\n  tensors.emplace_back(std::move(att_cache_ort_));\r\n  tensors.emplace_back(std::move(cnn_cache_ort_));\r\n  tensors.emplace_back(std::move(att_mask_ort_));\r\n\r\n  std::vector<Ort::Value> ort_outputs =\r\n      encoder_session_->Run(Ort::RunOptions{nullptr}, input_names_,\r\n                            tensors.data(), 6, output_names_, 3);\r\n\r\n  offset_ += ort_outputs[0].GetTensorTypeAndShapeInfo().GetShape()[1];\r\n  att_cache_ort_ = std::move(ort_outputs[1]);\r\n  cnn_cache_ort_ = std::move(ort_outputs[2]);\r\n\r\n  std::vector<Ort::Value> ctc_tensors;\r\n  ctc_tensors.emplace_back(std::move(ort_outputs[0]));\r\n\r\n  std::vector<Ort::Value> ctc_ort_outputs =\r\n      ctc_session_->Run(Ort::RunOptions{nullptr}, ctc_input_names_,\r\n                        ctc_tensors.data(), 1, ctc_output_names_, 1);\r\n  encoder_outs_.push_back(std::move(ctc_tensors[0]));\r\n\r\n  float* logp_data = ctc_ort_outputs[0].GetTensorMutableData<float>();\r\n  auto type_info = ctc_ort_outputs[0].GetTensorTypeAndShapeInfo();\r\n\r\n  int num_outputs = type_info.GetShape()[1];\r\n  int output_dim = type_info.GetShape()[2];\r\n  out_prob->resize(num_outputs);\r\n  for (int i = 0; i < num_outputs; i++) {\r\n    (*out_prob)[i].resize(output_dim);\r\n    memcpy((*out_prob)[i].data(), logp_data + i * output_dim,\r\n           sizeof(float) * output_dim);\r\n  }\r\n}\r\n\r\n\r\n**I'll check the code carefully tomorrow.\r\nI have submited a draft pr in [wenet pr](https://github.com/wenet-e2e/wenet/pull/1053). Look forword your review. Thank you very much.**",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1107837134/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]