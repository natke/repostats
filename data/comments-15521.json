[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1509390162",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15521#issuecomment-1509390162",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15521",
        "id": 1509390162,
        "node_id": "IC_kwDOCVq1mM5Z93dS",
        "user": {
            "login": "jstoecker",
            "id": 3835701,
            "node_id": "MDQ6VXNlcjM4MzU3MDE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3835701?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jstoecker",
            "html_url": "https://github.com/jstoecker",
            "followers_url": "https://api.github.com/users/jstoecker/followers",
            "following_url": "https://api.github.com/users/jstoecker/following{/other_user}",
            "gists_url": "https://api.github.com/users/jstoecker/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jstoecker/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jstoecker/subscriptions",
            "organizations_url": "https://api.github.com/users/jstoecker/orgs",
            "repos_url": "https://api.github.com/users/jstoecker/repos",
            "events_url": "https://api.github.com/users/jstoecker/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jstoecker/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-14T23:29:37Z",
        "updated_at": "2023-04-14T23:29:37Z",
        "author_association": "MEMBER",
        "body": "@PatriceVignola FYI",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1509390162/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1513670257",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15521#issuecomment-1513670257",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15521",
        "id": 1513670257,
        "node_id": "IC_kwDOCVq1mM5aOMZx",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-18T19:11:59Z",
        "updated_at": "2023-04-18T19:12:54Z",
        "author_association": "MEMBER",
        "body": "It is a known issue. see comments in the code:\r\nhttps://github.com/microsoft/onnxruntime/blob/698e9f71cd72ed6176938ff093b40e57f92cd681/onnxruntime/python/tools/symbolic_shape_infer.py#L362-L363\r\n\r\nExample of walkaround is to merge type information back to original model like the following:\r\n```\r\nshape_infer_helper = SymbolicShapeInferenceHelper(model)\r\nmodel_with_shape = shape_infer_helper.infer_shapes(model, auto_merge=True, guess_output_rank=False)\r\n\r\n# we only merge data type but not shape information back to the original onnx model\r\nif model_with_shape is not None:\r\n    tensor_type = {}\r\n    for value_info in model_with_shape.graph.value_info:\r\n        tensor_type[value_info.name] = value_info.type.tensor_type.elem_type\r\n    for value_info in model.graph.value_info:\r\n        if value_info.name in tensor_type:\r\n            del tensor_type[value_info.name]\r\n    for name, type in tensor_type.items():\r\n        vi = onnx.helper.make_tensor_value_info(name, type, None)\r\n        model.graph.value_info.append(vi)\r\n```\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1513670257/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1513791701",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15521#issuecomment-1513791701",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15521",
        "id": 1513791701,
        "node_id": "IC_kwDOCVq1mM5aOqDV",
        "user": {
            "login": "jstoecker",
            "id": 3835701,
            "node_id": "MDQ6VXNlcjM4MzU3MDE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3835701?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jstoecker",
            "html_url": "https://github.com/jstoecker",
            "followers_url": "https://api.github.com/users/jstoecker/followers",
            "following_url": "https://api.github.com/users/jstoecker/following{/other_user}",
            "gists_url": "https://api.github.com/users/jstoecker/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jstoecker/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jstoecker/subscriptions",
            "organizations_url": "https://api.github.com/users/jstoecker/orgs",
            "repos_url": "https://api.github.com/users/jstoecker/repos",
            "events_url": "https://api.github.com/users/jstoecker/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jstoecker/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-18T21:03:06Z",
        "updated_at": "2023-04-18T21:03:06Z",
        "author_association": "MEMBER",
        "body": "> It is a known issue. see comments in the code:\r\n> \r\n> https://github.com/microsoft/onnxruntime/blob/698e9f71cd72ed6176938ff093b40e57f92cd681/onnxruntime/python/tools/symbolic_shape_infer.py#L362-L363\r\n> \r\n> Example of walkaround is to merge type information back to original model like the following:\r\n\r\nThanks @tianleiwu. Would it be possible to make the workaround an optional feature of the transformer optimizer API (e.g. a parameter that gets propagated to the float16 conversion helper and copies type but not shape data)? Ultimately, symbolic shape inference is buried a few levels below the surface of what users will typically interact with.\r\n\r\nFor context, Olive has an [optimization pass](https://github.com/microsoft/Olive/blob/main/olive/passes/onnx/transformer_optimization.py#L187) that layers on top of onnxruntime.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1513791701/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]