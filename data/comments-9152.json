[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/925092972",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9152#issuecomment-925092972",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9152",
        "id": 925092972,
        "node_id": "IC_kwDOCVq1mM43I8xs",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-09-22T16:32:21Z",
        "updated_at": "2021-09-22T16:32:21Z",
        "author_association": "MEMBER",
        "body": "Did you try disabling enable_mem_pattern and enable_cpu_mem_arena?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/925092972/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/925738084",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9152#issuecomment-925738084",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9152",
        "id": 925738084,
        "node_id": "IC_kwDOCVq1mM43LaRk",
        "user": {
            "login": "MaialenUrbieta",
            "id": 16615861,
            "node_id": "MDQ6VXNlcjE2NjE1ODYx",
            "avatar_url": "https://avatars.githubusercontent.com/u/16615861?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/MaialenUrbieta",
            "html_url": "https://github.com/MaialenUrbieta",
            "followers_url": "https://api.github.com/users/MaialenUrbieta/followers",
            "following_url": "https://api.github.com/users/MaialenUrbieta/following{/other_user}",
            "gists_url": "https://api.github.com/users/MaialenUrbieta/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/MaialenUrbieta/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/MaialenUrbieta/subscriptions",
            "organizations_url": "https://api.github.com/users/MaialenUrbieta/orgs",
            "repos_url": "https://api.github.com/users/MaialenUrbieta/repos",
            "events_url": "https://api.github.com/users/MaialenUrbieta/events{/privacy}",
            "received_events_url": "https://api.github.com/users/MaialenUrbieta/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-09-23T11:49:45Z",
        "updated_at": "2021-09-23T11:49:45Z",
        "author_association": "NONE",
        "body": "Thanks Yufeng, those two options have helped. Now the memory usage is not that constant; cpu usage increases a bit but not a significant amount. Regarding memory usage, there are still some peaks that remind us of the same order of memory usage as before:  160 MB for one thread, 310 MB with two threads and up to 610MB with 4 threads. Are there any other configuration or even compilation options we might study? If that makes sense, we could even reduce functionality offered by Onnxruntime to adapt to our needs, but I recognize that this must be complicated. Any guidance is welcome.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/925738084/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/926768141",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9152#issuecomment-926768141",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9152",
        "id": 926768141,
        "node_id": "IC_kwDOCVq1mM43PVwN",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-09-24T16:34:56Z",
        "updated_at": "2021-09-24T16:34:56Z",
        "author_association": "MEMBER",
        "body": "@MaialenUrbieta, did you create an InferenceSession in each thread? Or the memory won't increase so much with multiple threading. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/926768141/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/927877286",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9152#issuecomment-927877286",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9152",
        "id": 927877286,
        "node_id": "IC_kwDOCVq1mM43Tkim",
        "user": {
            "login": "MaialenUrbieta",
            "id": 16615861,
            "node_id": "MDQ6VXNlcjE2NjE1ODYx",
            "avatar_url": "https://avatars.githubusercontent.com/u/16615861?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/MaialenUrbieta",
            "html_url": "https://github.com/MaialenUrbieta",
            "followers_url": "https://api.github.com/users/MaialenUrbieta/followers",
            "following_url": "https://api.github.com/users/MaialenUrbieta/following{/other_user}",
            "gists_url": "https://api.github.com/users/MaialenUrbieta/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/MaialenUrbieta/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/MaialenUrbieta/subscriptions",
            "organizations_url": "https://api.github.com/users/MaialenUrbieta/orgs",
            "repos_url": "https://api.github.com/users/MaialenUrbieta/repos",
            "events_url": "https://api.github.com/users/MaialenUrbieta/events{/privacy}",
            "received_events_url": "https://api.github.com/users/MaialenUrbieta/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-09-27T13:29:40Z",
        "updated_at": "2021-09-27T13:30:18Z",
        "author_association": "NONE",
        "body": "Threads share a common session, but if multiple threads call the Run method on the same inference session, maybe at times they overlap using more memory, up to the maximun of 610MB?. Would that make sense? In this 4 thread execution, the memory usage has been as follows (max. 592MB):\r\n\r\n![Memory](https://user-images.githubusercontent.com/16615861/134917283-5bd3d166-1bb2-4571-98ea-5acf7cc93f8a.png)\r\n\r\nNote that threads calling Run... is quite intense.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/927877286/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/931415440",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9152#issuecomment-931415440",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9152",
        "id": 931415440,
        "node_id": "IC_kwDOCVq1mM43hEWQ",
        "user": {
            "login": "MaialenUrbieta",
            "id": 16615861,
            "node_id": "MDQ6VXNlcjE2NjE1ODYx",
            "avatar_url": "https://avatars.githubusercontent.com/u/16615861?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/MaialenUrbieta",
            "html_url": "https://github.com/MaialenUrbieta",
            "followers_url": "https://api.github.com/users/MaialenUrbieta/followers",
            "following_url": "https://api.github.com/users/MaialenUrbieta/following{/other_user}",
            "gists_url": "https://api.github.com/users/MaialenUrbieta/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/MaialenUrbieta/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/MaialenUrbieta/subscriptions",
            "organizations_url": "https://api.github.com/users/MaialenUrbieta/orgs",
            "repos_url": "https://api.github.com/users/MaialenUrbieta/repos",
            "events_url": "https://api.github.com/users/MaialenUrbieta/events{/privacy}",
            "received_events_url": "https://api.github.com/users/MaialenUrbieta/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-09-30T15:14:52Z",
        "updated_at": "2021-09-30T15:14:52Z",
        "author_association": "NONE",
        "body": "@yufenglee, trying to reproduce a similar state, we have realized that the memory usage was about 42 MB max. with 8 evaluating threads in squeezenet. That has led us to study the model we were using, which also had several times bigger input than squeezenet to start with... We'll work in that direction.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/931415440/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]