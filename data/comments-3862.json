[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/628899990",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/3862#issuecomment-628899990",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/3862",
        "id": 628899990,
        "node_id": "MDEyOklzc3VlQ29tbWVudDYyODg5OTk5MA==",
        "user": {
            "login": "hariharans29",
            "id": 9969784,
            "node_id": "MDQ6VXNlcjk5Njk3ODQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/9969784?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/hariharans29",
            "html_url": "https://github.com/hariharans29",
            "followers_url": "https://api.github.com/users/hariharans29/followers",
            "following_url": "https://api.github.com/users/hariharans29/following{/other_user}",
            "gists_url": "https://api.github.com/users/hariharans29/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/hariharans29/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/hariharans29/subscriptions",
            "organizations_url": "https://api.github.com/users/hariharans29/orgs",
            "repos_url": "https://api.github.com/users/hariharans29/repos",
            "events_url": "https://api.github.com/users/hariharans29/events{/privacy}",
            "received_events_url": "https://api.github.com/users/hariharans29/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-05-14T21:37:53Z",
        "updated_at": "2020-05-14T21:37:59Z",
        "author_association": "MEMBER",
        "body": "Possible dupe of https://github.com/microsoft/onnxruntime/issues/3452. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/628899990/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/633559764",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/3862#issuecomment-633559764",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/3862",
        "id": 633559764,
        "node_id": "MDEyOklzc3VlQ29tbWVudDYzMzU1OTc2NA==",
        "user": {
            "login": "acfloria",
            "id": 6713722,
            "node_id": "MDQ6VXNlcjY3MTM3MjI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6713722?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/acfloria",
            "html_url": "https://github.com/acfloria",
            "followers_url": "https://api.github.com/users/acfloria/followers",
            "following_url": "https://api.github.com/users/acfloria/following{/other_user}",
            "gists_url": "https://api.github.com/users/acfloria/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/acfloria/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/acfloria/subscriptions",
            "organizations_url": "https://api.github.com/users/acfloria/orgs",
            "repos_url": "https://api.github.com/users/acfloria/repos",
            "events_url": "https://api.github.com/users/acfloria/events{/privacy}",
            "received_events_url": "https://api.github.com/users/acfloria/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-05-25T12:57:43Z",
        "updated_at": "2020-05-25T12:57:43Z",
        "author_association": "NONE",
        "body": "So I had another look at the issue and copying the memory is not an the bottleneck. What I learned is that the torch cuda calls are [asynchronous](https://discuss.pytorch.org/t/copy-tensor-from-cuda-to-cpu-is-too-slow/13056) meaning that my presented pytorch times are actually wrong. I adjusted my script and ran it again and got the following times where for the GPU the times are comparable:\r\n\r\n- onnx time all: 0.6150667667388916\r\n-   onnx time cpu: 1.4453442096710205\r\n-   pytorch time cpu: 2.356342077255249\r\n-   pytorch time gpu: 0.5803976058959961\r\n\r\nHowever, when I ran the same script with the same model on a desktop computer with a Quadro M4000 the times were still different between onnx and pytorch:\r\n\r\n-   onnx time all: 0.2912168502807617\r\n-   onnx time cpu: 0.5953676700592041\r\n-   pytorch time cpu: 1.3679423332214355\r\n-   pytorch time gpu: 0.09741926193237305\r\n\r\nThis is the modified profiling section which makes sure that copying the memory is included in the onnx/pytorch times and all pytorch gpu operations are executed:\r\n```\r\n        with torch.no_grad():\r\n            # profiling\r\n            if args.gpu:\r\n                t_start = time.time()\r\n                outputs = ort_sess.run(None, {'optical': optical.numpy(),\r\n                                              'thermal': thermal.numpy()})\r\n                print('onnx time all: ' + str(time.time() - t_start))\r\n\r\n            t_start = time.time()\r\n            outputs = ort_sess.run(None, {'optical': optical.numpy(),\r\n                                          'thermal': thermal.numpy()})\r\n\r\n            ort_sess.set_providers(['CPUExecutionProvider'])\r\n            t_start = time.time()\r\n            outputs = ort_sess.run(None, {'optical': optical.numpy(),\r\n                                          'thermal': thermal.numpy()})\r\n            print('onnx time cpu: ' + str(time.time() - t_start))\r\n    \r\n            t_start = time.time()\r\n            p_o, p_t, d_o, d_t = net_eval(optical, thermal)\r\n            print('pytorch time cpu: ' + str(time.time() - t_start))\r\n\r\n            if torch.cuda.is_available() and args.gpu:\r\n                net_eval = net_eval.cuda()\r\n                torch.cuda.synchronize()\r\n                t_start = time.time()\r\n                p_o, p_t, d_o, d_t = net_eval(optical.cuda(), thermal.cuda())\r\n                p_o, p_t, d_o, d_t = p_o.cpu(), p_t.cpu(), d_o.cpu(), d_t.cpu()\r\n                torch.cuda.synchronize()\r\n                print('pytorch time gpu: ' + str(time.time() - t_start))\r\n\r\n```\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/633559764/reactions",
            "total_count": 2,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 2,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/663802602",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/3862#issuecomment-663802602",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/3862",
        "id": 663802602,
        "node_id": "MDEyOklzc3VlQ29tbWVudDY2MzgwMjYwMg==",
        "user": {
            "login": "stale[bot]",
            "id": 26384082,
            "node_id": "MDM6Qm90MjYzODQwODI=",
            "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stale%5Bbot%5D",
            "html_url": "https://github.com/apps/stale",
            "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
            "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
            "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
            "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
            "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
            "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
            "type": "Bot",
            "site_admin": false
        },
        "created_at": "2020-07-25T03:39:53Z",
        "updated_at": "2020-07-25T03:39:53Z",
        "author_association": "NONE",
        "body": "This issue has been automatically marked as stale due to inactivity and will be closed in 7 days if no further activity occurs. If further support is needed, please provide an update and/or more details.\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/663802602/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/667496914",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/3862#issuecomment-667496914",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/3862",
        "id": 667496914,
        "node_id": "MDEyOklzc3VlQ29tbWVudDY2NzQ5NjkxNA==",
        "user": {
            "login": "stale[bot]",
            "id": 26384082,
            "node_id": "MDM6Qm90MjYzODQwODI=",
            "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stale%5Bbot%5D",
            "html_url": "https://github.com/apps/stale",
            "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
            "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
            "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
            "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
            "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
            "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
            "type": "Bot",
            "site_admin": false
        },
        "created_at": "2020-08-01T08:43:58Z",
        "updated_at": "2020-08-01T08:43:58Z",
        "author_association": "NONE",
        "body": "This issue has been automatically closed due to inactivity. Please reactivate if further support is needed.\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/667496914/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]