[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378818345",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14235#issuecomment-1378818345",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14235",
        "id": 1378818345,
        "node_id": "IC_kwDOCVq1mM5SLxkp",
        "user": {
            "login": "xadupre",
            "id": 22452781,
            "node_id": "MDQ6VXNlcjIyNDUyNzgx",
            "avatar_url": "https://avatars.githubusercontent.com/u/22452781?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/xadupre",
            "html_url": "https://github.com/xadupre",
            "followers_url": "https://api.github.com/users/xadupre/followers",
            "following_url": "https://api.github.com/users/xadupre/following{/other_user}",
            "gists_url": "https://api.github.com/users/xadupre/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/xadupre/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/xadupre/subscriptions",
            "organizations_url": "https://api.github.com/users/xadupre/orgs",
            "repos_url": "https://api.github.com/users/xadupre/repos",
            "events_url": "https://api.github.com/users/xadupre/events{/privacy}",
            "received_events_url": "https://api.github.com/users/xadupre/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-11T14:15:43Z",
        "updated_at": "2023-01-11T14:15:43Z",
        "author_association": "MEMBER",
        "body": "I wonder what is the discrepancy when you compare torch with float32 and the same torch model converted into float16 (no onnx).",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378818345/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378828350",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14235#issuecomment-1378828350",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14235",
        "id": 1378828350,
        "node_id": "IC_kwDOCVq1mM5SL0A-",
        "user": {
            "login": "FrancescoSaverioZuppichini",
            "id": 15908060,
            "node_id": "MDQ6VXNlcjE1OTA4MDYw",
            "avatar_url": "https://avatars.githubusercontent.com/u/15908060?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/FrancescoSaverioZuppichini",
            "html_url": "https://github.com/FrancescoSaverioZuppichini",
            "followers_url": "https://api.github.com/users/FrancescoSaverioZuppichini/followers",
            "following_url": "https://api.github.com/users/FrancescoSaverioZuppichini/following{/other_user}",
            "gists_url": "https://api.github.com/users/FrancescoSaverioZuppichini/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/FrancescoSaverioZuppichini/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/FrancescoSaverioZuppichini/subscriptions",
            "organizations_url": "https://api.github.com/users/FrancescoSaverioZuppichini/orgs",
            "repos_url": "https://api.github.com/users/FrancescoSaverioZuppichini/repos",
            "events_url": "https://api.github.com/users/FrancescoSaverioZuppichini/events{/privacy}",
            "received_events_url": "https://api.github.com/users/FrancescoSaverioZuppichini/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-11T14:22:34Z",
        "updated_at": "2023-01-11T14:42:12Z",
        "author_association": "NONE",
        "body": "@xadupre thanks for the reply, sure\r\n\r\n```python\r\nmodel = convnext_small(ConvNeXt_Small_Weights.IMAGENET1K_V1).eval().cuda()\r\nx = torch.randn(1, 3, 224, 224, device=\"cuda\")\r\n# let's store the outputs to compare the results\r\nwith torch.no_grad():\r\n    out_torch = model(x)\r\n\r\n# let's store the outputs to compare the results\r\nwith torch.no_grad():\r\n    out_torch_half = model.half()(x.half())\r\n\r\nprint(torch.abs(out_torch_half - out_torch).mean())\r\n```\r\n\r\nPrints `tensor(0.0006, device='cuda:0')`\r\n\r\n\r\n\r\nkeep in mind I'd like to know **how to convert a model to mixed precision** \r\n\r\nPeople have said to me, do it in torch and export it ot ONNX, and other people have to me do it in ONNX, your doc shows how to do it ONNX but is causing this issue\r\n\r\nThanks :)",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1378828350/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1379197491",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14235#issuecomment-1379197491",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14235",
        "id": 1379197491,
        "node_id": "IC_kwDOCVq1mM5SNOIz",
        "user": {
            "login": "xadupre",
            "id": 22452781,
            "node_id": "MDQ6VXNlcjIyNDUyNzgx",
            "avatar_url": "https://avatars.githubusercontent.com/u/22452781?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/xadupre",
            "html_url": "https://github.com/xadupre",
            "followers_url": "https://api.github.com/users/xadupre/followers",
            "following_url": "https://api.github.com/users/xadupre/following{/other_user}",
            "gists_url": "https://api.github.com/users/xadupre/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/xadupre/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/xadupre/subscriptions",
            "organizations_url": "https://api.github.com/users/xadupre/orgs",
            "repos_url": "https://api.github.com/users/xadupre/repos",
            "events_url": "https://api.github.com/users/xadupre/events{/privacy}",
            "received_events_url": "https://api.github.com/users/xadupre/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-11T17:12:03Z",
        "updated_at": "2023-01-11T17:15:37Z",
        "author_association": "MEMBER",
        "body": "I looked at the code of auto_convert_mixed_precision and the documentation is too short. It is not recursive, it does not dig into subgraphs - loop, if. Then, it removes one by one nodes showing coefficients outside boundaries of float16. torch does not do that. This behaviour can be changed by using different values for parameters *atol*, *rtol*, *validation_fn*. `float16.convert_float_to_float16(model)` is closer to `torch.to(float16)`.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1379197491/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1380263729",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14235#issuecomment-1380263729",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14235",
        "id": 1380263729,
        "node_id": "IC_kwDOCVq1mM5SRScx",
        "user": {
            "login": "FrancescoSaverioZuppichini",
            "id": 15908060,
            "node_id": "MDQ6VXNlcjE1OTA4MDYw",
            "avatar_url": "https://avatars.githubusercontent.com/u/15908060?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/FrancescoSaverioZuppichini",
            "html_url": "https://github.com/FrancescoSaverioZuppichini",
            "followers_url": "https://api.github.com/users/FrancescoSaverioZuppichini/followers",
            "following_url": "https://api.github.com/users/FrancescoSaverioZuppichini/following{/other_user}",
            "gists_url": "https://api.github.com/users/FrancescoSaverioZuppichini/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/FrancescoSaverioZuppichini/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/FrancescoSaverioZuppichini/subscriptions",
            "organizations_url": "https://api.github.com/users/FrancescoSaverioZuppichini/orgs",
            "repos_url": "https://api.github.com/users/FrancescoSaverioZuppichini/repos",
            "events_url": "https://api.github.com/users/FrancescoSaverioZuppichini/events{/privacy}",
            "received_events_url": "https://api.github.com/users/FrancescoSaverioZuppichini/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-12T12:35:02Z",
        "updated_at": "2023-01-12T12:35:02Z",
        "author_association": "NONE",
        "body": "@xadupre, not sure I am following :) I am interested on mixed precision or at least I am interested to check the performance of the converted model with mixed precision in onnx",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1380263729/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1381525032",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14235#issuecomment-1381525032",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14235",
        "id": 1381525032,
        "node_id": "IC_kwDOCVq1mM5SWGYo",
        "user": {
            "login": "FrancescoSaverioZuppichini",
            "id": 15908060,
            "node_id": "MDQ6VXNlcjE1OTA4MDYw",
            "avatar_url": "https://avatars.githubusercontent.com/u/15908060?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/FrancescoSaverioZuppichini",
            "html_url": "https://github.com/FrancescoSaverioZuppichini",
            "followers_url": "https://api.github.com/users/FrancescoSaverioZuppichini/followers",
            "following_url": "https://api.github.com/users/FrancescoSaverioZuppichini/following{/other_user}",
            "gists_url": "https://api.github.com/users/FrancescoSaverioZuppichini/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/FrancescoSaverioZuppichini/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/FrancescoSaverioZuppichini/subscriptions",
            "organizations_url": "https://api.github.com/users/FrancescoSaverioZuppichini/orgs",
            "repos_url": "https://api.github.com/users/FrancescoSaverioZuppichini/repos",
            "events_url": "https://api.github.com/users/FrancescoSaverioZuppichini/events{/privacy}",
            "received_events_url": "https://api.github.com/users/FrancescoSaverioZuppichini/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-13T09:20:46Z",
        "updated_at": "2023-04-07T11:47:48Z",
        "author_association": "NONE",
        "body": " ONNX and Torch fp16 give the same result\r\n\r\n```python\r\ndef export_fp16_model():\r\n    model_name = \"model.fp16.onnx\"\r\n    model = convnext_small(ConvNeXt_Small_Weights.IMAGENET1K_V1).eval().cuda()\r\n    x = torch.randn(1, 3, 224, 224, device=\"cuda\")\r\n    export_onnx(model, x, model_name)\r\n    # let's store the outputs to compare the results\r\n    with torch.no_grad():\r\n        out_torch = model.half()(x.half())\r\n    # load fp32 model, convert to fp16\r\n    model = onnx.load(\"model.onnx\")\r\n    model_fp16 = float16.convert_float_to_float16(model)\r\n    onnx.save(model_fp16, model_name)\r\n    ort_session = ort.InferenceSession(model_name, providers=[\"CUDAExecutionProvider\"])\r\n    outputs = ort_session.run(None, {\"image\": x.half().cpu().numpy()})\r\n    # checking the difference\r\n    print(np.abs(out_torch.cpu().numpy() - outputs[0]).mean())\r\n  ```\r\n  Prints `0.0239` \r\n  \r\n  Same thing if I convert the model first in pytorch  \r\n  \r\n  ```python\r\n  def export_fp16_from_torch_model():\r\n    model_name = \"model.fp16.onnx\"\r\n    model = convnext_small(ConvNeXt_Small_Weights.IMAGENET1K_V1).eval().cuda().half()\r\n    x = torch.randn(1, 3, 224, 224, device=\"cuda\").half()\r\n    export_onnx(model, x, model_name)\r\n    # let's store the outputs to compare the results\r\n    with torch.no_grad():\r\n        out_torch = model(x)\r\n    # load fp16 model\r\n    ort_session = ort.InferenceSession(model_name, providers=[\"CUDAExecutionProvider\"])\r\n    outputs = ort_session.run(None, {\"image\": x.half().cpu().numpy()})\r\n    # checking the difference\r\n    print(np.abs(out_torch.cpu().numpy() - outputs[0]).mean())\r\n``` \r\n\r\nPrints `0.0239` \r\n   ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1381525032/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1408480965",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14235#issuecomment-1408480965",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14235",
        "id": 1408480965,
        "node_id": "IC_kwDOCVq1mM5T87bF",
        "user": {
            "login": "FrancescoSaverioZuppichini",
            "id": 15908060,
            "node_id": "MDQ6VXNlcjE1OTA4MDYw",
            "avatar_url": "https://avatars.githubusercontent.com/u/15908060?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/FrancescoSaverioZuppichini",
            "html_url": "https://github.com/FrancescoSaverioZuppichini",
            "followers_url": "https://api.github.com/users/FrancescoSaverioZuppichini/followers",
            "following_url": "https://api.github.com/users/FrancescoSaverioZuppichini/following{/other_user}",
            "gists_url": "https://api.github.com/users/FrancescoSaverioZuppichini/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/FrancescoSaverioZuppichini/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/FrancescoSaverioZuppichini/subscriptions",
            "organizations_url": "https://api.github.com/users/FrancescoSaverioZuppichini/orgs",
            "repos_url": "https://api.github.com/users/FrancescoSaverioZuppichini/repos",
            "events_url": "https://api.github.com/users/FrancescoSaverioZuppichini/events{/privacy}",
            "received_events_url": "https://api.github.com/users/FrancescoSaverioZuppichini/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-30T11:48:29Z",
        "updated_at": "2023-01-30T11:48:29Z",
        "author_association": "NONE",
        "body": "guys?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1408480965/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1568158720",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14235#issuecomment-1568158720",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14235",
        "id": 1568158720,
        "node_id": "IC_kwDOCVq1mM5deDQA",
        "user": {
            "login": "p0wned17",
            "id": 70631405,
            "node_id": "MDQ6VXNlcjcwNjMxNDA1",
            "avatar_url": "https://avatars.githubusercontent.com/u/70631405?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/p0wned17",
            "html_url": "https://github.com/p0wned17",
            "followers_url": "https://api.github.com/users/p0wned17/followers",
            "following_url": "https://api.github.com/users/p0wned17/following{/other_user}",
            "gists_url": "https://api.github.com/users/p0wned17/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/p0wned17/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/p0wned17/subscriptions",
            "organizations_url": "https://api.github.com/users/p0wned17/orgs",
            "repos_url": "https://api.github.com/users/p0wned17/repos",
            "events_url": "https://api.github.com/users/p0wned17/events{/privacy}",
            "received_events_url": "https://api.github.com/users/p0wned17/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-05-30T10:05:38Z",
        "updated_at": "2023-05-30T10:05:38Z",
        "author_association": "NONE",
        "body": "I have the same problem too\r\nDo you fix that?\r\n\r\n\r\n> guys?\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1568158720/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1575539277",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14235#issuecomment-1575539277",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14235",
        "id": 1575539277,
        "node_id": "IC_kwDOCVq1mM5d6NJN",
        "user": {
            "login": "FrancescoSaverioZuppichini",
            "id": 15908060,
            "node_id": "MDQ6VXNlcjE1OTA4MDYw",
            "avatar_url": "https://avatars.githubusercontent.com/u/15908060?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/FrancescoSaverioZuppichini",
            "html_url": "https://github.com/FrancescoSaverioZuppichini",
            "followers_url": "https://api.github.com/users/FrancescoSaverioZuppichini/followers",
            "following_url": "https://api.github.com/users/FrancescoSaverioZuppichini/following{/other_user}",
            "gists_url": "https://api.github.com/users/FrancescoSaverioZuppichini/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/FrancescoSaverioZuppichini/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/FrancescoSaverioZuppichini/subscriptions",
            "organizations_url": "https://api.github.com/users/FrancescoSaverioZuppichini/orgs",
            "repos_url": "https://api.github.com/users/FrancescoSaverioZuppichini/repos",
            "events_url": "https://api.github.com/users/FrancescoSaverioZuppichini/events{/privacy}",
            "received_events_url": "https://api.github.com/users/FrancescoSaverioZuppichini/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-06-04T11:53:40Z",
        "updated_at": "2023-06-04T11:53:40Z",
        "author_association": "NONE",
        "body": "To my understanding, to this day even if some people shows benchmarks, **NOBODY** was ever able to run a model in mixed precision in ONNX and it is crazy to have such little support and documentation (but thanks a lot for everything you are doing so far) but at least state somewhere that is not possible or it's unstable, so we don't waste hours - thanks a lot",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1575539277/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]