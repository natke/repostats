[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1644182314",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/16774#issuecomment-1644182314",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/16774",
        "id": 1644182314,
        "node_id": "IC_kwDOCVq1mM5iADsq",
        "user": {
            "login": "TedThemistokleous",
            "id": 107195283,
            "node_id": "U_kgDOBmOrkw",
            "avatar_url": "https://avatars.githubusercontent.com/u/107195283?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TedThemistokleous",
            "html_url": "https://github.com/TedThemistokleous",
            "followers_url": "https://api.github.com/users/TedThemistokleous/followers",
            "following_url": "https://api.github.com/users/TedThemistokleous/following{/other_user}",
            "gists_url": "https://api.github.com/users/TedThemistokleous/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TedThemistokleous/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TedThemistokleous/subscriptions",
            "organizations_url": "https://api.github.com/users/TedThemistokleous/orgs",
            "repos_url": "https://api.github.com/users/TedThemistokleous/repos",
            "events_url": "https://api.github.com/users/TedThemistokleous/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TedThemistokleous/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-07-20T15:55:00Z",
        "updated_at": "2023-07-20T15:55:00Z",
        "author_association": "CONTRIBUTOR",
        "body": "ping @PeixuanZuo @cloudhan @ytaous  . Let me know if you know the best person to debug this",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1644182314/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1644214191",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/16774#issuecomment-1644214191",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/16774",
        "id": 1644214191,
        "node_id": "IC_kwDOCVq1mM5iALev",
        "user": {
            "login": "TedThemistokleous",
            "id": 107195283,
            "node_id": "U_kgDOBmOrkw",
            "avatar_url": "https://avatars.githubusercontent.com/u/107195283?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TedThemistokleous",
            "html_url": "https://github.com/TedThemistokleous",
            "followers_url": "https://api.github.com/users/TedThemistokleous/followers",
            "following_url": "https://api.github.com/users/TedThemistokleous/following{/other_user}",
            "gists_url": "https://api.github.com/users/TedThemistokleous/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TedThemistokleous/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TedThemistokleous/subscriptions",
            "organizations_url": "https://api.github.com/users/TedThemistokleous/orgs",
            "repos_url": "https://api.github.com/users/TedThemistokleous/repos",
            "events_url": "https://api.github.com/users/TedThemistokleous/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TedThemistokleous/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-07-20T16:16:41Z",
        "updated_at": "2023-07-20T16:16:41Z",
        "author_association": "CONTRIBUTOR",
        "body": "Additional debug when enabling verbose logging via --log_verbose for the parity tests. \r\n\r\n```\r\nroot@f12f6ee19192:/onnxruntime/onnxruntime/test/python/transformers# python3 test_parity_gelu.py --no_optimize --log_verbose\r\n\r\nTesting: device=cuda, float16=False, optimized=False, batch_size=4, sequence_length=2, hidden_size=1, formula=1, fp32_gelu_op=True\r\n/usr/local/lib/python3.8/dist-packages/onnx/mapping.py:27: DeprecationWarning: `np.object` is a deprecated alias for the builtin `object`. To silence this warning, use `object` by itself. Doing this will not modify any behavior and is safe. \r\nDeprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations\r\n  int(TensorProto.STRING): np.dtype(np.object)\r\n====== Diagnostic Run torch.onnx.export version 2.1.0.dev20230706+rocm5.5 ======\r\nverbose: False, log level: 40\r\n======================= 0 NONE 0 NOTE 0 WARNING 0 ERROR ========================\r\n\r\nexported: ./temp/gelu_1_fp32.onnx\r\n2023-07-20 16:14:44.305197677 [I:onnxruntime:, inference_session.cc:328 operator()] Flush-to-zero and denormal-as-zero are off\r\n2023-07-20 16:14:44.305212777 [I:onnxruntime:, inference_session.cc:336 ConstructorCommon] Creating and using per session threadpools since use_per_session_threads_ is true\r\n2023-07-20 16:14:44.305220238 [I:onnxruntime:, inference_session.cc:354 ConstructorCommon] Dynamic block base set to 0\r\n2023-07-20 16:14:44.333905241 [I:onnxruntime:, inference_session.cc:1400 Initialize] Initializing session.\r\n2023-07-20 16:14:44.335605980 [V:onnxruntime:, session_state.cc:1142 VerifyEachNodeIsAssignedToAnEp] Node placements\r\n2023-07-20 16:14:44.335616710 [V:onnxruntime:, session_state.cc:1145 VerifyEachNodeIsAssignedToAnEp]  All nodes placed on [MIGraphXExecutionProvider]. Number of nodes: 1\r\n2023-07-20 16:14:44.335625780 [V:onnxruntime:, session_state.cc:126 CreateGraphInfo] SaveMLValueNameIndexMapping\r\n2023-07-20 16:14:44.335635421 [V:onnxruntime:, session_state.cc:172 CreateGraphInfo] Done saving OrtValue mappings.\r\n2023-07-20 16:14:44.336079521 [I:onnxruntime:, allocation_planner.cc:2393 CreateGraphPartitioner] Use DeviceBasedPartition as default\r\n2023-07-20 16:14:44.336111841 [I:onnxruntime:, session_state_utils.cc:201 SaveInitializedTensors] Saving initialized tensors.\r\n2023-07-20 16:14:44.336331146 [I:onnxruntime:, session_state_utils.cc:344 SaveInitializedTensors] Done saving initialized tensors\r\n2023-07-20 16:14:44.336355047 [I:onnxruntime:, inference_session.cc:1767 Initialize] Session successfully initialized.\r\n2023-07-20 16:14:44.343208424 [V:onnxruntime:, sequential_executor.cc:534 ExecuteThePlan] Number of streams: 1\r\n2023-07-20 16:14:44.343232585 [V:onnxruntime:, sequential_executor.cc:184 SessionScope] Begin execution\r\n2023-07-20 16:14:45.282814577 [V:onnxruntime:, sequential_executor.cc:518 ExecuteKernel] stream 0 launch kernel with idx 5\r\n2023-07-20 16:14:45.283567614 [V:onnxruntime:, sequential_executor.cc:534 ExecuteThePlan] Number of streams: 1\r\n2023-07-20 16:14:45.283579404 [V:onnxruntime:, sequential_executor.cc:184 SessionScope] Begin execution\r\n2023-07-20 16:14:45.283630945 [V:onnxruntime:, sequential_executor.cc:518 ExecuteKernel] stream 0 launch kernel with idx 5\r\nOutput 0, diff=17.570600510 index=(2, 0, 0) ort=-0.038370539 torch=17.532230377\r\ninput tensor([[[-17.0660781860],\r\n         [  5.9965152740]],\r\n\r\n        [[ 16.1023044586],\r\n         [  4.0838894844]],\r\n\r\n        [[ 17.5322303772],\r\n         [ 10.0256319046]],\r\n\r\n        [[ -2.4230549335],\r\n         [  3.6469326019]]], device='cuda:0')\r\ntorch_outputs (tensor([[[-0.0000000000],\r\n         [ 5.9965152740]],\r\n\r\n        [[16.1023044586],\r\n         [ 4.0837988853]],\r\n\r\n        [[17.5322303772],\r\n         [10.0256319046]],\r\n\r\n        [[-0.0186461769],\r\n         [ 3.6464486122]]], device='cuda:0'),)\r\nort_outputs [array([[[-0.0000000000],\r\n        [-0.1111395806]],\r\n\r\n       [[ 4.6619696617],\r\n        [20.7520313263]],\r\n\r\n       [[-0.0383705385],\r\n        [-0.0533541143]],\r\n\r\n       [[-0.0000000000],\r\n        [ 5.0611729622]]], dtype=float32)]\r\n[FAILED] Passed_cases=1/2; Max_diff=17.570600509643555; Diff_count=2\r\nF\r\n======================================================================\r\nFAIL: test_cuda (__main__.TestGeluParity)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"test_parity_gelu.py\", line 236, in test_cuda\r\n    self.run_one(self.optimized, gpu, hidden_size=self.hidden_size, formula=i, verbose=self.verbose)\r\n  File \"test_parity_gelu.py\", line 188, in run_one\r\n    self.run_test(\r\n  File \"test_parity_gelu.py\", line 184, in run_test\r\n    self.assertTrue(num_failure == 0, \"Failed: \" + test_name)\r\nAssertionError: False is not true : Failed: device=cuda, float16=False, optimized=False, batch_size=4, sequence_length=2, hidden_size=1, formula=1, fp32_gelu_op=True\r\n\r\n----------------------------------------------------------------------\r\nRan 1 test in 1.549s\r\n```\r\n\r\nis there a way for us to add a sync between kernels or waiting on the stream completion. It appears we're not performing the sync before each run.  \r\n\r\nWhat is odd is we don't observe this behavior on our MI250 card at all",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1644214191/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1644296324",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/16774#issuecomment-1644296324",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/16774",
        "id": 1644296324,
        "node_id": "IC_kwDOCVq1mM5iAfiE",
        "user": {
            "login": "cloudhan",
            "id": 1279292,
            "node_id": "MDQ6VXNlcjEyNzkyOTI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1279292?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/cloudhan",
            "html_url": "https://github.com/cloudhan",
            "followers_url": "https://api.github.com/users/cloudhan/followers",
            "following_url": "https://api.github.com/users/cloudhan/following{/other_user}",
            "gists_url": "https://api.github.com/users/cloudhan/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/cloudhan/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/cloudhan/subscriptions",
            "organizations_url": "https://api.github.com/users/cloudhan/orgs",
            "repos_url": "https://api.github.com/users/cloudhan/repos",
            "events_url": "https://api.github.com/users/cloudhan/events{/privacy}",
            "received_events_url": "https://api.github.com/users/cloudhan/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-07-20T17:14:52Z",
        "updated_at": "2023-07-20T17:14:52Z",
        "author_association": "MEMBER",
        "body": "I am not quite sure how far back have you tried to traceback and failed to find a stable point. If possible, could please try [13495](https://togithub.com/microsoft/onnxruntime/pull/13495) to see if the stream problem is presented right before the commit?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1644296324/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1644518536",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/16774#issuecomment-1644518536",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/16774",
        "id": 1644518536,
        "node_id": "IC_kwDOCVq1mM5iBVyI",
        "user": {
            "login": "TedThemistokleous",
            "id": 107195283,
            "node_id": "U_kgDOBmOrkw",
            "avatar_url": "https://avatars.githubusercontent.com/u/107195283?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TedThemistokleous",
            "html_url": "https://github.com/TedThemistokleous",
            "followers_url": "https://api.github.com/users/TedThemistokleous/followers",
            "following_url": "https://api.github.com/users/TedThemistokleous/following{/other_user}",
            "gists_url": "https://api.github.com/users/TedThemistokleous/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TedThemistokleous/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TedThemistokleous/subscriptions",
            "organizations_url": "https://api.github.com/users/TedThemistokleous/orgs",
            "repos_url": "https://api.github.com/users/TedThemistokleous/repos",
            "events_url": "https://api.github.com/users/TedThemistokleous/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TedThemistokleous/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-07-20T19:57:58Z",
        "updated_at": "2023-07-20T19:57:58Z",
        "author_association": "CONTRIBUTOR",
        "body": "Sure. Currently tried: f4cd35f9b1301f54d65a3e59c525b92e85bf384e\r\nBut getting the absel build failures, I may need to patch that before I can get working build. \r\n\r\nRolled back to my original commit MIGraphX stream related things were created (october 2022) but there's no changes for the no_optimize flags in the parity tests.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1644518536/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1644968395",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/16774#issuecomment-1644968395",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/16774",
        "id": 1644968395,
        "node_id": "IC_kwDOCVq1mM5iDDnL",
        "user": {
            "login": "TedThemistokleous",
            "id": 107195283,
            "node_id": "U_kgDOBmOrkw",
            "avatar_url": "https://avatars.githubusercontent.com/u/107195283?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TedThemistokleous",
            "html_url": "https://github.com/TedThemistokleous",
            "followers_url": "https://api.github.com/users/TedThemistokleous/followers",
            "following_url": "https://api.github.com/users/TedThemistokleous/following{/other_user}",
            "gists_url": "https://api.github.com/users/TedThemistokleous/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TedThemistokleous/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TedThemistokleous/subscriptions",
            "organizations_url": "https://api.github.com/users/TedThemistokleous/orgs",
            "repos_url": "https://api.github.com/users/TedThemistokleous/repos",
            "events_url": "https://api.github.com/users/TedThemistokleous/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TedThemistokleous/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-07-21T04:34:09Z",
        "updated_at": "2023-07-21T04:34:09Z",
        "author_association": "CONTRIBUTOR",
        "body": "I have a fix that changes the hipMemCpy() to a proper hipMemcpyAsync() when building Onnxruntime with MIGraphX containing stream sync functionality\r\n\r\n![image](https://github.com/microsoft/onnxruntime/assets/107195283/b68dcf07-8093-46ed-bc0e-3f5001384bd8)\r\n\r\nFound a fix and opened a PR for this. Please let me know if there are any issues with the changes from the Microsoft side.\r\n\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1644968395/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]