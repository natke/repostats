[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1563336029",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15982#issuecomment-1563336029",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15982",
        "id": 1563336029,
        "node_id": "IC_kwDOCVq1mM5dLp1d",
        "user": {
            "login": "RyanUnderhill",
            "id": 38674843,
            "node_id": "MDQ6VXNlcjM4Njc0ODQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/38674843?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/RyanUnderhill",
            "html_url": "https://github.com/RyanUnderhill",
            "followers_url": "https://api.github.com/users/RyanUnderhill/followers",
            "following_url": "https://api.github.com/users/RyanUnderhill/following{/other_user}",
            "gists_url": "https://api.github.com/users/RyanUnderhill/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/RyanUnderhill/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/RyanUnderhill/subscriptions",
            "organizations_url": "https://api.github.com/users/RyanUnderhill/orgs",
            "repos_url": "https://api.github.com/users/RyanUnderhill/repos",
            "events_url": "https://api.github.com/users/RyanUnderhill/events{/privacy}",
            "received_events_url": "https://api.github.com/users/RyanUnderhill/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-05-25T18:33:08Z",
        "updated_at": "2023-05-25T18:33:08Z",
        "author_association": "MEMBER",
        "body": "Looks like it's not throwing an exception and just crashing, even though it does log that error before it happens.\r\n\r\n@jywu-msft Is this something that should be fixed in the tensorrt provider?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1563336029/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1563619930",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15982#issuecomment-1563619930",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15982",
        "id": 1563619930,
        "node_id": "IC_kwDOCVq1mM5dMvJa",
        "user": {
            "login": "jywu-msft",
            "id": 43355415,
            "node_id": "MDQ6VXNlcjQzMzU1NDE1",
            "avatar_url": "https://avatars.githubusercontent.com/u/43355415?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jywu-msft",
            "html_url": "https://github.com/jywu-msft",
            "followers_url": "https://api.github.com/users/jywu-msft/followers",
            "following_url": "https://api.github.com/users/jywu-msft/following{/other_user}",
            "gists_url": "https://api.github.com/users/jywu-msft/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jywu-msft/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jywu-msft/subscriptions",
            "organizations_url": "https://api.github.com/users/jywu-msft/orgs",
            "repos_url": "https://api.github.com/users/jywu-msft/repos",
            "events_url": "https://api.github.com/users/jywu-msft/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jywu-msft/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-05-25T23:14:21Z",
        "updated_at": "2023-05-25T23:14:21Z",
        "author_association": "MEMBER",
        "body": "+@yf711 can you take a look and reproduce it?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1563619930/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1586881229",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15982#issuecomment-1586881229",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15982",
        "id": 1586881229,
        "node_id": "IC_kwDOCVq1mM5eleLN",
        "user": {
            "login": "mattiasbax",
            "id": 14754243,
            "node_id": "MDQ6VXNlcjE0NzU0MjQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/14754243?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mattiasbax",
            "html_url": "https://github.com/mattiasbax",
            "followers_url": "https://api.github.com/users/mattiasbax/followers",
            "following_url": "https://api.github.com/users/mattiasbax/following{/other_user}",
            "gists_url": "https://api.github.com/users/mattiasbax/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mattiasbax/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mattiasbax/subscriptions",
            "organizations_url": "https://api.github.com/users/mattiasbax/orgs",
            "repos_url": "https://api.github.com/users/mattiasbax/repos",
            "events_url": "https://api.github.com/users/mattiasbax/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mattiasbax/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-06-12T08:53:34Z",
        "updated_at": "2023-06-12T08:53:34Z",
        "author_association": "NONE",
        "body": "Any update regarding this? :) ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1586881229/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1588856262",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15982#issuecomment-1588856262",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15982",
        "id": 1588856262,
        "node_id": "IC_kwDOCVq1mM5etAXG",
        "user": {
            "login": "yf711",
            "id": 109183385,
            "node_id": "U_kgDOBoIBmQ",
            "avatar_url": "https://avatars.githubusercontent.com/u/109183385?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yf711",
            "html_url": "https://github.com/yf711",
            "followers_url": "https://api.github.com/users/yf711/followers",
            "following_url": "https://api.github.com/users/yf711/following{/other_user}",
            "gists_url": "https://api.github.com/users/yf711/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yf711/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yf711/subscriptions",
            "organizations_url": "https://api.github.com/users/yf711/orgs",
            "repos_url": "https://api.github.com/users/yf711/repos",
            "events_url": "https://api.github.com/users/yf711/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yf711/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-06-13T08:59:34Z",
        "updated_at": "2023-06-13T08:59:34Z",
        "author_association": "MEMBER",
        "body": "@mattiasbax I ran your code but didn't encounter the unhandled exception. Here's what I tried:\r\n\r\nFirst, I created engine cache on a sm_75 GPU machine using model resnet50v2 and copied this cache to another machine with sm_86 GPU.\r\n\r\nThen, I directly ran the code sample, the session was eventually initiated with cuda ep (as trt option was fed with incompatible cache) and the dummy img was inferred with cuda ep as well. No exception happened;\r\n\r\nNext, I commented out the cuda option and forced to init the session with tensorrt option, the session failed to initiate and an error was caught. Here's the log (the last line is the caught error message)\r\n\r\n```\r\n2023-06-08 11:01:08.3533793 [E:onnxruntime:test, tensorrt_execution_provider.h:61 onnxruntime::TensorrtLogger::log] [2023-06-08 18:01:08   ERROR] 1: [stdArchiveReader.cpp::nvinfer1::rt::StdArchiveReader::StdArchiveReader::32] Error Code 1: Serialization (Serialization assertion magicTagRead == kMAGIC_TAG failed.Magic tag does not match)\r\n2023-06-08 11:01:08.3601855 [E:onnxruntime:test, tensorrt_execution_provider.h:61 onnxruntime::TensorrtLogger::log] [2023-06-08 18:01:08   ERROR] 4: [runtime.cpp::nvinfer1::Runtime::deserializeCudaEngine::66] Error Code 4: Internal Error (Engine deserialization failed.)\r\nError: TensorRT EP could not deserialize engine from cache: C:\\tmp\\TensorrtExecutionProvider_TRTKernel_graph_main_4210380117390000368_0_0_fp16.engine\r\n```\r\nThis exception was handled during `session = Ort::Session(env, path sessionOptions)`\r\n, which was different from your case (as you mentioned the unhandled exception happened during `Ort::Session::Run(...)`). \r\n\r\nI was wondering how you (1). init the session using trt ep and incompatible cache and 2. Ort::Session::Run(...) with that cache? On my side, the error appeared and got handled in (1) already",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1588856262/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1588933471",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15982#issuecomment-1588933471",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15982",
        "id": 1588933471,
        "node_id": "IC_kwDOCVq1mM5etTNf",
        "user": {
            "login": "mattiasbax",
            "id": 14754243,
            "node_id": "MDQ6VXNlcjE0NzU0MjQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/14754243?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mattiasbax",
            "html_url": "https://github.com/mattiasbax",
            "followers_url": "https://api.github.com/users/mattiasbax/followers",
            "following_url": "https://api.github.com/users/mattiasbax/following{/other_user}",
            "gists_url": "https://api.github.com/users/mattiasbax/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mattiasbax/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mattiasbax/subscriptions",
            "organizations_url": "https://api.github.com/users/mattiasbax/orgs",
            "repos_url": "https://api.github.com/users/mattiasbax/repos",
            "events_url": "https://api.github.com/users/mattiasbax/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mattiasbax/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-06-13T09:40:26Z",
        "updated_at": "2023-06-13T09:40:26Z",
        "author_association": "NONE",
        "body": "@yf711 Hmmm, that's weird as this is very reproducable for me.\r\nWould you be able to share a downloadable link for your sm_75 engine cache of the resnet model so I can try that?\r\n\r\nWhat versions of onnxruntime and trt are you running?\r\n\r\nWhen I run the above example code with an imcompatible engine cache of my model with an attached debugger, I can step over `session = Ort::Session(env, path sessionOptions)` just fine without any exception or error log (even if I comment out the cuda ep options) ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1588933471/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1589324144",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15982#issuecomment-1589324144",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15982",
        "id": 1589324144,
        "node_id": "IC_kwDOCVq1mM5euylw",
        "user": {
            "login": "JulienTheron",
            "id": 25664475,
            "node_id": "MDQ6VXNlcjI1NjY0NDc1",
            "avatar_url": "https://avatars.githubusercontent.com/u/25664475?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/JulienTheron",
            "html_url": "https://github.com/JulienTheron",
            "followers_url": "https://api.github.com/users/JulienTheron/followers",
            "following_url": "https://api.github.com/users/JulienTheron/following{/other_user}",
            "gists_url": "https://api.github.com/users/JulienTheron/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/JulienTheron/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/JulienTheron/subscriptions",
            "organizations_url": "https://api.github.com/users/JulienTheron/orgs",
            "repos_url": "https://api.github.com/users/JulienTheron/repos",
            "events_url": "https://api.github.com/users/JulienTheron/events{/privacy}",
            "received_events_url": "https://api.github.com/users/JulienTheron/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-06-13T13:30:48Z",
        "updated_at": "2023-06-13T13:30:48Z",
        "author_association": "NONE",
        "body": "Hi,\r\nWe have the same issue. We use a model with a dynamic input shape, where the TensorRT engine build happens when running the inference. @yf711 did your model have a static shape?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1589324144/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1597545166",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15982#issuecomment-1597545166",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15982",
        "id": 1597545166,
        "node_id": "IC_kwDOCVq1mM5fOJrO",
        "user": {
            "login": "yf711",
            "id": 109183385,
            "node_id": "U_kgDOBoIBmQ",
            "avatar_url": "https://avatars.githubusercontent.com/u/109183385?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yf711",
            "html_url": "https://github.com/yf711",
            "followers_url": "https://api.github.com/users/yf711/followers",
            "following_url": "https://api.github.com/users/yf711/following{/other_user}",
            "gists_url": "https://api.github.com/users/yf711/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yf711/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yf711/subscriptions",
            "organizations_url": "https://api.github.com/users/yf711/orgs",
            "repos_url": "https://api.github.com/users/yf711/repos",
            "events_url": "https://api.github.com/users/yf711/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yf711/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-06-19T17:49:41Z",
        "updated_at": "2023-06-19T17:49:41Z",
        "author_association": "MEMBER",
        "body": "Thanks @JulienTheron @mattiasbax for the context. I was using a static resnet50 model and now I use a dynamic input resnet50 and reproduce the issue.\r\n\r\n[ORT-TRT treats static/dynamic input shape model differently](https://github.com/microsoft/onnxruntime/blob/main/onnxruntime/core/providers/tensorrt/tensorrt_execution_provider.cc#L1989): for static one ort-trt would load engine cache during session init, and for dynamic one it would load engine cache during session run. That explains why exception happen during session run rather than session init.\r\n\r\nI've drafted a change to prevent loading incompatible engine cache by distinguishing the cache filename with compute capacity, which plans to be in next ort release. I will continue checking on why this exception can't be caught",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1597545166/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1598144413",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15982#issuecomment-1598144413",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15982",
        "id": 1598144413,
        "node_id": "IC_kwDOCVq1mM5fQb-d",
        "user": {
            "login": "mattiasbax",
            "id": 14754243,
            "node_id": "MDQ6VXNlcjE0NzU0MjQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/14754243?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mattiasbax",
            "html_url": "https://github.com/mattiasbax",
            "followers_url": "https://api.github.com/users/mattiasbax/followers",
            "following_url": "https://api.github.com/users/mattiasbax/following{/other_user}",
            "gists_url": "https://api.github.com/users/mattiasbax/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mattiasbax/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mattiasbax/subscriptions",
            "organizations_url": "https://api.github.com/users/mattiasbax/orgs",
            "repos_url": "https://api.github.com/users/mattiasbax/repos",
            "events_url": "https://api.github.com/users/mattiasbax/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mattiasbax/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-06-20T05:34:31Z",
        "updated_at": "2023-06-20T05:34:31Z",
        "author_association": "NONE",
        "body": "@yf711 That's great, thank you!\r\n\r\nI believe we have seen different exceptions not being caught in the trt ep, but this one was easy to reproduce.\r\nI agree that continuing looking into why it isn't caught is a good idea.\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1598144413/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1607815349",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15982#issuecomment-1607815349",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15982",
        "id": 1607815349,
        "node_id": "IC_kwDOCVq1mM5f1VC1",
        "user": {
            "login": "yf711",
            "id": 109183385,
            "node_id": "U_kgDOBoIBmQ",
            "avatar_url": "https://avatars.githubusercontent.com/u/109183385?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yf711",
            "html_url": "https://github.com/yf711",
            "followers_url": "https://api.github.com/users/yf711/followers",
            "following_url": "https://api.github.com/users/yf711/following{/other_user}",
            "gists_url": "https://api.github.com/users/yf711/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yf711/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yf711/subscriptions",
            "organizations_url": "https://api.github.com/users/yf711/orgs",
            "repos_url": "https://api.github.com/users/yf711/repos",
            "events_url": "https://api.github.com/users/yf711/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yf711/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-06-26T16:20:39Z",
        "updated_at": "2023-06-26T16:20:39Z",
        "author_association": "MEMBER",
        "body": "@mattiasbax I think I found why this issue happened.\r\nWhen the model has dynamic input shape, [here](https://github.com/microsoft/onnxruntime/blob/rel-1.15.1/onnxruntime/core/providers/tensorrt/tensorrt_execution_provider.cc#L2263) we had a nullptr check to verify if engine is ready to be used, which didn't work as expected.\r\nI had a fix on that and now the error can be caught even I force to use incompatible cache. That fix will also be available in next ort release",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1607815349/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]