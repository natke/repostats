[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1137668551",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11627#issuecomment-1137668551",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11627",
        "id": 1137668551,
        "node_id": "IC_kwDOCVq1mM5Dz3HH",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-05-25T18:16:15Z",
        "updated_at": "2022-05-25T18:27:18Z",
        "author_association": "MEMBER",
        "body": "This is expected. If you disable Arena, heap memory allocation will take time, so inference latency will increase. One drawback of default Arena extend strategy is that it might allocate more memory than needed, which could be a waste.\r\n\r\nIf you want to save memory, but do not want to impact latency. I recommend to set execution provider options like the following python code:\r\n```\r\nimport onnxruntime as ort\r\nsess_options = ort.SessionOptions()\r\ncuda_provider_options = {\r\n\"gpu_mem_limit\": \"17179869184\", # 16GB.\r\n\"arena_extend_strategy\": \"kSameAsRequested\",\r\n}\r\ncpu_provider_options = {\r\n\"arena_extend_strategy\": \"kSameAsRequested\",\r\n}\r\nexecution_providers = [(\"CUDAExecutionProvider\", cuda_provider_options), (\"CPUExecutionProvider\", cpu_provider_options)]\r\nort_sess = ort.InferenceSession(onnx_path, sess_options, providers=execution_providers)\r\n```\r\n\r\nThen use one input (warm up query) that need most memory to inference after session is created. That will allocate just enough memory for your need, and also ensure that future inference does not allocate heap memory.\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1137668551/reactions",
            "total_count": 3,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 3,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1137754576",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11627#issuecomment-1137754576",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11627",
        "id": 1137754576,
        "node_id": "IC_kwDOCVq1mM5D0MHQ",
        "user": {
            "login": "joshuacwnewton",
            "id": 16181459,
            "node_id": "MDQ6VXNlcjE2MTgxNDU5",
            "avatar_url": "https://avatars.githubusercontent.com/u/16181459?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/joshuacwnewton",
            "html_url": "https://github.com/joshuacwnewton",
            "followers_url": "https://api.github.com/users/joshuacwnewton/followers",
            "following_url": "https://api.github.com/users/joshuacwnewton/following{/other_user}",
            "gists_url": "https://api.github.com/users/joshuacwnewton/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/joshuacwnewton/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/joshuacwnewton/subscriptions",
            "organizations_url": "https://api.github.com/users/joshuacwnewton/orgs",
            "repos_url": "https://api.github.com/users/joshuacwnewton/repos",
            "events_url": "https://api.github.com/users/joshuacwnewton/events{/privacy}",
            "received_events_url": "https://api.github.com/users/joshuacwnewton/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-05-25T19:13:21Z",
        "updated_at": "2022-06-02T23:54:10Z",
        "author_association": "NONE",
        "body": "Thank you so much for confirming that this is expected behavior, and for explaining the trade-offs involved here, and also for providing a more detailed configuration to address this issue. :heart: \r\n\r\nWould it be worth adding a section in the documentation that covers the CPU memory arena? I first read through the [Tune performance](https://onnxruntime.ai/docs/performance/tune-performance.html) page before making this issue, but there is currently no mention of `enable_cpu_mem_arena`.\r\n \r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1137754576/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1137776570",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11627#issuecomment-1137776570",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11627",
        "id": 1137776570,
        "node_id": "IC_kwDOCVq1mM5D0Re6",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-05-25T19:40:08Z",
        "updated_at": "2022-05-25T19:40:08Z",
        "author_association": "MEMBER",
        "body": "@[joshuacwnewton](https://github.com/joshuacwnewton), The suggestion sounds good. It worth to have a section about arena settings.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1137776570/reactions",
            "total_count": 1,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 1,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1137821969",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11627#issuecomment-1137821969",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11627",
        "id": 1137821969,
        "node_id": "IC_kwDOCVq1mM5D0ckR",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-05-25T20:34:43Z",
        "updated_at": "2022-05-25T20:34:43Z",
        "author_association": "MEMBER",
        "body": "Here are some info related to Arena:\r\nhttps://onnxruntime.ai/docs/get-started/with-c.html\r\nSee the sections of `Share allocator(s) between sessions`, `Memory arena shrinkage`, `Allocate memory for initializer(s) from non-arena memory (for advanced users)`. \r\n\r\nExample code: https://github.com/microsoft/onnxruntime/blob/f0dff6bb74fbc2a37f8c08e2615308d4f5ed26a7/onnxruntime/test/shared_lib/test_inference.cc#L1877-L1906\r\n\r\nIt is for C API, and some settings might not be available to python API.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1137821969/reactions",
            "total_count": 2,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 2,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1145426227",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11627#issuecomment-1145426227",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11627",
        "id": 1145426227,
        "node_id": "IC_kwDOCVq1mM5ERdEz",
        "user": {
            "login": "snnn",
            "id": 856316,
            "node_id": "MDQ6VXNlcjg1NjMxNg==",
            "avatar_url": "https://avatars.githubusercontent.com/u/856316?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/snnn",
            "html_url": "https://github.com/snnn",
            "followers_url": "https://api.github.com/users/snnn/followers",
            "following_url": "https://api.github.com/users/snnn/following{/other_user}",
            "gists_url": "https://api.github.com/users/snnn/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/snnn/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/snnn/subscriptions",
            "organizations_url": "https://api.github.com/users/snnn/orgs",
            "repos_url": "https://api.github.com/users/snnn/repos",
            "events_url": "https://api.github.com/users/snnn/events{/privacy}",
            "received_events_url": "https://api.github.com/users/snnn/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-02T23:09:48Z",
        "updated_at": "2022-06-02T23:09:48Z",
        "author_association": "MEMBER",
        "body": "@souptc , FYI. \r\n\r\n@[tianleiwu](https://github.com/tianleiwu), is arena enabled by default in our published python cpu package for the default CPU EP?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1145426227/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1149031840",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11627#issuecomment-1149031840",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11627",
        "id": 1149031840,
        "node_id": "IC_kwDOCVq1mM5EfNWg",
        "user": {
            "login": "natke",
            "id": 3302433,
            "node_id": "MDQ6VXNlcjMzMDI0MzM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3302433?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/natke",
            "html_url": "https://github.com/natke",
            "followers_url": "https://api.github.com/users/natke/followers",
            "following_url": "https://api.github.com/users/natke/following{/other_user}",
            "gists_url": "https://api.github.com/users/natke/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/natke/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/natke/subscriptions",
            "organizations_url": "https://api.github.com/users/natke/orgs",
            "repos_url": "https://api.github.com/users/natke/repos",
            "events_url": "https://api.github.com/users/natke/events{/privacy}",
            "received_events_url": "https://api.github.com/users/natke/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-07T18:37:29Z",
        "updated_at": "2022-06-07T18:37:29Z",
        "author_association": "MEMBER",
        "body": "@pkreg101 You could add this information to #11508 ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1149031840/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1190838559",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11627#issuecomment-1190838559",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11627",
        "id": 1190838559,
        "node_id": "IC_kwDOCVq1mM5G-sEf",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-20T22:40:05Z",
        "updated_at": "2022-07-20T22:40:05Z",
        "author_association": "MEMBER",
        "body": "@snnn, arena is enabled by default for CPU. See https://onnxruntime.ai/docs/api/python/api_summary.html#sessionoptions mentions that the option enable_cpu_mem_arena has default value True.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1190838559/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]