[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/995778754",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10047#issuecomment-995778754",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10047",
        "id": 995778754,
        "node_id": "IC_kwDOCVq1mM47WmDC",
        "user": {
            "login": "romain-keramitas-prl",
            "id": 91061498,
            "node_id": "MDQ6VXNlcjkxMDYxNDk4",
            "avatar_url": "https://avatars.githubusercontent.com/u/91061498?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/romain-keramitas-prl",
            "html_url": "https://github.com/romain-keramitas-prl",
            "followers_url": "https://api.github.com/users/romain-keramitas-prl/followers",
            "following_url": "https://api.github.com/users/romain-keramitas-prl/following{/other_user}",
            "gists_url": "https://api.github.com/users/romain-keramitas-prl/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/romain-keramitas-prl/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/romain-keramitas-prl/subscriptions",
            "organizations_url": "https://api.github.com/users/romain-keramitas-prl/orgs",
            "repos_url": "https://api.github.com/users/romain-keramitas-prl/repos",
            "events_url": "https://api.github.com/users/romain-keramitas-prl/events{/privacy}",
            "received_events_url": "https://api.github.com/users/romain-keramitas-prl/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-12-16T12:37:49Z",
        "updated_at": "2021-12-16T12:37:49Z",
        "author_association": "NONE",
        "body": "Actually my bad ! This is already implemented apparently under the name `DecoderAttention`, but in [this documentation file](https://github.com/microsoft/onnxruntime/blob/master/onnxruntime/python/tools/transformers/Dev_Guide.md) I was pointed to a previous version of the repository, instead of the most recent one :S ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/995778754/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/996284202",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10047#issuecomment-996284202",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10047",
        "id": 996284202,
        "node_id": "IC_kwDOCVq1mM47Yhcq",
        "user": {
            "login": "ytaous",
            "id": 4484531,
            "node_id": "MDQ6VXNlcjQ0ODQ1MzE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4484531?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ytaous",
            "html_url": "https://github.com/ytaous",
            "followers_url": "https://api.github.com/users/ytaous/followers",
            "following_url": "https://api.github.com/users/ytaous/following{/other_user}",
            "gists_url": "https://api.github.com/users/ytaous/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ytaous/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ytaous/subscriptions",
            "organizations_url": "https://api.github.com/users/ytaous/orgs",
            "repos_url": "https://api.github.com/users/ytaous/repos",
            "events_url": "https://api.github.com/users/ytaous/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ytaous/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-12-16T23:55:16Z",
        "updated_at": "2021-12-16T23:55:16Z",
        "author_association": "MEMBER",
        "body": "Thanks, can you please point out which part of the doc should be corrected?\r\n\r\n@wangyems ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/996284202/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/996320491",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10047#issuecomment-996320491",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10047",
        "id": 996320491,
        "node_id": "IC_kwDOCVq1mM47YqTr",
        "user": {
            "login": "wangyems",
            "id": 52801275,
            "node_id": "MDQ6VXNlcjUyODAxMjc1",
            "avatar_url": "https://avatars.githubusercontent.com/u/52801275?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/wangyems",
            "html_url": "https://github.com/wangyems",
            "followers_url": "https://api.github.com/users/wangyems/followers",
            "following_url": "https://api.github.com/users/wangyems/following{/other_user}",
            "gists_url": "https://api.github.com/users/wangyems/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/wangyems/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/wangyems/subscriptions",
            "organizations_url": "https://api.github.com/users/wangyems/orgs",
            "repos_url": "https://api.github.com/users/wangyems/repos",
            "events_url": "https://api.github.com/users/wangyems/events{/privacy}",
            "received_events_url": "https://api.github.com/users/wangyems/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-12-17T00:47:59Z",
        "updated_at": "2021-12-17T00:47:59Z",
        "author_association": "MEMBER",
        "body": "Hi @rom1K, the link to the doc is based on rel-1.9 for stability reason. Please refer to the master branch or rel-1.10 for any most updated features.\r\n\r\nPlease also note that we only have DecoderAttention cuda op and there is no corresponding cpu op and graph transformation code for it at the moment. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/996320491/reactions",
            "total_count": 2,
            "+1": 2,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/996526611",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10047#issuecomment-996526611",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10047",
        "id": 996526611,
        "node_id": "IC_kwDOCVq1mM47ZcoT",
        "user": {
            "login": "romain-keramitas-prl",
            "id": 91061498,
            "node_id": "MDQ6VXNlcjkxMDYxNDk4",
            "avatar_url": "https://avatars.githubusercontent.com/u/91061498?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/romain-keramitas-prl",
            "html_url": "https://github.com/romain-keramitas-prl",
            "followers_url": "https://api.github.com/users/romain-keramitas-prl/followers",
            "following_url": "https://api.github.com/users/romain-keramitas-prl/following{/other_user}",
            "gists_url": "https://api.github.com/users/romain-keramitas-prl/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/romain-keramitas-prl/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/romain-keramitas-prl/subscriptions",
            "organizations_url": "https://api.github.com/users/romain-keramitas-prl/orgs",
            "repos_url": "https://api.github.com/users/romain-keramitas-prl/repos",
            "events_url": "https://api.github.com/users/romain-keramitas-prl/events{/privacy}",
            "received_events_url": "https://api.github.com/users/romain-keramitas-prl/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-12-17T08:24:52Z",
        "updated_at": "2021-12-17T08:24:52Z",
        "author_association": "NONE",
        "body": "Hey @wangyems ! Okay thanks for the explanation :) SInce I was on the master branch when reading the doc I was surprised when it pointed me right back to the previous release, but I guess it makes sense.\r\n\r\n> Please also note that we only have DecoderAttention cuda op and there is no corresponding cpu op and graph transformation code for it at the moment.\r\n\r\nIn my case not a problem, I'm using a GPU and I've already had to modify the graph transformation code to adapt to my model so it shouldn't be too much of a hassle to adapt it some more.\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/996526611/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/996865380",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10047#issuecomment-996865380",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10047",
        "id": 996865380,
        "node_id": "IC_kwDOCVq1mM47avVk",
        "user": {
            "login": "romain-keramitas-prl",
            "id": 91061498,
            "node_id": "MDQ6VXNlcjkxMDYxNDk4",
            "avatar_url": "https://avatars.githubusercontent.com/u/91061498?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/romain-keramitas-prl",
            "html_url": "https://github.com/romain-keramitas-prl",
            "followers_url": "https://api.github.com/users/romain-keramitas-prl/followers",
            "following_url": "https://api.github.com/users/romain-keramitas-prl/following{/other_user}",
            "gists_url": "https://api.github.com/users/romain-keramitas-prl/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/romain-keramitas-prl/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/romain-keramitas-prl/subscriptions",
            "organizations_url": "https://api.github.com/users/romain-keramitas-prl/orgs",
            "repos_url": "https://api.github.com/users/romain-keramitas-prl/repos",
            "events_url": "https://api.github.com/users/romain-keramitas-prl/events{/privacy}",
            "received_events_url": "https://api.github.com/users/romain-keramitas-prl/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-12-17T16:44:33Z",
        "updated_at": "2021-12-17T16:44:33Z",
        "author_association": "NONE",
        "body": "I think this issue can be closed, but I've got a couple of observations if anyone comes onto this issue, which could also perhaps orient future development of this kernel. \r\n\r\nI've been able to modify the ONNX graph of my decoder layer without too many problems, however the way the kernel is made, compared to the regular (self) `Attention` kernel, makes the process a bit tedious. Specifically:\r\n\r\n- optional values for the key / value cache must be specified or the model can't be used, so I had to put dummy inputs, resulting in warning about shape mismatch\r\n- since this kernel expects the sequence length before the batch size instead of the other way around I had to add transpose nodes before and after each cross-attention block, which probably slows down computation\r\n-  the key mask had to be cast to bool instead of int32, unlike the previous kernel\r\n- **the key mask is inverted**: at first, I had NaN values outputted because the mask expects zeros for non-padding tokens instead of ones ! \r\n- the documentation regarding the `has_layer_state` is pretty lacking, no idea how to use this\r\n- the past  key / value must be inputted separately, unlike the previous kernel\r\n\r\nI think if  @wangyems or another maintainer has some time it would be cool to address some of these points, be it simply through documentation or by modifying the kernel. Finally, I must say that I haven't yet been able to see any performance increase when converting the model to FP16. I don't know if it's due to unnecessary casting back and from FP16 to FP32 between inputs and outputs, or if it's due to something else, like the kernel itself. It's pretty strange, since for the encoder conterpart I've seen a pretty significant speedup.  \r\n\r\nAnyway, although I may seem somewhat critical here, I'd like to thank you very much for your effort and work, all of this is awesome and I'm really having fun with it :100:  \r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/996865380/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/996929093",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10047#issuecomment-996929093",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10047",
        "id": 996929093,
        "node_id": "IC_kwDOCVq1mM47a-5F",
        "user": {
            "login": "ytaous",
            "id": 4484531,
            "node_id": "MDQ6VXNlcjQ0ODQ1MzE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4484531?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ytaous",
            "html_url": "https://github.com/ytaous",
            "followers_url": "https://api.github.com/users/ytaous/followers",
            "following_url": "https://api.github.com/users/ytaous/following{/other_user}",
            "gists_url": "https://api.github.com/users/ytaous/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ytaous/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ytaous/subscriptions",
            "organizations_url": "https://api.github.com/users/ytaous/orgs",
            "repos_url": "https://api.github.com/users/ytaous/repos",
            "events_url": "https://api.github.com/users/ytaous/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ytaous/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-12-17T18:24:55Z",
        "updated_at": "2021-12-17T18:24:55Z",
        "author_association": "MEMBER",
        "body": "will leave it open as an enhancement for review, thx",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/996929093/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/997024353",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10047#issuecomment-997024353",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10047",
        "id": 997024353,
        "node_id": "IC_kwDOCVq1mM47bWJh",
        "user": {
            "login": "wangyems",
            "id": 52801275,
            "node_id": "MDQ6VXNlcjUyODAxMjc1",
            "avatar_url": "https://avatars.githubusercontent.com/u/52801275?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/wangyems",
            "html_url": "https://github.com/wangyems",
            "followers_url": "https://api.github.com/users/wangyems/followers",
            "following_url": "https://api.github.com/users/wangyems/following{/other_user}",
            "gists_url": "https://api.github.com/users/wangyems/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/wangyems/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/wangyems/subscriptions",
            "organizations_url": "https://api.github.com/users/wangyems/orgs",
            "repos_url": "https://api.github.com/users/wangyems/repos",
            "events_url": "https://api.github.com/users/wangyems/events{/privacy}",
            "received_events_url": "https://api.github.com/users/wangyems/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-12-17T20:51:57Z",
        "updated_at": "2021-12-17T20:51:57Z",
        "author_association": "MEMBER",
        "body": "@rom1K Thank you very much for the comments!",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/997024353/reactions",
            "total_count": 2,
            "+1": 2,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]