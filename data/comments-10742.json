[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1064659348",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10742#issuecomment-1064659348",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10742",
        "id": 1064659348,
        "node_id": "IC_kwDOCVq1mM4_dWmU",
        "user": {
            "login": "yuslepukhin",
            "id": 11303988,
            "node_id": "MDQ6VXNlcjExMzAzOTg4",
            "avatar_url": "https://avatars.githubusercontent.com/u/11303988?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yuslepukhin",
            "html_url": "https://github.com/yuslepukhin",
            "followers_url": "https://api.github.com/users/yuslepukhin/followers",
            "following_url": "https://api.github.com/users/yuslepukhin/following{/other_user}",
            "gists_url": "https://api.github.com/users/yuslepukhin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yuslepukhin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yuslepukhin/subscriptions",
            "organizations_url": "https://api.github.com/users/yuslepukhin/orgs",
            "repos_url": "https://api.github.com/users/yuslepukhin/repos",
            "events_url": "https://api.github.com/users/yuslepukhin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yuslepukhin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-03-11T00:46:58Z",
        "updated_at": "2022-03-11T00:46:58Z",
        "author_association": "MEMBER",
        "body": "If you are using C#, one known issue with customers code was that they do not dispose IDisposable objects that hold on to the native memory so memory is never freed.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1064659348/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1476922398",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10742#issuecomment-1476922398",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10742",
        "id": 1476922398,
        "node_id": "IC_kwDOCVq1mM5YCAwe",
        "user": {
            "login": "anonymoussky",
            "id": 124943617,
            "node_id": "U_kgDOB3J9AQ",
            "avatar_url": "https://avatars.githubusercontent.com/u/124943617?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/anonymoussky",
            "html_url": "https://github.com/anonymoussky",
            "followers_url": "https://api.github.com/users/anonymoussky/followers",
            "following_url": "https://api.github.com/users/anonymoussky/following{/other_user}",
            "gists_url": "https://api.github.com/users/anonymoussky/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/anonymoussky/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/anonymoussky/subscriptions",
            "organizations_url": "https://api.github.com/users/anonymoussky/orgs",
            "repos_url": "https://api.github.com/users/anonymoussky/repos",
            "events_url": "https://api.github.com/users/anonymoussky/events{/privacy}",
            "received_events_url": "https://api.github.com/users/anonymoussky/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-20T20:55:43Z",
        "updated_at": "2023-03-20T20:55:43Z",
        "author_association": "NONE",
        "body": "> **or**\r\n> Local run only consumes around 3G memory\r\n\r\nhave you solved this issue? I also encounter that ONNX consumes lots of memory on CPU inference.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1476922398/reactions",
            "total_count": 1,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 1
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1491181692",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10742#issuecomment-1491181692",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10742",
        "id": 1491181692,
        "node_id": "IC_kwDOCVq1mM5Y4aB8",
        "user": {
            "login": "ziggy1209",
            "id": 58074506,
            "node_id": "MDQ6VXNlcjU4MDc0NTA2",
            "avatar_url": "https://avatars.githubusercontent.com/u/58074506?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ziggy1209",
            "html_url": "https://github.com/ziggy1209",
            "followers_url": "https://api.github.com/users/ziggy1209/followers",
            "following_url": "https://api.github.com/users/ziggy1209/following{/other_user}",
            "gists_url": "https://api.github.com/users/ziggy1209/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ziggy1209/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ziggy1209/subscriptions",
            "organizations_url": "https://api.github.com/users/ziggy1209/orgs",
            "repos_url": "https://api.github.com/users/ziggy1209/repos",
            "events_url": "https://api.github.com/users/ziggy1209/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ziggy1209/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-31T01:58:26Z",
        "updated_at": "2023-03-31T01:58:26Z",
        "author_association": "NONE",
        "body": "Same here... A 300KB model consumes 100MB memory.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1491181692/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1491278158",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10742#issuecomment-1491278158",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10742",
        "id": 1491278158,
        "node_id": "IC_kwDOCVq1mM5Y4xlO",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-03-31T04:39:57Z",
        "updated_at": "2023-03-31T04:39:57Z",
        "author_association": "MEMBER",
        "body": "Can you use C/C++ APIs and check if the memory consumption is the same? This is to isolate any GC related concerns. Can you attach the model if possible?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1491278158/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1495267339",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10742#issuecomment-1495267339",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10742",
        "id": 1495267339,
        "node_id": "IC_kwDOCVq1mM5ZH_gL",
        "user": {
            "login": "ziggy1209",
            "id": 58074506,
            "node_id": "MDQ6VXNlcjU4MDc0NTA2",
            "avatar_url": "https://avatars.githubusercontent.com/u/58074506?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ziggy1209",
            "html_url": "https://github.com/ziggy1209",
            "followers_url": "https://api.github.com/users/ziggy1209/followers",
            "following_url": "https://api.github.com/users/ziggy1209/following{/other_user}",
            "gists_url": "https://api.github.com/users/ziggy1209/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ziggy1209/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ziggy1209/subscriptions",
            "organizations_url": "https://api.github.com/users/ziggy1209/orgs",
            "repos_url": "https://api.github.com/users/ziggy1209/repos",
            "events_url": "https://api.github.com/users/ziggy1209/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ziggy1209/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-04T02:52:51Z",
        "updated_at": "2023-04-04T02:52:51Z",
        "author_association": "NONE",
        "body": "> Can you use C/C++ APIs and check if the memory consumption is the same? This is to isolate any GC related concerns. Can you attach the model if possible?\r\n\r\nI was using the C++ API and the inference sessions were running on Linux ARM. There were two models running in different thread, but I don't think this would exert much influence on the total memory usage..?\r\n\r\nIn the main thread the model was as follows:\r\n```Python\r\nclass CnnBlock2D(nn.Module):\r\n    def __init__(self,\r\n                 channel: int,\r\n                 kernel_size: int,\r\n                 dilation: int,\r\n                 dropout: float = 0.1):\r\n        super().__init__()\r\n        self.padding = (kernel_size - 1) * dilation\r\n\r\n        self.cnn = nn.Conv2d(channel,\r\n                      channel,\r\n                      (1, kernel_size),\r\n                      stride=(1, 1),\r\n                      dilation=(1, dilation),\r\n                      groups=channel)\r\n\r\n        self.bn = nn.BatchNorm2d(channel)\r\n        self.dropout = nn.Dropout(dropout)\r\n\r\n    def forward(self, x: torch.Tensor = None):\r\n        y = F.pad(x, (self.padding, 0, 0, 0), value=0.0)\r\n        y = self.cnn(y)\r\n        y = self.bn(y)\r\n        y = F.relu(y, inplace=True)\r\n        y = self.dropout(y)\r\n        y = y + x  # residual connection\r\n        return y\r\n\r\nclass TCN2D(nn.Module):\r\n    def __init__(self,\r\n                 num_layers: int,\r\n                 channel: int,\r\n                 kernel_size: int,\r\n                 dropout: float = 0.1,\r\n                 block_class=CnnBlock2D):\r\n        super().__init__()\r\n        layers = []\r\n        self.padding = 0\r\n        self.network = nn.ModuleList()\r\n        for i in range(num_layers):\r\n            dilation = 2**i\r\n            self.padding += (kernel_size - 1) * dilation\r\n            self.network.append(\r\n                block_class(channel, kernel_size, dilation, dropout))\r\n\r\n    def forward(self, x: torch.Tensor = None):\r\n\r\n        for block in self.network:\r\n            x = block(x)\r\n        return x\r\n\r\ntcn = TCN2D(4, 40, 8, block_class=CnnBlock2D)\r\n\r\n```\r\nIn another thread the model was an LSTM:\r\n```Python\r\nclass SpectralCNNLSTM2D(nn.Module):\r\n    def __init__(self, \r\n                 lstm_h: int):\r\n        super().__init__()\r\n        self.encoder = nn.Sequential(\r\n            nn.Conv2d(40,int(lstm_h/2),(5,1)),\r\n            nn.ReLU(),\r\n            nn.BatchNorm2d(int(lstm_h/2)),\r\n            nn.Conv2d(int(lstm_h/2),int(lstm_h/2),(5,1)),\r\n            nn.ReLU(),\r\n            nn.BatchNorm2d(int(lstm_h/2)),\r\n            )\r\n        self.linear = nn.Linear(int(lstm_h/2),1)\r\n        self.lstm = nn.LSTM(int(lstm_h/2),int(lstm_h/2),batch_first=True)\r\n        self.attention = SoftAttention(int(lstm_h/2), int(lstm_h/2))\r\n    \r\n        self.classifier = nn.Sequential(\r\n                nn.Linear(int(lstm_h/2), int(lstm_h/2)),\r\n                nn.ReLU(),\r\n                nn.Dropout(0.3),\r\n                nn.Linear(int(lstm_h/2), 1),\r\n                nn.Sigmoid())\r\n\r\n    def forward(self, x):\r\n        x = x.permute(0,1,3,2)\r\n        x = self.encoder(x)\r\n        x = x.squeeze(3)\r\n        output, (hidden, _) = self.lstm(x.transpose(1,2))\r\n        attn_output = self.attention(output)\r\n\r\n        ret = self.classifier(attn_output)\r\n        return ret\r\n\r\nLSTM2D = SpectralCNNLSTM2D(128)\r\n```\r\nThanks for your reply.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1495267339/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1495291086",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10742#issuecomment-1495291086",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10742",
        "id": 1495291086,
        "node_id": "IC_kwDOCVq1mM5ZIFTO",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-04T03:22:41Z",
        "updated_at": "2023-04-04T03:22:41Z",
        "author_association": "MEMBER",
        "body": "> There were two models running in different thread, but I don't think this would exert much influence on the total memory usage..?\r\n\r\nYes, it definitely will. Each session comes with its own arena, threadpool and other things. Each arena allocates a lot of memory. You can try turning off the arena altogether.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1495291086/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1495490634",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10742#issuecomment-1495490634",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10742",
        "id": 1495490634,
        "node_id": "IC_kwDOCVq1mM5ZI2BK",
        "user": {
            "login": "ziggy1209",
            "id": 58074506,
            "node_id": "MDQ6VXNlcjU4MDc0NTA2",
            "avatar_url": "https://avatars.githubusercontent.com/u/58074506?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ziggy1209",
            "html_url": "https://github.com/ziggy1209",
            "followers_url": "https://api.github.com/users/ziggy1209/followers",
            "following_url": "https://api.github.com/users/ziggy1209/following{/other_user}",
            "gists_url": "https://api.github.com/users/ziggy1209/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ziggy1209/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ziggy1209/subscriptions",
            "organizations_url": "https://api.github.com/users/ziggy1209/orgs",
            "repos_url": "https://api.github.com/users/ziggy1209/repos",
            "events_url": "https://api.github.com/users/ziggy1209/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ziggy1209/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-04T07:36:00Z",
        "updated_at": "2023-04-04T07:36:00Z",
        "author_association": "NONE",
        "body": "> > There were two models running in different thread, but I don't think this would exert much influence on the total memory usage..?\r\n> \r\n> Yes, it definitely will. Each session comes with its own arena, threadpool and other things. Each arena allocates a lot of memory. You can try turning off the arena altogether.\r\n\r\nThanks! I stopped one of the threads and left only the main thread running, however, it still consumed >90MB memory...",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1495490634/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]