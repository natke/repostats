[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/977576652",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9853#issuecomment-977576652",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9853",
        "id": 977576652,
        "node_id": "IC_kwDOCVq1mM46RKLM",
        "user": {
            "login": "stevenlix",
            "id": 38092805,
            "node_id": "MDQ6VXNlcjM4MDkyODA1",
            "avatar_url": "https://avatars.githubusercontent.com/u/38092805?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stevenlix",
            "html_url": "https://github.com/stevenlix",
            "followers_url": "https://api.github.com/users/stevenlix/followers",
            "following_url": "https://api.github.com/users/stevenlix/following{/other_user}",
            "gists_url": "https://api.github.com/users/stevenlix/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stevenlix/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stevenlix/subscriptions",
            "organizations_url": "https://api.github.com/users/stevenlix/orgs",
            "repos_url": "https://api.github.com/users/stevenlix/repos",
            "events_url": "https://api.github.com/users/stevenlix/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stevenlix/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-11-24T06:39:42Z",
        "updated_at": "2021-11-24T06:39:42Z",
        "author_association": "CONTRIBUTOR",
        "body": "Could you run shape inference on the model first as indicated by the message in #4? TensorRT requires input shape info to be available before inference. #1 and #3 are not errors. Not sure what's the reason for #2. Can you share your model if possible?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/977576652/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/978779037",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9853#issuecomment-978779037",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9853",
        "id": 978779037,
        "node_id": "IC_kwDOCVq1mM46Vvud",
        "user": {
            "login": "ggslayer",
            "id": 15798355,
            "node_id": "MDQ6VXNlcjE1Nzk4MzU1",
            "avatar_url": "https://avatars.githubusercontent.com/u/15798355?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ggslayer",
            "html_url": "https://github.com/ggslayer",
            "followers_url": "https://api.github.com/users/ggslayer/followers",
            "following_url": "https://api.github.com/users/ggslayer/following{/other_user}",
            "gists_url": "https://api.github.com/users/ggslayer/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ggslayer/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ggslayer/subscriptions",
            "organizations_url": "https://api.github.com/users/ggslayer/orgs",
            "repos_url": "https://api.github.com/users/ggslayer/repos",
            "events_url": "https://api.github.com/users/ggslayer/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ggslayer/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-11-25T03:06:46Z",
        "updated_at": "2021-11-25T03:06:46Z",
        "author_association": "NONE",
        "body": "Hi, sevenlix, thank you for your reply, I tried the onnxruntime/python/tools/symbolic_shape_infer.py on my onnx model, but got a error: \r\n\r\nsymbolic_shape_infer.py --input=./fs.onnx \r\ninput model: ./fs.onnx\r\nDoing symbolic shape inference...\r\nTraceback (most recent call last):\r\n  File \"/data/projects/onnxruntime_1.9.1/onnxruntime/python/tools/symbolic_shape_infer.py\", line 2035, in <module>\r\n    out_mp = SymbolicShapeInference.infer_shapes(onnx.load(args.input), args.int_max, args.auto_merge,\r\n  File \"/data/projects/onnxruntime_1.9.1/onnxruntime/python/tools/symbolic_shape_infer.py\", line 1999, in infer_shapes\r\n    all_shapes_inferred = symbolic_shape_inference._infer_impl()\r\n  File \"/data/projects/onnxruntime_1.9.1/onnxruntime/python/tools/symbolic_shape_infer.py\", line 1833, in _infer_impl\r\n    self.dispatcher_[node.op_type](node)\r\n  File \"/data/projects/onnxruntime_1.9.1/onnxruntime/python/tools/symbolic_shape_infer.py\", line 1627, in _infer_Unsqueeze\r\n    output_rank = len(input_shape) + len(axes)\r\nTypeError: object of type 'NoneType' has no len()\r\n\r\nplease give me some advice for this error, thank you!",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/978779037/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/981872081",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9853#issuecomment-981872081",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9853",
        "id": 981872081,
        "node_id": "IC_kwDOCVq1mM46hi3R",
        "user": {
            "login": "askhade",
            "id": 6475296,
            "node_id": "MDQ6VXNlcjY0NzUyOTY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6475296?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/askhade",
            "html_url": "https://github.com/askhade",
            "followers_url": "https://api.github.com/users/askhade/followers",
            "following_url": "https://api.github.com/users/askhade/following{/other_user}",
            "gists_url": "https://api.github.com/users/askhade/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/askhade/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/askhade/subscriptions",
            "organizations_url": "https://api.github.com/users/askhade/orgs",
            "repos_url": "https://api.github.com/users/askhade/repos",
            "events_url": "https://api.github.com/users/askhade/events{/privacy}",
            "received_events_url": "https://api.github.com/users/askhade/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-11-29T17:52:19Z",
        "updated_at": "2021-11-29T17:52:19Z",
        "author_association": "MEMBER",
        "body": "Please run onnx checker to make sure the model is valid. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/981872081/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/997323743",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9853#issuecomment-997323743",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9853",
        "id": 997323743,
        "node_id": "IC_kwDOCVq1mM47cfPf",
        "user": {
            "login": "weixsong",
            "id": 7642350,
            "node_id": "MDQ6VXNlcjc2NDIzNTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7642350?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/weixsong",
            "html_url": "https://github.com/weixsong",
            "followers_url": "https://api.github.com/users/weixsong/followers",
            "following_url": "https://api.github.com/users/weixsong/following{/other_user}",
            "gists_url": "https://api.github.com/users/weixsong/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/weixsong/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/weixsong/subscriptions",
            "organizations_url": "https://api.github.com/users/weixsong/orgs",
            "repos_url": "https://api.github.com/users/weixsong/repos",
            "events_url": "https://api.github.com/users/weixsong/events{/privacy}",
            "received_events_url": "https://api.github.com/users/weixsong/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-12-19T03:35:53Z",
        "updated_at": "2021-12-19T03:58:40Z",
        "author_association": "NONE",
        "body": "The model is correct because the ORT could load the model and do inference as expected.\r\n\r\nWe want to convert the ONNX model to TensorRT, it seems the error comes from the mask code:\r\n```\r\ndef get_mask_from_lengths(lengths, max_len=None):\r\n    batch_size = lengths.shape[0]\r\n    if max_len is None:\r\n        max_len = torch.max(lengths)\r\n\r\n    ids = torch.arange(0, max_len).unsqueeze(0).expand(batch_size, -1).to(device)\r\n    mask = ids >= lengths.unsqueeze(1).expand(-1, max_len)\r\n\r\n    return mask\r\n```\r\n\r\nWe also tried using torch2trt to export the TRT model directly, but encountered the below error:\r\n```\r\nTraceback (most recent call last):\r\n  File \"torch2trt_tutorial.py\", line 207, in <module>\r\n    model_trt = torch2trt(model, [speakers, texts, src_lens, duration_control])\r\n  File \"/export/anaconda3/lib/python3.7/site-packages/torch2trt-0.3.0-py3.7.egg/torch2trt/torch2trt.py\", line 553, in torch2trt\r\n    outputs = module(*inputs)\r\n  File \"/export/anaconda3/lib/python3.7/site-packages/torch/nn/modules/module.py\", line 1102, in _call_impl\r\n    return forward_call(*input, **kwargs)\r\n  File \"/export/users/songwei/workspace/FastSpeech/exp02_test/fastspeech/model/fastspeech2.py\", line 35, in forward\r\n    src_masks = get_mask_from_lengths(src_lens, max_src_len)\r\n  File \"/export/users/songwei/workspace/FastSpeech/exp02_test/fastspeech/utils/tools.py\", line 64, in get_mask_from_lengths\r\n    max_len = torch.max(lengths)\r\n  File \"/export/anaconda3/lib/python3.7/site-packages/torch2trt-0.3.0-py3.7.egg/torch2trt/torch2trt.py\", line 300, in wrapper\r\n    converter[\"converter\"](ctx)\r\n  File \"/export/anaconda3/lib/python3.7/site-packages/torch2trt-0.3.0-py3.7.egg/torch2trt/converters/max.py\", line 33, in convert_max\r\n    __convert_max_reduce(ctx)\r\n  File \"/export/anaconda3/lib/python3.7/site-packages/torch2trt-0.3.0-py3.7.egg/torch2trt/converters/max.py\", line 21, in __convert_max_reduce\r\n    output_val = ctx.method_return[0]\r\n  File \"/export/anaconda3/lib/python3.7/site-packages/torch2trt-0.3.0-py3.7.egg/torch2trt/torch2trt.py\", line 291, in wrapper\r\n    outputs = method(*args, **kwargs)\r\nIndexError: invalid index of a 0-dim tensor. Use `tensor.item()` in Python or `tensor.item<T>()` in C++ to convert a 0-dim tensor to a number\r\n\r\n```\r\n\r\nThis error is also from the mask code, it seems the ONNX to TRT error and the torch2trt error are from the same part.\r\n\r\nThis dynamically generated mask is a must for our model because of the dynamic predicted decoder length.\r\nHow could we solve this issue?\r\n\r\nIt seems TRT does not support the torch.arange function?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/997323743/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1100843542",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9853#issuecomment-1100843542",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9853",
        "id": 1100843542,
        "node_id": "IC_kwDOCVq1mM5BnYoW",
        "user": {
            "login": "stale[bot]",
            "id": 26384082,
            "node_id": "MDM6Qm90MjYzODQwODI=",
            "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stale%5Bbot%5D",
            "html_url": "https://github.com/apps/stale",
            "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
            "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
            "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
            "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
            "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
            "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
            "type": "Bot",
            "site_admin": false
        },
        "created_at": "2022-04-17T09:53:44Z",
        "updated_at": "2022-04-17T09:53:44Z",
        "author_association": "NONE",
        "body": "This issue has been automatically marked as stale due to inactivity and will be closed in 7 days if no further activity occurs. If further support is needed, please provide an update and/or more details.\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1100843542/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]