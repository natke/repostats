[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/941869985",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9334#issuecomment-941869985",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9334",
        "id": 941869985,
        "node_id": "IC_kwDOCVq1mM44I8uh",
        "user": {
            "login": "gramalingam",
            "id": 10075881,
            "node_id": "MDQ6VXNlcjEwMDc1ODgx",
            "avatar_url": "https://avatars.githubusercontent.com/u/10075881?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/gramalingam",
            "html_url": "https://github.com/gramalingam",
            "followers_url": "https://api.github.com/users/gramalingam/followers",
            "following_url": "https://api.github.com/users/gramalingam/following{/other_user}",
            "gists_url": "https://api.github.com/users/gramalingam/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/gramalingam/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/gramalingam/subscriptions",
            "organizations_url": "https://api.github.com/users/gramalingam/orgs",
            "repos_url": "https://api.github.com/users/gramalingam/repos",
            "events_url": "https://api.github.com/users/gramalingam/events{/privacy}",
            "received_events_url": "https://api.github.com/users/gramalingam/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-10-13T03:00:27Z",
        "updated_at": "2021-10-13T03:00:27Z",
        "author_association": "MEMBER",
        "body": "I think loops over elements of a tensor won't produce good performance. It would be better to express the computation in terms of tensor operations. Is alignment initialized to zeros in the beginning in the above example? Also, it is unclear what its middle dimension is (I assume it must be the max-of-sum-of-durations?). I think the code could be rewritten as below using tensor operations. I assumed durations are all int32s here. If it is float, some adjustment may be required to account for the float-int cast:\r\n```py\r\ndef create_alignment2(alignment, duration):\r\n    N, M, L = alignment.shape\r\n    k_end = torch.cumsum(duration, dim=1)\r\n    k_start = k_end - duration\r\n    k = torch.arange(0, M).reshape(M,1,1)\r\n    result_mnl = torch.logical_and(k >= k_start, k < k_end)\r\n    result = torch.transpose(result_mnl, 0, 1)\r\n    return result.type(torch.int32)\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/941869985/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/943271428",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9334#issuecomment-943271428",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9334",
        "id": 943271428,
        "node_id": "IC_kwDOCVq1mM44OS4E",
        "user": {
            "login": "weixsong",
            "id": 7642350,
            "node_id": "MDQ6VXNlcjc2NDIzNTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7642350?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/weixsong",
            "html_url": "https://github.com/weixsong",
            "followers_url": "https://api.github.com/users/weixsong/followers",
            "following_url": "https://api.github.com/users/weixsong/following{/other_user}",
            "gists_url": "https://api.github.com/users/weixsong/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/weixsong/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/weixsong/subscriptions",
            "organizations_url": "https://api.github.com/users/weixsong/orgs",
            "repos_url": "https://api.github.com/users/weixsong/repos",
            "events_url": "https://api.github.com/users/weixsong/events{/privacy}",
            "received_events_url": "https://api.github.com/users/weixsong/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-10-14T11:33:38Z",
        "updated_at": "2021-10-14T11:33:38Z",
        "author_association": "NONE",
        "body": "> I think loops over elements of a tensor won't produce good performance. It would be better to express the computation in terms of tensor operations. Is alignment initialized to zeros in the beginning in the above example? Also, it is unclear what its middle dimension is (I assume it must be the max-of-sum-of-durations?). I think the code could be rewritten as below using tensor operations. I assumed durations are all int32s here. If it is float, some adjustment may be required to account for the float-int cast:\r\n> \r\n> ```python\r\n> def create_alignment2(alignment, duration):\r\n>     N, M, L = alignment.shape\r\n>     k_end = torch.cumsum(duration, dim=1)\r\n>     k_start = k_end - duration\r\n>     k = torch.arange(0, M).reshape(M,1,1)\r\n>     result_mnl = torch.logical_and(k >= k_start, k < k_end)\r\n>     result = torch.transpose(result_mnl, 0, 1)\r\n>     return result.type(torch.int32)\r\n> ```\r\n\r\nThanks very much. I will try it.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/943271428/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/946435727",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9334#issuecomment-946435727",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9334",
        "id": 946435727,
        "node_id": "IC_kwDOCVq1mM44aXaP",
        "user": {
            "login": "weixsong",
            "id": 7642350,
            "node_id": "MDQ6VXNlcjc2NDIzNTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7642350?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/weixsong",
            "html_url": "https://github.com/weixsong",
            "followers_url": "https://api.github.com/users/weixsong/followers",
            "following_url": "https://api.github.com/users/weixsong/following{/other_user}",
            "gists_url": "https://api.github.com/users/weixsong/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/weixsong/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/weixsong/subscriptions",
            "organizations_url": "https://api.github.com/users/weixsong/orgs",
            "repos_url": "https://api.github.com/users/weixsong/repos",
            "events_url": "https://api.github.com/users/weixsong/events{/privacy}",
            "received_events_url": "https://api.github.com/users/weixsong/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-10-19T07:23:23Z",
        "updated_at": "2021-10-19T07:23:23Z",
        "author_association": "NONE",
        "body": "> > I think loops over elements of a tensor won't produce good performance. It would be better to express the computation in terms of tensor operations. Is alignment initialized to zeros in the beginning in the above example? Also, it is unclear what its middle dimension is (I assume it must be the max-of-sum-of-durations?). I think the code could be rewritten as below using tensor operations. I assumed durations are all int32s here. If it is float, some adjustment may be required to account for the float-int cast:\r\n> > ```python\r\n> > def create_alignment2(alignment, duration):\r\n> >     N, M, L = alignment.shape\r\n> >     k_end = torch.cumsum(duration, dim=1)\r\n> >     k_start = k_end - duration\r\n> >     k = torch.arange(0, M).reshape(M,1,1)\r\n> >     result_mnl = torch.logical_and(k >= k_start, k < k_end)\r\n> >     result = torch.transpose(result_mnl, 0, 1)\r\n> >     return result.type(torch.int32)\r\n> > ```\r\n> \r\n> Thanks very much. I will try it.\r\n\r\nThanks, this tensor ops works. it solved the performance issue. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/946435727/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]