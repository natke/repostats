[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1656039645",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/16889#issuecomment-1656039645",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/16889",
        "id": 1656039645,
        "node_id": "IC_kwDOCVq1mM5itSjd",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-07-28T17:19:07Z",
        "updated_at": "2023-07-28T17:19:07Z",
        "author_association": "MEMBER",
        "body": "I recommend using different engine cache path for different profile like this: https://github.com/microsoft/onnxruntime/blob/21a71d52bd2074b770807b209939ec11e2c64fa7/onnxruntime/python/tools/transformers/models/stable_diffusion/onnxruntime_tensorrt_txt2img.py#L94",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1656039645/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1658718354",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/16889#issuecomment-1658718354",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/16889",
        "id": 1658718354,
        "node_id": "IC_kwDOCVq1mM5i3giS",
        "user": {
            "login": "chilo-ms",
            "id": 54722500,
            "node_id": "MDQ6VXNlcjU0NzIyNTAw",
            "avatar_url": "https://avatars.githubusercontent.com/u/54722500?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/chilo-ms",
            "html_url": "https://github.com/chilo-ms",
            "followers_url": "https://api.github.com/users/chilo-ms/followers",
            "following_url": "https://api.github.com/users/chilo-ms/following{/other_user}",
            "gists_url": "https://api.github.com/users/chilo-ms/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/chilo-ms/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/chilo-ms/subscriptions",
            "organizations_url": "https://api.github.com/users/chilo-ms/orgs",
            "repos_url": "https://api.github.com/users/chilo-ms/repos",
            "events_url": "https://api.github.com/users/chilo-ms/events{/privacy}",
            "received_events_url": "https://api.github.com/users/chilo-ms/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-07-31T16:22:13Z",
        "updated_at": "2023-07-31T16:30:15Z",
        "author_association": "MEMBER",
        "body": "The current TRT EP's logic of using engine cache is if the `trt_engine_cache_enable` is on and there are matching engine/profile cache files in the cache path, TRT EP will load those files.\r\nJust like tianleiwu suggested, could you use different `trt_engine_cache_enable` (meaning maintaining different folders) for different inference session if the ep options are different?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1658718354/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1660908338",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/16889#issuecomment-1660908338",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/16889",
        "id": 1660908338,
        "node_id": "IC_kwDOCVq1mM5i_3My",
        "user": {
            "login": "talmaj-at-hypothetic",
            "id": 104864822,
            "node_id": "U_kgDOBkAcNg",
            "avatar_url": "https://avatars.githubusercontent.com/u/104864822?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/talmaj-at-hypothetic",
            "html_url": "https://github.com/talmaj-at-hypothetic",
            "followers_url": "https://api.github.com/users/talmaj-at-hypothetic/followers",
            "following_url": "https://api.github.com/users/talmaj-at-hypothetic/following{/other_user}",
            "gists_url": "https://api.github.com/users/talmaj-at-hypothetic/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/talmaj-at-hypothetic/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/talmaj-at-hypothetic/subscriptions",
            "organizations_url": "https://api.github.com/users/talmaj-at-hypothetic/orgs",
            "repos_url": "https://api.github.com/users/talmaj-at-hypothetic/repos",
            "events_url": "https://api.github.com/users/talmaj-at-hypothetic/events{/privacy}",
            "received_events_url": "https://api.github.com/users/talmaj-at-hypothetic/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-08-01T18:58:58Z",
        "updated_at": "2023-08-01T19:00:27Z",
        "author_association": "NONE",
        "body": "I am keeping the same ep options. This part is basically narrowing down / debugging the problem:\r\n\r\n> If I first build the cache with dynamic shapes and in the next inference do not define the trt_profile shapes, then the cache is used.\r\n\r\n- If I keep the same **ep options without dynamic shapes** it rebuilds cache for each different dynamic input. \r\n- If I keep the same **ep options with dynamic shapes** it also always rebuilds the cache, even for the same dynamic input.\r\n- If I first build cache with dynamic shapes and then switch off the dynamic shapes, then it always loads the cache for predefined shapes.\r\n\r\nSo we would want the last behaviour with **ep options with dynamic shapes** always on.\r\n\r\nDoes that make it clearer?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1660908338/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1661067547",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/16889#issuecomment-1661067547",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/16889",
        "id": 1661067547,
        "node_id": "IC_kwDOCVq1mM5jAeEb",
        "user": {
            "login": "chilo-ms",
            "id": 54722500,
            "node_id": "MDQ6VXNlcjU0NzIyNTAw",
            "avatar_url": "https://avatars.githubusercontent.com/u/54722500?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/chilo-ms",
            "html_url": "https://github.com/chilo-ms",
            "followers_url": "https://api.github.com/users/chilo-ms/followers",
            "following_url": "https://api.github.com/users/chilo-ms/following{/other_user}",
            "gists_url": "https://api.github.com/users/chilo-ms/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/chilo-ms/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/chilo-ms/subscriptions",
            "organizations_url": "https://api.github.com/users/chilo-ms/orgs",
            "repos_url": "https://api.github.com/users/chilo-ms/repos",
            "events_url": "https://api.github.com/users/chilo-ms/events{/privacy}",
            "received_events_url": "https://api.github.com/users/chilo-ms/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-08-01T20:45:45Z",
        "updated_at": "2023-08-01T21:04:13Z",
        "author_association": "MEMBER",
        "body": "> * If I keep the same **ep options with dynamic shapes** it also always rebuilds the cache, even for the same dynamic input.\r\n\r\nThis behavior is weird, the engine cache shouldn't be rebuilt if the dynamic input is the same across inference runs. Could you turn on the verbose mode and share the log? Or could you share the model so that I can try to repro. \r\n \r\n> * If I first build cache with dynamic shapes and then switch off the dynamic shapes, then it always loads the cache for predefined shapes.\r\n\r\nWhat do you mean by switching off the dynamic shapes? \r\nDoes it mean not providing the trt_profile_xxx_shapes ep options? If so, the result you were seeing is expected.\r\nThe engine cache built in the first inference run has the associated shape ranges for each dynamic input stored in the xxxxx.profile, and for the second inference run, TRT EP will compare the current input shape with the ones that in the xxxx.profile and found it was in the range, so TRT EP won't rebuild the engine and will use the cache directly. Only if the shape of current input is out of range, TRT EP will rebuild the engine.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1661067547/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]