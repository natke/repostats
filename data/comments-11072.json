[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1084790858",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11072#issuecomment-1084790858",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11072",
        "id": 1084790858,
        "node_id": "IC_kwDOCVq1mM5AqJhK",
        "user": {
            "login": "reuben",
            "id": 477142,
            "node_id": "MDQ6VXNlcjQ3NzE0Mg==",
            "avatar_url": "https://avatars.githubusercontent.com/u/477142?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/reuben",
            "html_url": "https://github.com/reuben",
            "followers_url": "https://api.github.com/users/reuben/followers",
            "following_url": "https://api.github.com/users/reuben/following{/other_user}",
            "gists_url": "https://api.github.com/users/reuben/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/reuben/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/reuben/subscriptions",
            "organizations_url": "https://api.github.com/users/reuben/orgs",
            "repos_url": "https://api.github.com/users/reuben/repos",
            "events_url": "https://api.github.com/users/reuben/events{/privacy}",
            "received_events_url": "https://api.github.com/users/reuben/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-03-31T16:05:41Z",
        "updated_at": "2022-03-31T16:05:41Z",
        "author_association": "NONE",
        "body": "Sorry, accidentally clicked \"Submit\" before I finished writing up the report. For any email viewers, the first comment has been completed with more info, script to reproduce, etc.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1084790858/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1084866856",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11072#issuecomment-1084866856",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11072",
        "id": 1084866856,
        "node_id": "IC_kwDOCVq1mM5AqcEo",
        "user": {
            "login": "reuben",
            "id": 477142,
            "node_id": "MDQ6VXNlcjQ3NzE0Mg==",
            "avatar_url": "https://avatars.githubusercontent.com/u/477142?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/reuben",
            "html_url": "https://github.com/reuben",
            "followers_url": "https://api.github.com/users/reuben/followers",
            "following_url": "https://api.github.com/users/reuben/following{/other_user}",
            "gists_url": "https://api.github.com/users/reuben/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/reuben/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/reuben/subscriptions",
            "organizations_url": "https://api.github.com/users/reuben/orgs",
            "repos_url": "https://api.github.com/users/reuben/repos",
            "events_url": "https://api.github.com/users/reuben/events{/privacy}",
            "received_events_url": "https://api.github.com/users/reuben/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-03-31T17:08:19Z",
        "updated_at": "2022-03-31T17:08:19Z",
        "author_association": "NONE",
        "body": "I figured out a hacky fix just for my use case. Unfortunately I don't have time right now to clean it up for a proper PR but maybe it's a useful starting point: https://github.com/reuben/onnxruntime/commit/c464245822bc5e2688e2d8b3fef9aa92b8ef0e40",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1084866856/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1084919607",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11072#issuecomment-1084919607",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11072",
        "id": 1084919607,
        "node_id": "IC_kwDOCVq1mM5Aqo83",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-03-31T17:46:52Z",
        "updated_at": "2022-03-31T17:46:52Z",
        "author_association": "MEMBER",
        "body": "There is an option DisableShapeInference to disable the shape inference, which is not required for quantize_dynamic.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1084919607/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1085713711",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11072#issuecomment-1085713711",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11072",
        "id": 1085713711,
        "node_id": "IC_kwDOCVq1mM5Atq0v",
        "user": {
            "login": "mfuntowicz",
            "id": 2241520,
            "node_id": "MDQ6VXNlcjIyNDE1MjA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2241520?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mfuntowicz",
            "html_url": "https://github.com/mfuntowicz",
            "followers_url": "https://api.github.com/users/mfuntowicz/followers",
            "following_url": "https://api.github.com/users/mfuntowicz/following{/other_user}",
            "gists_url": "https://api.github.com/users/mfuntowicz/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mfuntowicz/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mfuntowicz/subscriptions",
            "organizations_url": "https://api.github.com/users/mfuntowicz/orgs",
            "repos_url": "https://api.github.com/users/mfuntowicz/repos",
            "events_url": "https://api.github.com/users/mfuntowicz/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mfuntowicz/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-01T10:10:56Z",
        "updated_at": "2022-04-05T22:58:05Z",
        "author_association": "CONTRIBUTOR",
        "body": "@yufenglee we are observing the same issue with static quantization (QDQ): \r\n\r\n\r\nSetting `use_external_data_format=True` is not sufficient because the error happens before the actual export.\r\n\r\nTested with [XLM-R large](https://huggingface.co/deepset/xlm-roberta-large-squad2)\r\n\r\n```python\r\n    model_str = model if isinstance(model, bytes) else model.SerializeToString()\r\nValueError: Message onnx.ModelProto exceeds maximum protobuf size of 2GB: 2235543724\r\n``` ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1085713711/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1197711143",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11072#issuecomment-1197711143",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11072",
        "id": 1197711143,
        "node_id": "IC_kwDOCVq1mM5HY58n",
        "user": {
            "login": "michaelroyzen",
            "id": 45830328,
            "node_id": "MDQ6VXNlcjQ1ODMwMzI4",
            "avatar_url": "https://avatars.githubusercontent.com/u/45830328?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/michaelroyzen",
            "html_url": "https://github.com/michaelroyzen",
            "followers_url": "https://api.github.com/users/michaelroyzen/followers",
            "following_url": "https://api.github.com/users/michaelroyzen/following{/other_user}",
            "gists_url": "https://api.github.com/users/michaelroyzen/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/michaelroyzen/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/michaelroyzen/subscriptions",
            "organizations_url": "https://api.github.com/users/michaelroyzen/orgs",
            "repos_url": "https://api.github.com/users/michaelroyzen/repos",
            "events_url": "https://api.github.com/users/michaelroyzen/events{/privacy}",
            "received_events_url": "https://api.github.com/users/michaelroyzen/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-28T06:16:29Z",
        "updated_at": "2022-07-28T06:18:03Z",
        "author_association": "NONE",
        "body": "@yufenglee I'm not sure this issue is fixed (tried using the latest onnxruntime-1.12.0 GPU). While disabling shape inference works for quantization, optimization is still broken for saving models such as albert-xxl. The issue seems to be that [write_external_data_tensors](https://github.com/onnx/onnx/blob/529f7cab88eed143fc9f0126147e9732585e4c5e/onnx/__init__.py#L195) isn't actually respecting the condition when it's set to true:\r\n\r\n> Traceback (most recent call last):\r\n  File \"examples/onnxruntime/optimization/question-answering/run_qa.py\", line 525, in <module>\r\n    main()\r\n  File \"examples/onnxruntime/optimization/question-answering/run_qa.py\", line 311, in main\r\n    optimizer.export(\r\n  File \"/home/mroyzen/train_files/optimum/optimum/onnxruntime/optimization.py\", line 149, in export\r\n    optimizer.save_model_to_file(onnx_optimized_model_output_path, use_external_data_format=True)\r\n  File \"/opt/conda/lib/python3.8/site-packages/onnxruntime/transformers/models/gpt2/../../onnx_model.py\", line 934, in save_model_to_file\r\n    save_model(self.model, output_path)\r\n  File \"/opt/conda/lib/python3.8/site-packages/onnx/__init__.py\", line 202, in save_model\r\n    s = _serialize(proto)\r\n  File \"/opt/conda/lib/python3.8/site-packages/onnx/__init__.py\", line 71, in _serialize\r\n    result = proto.SerializeToString()\r\nValueError: Message onnx.ModelProto exceeds maximum protobuf size of 2GB: 2215158499\r\n\r\nYour help would be appreciated. [Linking to my issue](https://github.com/huggingface/optimum/issues/222) in Huggingface's Optimum library, but everything seems to be working on their end as evidenced by the stack trace.\r\n\r\nYour help would be appreciated. Thanks",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1197711143/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]