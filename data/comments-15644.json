[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1520885169",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15644#issuecomment-1520885169",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15644",
        "id": 1520885169,
        "node_id": "IC_kwDOCVq1mM5apt2x",
        "user": {
            "login": "fs-eire",
            "id": 7679871,
            "node_id": "MDQ6VXNlcjc2Nzk4NzE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7679871?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/fs-eire",
            "html_url": "https://github.com/fs-eire",
            "followers_url": "https://api.github.com/users/fs-eire/followers",
            "following_url": "https://api.github.com/users/fs-eire/following{/other_user}",
            "gists_url": "https://api.github.com/users/fs-eire/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/fs-eire/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/fs-eire/subscriptions",
            "organizations_url": "https://api.github.com/users/fs-eire/orgs",
            "repos_url": "https://api.github.com/users/fs-eire/repos",
            "events_url": "https://api.github.com/users/fs-eire/events{/privacy}",
            "received_events_url": "https://api.github.com/users/fs-eire/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-24T22:00:31Z",
        "updated_at": "2023-04-24T22:00:31Z",
        "author_association": "MEMBER",
        "body": "Hi @xenova, thanks for the feedback!\r\n\r\nI did some investigation and found that Safari starts to support fixed-width SIMD for webassembly since v16.4, and because ort-web checks the environment availability and enable SIMD if it's supported in default behavior, so since safari 16.4 it will enable SIMD on iOS. However, Safari does not return correct result when enabled SIMD. To workaround, use this line before creating inference session:\r\n```\r\nort.env.wasm.simd = false;\r\n```\r\nI validated iOS generates correct result in Safari on my iPhone (16.4.1) with SIMD off.\r\n\r\nThe root cause, however, is difficult for to address. So it's possibly lying inside iOS safari implementation (this is more likely, considering chrome/win, chrome/android and safari/mac are all good), or in ORT (the bug may be only triggered on iOS?). It's also far more difficult to debug safari on iOS than debugging onnxruntime.dll on windows.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1520885169/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1520891667",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15644#issuecomment-1520891667",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15644",
        "id": 1520891667,
        "node_id": "IC_kwDOCVq1mM5apvcT",
        "user": {
            "login": "xenova",
            "id": 26504141,
            "node_id": "MDQ6VXNlcjI2NTA0MTQx",
            "avatar_url": "https://avatars.githubusercontent.com/u/26504141?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/xenova",
            "html_url": "https://github.com/xenova",
            "followers_url": "https://api.github.com/users/xenova/followers",
            "following_url": "https://api.github.com/users/xenova/following{/other_user}",
            "gists_url": "https://api.github.com/users/xenova/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/xenova/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/xenova/subscriptions",
            "organizations_url": "https://api.github.com/users/xenova/orgs",
            "repos_url": "https://api.github.com/users/xenova/repos",
            "events_url": "https://api.github.com/users/xenova/events{/privacy}",
            "received_events_url": "https://api.github.com/users/xenova/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-24T22:06:52Z",
        "updated_at": "2023-04-24T22:06:52Z",
        "author_association": "NONE",
        "body": "Thanks for the response! Okay, that seems like a simple-enough fix. \r\n\r\nI assume that disabling simd globally will negatively impact performance for other non-iOS clients, correct? If that's the case, I'll add a check for iOS (based on user-agent or something) and disable simd only on affected devices.\r\n\r\nDo you think this will be detectable/fixable in later releases of onnxruntime-web?\r\n\r\n> It's also far more difficult to debug safari on iOS than debugging onnxruntime.dll on windows.\r\n\r\n100% agreed! That's why it took so long for me to figure out that something was wrong.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1520891667/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1520898344",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15644#issuecomment-1520898344",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15644",
        "id": 1520898344,
        "node_id": "IC_kwDOCVq1mM5apxEo",
        "user": {
            "login": "fs-eire",
            "id": 7679871,
            "node_id": "MDQ6VXNlcjc2Nzk4NzE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7679871?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/fs-eire",
            "html_url": "https://github.com/fs-eire",
            "followers_url": "https://api.github.com/users/fs-eire/followers",
            "following_url": "https://api.github.com/users/fs-eire/following{/other_user}",
            "gists_url": "https://api.github.com/users/fs-eire/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/fs-eire/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/fs-eire/subscriptions",
            "organizations_url": "https://api.github.com/users/fs-eire/orgs",
            "repos_url": "https://api.github.com/users/fs-eire/repos",
            "events_url": "https://api.github.com/users/fs-eire/events{/privacy}",
            "received_events_url": "https://api.github.com/users/fs-eire/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-24T22:15:17Z",
        "updated_at": "2023-04-24T22:15:17Z",
        "author_association": "MEMBER",
        "body": "> I assume that disabling simd globally will negatively impact performance for other non-iOS clients, correct? \r\n\r\nYes. please only check whether it's iOS or not to disable SIMD.\r\n\r\nAlso, if you happened to validate multiple models and found that iOS safari works with SIMD on some models and some not, I can also take a closer look at the models and try if I can find why the issue occurs.\r\n> Do you think this will be detectable/fixable in later releases of onnxruntime-web?\r\n\r\nI am not an iOS expert, so I need help on investigating the issue to narrow down to the root cause. If we know it's why and where, then I can submit a fix for it. I'm out of idea for the investigation of this issue.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1520898344/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1520952188",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15644#issuecomment-1520952188",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15644",
        "id": 1520952188,
        "node_id": "IC_kwDOCVq1mM5ap-N8",
        "user": {
            "login": "xenova",
            "id": 26504141,
            "node_id": "MDQ6VXNlcjI2NTA0MTQx",
            "avatar_url": "https://avatars.githubusercontent.com/u/26504141?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/xenova",
            "html_url": "https://github.com/xenova",
            "followers_url": "https://api.github.com/users/xenova/followers",
            "following_url": "https://api.github.com/users/xenova/following{/other_user}",
            "gists_url": "https://api.github.com/users/xenova/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/xenova/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/xenova/subscriptions",
            "organizations_url": "https://api.github.com/users/xenova/orgs",
            "repos_url": "https://api.github.com/users/xenova/repos",
            "events_url": "https://api.github.com/users/xenova/events{/privacy}",
            "received_events_url": "https://api.github.com/users/xenova/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-24T23:35:26Z",
        "updated_at": "2023-04-24T23:35:54Z",
        "author_association": "NONE",
        "body": "I ran some more tests, and the problems occurred with every model tested, including [t5](https://huggingface.co/Xenova/transformers.js/tree/main/quantized/t5-small/seq2seq-lm-with-past) (translation) and [whisper](https://huggingface.co/Xenova/transformers.js/tree/main/quantized/openai/whisper-small.en/speech2seq-lm-with-past) (speech-to-text). Fortunately, disabling SIMD fixes all cases.\r\n\r\nFor anyone else reading, here is the code I added:\r\n```js\r\nimport ONNX from 'onnxruntime-web';\r\n\r\n// ...\r\n\r\nconst isIOS = typeof navigator !== 'undefined' && /iP(hone|od|ad)/.test(navigator.userAgent);\r\nif (isIOS) {\r\n    ONNX.env.wasm.simd = false;\r\n}\r\n```\r\n\r\n@fs-eire Feel free to close the issue if you'd like. Otherwise, it can be closed when a proper fix has been implemented.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1520952188/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1572563441",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15644#issuecomment-1572563441",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15644",
        "id": 1572563441,
        "node_id": "IC_kwDOCVq1mM5du2nx",
        "user": {
            "login": "guschmue",
            "id": 22941064,
            "node_id": "MDQ6VXNlcjIyOTQxMDY0",
            "avatar_url": "https://avatars.githubusercontent.com/u/22941064?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/guschmue",
            "html_url": "https://github.com/guschmue",
            "followers_url": "https://api.github.com/users/guschmue/followers",
            "following_url": "https://api.github.com/users/guschmue/following{/other_user}",
            "gists_url": "https://api.github.com/users/guschmue/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/guschmue/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/guschmue/subscriptions",
            "organizations_url": "https://api.github.com/users/guschmue/orgs",
            "repos_url": "https://api.github.com/users/guschmue/repos",
            "events_url": "https://api.github.com/users/guschmue/events{/privacy}",
            "received_events_url": "https://api.github.com/users/guschmue/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-06-01T18:16:32Z",
        "updated_at": "2023-06-01T18:16:32Z",
        "author_association": "MEMBER",
        "body": "we are checking for simd here:\r\nhttps://github.com/microsoft/onnxruntime/blob/main/js/web/lib/wasm/wasm-factory.ts#L50\r\nnot sure why this doesn't seem to be working on ios but I ran into the same with whisper.\r\nOdd, if it doesn't support simd it should be crashing on the instruction.\r\nI can poke around a little but have no good ios dev setup.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1572563441/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1593906638",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15644#issuecomment-1593906638",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15644",
        "id": 1593906638,
        "node_id": "IC_kwDOCVq1mM5fARXO",
        "user": {
            "login": "FrostKiwi",
            "id": 60887273,
            "node_id": "MDQ6VXNlcjYwODg3Mjcz",
            "avatar_url": "https://avatars.githubusercontent.com/u/60887273?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/FrostKiwi",
            "html_url": "https://github.com/FrostKiwi",
            "followers_url": "https://api.github.com/users/FrostKiwi/followers",
            "following_url": "https://api.github.com/users/FrostKiwi/following{/other_user}",
            "gists_url": "https://api.github.com/users/FrostKiwi/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/FrostKiwi/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/FrostKiwi/subscriptions",
            "organizations_url": "https://api.github.com/users/FrostKiwi/orgs",
            "repos_url": "https://api.github.com/users/FrostKiwi/repos",
            "events_url": "https://api.github.com/users/FrostKiwi/events{/privacy}",
            "received_events_url": "https://api.github.com/users/FrostKiwi/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-06-16T01:06:37Z",
        "updated_at": "2023-06-16T01:07:52Z",
        "author_association": "NONE",
        "body": "Having the same('ish?) problem with things going up in flames on iOS devices, when enabling SIMD. Reported in https://github.com/recp/cglm/issues/312 and https://github.com/emscripten-core/emscripten/issues/19619.\r\nGarbage float values on `iPhone SE, iOS 16.4.1`, `iPhone Xs, iOS 16.5`.\r\n\r\n@gottfriedleibniz found the connection to this issue. Version numbers seem to be a perfect match with 16.4 being identified as the reason in this issue. I'll create a minimal crashing buggy version over the weekend.\r\n\r\nNot fitting the version numbers on this issue, is the WebApp having a hardcrash on `iPad 9th gen, iOS 16.3.1` though. So maybe that's unrelated(?).",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1593906638/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1615219929",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15644#issuecomment-1615219929",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15644",
        "id": 1615219929,
        "node_id": "IC_kwDOCVq1mM5gRkzZ",
        "user": {
            "login": "xenova",
            "id": 26504141,
            "node_id": "MDQ6VXNlcjI2NTA0MTQx",
            "avatar_url": "https://avatars.githubusercontent.com/u/26504141?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/xenova",
            "html_url": "https://github.com/xenova",
            "followers_url": "https://api.github.com/users/xenova/followers",
            "following_url": "https://api.github.com/users/xenova/following{/other_user}",
            "gists_url": "https://api.github.com/users/xenova/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/xenova/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/xenova/subscriptions",
            "organizations_url": "https://api.github.com/users/xenova/orgs",
            "repos_url": "https://api.github.com/users/xenova/repos",
            "events_url": "https://api.github.com/users/xenova/events{/privacy}",
            "received_events_url": "https://api.github.com/users/xenova/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-06-30T21:41:36Z",
        "updated_at": "2023-06-30T21:41:36Z",
        "author_association": "NONE",
        "body": "@guschmue A user of the transformers.js library recently reported that the problem seems to be resolved on later versions of iOS (>=16.5.1). The only mention of this I can see from iOS/webkit release notes is [here](https://webkit.org/blog/14154/webkit-features-in-safari-16-5/#:~:text=Fixed%20WASM%20SIMD%20breaking%20WebP%20decoding%20applications), where they mention that they \"Fixed WASM SIMD breaking WebP decoding applications.\" in 16.5.\r\n\r\nSo, overall, I don't think this was an issue specific to onnxruntime-web (unless your feature detection code is somehow to blame, which considering the bug fix they listed, seems to be unlikely). @fs-eire Feel free to close this issue if needed.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1615219929/reactions",
            "total_count": 2,
            "+1": 2,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1615278771",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15644#issuecomment-1615278771",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15644",
        "id": 1615278771,
        "node_id": "IC_kwDOCVq1mM5gRzKz",
        "user": {
            "login": "guschmue",
            "id": 22941064,
            "node_id": "MDQ6VXNlcjIyOTQxMDY0",
            "avatar_url": "https://avatars.githubusercontent.com/u/22941064?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/guschmue",
            "html_url": "https://github.com/guschmue",
            "followers_url": "https://api.github.com/users/guschmue/followers",
            "following_url": "https://api.github.com/users/guschmue/following{/other_user}",
            "gists_url": "https://api.github.com/users/guschmue/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/guschmue/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/guschmue/subscriptions",
            "organizations_url": "https://api.github.com/users/guschmue/orgs",
            "repos_url": "https://api.github.com/users/guschmue/repos",
            "events_url": "https://api.github.com/users/guschmue/events{/privacy}",
            "received_events_url": "https://api.github.com/users/guschmue/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-06-30T23:41:38Z",
        "updated_at": "2023-06-30T23:41:38Z",
        "author_association": "MEMBER",
        "body": "ok, let me verify.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1615278771/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1626254942",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15644#issuecomment-1626254942",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15644",
        "id": 1626254942,
        "node_id": "IC_kwDOCVq1mM5g7q5e",
        "user": {
            "login": "guschmue",
            "id": 22941064,
            "node_id": "MDQ6VXNlcjIyOTQxMDY0",
            "avatar_url": "https://avatars.githubusercontent.com/u/22941064?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/guschmue",
            "html_url": "https://github.com/guschmue",
            "followers_url": "https://api.github.com/users/guschmue/followers",
            "following_url": "https://api.github.com/users/guschmue/following{/other_user}",
            "gists_url": "https://api.github.com/users/guschmue/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/guschmue/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/guschmue/subscriptions",
            "organizations_url": "https://api.github.com/users/guschmue/orgs",
            "repos_url": "https://api.github.com/users/guschmue/repos",
            "events_url": "https://api.github.com/users/guschmue/events{/privacy}",
            "received_events_url": "https://api.github.com/users/guschmue/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-07-07T22:07:33Z",
        "updated_at": "2023-07-07T22:07:33Z",
        "author_association": "MEMBER",
        "body": "yeap, works fine for me on 16.5.1. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1626254942/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]