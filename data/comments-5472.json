[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/707866393",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/5472#issuecomment-707866393",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/5472",
        "id": 707866393,
        "node_id": "MDEyOklzc3VlQ29tbWVudDcwNzg2NjM5Mw==",
        "user": {
            "login": "tracysh",
            "id": 42477615,
            "node_id": "MDQ6VXNlcjQyNDc3NjE1",
            "avatar_url": "https://avatars.githubusercontent.com/u/42477615?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tracysh",
            "html_url": "https://github.com/tracysh",
            "followers_url": "https://api.github.com/users/tracysh/followers",
            "following_url": "https://api.github.com/users/tracysh/following{/other_user}",
            "gists_url": "https://api.github.com/users/tracysh/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tracysh/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tracysh/subscriptions",
            "organizations_url": "https://api.github.com/users/tracysh/orgs",
            "repos_url": "https://api.github.com/users/tracysh/repos",
            "events_url": "https://api.github.com/users/tracysh/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tracysh/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-10-13T16:38:16Z",
        "updated_at": "2020-10-13T16:38:16Z",
        "author_association": "CONTRIBUTOR",
        "body": "You're likely hitting a problem with denormals. PR #5391 is addressing the problem. My understanding is that PyTorch should have the same slowdown unless torch.set_flush_denormal(true) is called.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/707866393/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/707968133",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/5472#issuecomment-707968133",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/5472",
        "id": 707968133,
        "node_id": "MDEyOklzc3VlQ29tbWVudDcwNzk2ODEzMw==",
        "user": {
            "login": "addisonklinke",
            "id": 39926682,
            "node_id": "MDQ6VXNlcjM5OTI2Njgy",
            "avatar_url": "https://avatars.githubusercontent.com/u/39926682?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/addisonklinke",
            "html_url": "https://github.com/addisonklinke",
            "followers_url": "https://api.github.com/users/addisonklinke/followers",
            "following_url": "https://api.github.com/users/addisonklinke/following{/other_user}",
            "gists_url": "https://api.github.com/users/addisonklinke/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/addisonklinke/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/addisonklinke/subscriptions",
            "organizations_url": "https://api.github.com/users/addisonklinke/orgs",
            "repos_url": "https://api.github.com/users/addisonklinke/repos",
            "events_url": "https://api.github.com/users/addisonklinke/events{/privacy}",
            "received_events_url": "https://api.github.com/users/addisonklinke/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-10-13T19:45:52Z",
        "updated_at": "2020-10-13T19:45:52Z",
        "author_association": "NONE",
        "body": "@tracysh Thank you for the pointer! I would have spent much longer debugging other potential causes without it. For others stumbling on this, you can use snippet below to determine whether your pretrained weights contain any denormals \r\n\r\n```\r\nimport torch\r\n\r\ncheckpoint = torch.load('/path/to/pretrain.pth')\r\ndenormal = []\r\nfor k, v in checkpoint.items():\r\n    denorms = (v != 0) & (v.abs() < 1.e-32)\r\n    if denorms.sum() > 0:\r\n        denormal.append(k)\r\nprint(f'{len(denormal)} / {len(checkpoint.values())} denormal weights')\r\n```\r\n\r\nFollowing the suggestion on this PyTorch forum [thread](https://discuss.pytorch.org/t/conv2d-is-very-slow-on-trained-weights-vs-random-weights/43377/2), I added `torch.set_flush_denormal(True)` to the top of my ONNX export script and now the pretrained model is running at the expected inference speed",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/707968133/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]