[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1156514136",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11856#issuecomment-1156514136",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11856",
        "id": 1156514136,
        "node_id": "IC_kwDOCVq1mM5E7wFY",
        "user": {
            "login": "wjj19950828",
            "id": 19977378,
            "node_id": "MDQ6VXNlcjE5OTc3Mzc4",
            "avatar_url": "https://avatars.githubusercontent.com/u/19977378?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/wjj19950828",
            "html_url": "https://github.com/wjj19950828",
            "followers_url": "https://api.github.com/users/wjj19950828/followers",
            "following_url": "https://api.github.com/users/wjj19950828/following{/other_user}",
            "gists_url": "https://api.github.com/users/wjj19950828/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/wjj19950828/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/wjj19950828/subscriptions",
            "organizations_url": "https://api.github.com/users/wjj19950828/orgs",
            "repos_url": "https://api.github.com/users/wjj19950828/repos",
            "events_url": "https://api.github.com/users/wjj19950828/events{/privacy}",
            "received_events_url": "https://api.github.com/users/wjj19950828/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-15T14:01:15Z",
        "updated_at": "2022-06-15T14:13:27Z",
        "author_association": "NONE",
        "body": "this is my onnx model for ernie-3.0\r\n<img width=\"551\" alt=\"image\" src=\"https://user-images.githubusercontent.com/19977378/173846253-a3a54f1c-e497-45f2-b92a-f202881f0198.png\">\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1156514136/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1157341202",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11856#issuecomment-1157341202",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11856",
        "id": 1157341202,
        "node_id": "IC_kwDOCVq1mM5E-6AS",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-16T07:42:49Z",
        "updated_at": "2022-06-16T08:10:56Z",
        "author_association": "MEMBER",
        "body": "For example, when we match an edge (Source -> Destination) between two nodes, like the Add ---> MatMul at the top of the above graph. One end of the edge is the first output of Add node, src_arg_index=0 indicates the output index in the source node; At the other end of edge, it is the first input of MatMul node, thus dst_arg_index=0 indicates the input index in the destination node.\r\n\r\nThe C++ matching code is more strict so the coverage could be low. You can also try the python version to see whether Attention could be fused like:\r\n```\r\npython -m onnxruntime.transformers.optimizer --input bert.onnx --output optimized_bert.onnx\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1157341202/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1161759944",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11856#issuecomment-1161759944",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11856",
        "id": 1161759944,
        "node_id": "IC_kwDOCVq1mM5FPwzI",
        "user": {
            "login": "wjj19950828",
            "id": 19977378,
            "node_id": "MDQ6VXNlcjE5OTc3Mzc4",
            "avatar_url": "https://avatars.githubusercontent.com/u/19977378?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/wjj19950828",
            "html_url": "https://github.com/wjj19950828",
            "followers_url": "https://api.github.com/users/wjj19950828/followers",
            "following_url": "https://api.github.com/users/wjj19950828/following{/other_user}",
            "gists_url": "https://api.github.com/users/wjj19950828/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/wjj19950828/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/wjj19950828/subscriptions",
            "organizations_url": "https://api.github.com/users/wjj19950828/orgs",
            "repos_url": "https://api.github.com/users/wjj19950828/repos",
            "events_url": "https://api.github.com/users/wjj19950828/events{/privacy}",
            "received_events_url": "https://api.github.com/users/wjj19950828/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-21T13:36:34Z",
        "updated_at": "2022-06-21T13:46:04Z",
        "author_association": "NONE",
        "body": "@tianleiwu There is one more question I want to ask. In the cpu environment, whether the pass is hit or not, the speed is not much improved（about 5%）, but the gpu will increase by about 20%. Is this normal in cpu(<5%)?\r\n\r\n```code\r\nimport onnxruntime as ort\r\nimport os\r\nimport numpy as np\r\nimport sys\r\nimport pickle\r\nimport time\r\n \r\nmodel_dir = 'model.onnx'\r\ndevice = 'cpu'\r\nnum_threads = 1\r\n \r\nif device == 'cpu':\r\n    providers = ['CPUExecutionProvider']\r\nelse:\r\n    providers = ['CUDAExecutionProvider']\r\n\r\nsess_options = ort.SessionOptions()\r\nsess_options.graph_optimization_level = ort.GraphOptimizationLevel.ORT_ENABLE_EXTENDED\r\nsess_options.optimized_model_filepath = \"optimized_model_cpu_test.onnx\"\r\nsess_options.intra_op_num_threads = num_threads\r\nsess = ort.InferenceSession(\r\n    model_dir,\r\n    sess_options=sess_options,\r\n    providers=providers)\r\ninputs_dict = {}\r\ninput_list = list()\r\nnp.random.seed(6)\r\n\r\nwith open('onnx_inputs.pkl', 'rb') as inp:\r\n    inputs = pickle.load(inp)\r\n\r\nprint(sess.get_inputs()[0].name)\r\ninputs_dict[sess.get_inputs()[0].name] = inputs[\"input_ids\"]\r\nprint(sess.get_inputs()[1].name)\r\ninputs_dict[sess.get_inputs()[1].name] = inputs[\"attention_mask\"]\r\nprint(sess.get_inputs()[2].name)\r\ninputs_dict[sess.get_inputs()[2].name] = inputs[\"token_type_ids\"]\r\n\r\nwarmup_count = 10\r\ncount = 100\r\nfor i in range(warmup_count):\r\n    result = sess.run(None, input_feed=inputs_dict)\r\n\r\nstart = time.time()\r\nfor i in range(count):\r\n    result = sess.run(None, input_feed=inputs_dict)\r\nelapsed_ms = (time.time() - start) * 1000\r\nprint(\"Latency: {:.2f} ms\".format(elapsed_ms / count))\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1161759944/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1165767478",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11856#issuecomment-1165767478",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11856",
        "id": 1165767478,
        "node_id": "IC_kwDOCVq1mM5FfDM2",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-24T17:07:29Z",
        "updated_at": "2022-06-24T17:07:29Z",
        "author_association": "MEMBER",
        "body": "@[wjj19950828](https://github.com/wjj19950828),\r\n`sess_options.intra_op_num_threads = 1` is not good for performance. You can remove the line of the setting, the default value is number of CPU cores.\r\n\r\nFor best performance, you need [IO Binding](https://onnxruntime.ai/docs/api/python/api_summary.html#iobinding) to avoid copying input/output data between CPU and GPU.\r\n\r\nFor execution provider,  you can set providers = ['CUDAExecutionProvider', 'CPUExecutionProvider']. Sometime, it is faster.\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1165767478/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]