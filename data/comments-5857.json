[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/730131808",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/5857#issuecomment-730131808",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/5857",
        "id": 730131808,
        "node_id": "MDEyOklzc3VlQ29tbWVudDczMDEzMTgwOA==",
        "user": {
            "login": "skottmckay",
            "id": 979079,
            "node_id": "MDQ6VXNlcjk3OTA3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/skottmckay",
            "html_url": "https://github.com/skottmckay",
            "followers_url": "https://api.github.com/users/skottmckay/followers",
            "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
            "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
            "organizations_url": "https://api.github.com/users/skottmckay/orgs",
            "repos_url": "https://api.github.com/users/skottmckay/repos",
            "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
            "received_events_url": "https://api.github.com/users/skottmckay/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-11-19T05:05:13Z",
        "updated_at": "2020-11-19T05:05:13Z",
        "author_association": "MEMBER",
        "body": "I believe your 'workaround' is actually using the feature as intended. If you wish to change the value you have to re-bind the input to explicitly copy a new value. We do not and cannot keep track of the original memory location for the data that was copied. We have no control over that location, and have no way of knowing if it still points to something valid. e.g. it could have been a temporary variable that has since been destroyed and that memory has been overwritten by completely unrelated data. \r\n\r\ni.e. the 'binding' is not creating a connection between the original data location and the target location, with a copy between the two each time Run is called. It is doing a one-off copy between the two at the time of binding.\r\n\r\nIOBinding::SynchronizeInputs is for a very specific use case where you may have async copies of multiple inputs going on, and want to block the entire device to be sure those complete prior to execution. This would affect **all** concurrently running requests using that device, so there is significant potential performance impact. At this point I'm not aware of any external use case where it's needed, which is why it's not currently exposed via the API.\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/730131808/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/730144088",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/5857#issuecomment-730144088",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/5857",
        "id": 730144088,
        "node_id": "MDEyOklzc3VlQ29tbWVudDczMDE0NDA4OA==",
        "user": {
            "login": "hendrik-skubch",
            "id": 31203824,
            "node_id": "MDQ6VXNlcjMxMjAzODI0",
            "avatar_url": "https://avatars.githubusercontent.com/u/31203824?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/hendrik-skubch",
            "html_url": "https://github.com/hendrik-skubch",
            "followers_url": "https://api.github.com/users/hendrik-skubch/followers",
            "following_url": "https://api.github.com/users/hendrik-skubch/following{/other_user}",
            "gists_url": "https://api.github.com/users/hendrik-skubch/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/hendrik-skubch/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/hendrik-skubch/subscriptions",
            "organizations_url": "https://api.github.com/users/hendrik-skubch/orgs",
            "repos_url": "https://api.github.com/users/hendrik-skubch/repos",
            "events_url": "https://api.github.com/users/hendrik-skubch/events{/privacy}",
            "received_events_url": "https://api.github.com/users/hendrik-skubch/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-11-19T05:44:42Z",
        "updated_at": "2020-11-19T06:07:02Z",
        "author_association": "NONE",
        "body": "Thank you for your answer!\r\nBut in that case the bindings behave quite differently depending on whether or not a host->device copy has to be made, no?\r\nIn one case the memory is assumed to stay valid, in another it is not. It is also a different behavior to how output bindings work, because output bindings are assumed to stay valid and are copied to. This difference is not apparent in the API nor could I find documentation that points it out.\r\n\r\nAlso this implies that the user has to manage device memory if they want to avoid the repeated allocation, which sadly prevents abstracting away the execution provider. \r\n\r\nAs for synchronizing, conceptionally, at least in cuda, that should only be done for the streams associated with session that is to be run, not for the whole device. I would consider blocking the entire device for any reason a bug by itself.\r\n\r\nEdit: found my bug, now both nuget package and build from source behave the same and except the repeated call to bindings.\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/730144088/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/730564670",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/5857#issuecomment-730564670",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/5857",
        "id": 730564670,
        "node_id": "MDEyOklzc3VlQ29tbWVudDczMDU2NDY3MA==",
        "user": {
            "login": "yuslepukhin",
            "id": 11303988,
            "node_id": "MDQ6VXNlcjExMzAzOTg4",
            "avatar_url": "https://avatars.githubusercontent.com/u/11303988?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yuslepukhin",
            "html_url": "https://github.com/yuslepukhin",
            "followers_url": "https://api.github.com/users/yuslepukhin/followers",
            "following_url": "https://api.github.com/users/yuslepukhin/following{/other_user}",
            "gists_url": "https://api.github.com/users/yuslepukhin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yuslepukhin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yuslepukhin/subscriptions",
            "organizations_url": "https://api.github.com/users/yuslepukhin/orgs",
            "repos_url": "https://api.github.com/users/yuslepukhin/repos",
            "events_url": "https://api.github.com/users/yuslepukhin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yuslepukhin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-11-19T18:43:02Z",
        "updated_at": "2020-11-19T18:43:02Z",
        "author_association": "MEMBER",
        "body": "@hendrik-skubch I suspect you do not need IOBinding. One of the reasons the feature was exposed is to prevent copying if the buffer is already located to where the user wants it to be. If you want otherwise, you do not want to use IOBinding.\r\nAlso it allows full control of the buffer. You do not need to rebind if you want to re-use the same buffers and they stay valid.\r\nYou can also pass feed output to input if you rebind.\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/730564670/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/730736726",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/5857#issuecomment-730736726",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/5857",
        "id": 730736726,
        "node_id": "MDEyOklzc3VlQ29tbWVudDczMDczNjcyNg==",
        "user": {
            "login": "skottmckay",
            "id": 979079,
            "node_id": "MDQ6VXNlcjk3OTA3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/skottmckay",
            "html_url": "https://github.com/skottmckay",
            "followers_url": "https://api.github.com/users/skottmckay/followers",
            "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
            "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
            "organizations_url": "https://api.github.com/users/skottmckay/orgs",
            "repos_url": "https://api.github.com/users/skottmckay/repos",
            "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
            "received_events_url": "https://api.github.com/users/skottmckay/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-11-20T00:58:48Z",
        "updated_at": "2020-11-20T00:58:48Z",
        "author_association": "MEMBER",
        "body": "I don't think the behavior is different depending on whether there is a host->device copy or not. In both cases, at the time of binding, we do the copy. Now in some scenarios the original data may remain 'valid', and the 'copy' is just a shared_ptr update (e.g. input is on CPU and model wants it on CPU), but that is use case specific so is not guaranteed, and validity cannot be assumed. For example, if you do the binding from python a temporary OrtValue may be created from the input, and this does not stay valid, so if the input was from python on CPU, and the model wanted it on GPU, we'd copy from a temporary CPU location to a GPU location. \r\n\r\nThe difference with a bound output is that the device the output is on does not change. There's no 'this may copy to a different device' step.\r\n\r\nYes, if you wanted to avoid the repeated allocation on device you would need to manage device memory. Not sure what you mean by 'abstracting away the execution provider'. \r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/730736726/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/730803576",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/5857#issuecomment-730803576",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/5857",
        "id": 730803576,
        "node_id": "MDEyOklzc3VlQ29tbWVudDczMDgwMzU3Ng==",
        "user": {
            "login": "hendrik-skubch",
            "id": 31203824,
            "node_id": "MDQ6VXNlcjMxMjAzODI0",
            "avatar_url": "https://avatars.githubusercontent.com/u/31203824?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/hendrik-skubch",
            "html_url": "https://github.com/hendrik-skubch",
            "followers_url": "https://api.github.com/users/hendrik-skubch/followers",
            "following_url": "https://api.github.com/users/hendrik-skubch/following{/other_user}",
            "gists_url": "https://api.github.com/users/hendrik-skubch/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/hendrik-skubch/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/hendrik-skubch/subscriptions",
            "organizations_url": "https://api.github.com/users/hendrik-skubch/orgs",
            "repos_url": "https://api.github.com/users/hendrik-skubch/repos",
            "events_url": "https://api.github.com/users/hendrik-skubch/events{/privacy}",
            "received_events_url": "https://api.github.com/users/hendrik-skubch/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-11-20T02:22:39Z",
        "updated_at": "2020-11-20T02:22:39Z",
        "author_association": "NONE",
        "body": "Thank you guys for the insights!\r\n\r\n@yuslepukhin\r\n> You do not need to rebind if you want to re-use the same buffers and they stay valid.\r\nIt seems that is only the case if the buffer is already at right location. \r\n\r\n@skottmckay what I meant was for the most part the user doesn't need to care which execution provider under the hood performs the inference, which is great. However, since the user needs manage device memory, he needs to be aware of the provider. \r\n\r\nSo the intended way to use the API and avoid unnecessary allocations is to either \r\n- use IOBindings with device memory as input and output either on host or device depending on the use case.\r\n- use  `void Run(const RunOptions& run_options, const char* const* input_names, const Value* input_values, size_t input_count, const char* const* output_names, Value* output_values, size_t output_count)` with host memory.\r\nIs that accurate?\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/730803576/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/730822429",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/5857#issuecomment-730822429",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/5857",
        "id": 730822429,
        "node_id": "MDEyOklzc3VlQ29tbWVudDczMDgyMjQyOQ==",
        "user": {
            "login": "skottmckay",
            "id": 979079,
            "node_id": "MDQ6VXNlcjk3OTA3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/skottmckay",
            "html_url": "https://github.com/skottmckay",
            "followers_url": "https://api.github.com/users/skottmckay/followers",
            "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
            "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
            "organizations_url": "https://api.github.com/users/skottmckay/orgs",
            "repos_url": "https://api.github.com/users/skottmckay/repos",
            "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
            "received_events_url": "https://api.github.com/users/skottmckay/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-11-20T03:30:03Z",
        "updated_at": "2020-11-20T03:30:03Z",
        "author_association": "MEMBER",
        "body": "You're free to use Run with device memory. The same logic runs either way - for the Ort.Value input values, see if they're in the correct location, if not copy to the right location prior to running the model. It's just that with IOBinding, if a copy is required, it happens prior to the Run. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/730822429/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]