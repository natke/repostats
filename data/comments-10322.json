[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1016885873",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10322#issuecomment-1016885873",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10322",
        "id": 1016885873,
        "node_id": "IC_kwDOCVq1mM48nHJx",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-01-19T21:31:26Z",
        "updated_at": "2022-01-19T21:31:26Z",
        "author_association": "MEMBER",
        "body": "I think it is expected. The notebook uses dynamic quantization. \r\n\r\nWith/without past state, the input is different. with past state, input_ids has only one token for next iterations; without past state, input_ids has all tokens so far. Dynamic quantization result will depends on inputs, so the result will be different.\r\n\r\nCould you try static quantization instead?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1016885873/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1017330764",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10322#issuecomment-1017330764",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10322",
        "id": 1017330764,
        "node_id": "IC_kwDOCVq1mM48ozxM",
        "user": {
            "login": "smolskayanastassia",
            "id": 73059925,
            "node_id": "MDQ6VXNlcjczMDU5OTI1",
            "avatar_url": "https://avatars.githubusercontent.com/u/73059925?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/smolskayanastassia",
            "html_url": "https://github.com/smolskayanastassia",
            "followers_url": "https://api.github.com/users/smolskayanastassia/followers",
            "following_url": "https://api.github.com/users/smolskayanastassia/following{/other_user}",
            "gists_url": "https://api.github.com/users/smolskayanastassia/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/smolskayanastassia/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/smolskayanastassia/subscriptions",
            "organizations_url": "https://api.github.com/users/smolskayanastassia/orgs",
            "repos_url": "https://api.github.com/users/smolskayanastassia/repos",
            "events_url": "https://api.github.com/users/smolskayanastassia/events{/privacy}",
            "received_events_url": "https://api.github.com/users/smolskayanastassia/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-01-20T10:29:16Z",
        "updated_at": "2022-01-21T19:40:49Z",
        "author_association": "NONE",
        "body": "@tianleiwu  I tried, but I can't to convert it using quantize static\r\n\r\nI just use now several sentences, just for testing\r\nCode:\r\n\r\n```\r\nnum_attention_heads = 12\r\nhidden_size = 768\r\nnum_layer = 6\r\ndevice = \"cpu\"\r\n\r\ndef get_model_input(text, top_k=10):\r\n    encodings_dict = tokenizer.batch_encode_plus([text], padding=True)\r\n    input_ids = torch.tensor(encodings_dict[\"input_ids\"], dtype=torch.int64)\r\n    attention_mask = torch.tensor(encodings_dict[\"attention_mask\"], dtype=torch.float32)\r\n\r\n    position_ids = attention_mask.long().cumsum(-1) - 1\r\n\r\n    position_ids.masked_fill_(position_ids < 0, 0)\r\n\r\n    past_shape = [\r\n        2,\r\n        input_ids.size(0),\r\n        num_attention_heads,\r\n        0,\r\n        hidden_size // num_attention_heads,\r\n    ]\r\n    past = [torch.empty(past_shape).to(device)] * num_layer\r\n    \r\n    model_inputs = {\r\n    \"input_ids\": np.ascontiguousarray(input_ids.cpu().numpy()),\r\n    \"attention_mask\": np.ascontiguousarray(attention_mask.cpu().numpy()),\r\n    \"position_ids\": np.ascontiguousarray(position_ids.cpu().numpy()),\r\n    }\r\n\r\n    for i, past_i in enumerate(past):\r\n        model_inputs[f\"past_{i}\"] = np.ascontiguousarray(past_i.cpu().numpy())\r\n\r\n\r\n    return model_inputs\r\n    \r\n class GPT2CalibrationDataReader(CalibrationDataReader):\r\n    def __init__(self, batch_size=1):\r\n        self._iter = iter([get_model_input(\"Hello\"), get_model_input(\"Hi How are\")])\r\n    \r\n    def get_next(self):\r\n            return next(self._iter, None)\r\n \r\n\r\nsession = onnxruntime.InferenceSession(\"distilgpt2.onnx\")\r\ntokenizer = GPT2Tokenizer.from_pretrained(\"distilgpt2\")\r\ntokenizer.pad_token = tokenizer.eos_token\r\n\r\nquantize_static(\"distilgpt2.onnx\", \"distilgpt2_static.onnx\", GPT2CalibrationDataReader())\r\n```\r\n\r\nError: \r\n![image](https://user-images.githubusercontent.com/73059925/150321375-5be7e52d-589e-4f59-b9f8-ec887689f292.png)\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1017330764/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1018752332",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10322#issuecomment-1018752332",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10322",
        "id": 1018752332,
        "node_id": "IC_kwDOCVq1mM48uO1M",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-01-21T18:20:41Z",
        "updated_at": "2022-01-21T18:20:41Z",
        "author_association": "MEMBER",
        "body": "@yufenglee to take a look at error in static quantization.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1018752332/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1100599260",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10322#issuecomment-1100599260",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10322",
        "id": 1100599260,
        "node_id": "IC_kwDOCVq1mM5Bmc_c",
        "user": {
            "login": "stale[bot]",
            "id": 26384082,
            "node_id": "MDM6Qm90MjYzODQwODI=",
            "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stale%5Bbot%5D",
            "html_url": "https://github.com/apps/stale",
            "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
            "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
            "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
            "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
            "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
            "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
            "type": "Bot",
            "site_admin": false
        },
        "created_at": "2022-04-16T07:54:45Z",
        "updated_at": "2022-04-16T07:54:45Z",
        "author_association": "NONE",
        "body": "This issue has been automatically marked as stale due to inactivity and will be closed in 7 days if no further activity occurs. If further support is needed, please provide an update and/or more details.\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1100599260/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1316443781",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10322#issuecomment-1316443781",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10322",
        "id": 1316443781,
        "node_id": "IC_kwDOCVq1mM5Od1aF",
        "user": {
            "login": "AmitNikhade",
            "id": 66997477,
            "node_id": "MDQ6VXNlcjY2OTk3NDc3",
            "avatar_url": "https://avatars.githubusercontent.com/u/66997477?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/AmitNikhade",
            "html_url": "https://github.com/AmitNikhade",
            "followers_url": "https://api.github.com/users/AmitNikhade/followers",
            "following_url": "https://api.github.com/users/AmitNikhade/following{/other_user}",
            "gists_url": "https://api.github.com/users/AmitNikhade/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/AmitNikhade/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/AmitNikhade/subscriptions",
            "organizations_url": "https://api.github.com/users/AmitNikhade/orgs",
            "repos_url": "https://api.github.com/users/AmitNikhade/repos",
            "events_url": "https://api.github.com/users/AmitNikhade/events{/privacy}",
            "received_events_url": "https://api.github.com/users/AmitNikhade/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-11-16T06:29:27Z",
        "updated_at": "2022-11-16T06:29:27Z",
        "author_association": "NONE",
        "body": "I facing the same issue the onnx model yields incorrect outputs",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1316443781/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1316547776",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10322#issuecomment-1316547776",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10322",
        "id": 1316547776,
        "node_id": "IC_kwDOCVq1mM5OeOzA",
        "user": {
            "login": "trajepl",
            "id": 13343117,
            "node_id": "MDQ6VXNlcjEzMzQzMTE3",
            "avatar_url": "https://avatars.githubusercontent.com/u/13343117?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/trajepl",
            "html_url": "https://github.com/trajepl",
            "followers_url": "https://api.github.com/users/trajepl/followers",
            "following_url": "https://api.github.com/users/trajepl/following{/other_user}",
            "gists_url": "https://api.github.com/users/trajepl/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/trajepl/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/trajepl/subscriptions",
            "organizations_url": "https://api.github.com/users/trajepl/orgs",
            "repos_url": "https://api.github.com/users/trajepl/repos",
            "events_url": "https://api.github.com/users/trajepl/events{/privacy}",
            "received_events_url": "https://api.github.com/users/trajepl/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-11-16T07:56:56Z",
        "updated_at": "2022-11-16T07:56:56Z",
        "author_association": "MEMBER",
        "body": "![image](https://user-images.githubusercontent.com/13343117/202120662-35d377db-d2ee-4ad0-9a5f-81db3882e5ee.png)\r\n\r\n\r\n> @tianleiwu I tried, but I can't to convert it using quantize static\r\n> \r\n> I just use now several sentences, just for testing Code:\r\n> \r\n> ```\r\n> num_attention_heads = 12\r\n> hidden_size = 768\r\n> num_layer = 6\r\n> device = \"cpu\"\r\n> \r\n> def get_model_input(text, top_k=10):\r\n>     encodings_dict = tokenizer.batch_encode_plus([text], padding=True)\r\n>     input_ids = torch.tensor(encodings_dict[\"input_ids\"], dtype=torch.int64)\r\n>     attention_mask = torch.tensor(encodings_dict[\"attention_mask\"], dtype=torch.float32)\r\n> \r\n>     position_ids = attention_mask.long().cumsum(-1) - 1\r\n> \r\n>     position_ids.masked_fill_(position_ids < 0, 0)\r\n> \r\n>     past_shape = [\r\n>         2,\r\n>         input_ids.size(0),\r\n>         num_attention_heads,\r\n>         0,\r\n>         hidden_size // num_attention_heads,\r\n>     ]\r\n>     past = [torch.empty(past_shape).to(device)] * num_layer\r\n>     \r\n>     model_inputs = {\r\n>     \"input_ids\": np.ascontiguousarray(input_ids.cpu().numpy()),\r\n>     \"attention_mask\": np.ascontiguousarray(attention_mask.cpu().numpy()),\r\n>     \"position_ids\": np.ascontiguousarray(position_ids.cpu().numpy()),\r\n>     }\r\n> \r\n>     for i, past_i in enumerate(past):\r\n>         model_inputs[f\"past_{i}\"] = np.ascontiguousarray(past_i.cpu().numpy())\r\n> \r\n> \r\n>     return model_inputs\r\n>     \r\n>  class GPT2CalibrationDataReader(CalibrationDataReader):\r\n>     def __init__(self, batch_size=1):\r\n>         self._iter = iter([get_model_input(\"Hello\"), get_model_input(\"Hi How are\")])\r\n>     \r\n>     def get_next(self):\r\n>             return next(self._iter, None)\r\n>  \r\n> \r\n> session = onnxruntime.InferenceSession(\"distilgpt2.onnx\")\r\n> tokenizer = GPT2Tokenizer.from_pretrained(\"distilgpt2\")\r\n> tokenizer.pad_token = tokenizer.eos_token\r\n> \r\n> quantize_static(\"distilgpt2.onnx\", \"distilgpt2_static.onnx\", GPT2CalibrationDataReader())\r\n> ```\r\n> \r\n> Error: ![image](https://user-images.githubusercontent.com/73059925/150321375-5be7e52d-589e-4f59-b9f8-ec887689f292.png)\r\n\r\n![image](https://user-images.githubusercontent.com/13343117/202120702-b54427d7-c5b1-40cc-887b-73123f224a6f.png)\r\nSimilar errors when it came to static quantization.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1316547776/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1319597291",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/10322#issuecomment-1319597291",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/10322",
        "id": 1319597291,
        "node_id": "IC_kwDOCVq1mM5Op3Tr",
        "user": {
            "login": "AmitNikhade",
            "id": 66997477,
            "node_id": "MDQ6VXNlcjY2OTk3NDc3",
            "avatar_url": "https://avatars.githubusercontent.com/u/66997477?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/AmitNikhade",
            "html_url": "https://github.com/AmitNikhade",
            "followers_url": "https://api.github.com/users/AmitNikhade/followers",
            "following_url": "https://api.github.com/users/AmitNikhade/following{/other_user}",
            "gists_url": "https://api.github.com/users/AmitNikhade/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/AmitNikhade/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/AmitNikhade/subscriptions",
            "organizations_url": "https://api.github.com/users/AmitNikhade/orgs",
            "repos_url": "https://api.github.com/users/AmitNikhade/repos",
            "events_url": "https://api.github.com/users/AmitNikhade/events{/privacy}",
            "received_events_url": "https://api.github.com/users/AmitNikhade/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-11-18T06:18:40Z",
        "updated_at": "2022-11-18T06:18:40Z",
        "author_association": "NONE",
        "body": "Is there any alternative to this?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1319597291/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]