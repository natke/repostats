[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1293991091",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13478#issuecomment-1293991091",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13478",
        "id": 1293991091,
        "node_id": "IC_kwDOCVq1mM5NILyz",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-10-27T19:48:56Z",
        "updated_at": "2022-10-27T19:48:56Z",
        "author_association": "MEMBER",
        "body": "@wejoncy, please help take a look at this issue.\r\n\r\n@EmreOzkose, you can try excluding SoftMax from quantization by specifying op_types_to_quantize to bypass the issue. And for a transformer model, it is recommended to use dynamic_quantize on CPU.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1293991091/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1294278985",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13478#issuecomment-1294278985",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13478",
        "id": 1294278985,
        "node_id": "IC_kwDOCVq1mM5NJSFJ",
        "user": {
            "login": "wejoncy",
            "id": 9417365,
            "node_id": "MDQ6VXNlcjk0MTczNjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/9417365?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/wejoncy",
            "html_url": "https://github.com/wejoncy",
            "followers_url": "https://api.github.com/users/wejoncy/followers",
            "following_url": "https://api.github.com/users/wejoncy/following{/other_user}",
            "gists_url": "https://api.github.com/users/wejoncy/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/wejoncy/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/wejoncy/subscriptions",
            "organizations_url": "https://api.github.com/users/wejoncy/orgs",
            "repos_url": "https://api.github.com/users/wejoncy/repos",
            "events_url": "https://api.github.com/users/wejoncy/events{/privacy}",
            "received_events_url": "https://api.github.com/users/wejoncy/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-10-28T00:55:21Z",
        "updated_at": "2022-10-28T00:55:21Z",
        "author_association": "MEMBER",
        "body": "@EmreOzkose Could you share me the quantized model? Will try to reproduce this issue and fix as soon as possible.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1294278985/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1296572382",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13478#issuecomment-1296572382",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13478",
        "id": 1296572382,
        "node_id": "IC_kwDOCVq1mM5NSB_e",
        "user": {
            "login": "EmreOzkose",
            "id": 17765576,
            "node_id": "MDQ6VXNlcjE3NzY1NTc2",
            "avatar_url": "https://avatars.githubusercontent.com/u/17765576?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/EmreOzkose",
            "html_url": "https://github.com/EmreOzkose",
            "followers_url": "https://api.github.com/users/EmreOzkose/followers",
            "following_url": "https://api.github.com/users/EmreOzkose/following{/other_user}",
            "gists_url": "https://api.github.com/users/EmreOzkose/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/EmreOzkose/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/EmreOzkose/subscriptions",
            "organizations_url": "https://api.github.com/users/EmreOzkose/orgs",
            "repos_url": "https://api.github.com/users/EmreOzkose/repos",
            "events_url": "https://api.github.com/users/EmreOzkose/events{/privacy}",
            "received_events_url": "https://api.github.com/users/EmreOzkose/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-10-31T05:49:07Z",
        "updated_at": "2022-10-31T05:49:07Z",
        "author_association": "NONE",
        "body": "I am sharing onnx file: https://sestek-my.sharepoint.com/:u:/p/yunusemre_ozkose/Ee4JT6Ba0vpJjoIj487hCr0BiWF_DZ0fIdfvkwhJfq5ngA?e=4JHYaA\r\n\r\nMy optimization code is:\r\n```\r\nimport os\r\nimport numpy as np\r\nimport onnxruntime as ort\r\nfrom onnxruntime.quantization import quantize_static, CalibrationDataReader, QuantType, QuantFormat, CalibrationMethod\r\n\r\n\r\nclass WavDataReader(CalibrationDataReader):\r\n    def __init__(self):\r\n        self.preprocess_flag = True\r\n        self.enum_data_dicts = []\r\n\r\n    def get_next(self):\r\n        if self.preprocess_flag:\r\n            self.preprocess_flag = False\r\n            feature = np.random.rand(1, 500, 80).astype('float32')\r\n            feature_len = np.array([500])\r\n            self.enum_data_dicts = iter([{'x': feature, 'x_lens': feature_len}])\r\n\r\n        return next(self.enum_data_dicts, None)\r\n\r\n\r\ninput_model = \"encoder_en.onnx\"\r\nwav_data_reader = WavDataReader()\r\n\r\nprint(ort.__version__)\r\n\r\noutput_qt_model = f\"exported_models/encoder_en_static_qt_rand.onnx\"\r\nquantize_static(input_model,\r\n                output_qt_model,\r\n                wav_data_reader,\r\n                quant_format=QuantFormat.QOperator, # QOperator QDQ\r\n                optimize_model=True,\r\n                activation_type=QuantType.QUInt8,\r\n                weight_type=QuantType.QUInt8,\r\n                calibrate_method=CalibrationMethod.MinMax,\r\n                extra_options={\"ActivationSymmetric\": True, \"WeightSymmetric\": True}\r\n                )\r\n\r\n\r\nprint('ONNX full precision model size (MB):', os.path.getsize(input_model)/(1024*1024))\r\nprint('ONNX quantized model size (MB):', os.path.getsize(output_qt_model)/(1024*1024))\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1296572382/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1296826650",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13478#issuecomment-1296826650",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13478",
        "id": 1296826650,
        "node_id": "IC_kwDOCVq1mM5NTAEa",
        "user": {
            "login": "wejoncy",
            "id": 9417365,
            "node_id": "MDQ6VXNlcjk0MTczNjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/9417365?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/wejoncy",
            "html_url": "https://github.com/wejoncy",
            "followers_url": "https://api.github.com/users/wejoncy/followers",
            "following_url": "https://api.github.com/users/wejoncy/following{/other_user}",
            "gists_url": "https://api.github.com/users/wejoncy/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/wejoncy/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/wejoncy/subscriptions",
            "organizations_url": "https://api.github.com/users/wejoncy/orgs",
            "repos_url": "https://api.github.com/users/wejoncy/repos",
            "events_url": "https://api.github.com/users/wejoncy/events{/privacy}",
            "received_events_url": "https://api.github.com/users/wejoncy/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-10-31T09:31:36Z",
        "updated_at": "2022-11-04T09:32:06Z",
        "author_association": "MEMBER",
        "body": "I got what happened with this issue.\r\n\r\nThe input shape of `Softmax` does be dynamic and can be known at runtime, so it's normal that I get a null_ptr at initializing.\r\n\r\nI have removed the check in Ctor of `softmax`, then it won't be crashed.\r\n\r\n```\r\nfeature = np.random.rand(1, 500, 80).astype('float32')\r\nfeature_len = np.array([500])\r\nenum_data_dicts = {'x': feature, 'x_lens': feature_len}\r\nsess_q = ort.InferenceSession(output_qt_model,providers=['CPUExecutionProvider'])\r\nsess_f = ort.InferenceSession(input_model,providers=['CPUExecutionProvider'])\r\nq_res = sess_q.run([], input_feed=enum_data_dicts)\r\nf_res = sess_f.run([], input_feed=enum_data_dicts)\r\n```\r\nIt runs well, but yufenglee's suggestion of trying to use dynamic quantization may improve the accuracy.\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1296826650/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]