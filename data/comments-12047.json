[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1171643080",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12047#issuecomment-1171643080",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12047",
        "id": 1171643080,
        "node_id": "IC_kwDOCVq1mM5F1drI",
        "user": {
            "login": "wangyems",
            "id": 52801275,
            "node_id": "MDQ6VXNlcjUyODAxMjc1",
            "avatar_url": "https://avatars.githubusercontent.com/u/52801275?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/wangyems",
            "html_url": "https://github.com/wangyems",
            "followers_url": "https://api.github.com/users/wangyems/followers",
            "following_url": "https://api.github.com/users/wangyems/following{/other_user}",
            "gists_url": "https://api.github.com/users/wangyems/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/wangyems/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/wangyems/subscriptions",
            "organizations_url": "https://api.github.com/users/wangyems/orgs",
            "repos_url": "https://api.github.com/users/wangyems/repos",
            "events_url": "https://api.github.com/users/wangyems/events{/privacy}",
            "received_events_url": "https://api.github.com/users/wangyems/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-30T20:25:33Z",
        "updated_at": "2022-06-30T20:26:47Z",
        "author_association": "MEMBER",
        "body": "Hi @HaoboGu, the cached pasts are supported in beam search op - but not in the form of main graph's inputs. This op takes encoder/decoder as subgraphs in node attributes. You can take a look at the definition of the decoders: https://github.com/microsoft/onnxruntime/blob/master/onnxruntime/contrib_ops/cpu/transformers/subgraph_t5_decoder.cc#L25-L31 and https://github.com/microsoft/onnxruntime/blob/master/onnxruntime/contrib_ops/cpu/transformers/subgraph_gpt.cc#L102",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1171643080/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1171848500",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12047#issuecomment-1171848500",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12047",
        "id": 1171848500,
        "node_id": "IC_kwDOCVq1mM5F2P00",
        "user": {
            "login": "HaoboGu",
            "id": 8640918,
            "node_id": "MDQ6VXNlcjg2NDA5MTg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8640918?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/HaoboGu",
            "html_url": "https://github.com/HaoboGu",
            "followers_url": "https://api.github.com/users/HaoboGu/followers",
            "following_url": "https://api.github.com/users/HaoboGu/following{/other_user}",
            "gists_url": "https://api.github.com/users/HaoboGu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/HaoboGu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/HaoboGu/subscriptions",
            "organizations_url": "https://api.github.com/users/HaoboGu/orgs",
            "repos_url": "https://api.github.com/users/HaoboGu/repos",
            "events_url": "https://api.github.com/users/HaoboGu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/HaoboGu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-01T02:09:05Z",
        "updated_at": "2022-07-01T02:09:05Z",
        "author_association": "NONE",
        "body": "@wangyems So if I wanna use cached pasts, I have to write my own `export_beam_search.py`, and then add the cached pasts to graph input, am I right?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1171848500/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1172730977",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12047#issuecomment-1172730977",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12047",
        "id": 1172730977,
        "node_id": "IC_kwDOCVq1mM5F5nRh",
        "user": {
            "login": "wangyems",
            "id": 52801275,
            "node_id": "MDQ6VXNlcjUyODAxMjc1",
            "avatar_url": "https://avatars.githubusercontent.com/u/52801275?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/wangyems",
            "html_url": "https://github.com/wangyems",
            "followers_url": "https://api.github.com/users/wangyems/followers",
            "following_url": "https://api.github.com/users/wangyems/following{/other_user}",
            "gists_url": "https://api.github.com/users/wangyems/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/wangyems/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/wangyems/subscriptions",
            "organizations_url": "https://api.github.com/users/wangyems/orgs",
            "repos_url": "https://api.github.com/users/wangyems/repos",
            "events_url": "https://api.github.com/users/wangyems/events{/privacy}",
            "received_events_url": "https://api.github.com/users/wangyems/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-01T21:40:46Z",
        "updated_at": "2022-07-01T21:40:46Z",
        "author_association": "MEMBER",
        "body": "> @wangyems So if I wanna use cached pasts, I have to write my own `export_beam_search.py`, and then add the cached pasts to graph input, am I right?\r\n\r\nThe current `export_beam_search.py` supports pasts. By running this script you'll get an onnx model with decoder that already containing the past as input.\r\nIf you have a customized gpt2 model, you only need to make sure that the exported decoder onnx has the pasts as inputs. see https://github.com/microsoft/onnxruntime/blob/57ac3d0a612e6117b094fb7ead63658c6f61a3d4/onnxruntime/python/tools/transformers/models/gpt2/gpt2_helper.py#L89",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1172730977/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1172826448",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12047#issuecomment-1172826448",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12047",
        "id": 1172826448,
        "node_id": "IC_kwDOCVq1mM5F5-lQ",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-02T03:44:19Z",
        "updated_at": "2022-07-02T03:48:20Z",
        "author_association": "MEMBER",
        "body": "@[HaoboGu](https://github.com/HaoboGu), past is used in gpt2 beam search. You can observe it when opening the decoder subgraph with Netron tool. The expected inputs for GPT-2 subgraph is like the following:\r\nhttps://github.com/microsoft/onnxruntime/blob/df712d80ca33b56ce7d63ca3acdb6a4888638c58/onnxruntime/python/tools/transformers/convert_beam_search.py#L437\r\n\r\nThe operator will automatically generate empty past for first inference of GPT-2 internally so user need not pass past explicitly.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1172826448/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1173095515",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12047#issuecomment-1173095515",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12047",
        "id": 1173095515,
        "node_id": "IC_kwDOCVq1mM5F7ARb",
        "user": {
            "login": "HaoboGu",
            "id": 8640918,
            "node_id": "MDQ6VXNlcjg2NDA5MTg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8640918?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/HaoboGu",
            "html_url": "https://github.com/HaoboGu",
            "followers_url": "https://api.github.com/users/HaoboGu/followers",
            "following_url": "https://api.github.com/users/HaoboGu/following{/other_user}",
            "gists_url": "https://api.github.com/users/HaoboGu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/HaoboGu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/HaoboGu/subscriptions",
            "organizations_url": "https://api.github.com/users/HaoboGu/orgs",
            "repos_url": "https://api.github.com/users/HaoboGu/repos",
            "events_url": "https://api.github.com/users/HaoboGu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/HaoboGu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-03T13:58:53Z",
        "updated_at": "2022-07-03T14:02:30Z",
        "author_association": "NONE",
        "body": "@tianleiwu yeah, I know the empty past is auto-generated before doing beam search, my current exported model has only those inputs:\r\n```python\r\n     \"input_ids\", \r\n     \"max_length\", \r\n     \"min_length\", \r\n     \"num_beams\", \r\n     \"num_return_sequences\", \r\n     \"length_penalty\", \r\n     \"repetition_penalty\", \r\n```\r\n\r\nWhat I want is making pasts an option input of exported onnx beam search model, so that users can do beam search directly based on cached pasts. The exported model should have inputs as:\r\n```python\r\n     \"input_ids\", \r\n     \"cached_pasts\",  # Added input\r\n     \"max_length\", \r\n     \"min_length\", \r\n     \"num_beams\", \r\n     \"num_return_sequences\", \r\n     \"length_penalty\", \r\n     \"repetition_penalty\", \r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1173095515/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1178349027",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12047#issuecomment-1178349027",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12047",
        "id": 1178349027,
        "node_id": "IC_kwDOCVq1mM5GPC3j",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-07T23:03:49Z",
        "updated_at": "2022-07-07T23:03:49Z",
        "author_association": "MEMBER",
        "body": "@viboga, could you share @HaoboGu the custom operator of beam search.  I think it only need some minor changes for this scenario.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1178349027/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1181134770",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12047#issuecomment-1181134770",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12047",
        "id": 1181134770,
        "node_id": "IC_kwDOCVq1mM5GZq-y",
        "user": {
            "login": "viboga",
            "id": 44417868,
            "node_id": "MDQ6VXNlcjQ0NDE3ODY4",
            "avatar_url": "https://avatars.githubusercontent.com/u/44417868?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/viboga",
            "html_url": "https://github.com/viboga",
            "followers_url": "https://api.github.com/users/viboga/followers",
            "following_url": "https://api.github.com/users/viboga/following{/other_user}",
            "gists_url": "https://api.github.com/users/viboga/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/viboga/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/viboga/subscriptions",
            "organizations_url": "https://api.github.com/users/viboga/orgs",
            "repos_url": "https://api.github.com/users/viboga/repos",
            "events_url": "https://api.github.com/users/viboga/events{/privacy}",
            "received_events_url": "https://api.github.com/users/viboga/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-11T23:58:54Z",
        "updated_at": "2022-07-12T00:00:27Z",
        "author_association": "CONTRIBUTOR",
        "body": "@HaoboGu Currently we are keeping beam search as the most commonly used simple variant (Its loosely based on \r\n[https://github.com/huggingface/transformers/blob/a462fc9232eb9e04f9bc9c710d8c9a3ac21056de/src/transformers/generation_utils.py#L2022-L2136](https://nam06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fhuggingface%2Ftransformers%2Fblob%2Fa462fc9232eb9e04f9bc9c710d8c9a3ac21056de%2Fsrc%2Ftransformers%2Fgeneration_utils.py%23L2022-L2136&data=05%7C01%7CViswanath.Boga%40microsoft.com%7C9200a53d3f804d9463cd08da63968e19%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C637931795521299219%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=At1XbHy5uW%2FRoBYeVhhMuFL7L6pwkjD6uVMBycx%2F%2F4k%3D&reserved=0)). Is there any link you are referring to for your project, is past_key_values support based on a new publication?\r\n\r\nI am working on beam search as custom OP and planning to publish it end of month which can be leveraged for customizations.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1181134770/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1181258045",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12047#issuecomment-1181258045",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12047",
        "id": 1181258045,
        "node_id": "IC_kwDOCVq1mM5GaJE9",
        "user": {
            "login": "HaoboGu",
            "id": 8640918,
            "node_id": "MDQ6VXNlcjg2NDA5MTg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8640918?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/HaoboGu",
            "html_url": "https://github.com/HaoboGu",
            "followers_url": "https://api.github.com/users/HaoboGu/followers",
            "following_url": "https://api.github.com/users/HaoboGu/following{/other_user}",
            "gists_url": "https://api.github.com/users/HaoboGu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/HaoboGu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/HaoboGu/subscriptions",
            "organizations_url": "https://api.github.com/users/HaoboGu/orgs",
            "repos_url": "https://api.github.com/users/HaoboGu/repos",
            "events_url": "https://api.github.com/users/HaoboGu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/HaoboGu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-12T02:57:03Z",
        "updated_at": "2022-07-12T02:58:09Z",
        "author_association": "NONE",
        "body": "@viboga Yeah, our project is based on transformers 4.18.0, which supports past_key_values.\r\n\r\n---- some other suggestions below that you can consider\r\n\r\nBesides pasts, I think a multi-step `prefix_vocab_mask` is also useful, especially when we want to do generation **case-insensitively**.\r\n\r\nFor example, if current incomplete token is `beamsear`, it might be tokenized into `beam` and `sear`. In **case-insensitive** prediction, what we want might be `BeamSearch`. In this case, a two-step mask of `Beam`/`beam` and `Sear*`/`sear*` is needed.\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1181258045/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1197570531",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/12047#issuecomment-1197570531",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/12047",
        "id": 1197570531,
        "node_id": "IC_kwDOCVq1mM5HYXnj",
        "user": {
            "login": "HaoboGu",
            "id": 8640918,
            "node_id": "MDQ6VXNlcjg2NDA5MTg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8640918?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/HaoboGu",
            "html_url": "https://github.com/HaoboGu",
            "followers_url": "https://api.github.com/users/HaoboGu/followers",
            "following_url": "https://api.github.com/users/HaoboGu/following{/other_user}",
            "gists_url": "https://api.github.com/users/HaoboGu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/HaoboGu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/HaoboGu/subscriptions",
            "organizations_url": "https://api.github.com/users/HaoboGu/orgs",
            "repos_url": "https://api.github.com/users/HaoboGu/repos",
            "events_url": "https://api.github.com/users/HaoboGu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/HaoboGu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-28T02:11:50Z",
        "updated_at": "2022-07-28T02:11:50Z",
        "author_association": "NONE",
        "body": "@viboga any updates on beam search custom OP? ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1197570531/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]