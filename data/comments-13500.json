[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1297436530",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13500#issuecomment-1297436530",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13500",
        "id": 1297436530,
        "node_id": "IC_kwDOCVq1mM5NVU9y",
        "user": {
            "login": "yuslepukhin",
            "id": 11303988,
            "node_id": "MDQ6VXNlcjExMzAzOTg4",
            "avatar_url": "https://avatars.githubusercontent.com/u/11303988?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yuslepukhin",
            "html_url": "https://github.com/yuslepukhin",
            "followers_url": "https://api.github.com/users/yuslepukhin/followers",
            "following_url": "https://api.github.com/users/yuslepukhin/following{/other_user}",
            "gists_url": "https://api.github.com/users/yuslepukhin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yuslepukhin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yuslepukhin/subscriptions",
            "organizations_url": "https://api.github.com/users/yuslepukhin/orgs",
            "repos_url": "https://api.github.com/users/yuslepukhin/repos",
            "events_url": "https://api.github.com/users/yuslepukhin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yuslepukhin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-10-31T17:34:39Z",
        "updated_at": "2022-10-31T17:34:39Z",
        "author_association": "MEMBER",
        "body": "https://onnxruntime.ai/docs/performance/tune-performance.html#convolution-heavy-models-and-the-cuda-ep",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1297436530/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1297792551",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13500#issuecomment-1297792551",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13500",
        "id": 1297792551,
        "node_id": "IC_kwDOCVq1mM5NWr4n",
        "user": {
            "login": "igormis",
            "id": 6599037,
            "node_id": "MDQ6VXNlcjY1OTkwMzc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6599037?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/igormis",
            "html_url": "https://github.com/igormis",
            "followers_url": "https://api.github.com/users/igormis/followers",
            "following_url": "https://api.github.com/users/igormis/following{/other_user}",
            "gists_url": "https://api.github.com/users/igormis/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/igormis/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/igormis/subscriptions",
            "organizations_url": "https://api.github.com/users/igormis/orgs",
            "repos_url": "https://api.github.com/users/igormis/repos",
            "events_url": "https://api.github.com/users/igormis/events{/privacy}",
            "received_events_url": "https://api.github.com/users/igormis/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-10-31T23:00:41Z",
        "updated_at": "2022-10-31T23:17:03Z",
        "author_association": "NONE",
        "body": "Thanks @yuslepukhin. \r\nIt is still increasing, for instance I have started with 3 models:\r\n![image](https://user-images.githubusercontent.com/6599037/199125731-daa00fff-2d29-40f3-8126-e142b9eef450.png)\r\nand after certain number of requests the RAM gets exhausted:\r\n![image](https://user-images.githubusercontent.com/6599037/199125799-f8455c16-e8d4-4c0d-971f-5a525fde526f.png)\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1297792551/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1298614579",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13500#issuecomment-1298614579",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13500",
        "id": 1298614579,
        "node_id": "IC_kwDOCVq1mM5NZ0kz",
        "user": {
            "login": "igormis",
            "id": 6599037,
            "node_id": "MDQ6VXNlcjY1OTkwMzc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6599037?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/igormis",
            "html_url": "https://github.com/igormis",
            "followers_url": "https://api.github.com/users/igormis/followers",
            "following_url": "https://api.github.com/users/igormis/following{/other_user}",
            "gists_url": "https://api.github.com/users/igormis/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/igormis/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/igormis/subscriptions",
            "organizations_url": "https://api.github.com/users/igormis/orgs",
            "repos_url": "https://api.github.com/users/igormis/repos",
            "events_url": "https://api.github.com/users/igormis/events{/privacy}",
            "received_events_url": "https://api.github.com/users/igormis/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-11-01T14:45:34Z",
        "updated_at": "2022-11-01T14:45:34Z",
        "author_association": "NONE",
        "body": "I have tries the following code also:\r\n`cuda_provider_options = {\"arena_extend_strategy\": \"kSameAsRequested\", \"gpu_mem_limit\": 3221225472, \"cudnn_conv_use_max_workspace\": \"1\"}` but it still grows",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1298614579/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1303941280",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13500#issuecomment-1303941280",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13500",
        "id": 1303941280,
        "node_id": "IC_kwDOCVq1mM5NuJCg",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-11-04T17:45:13Z",
        "updated_at": "2022-11-04T17:51:06Z",
        "author_association": "MEMBER",
        "body": "The arena allocator used by the CUDA EP doesn't shrink by itself. You can configure it to shrink after every Run. See the ```Memory arena shrinkage``` section here https://onnxruntime.ai/docs/get-started/with-c.html. Also read https://github.com/microsoft/onnxruntime/issues/9509#issuecomment-951546580.\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1303941280/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1304641094",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13500#issuecomment-1304641094",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13500",
        "id": 1304641094,
        "node_id": "IC_kwDOCVq1mM5Nwz5G",
        "user": {
            "login": "igormis",
            "id": 6599037,
            "node_id": "MDQ6VXNlcjY1OTkwMzc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6599037?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/igormis",
            "html_url": "https://github.com/igormis",
            "followers_url": "https://api.github.com/users/igormis/followers",
            "following_url": "https://api.github.com/users/igormis/following{/other_user}",
            "gists_url": "https://api.github.com/users/igormis/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/igormis/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/igormis/subscriptions",
            "organizations_url": "https://api.github.com/users/igormis/orgs",
            "repos_url": "https://api.github.com/users/igormis/repos",
            "events_url": "https://api.github.com/users/igormis/events{/privacy}",
            "received_events_url": "https://api.github.com/users/igormis/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-11-05T21:02:46Z",
        "updated_at": "2022-11-05T21:08:51Z",
        "author_association": "NONE",
        "body": "@pranavsharma tnx a lot, it is perfect direction. I have these settings for EP in Python:\r\n```\r\nsess_options = rt.SessionOptions()\r\n\r\nsess_options.enable_mem_pattern = False\r\nsess_options.enable_cpu_mem_arena = False\r\n\r\ncuda_provider_options = {\"arena_extend_strategy\": \"kSameAsRequested\", \"cudnn_conv_use_max_workspace\": \"1\"}\r\ncpu_provider_options = {\"arena_extend_strategy\": \"kSameAsRequested\"}\r\nexecution_providers = [(\"CUDAExecutionProvider\", cuda_provider_options), \"CPUExecutionProvider\"]\r\nsess = rt.InferenceSession(\"roberta_onnx_model/__MODEL_PROTO.onnx\", providers=execution_providers)\r\n```\r\nSo does this mean that for the RunOptions I need to do something like this:\r\n```\r\nrun_options = rt.RunOptions()\r\nrun_options.add_run_config_entry(\"kOrtRunOptionsConfigEnableMemoryArenaShrinkage\", \"gpu:0\")\r\nlogits = sess.run([label_name], {input_name: X_test_sample}, run_options)[0]\r\n```\r\n@pranavsharma is this correct? I read the documentation, but still I'm a little bit confused",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1304641094/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1307794528",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13500#issuecomment-1307794528",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13500",
        "id": 1307794528,
        "node_id": "IC_kwDOCVq1mM5N81xg",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-11-08T20:35:05Z",
        "updated_at": "2022-11-08T20:35:05Z",
        "author_association": "MEMBER",
        "body": "Yeah, that sounds right. Please look at the test code as well. https://github.com/microsoft/onnxruntime/blob/2ecd1d662203d3fb5d77bf2aa97f6b8bcd7d1759/onnxruntime/test/shared_lib/test_inference.cc#L1904",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1307794528/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1328808298",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13500#issuecomment-1328808298",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13500",
        "id": 1328808298,
        "node_id": "IC_kwDOCVq1mM5PNAFq",
        "user": {
            "login": "igormis",
            "id": 6599037,
            "node_id": "MDQ6VXNlcjY1OTkwMzc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6599037?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/igormis",
            "html_url": "https://github.com/igormis",
            "followers_url": "https://api.github.com/users/igormis/followers",
            "following_url": "https://api.github.com/users/igormis/following{/other_user}",
            "gists_url": "https://api.github.com/users/igormis/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/igormis/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/igormis/subscriptions",
            "organizations_url": "https://api.github.com/users/igormis/orgs",
            "repos_url": "https://api.github.com/users/igormis/repos",
            "events_url": "https://api.github.com/users/igormis/events{/privacy}",
            "received_events_url": "https://api.github.com/users/igormis/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-11-28T09:56:42Z",
        "updated_at": "2022-11-28T09:56:42Z",
        "author_association": "NONE",
        "body": "The settings reduced the memory growth, but still it increases after certain time, is it possible to make it somehow fixed?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1328808298/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1328812915",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13500#issuecomment-1328812915",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13500",
        "id": 1328812915,
        "node_id": "IC_kwDOCVq1mM5PNBNz",
        "user": {
            "login": "igormis",
            "id": 6599037,
            "node_id": "MDQ6VXNlcjY1OTkwMzc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6599037?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/igormis",
            "html_url": "https://github.com/igormis",
            "followers_url": "https://api.github.com/users/igormis/followers",
            "following_url": "https://api.github.com/users/igormis/following{/other_user}",
            "gists_url": "https://api.github.com/users/igormis/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/igormis/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/igormis/subscriptions",
            "organizations_url": "https://api.github.com/users/igormis/orgs",
            "repos_url": "https://api.github.com/users/igormis/repos",
            "events_url": "https://api.github.com/users/igormis/events{/privacy}",
            "received_events_url": "https://api.github.com/users/igormis/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-11-28T10:00:43Z",
        "updated_at": "2022-11-28T10:01:05Z",
        "author_association": "NONE",
        "body": "After playing with the code and following the [code ](https://github.com/microsoft/onnxruntime/blob/2ecd1d662203d3fb5d77bf2aa97f6b8bcd7d1759/onnxruntime/test/shared_lib/test_inference.cc#L1904) that you have send me, this are the final settings:\r\n```\r\nsess_options = rt.SessionOptions()\r\n\r\n\r\n\r\ncuda_provider_options = {\"arena_extend_strategy\": \"kNextPowerOfTwo\", \"do_copy_in_default_stream\": False}\r\ncpu_provider_options = {\"arena_extend_strategy\": \"kNextPowerOfTwo\", \"do_copy_in_default_stream\": False}\r\n\r\nexecution_providers = [(\"CUDAExecutionProvider\", cuda_provider_options), (\"CPUExecutionProvider\", cpu_provider_options)]\r\nsess = rt.InferenceSession(\"roberta_onnx_model/__MODEL_PROTO.onnx\", providers=execution_providers)\r\n\r\nrun_options = rt.RunOptions()\r\nrun_options.add_run_config_entry(\"kOrtRunOptionsConfigEnableMemoryArenaShrinkage\", \"cpu:0,gpu:0\")\r\n\r\nlogits = sess.run([label_name], {input_name: X_test_sample}, run_options)[0]\r\n```\r\nDO not know what else to set/change",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1328812915/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]