[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1496328567",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15349#issuecomment-1496328567",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15349",
        "id": 1496328567,
        "node_id": "IC_kwDOCVq1mM5ZMCl3",
        "user": {
            "login": "baijumeswani",
            "id": 12852605,
            "node_id": "MDQ6VXNlcjEyODUyNjA1",
            "avatar_url": "https://avatars.githubusercontent.com/u/12852605?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/baijumeswani",
            "html_url": "https://github.com/baijumeswani",
            "followers_url": "https://api.github.com/users/baijumeswani/followers",
            "following_url": "https://api.github.com/users/baijumeswani/following{/other_user}",
            "gists_url": "https://api.github.com/users/baijumeswani/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/baijumeswani/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/baijumeswani/subscriptions",
            "organizations_url": "https://api.github.com/users/baijumeswani/orgs",
            "repos_url": "https://api.github.com/users/baijumeswani/repos",
            "events_url": "https://api.github.com/users/baijumeswani/events{/privacy}",
            "received_events_url": "https://api.github.com/users/baijumeswani/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-04T17:16:08Z",
        "updated_at": "2023-04-04T17:16:08Z",
        "author_association": "MEMBER",
        "body": "protobuf has a file size limit of 2GB.\r\n\r\nYou could consider saving to external data using: https://github.com/onnx/onnx/blob/main/docs/ExternalData.md#converting-an-onnx-model-to-external-data.\r\n\r\nAnd then pass in the `--use_external_data_format` flag when running the \r\n\r\n```py\r\npython3 -m onnxruntime.transformers.optimizer ...\r\n```\r\n\r\ncommand.\r\n\r\nLet me know if that works for you.\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1496328567/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1496338345",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15349#issuecomment-1496338345",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15349",
        "id": 1496338345,
        "node_id": "IC_kwDOCVq1mM5ZME-p",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-04T17:24:26Z",
        "updated_at": "2023-04-04T17:26:33Z",
        "author_association": "MEMBER",
        "body": "The cause is it uses ONNX shape inference which cannot handle model larger than 2GB. The solution is to upgrade to latest onnxruntime-gpu, which uses symbolic shape inference, and could avoid the limitation.\r\n\r\nTry install latest onnxruntime-gpu (fp16 need CUDA EP):\r\n```\r\npip3 uninstall onnxruntime\r\npip3 install -U onnxruntime-gpu\r\npip3 install -U onnx\r\npython3 -m onnxruntime.transformers.optimizer --input {onnx_model_path} --output {onnx_optimized_model_path} --hidden_size 1024 --num_heads 16 --opt_level 0 --float16 --use_external_data_format --use_gpu\r\n```\r\nNote that `--opt_level 0 --float16 --use_external_data_format --use_gpu` is used in the command.\r\n\r\nI think `--use_external_data_format` is optional since fp16 model size will be reduced to 50% so it could be within 2GB.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1496338345/reactions",
            "total_count": 2,
            "+1": 2,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1498756696",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15349#issuecomment-1498756696",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15349",
        "id": 1498756696,
        "node_id": "IC_kwDOCVq1mM5ZVTZY",
        "user": {
            "login": "toobashahid210",
            "id": 102026619,
            "node_id": "U_kgDOBhTNew",
            "avatar_url": "https://avatars.githubusercontent.com/u/102026619?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/toobashahid210",
            "html_url": "https://github.com/toobashahid210",
            "followers_url": "https://api.github.com/users/toobashahid210/followers",
            "following_url": "https://api.github.com/users/toobashahid210/following{/other_user}",
            "gists_url": "https://api.github.com/users/toobashahid210/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/toobashahid210/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/toobashahid210/subscriptions",
            "organizations_url": "https://api.github.com/users/toobashahid210/orgs",
            "repos_url": "https://api.github.com/users/toobashahid210/repos",
            "events_url": "https://api.github.com/users/toobashahid210/events{/privacy}",
            "received_events_url": "https://api.github.com/users/toobashahid210/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-06T09:26:06Z",
        "updated_at": "2023-04-06T09:26:45Z",
        "author_association": "NONE",
        "body": "> @baijumeswani \r\n\r\nI tried the solution you provided, but it didn't work. I encountered the same error again.\r\n\r\nHere's the code I used \r\n\r\n```python\r\nimport onnx\r\nonnx_model = onnx.load(\"/onnx_model/model.onnx\")\r\n\r\nonnx.save_model(onnx_model, \"/optmized_model/model.onnx\", save_as_external_data=True, all_tensors_to_one_file=True, \r\n                size_threshold=1024, convert_attribute=False, location='external_data')\r\n```\r\n\r\nonnx_model is the model converted using torch.onnx.export \r\nLet me know if i am missing something",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1498756696/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1555244336",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15349#issuecomment-1555244336",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15349",
        "id": 1555244336,
        "node_id": "IC_kwDOCVq1mM5csyUw",
        "user": {
            "login": "puyuanOT",
            "id": 121119211,
            "node_id": "U_kgDOBzgh6w",
            "avatar_url": "https://avatars.githubusercontent.com/u/121119211?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/puyuanOT",
            "html_url": "https://github.com/puyuanOT",
            "followers_url": "https://api.github.com/users/puyuanOT/followers",
            "following_url": "https://api.github.com/users/puyuanOT/following{/other_user}",
            "gists_url": "https://api.github.com/users/puyuanOT/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/puyuanOT/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/puyuanOT/subscriptions",
            "organizations_url": "https://api.github.com/users/puyuanOT/orgs",
            "repos_url": "https://api.github.com/users/puyuanOT/repos",
            "events_url": "https://api.github.com/users/puyuanOT/events{/privacy}",
            "received_events_url": "https://api.github.com/users/puyuanOT/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-05-19T21:01:24Z",
        "updated_at": "2023-05-19T21:01:24Z",
        "author_association": "NONE",
        "body": "got the same error when running command\r\n\r\noptimum-cli export onnx --model EleutherAI/pythia-2.8b /local_disk0/optimized_pythia_2.8b_fp16 --optimize O4 --task text-generation-with-past --framework pt --device cuda",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1555244336/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]