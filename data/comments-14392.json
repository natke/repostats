[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1400735854",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14392#issuecomment-1400735854",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14392",
        "id": 1400735854,
        "node_id": "IC_kwDOCVq1mM5TfYhu",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-23T17:43:53Z",
        "updated_at": "2023-01-23T17:43:53Z",
        "author_association": "MEMBER",
        "body": "MlasReorderInputNchw and MlasReorderOutputNchw are designed for case that input channel is a multiplier of 4. If input channel is not a multiplier of 4, ORT/MLAS won't compute Conv with NCHWc format.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1400735854/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1400740485",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14392#issuecomment-1400740485",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14392",
        "id": 1400740485,
        "node_id": "IC_kwDOCVq1mM5TfZqF",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-23T17:48:02Z",
        "updated_at": "2023-01-23T17:48:02Z",
        "author_association": "MEMBER",
        "body": "https://github.com/microsoft/onnxruntime/blob/0c6037b5abe571fc43a55ef7a9d2f846820fbe5d/onnxruntime/core/optimizer/nchwc_transformer.cc#L378",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1400740485/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1400781805",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14392#issuecomment-1400781805",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14392",
        "id": 1400781805,
        "node_id": "IC_kwDOCVq1mM5Tfjvt",
        "user": {
            "login": "fuhengwu2021",
            "id": 85374689,
            "node_id": "MDQ6VXNlcjg1Mzc0Njg5",
            "avatar_url": "https://avatars.githubusercontent.com/u/85374689?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/fuhengwu2021",
            "html_url": "https://github.com/fuhengwu2021",
            "followers_url": "https://api.github.com/users/fuhengwu2021/followers",
            "following_url": "https://api.github.com/users/fuhengwu2021/following{/other_user}",
            "gists_url": "https://api.github.com/users/fuhengwu2021/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/fuhengwu2021/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/fuhengwu2021/subscriptions",
            "organizations_url": "https://api.github.com/users/fuhengwu2021/orgs",
            "repos_url": "https://api.github.com/users/fuhengwu2021/repos",
            "events_url": "https://api.github.com/users/fuhengwu2021/events{/privacy}",
            "received_events_url": "https://api.github.com/users/fuhengwu2021/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-23T18:20:10Z",
        "updated_at": "2023-01-23T18:20:10Z",
        "author_association": "NONE",
        "body": "Thanks @yufenglee What Conv format will be used when Channel is not a multiplier of 4? Will NCHWc be better even when the input channel is not a multiplier of 4? If yes, I think my fix will make it work.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1400781805/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1400958455",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14392#issuecomment-1400958455",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14392",
        "id": 1400958455,
        "node_id": "IC_kwDOCVq1mM5TgO33",
        "user": {
            "login": "fuhengwu2021",
            "id": 85374689,
            "node_id": "MDQ6VXNlcjg1Mzc0Njg5",
            "avatar_url": "https://avatars.githubusercontent.com/u/85374689?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/fuhengwu2021",
            "html_url": "https://github.com/fuhengwu2021",
            "followers_url": "https://api.github.com/users/fuhengwu2021/followers",
            "following_url": "https://api.github.com/users/fuhengwu2021/following{/other_user}",
            "gists_url": "https://api.github.com/users/fuhengwu2021/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/fuhengwu2021/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/fuhengwu2021/subscriptions",
            "organizations_url": "https://api.github.com/users/fuhengwu2021/orgs",
            "repos_url": "https://api.github.com/users/fuhengwu2021/repos",
            "events_url": "https://api.github.com/users/fuhengwu2021/events{/privacy}",
            "received_events_url": "https://api.github.com/users/fuhengwu2021/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-23T20:47:41Z",
        "updated_at": "2023-01-23T20:47:41Z",
        "author_association": "NONE",
        "body": "emmm...That seems not always true. You can see it from the example below.\r\n\r\n![image](https://user-images.githubusercontent.com/85374689/214146051-e58dadea-d770-48a8-b305-d9e5dda38c8e.png)\r\n\r\nThe input channel is 3 (not a multiplier of 4) but it still uses NCHWC Conv. Am I correct? @yufenglee \r\n\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1400958455/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1400996014",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14392#issuecomment-1400996014",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14392",
        "id": 1400996014,
        "node_id": "IC_kwDOCVq1mM5TgYCu",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-23T21:20:07Z",
        "updated_at": "2023-01-23T21:23:24Z",
        "author_association": "MEMBER",
        "body": "For case input Channel < nchwc_block_size(16 for avx512 and 8 for others), ORT doesn't do ReOrder and uses NCHW buffer directly, i.e, input is still NCHW but output format is NCHWc.\r\nhttps://github.com/microsoft/onnxruntime/blob/0c6037b5abe571fc43a55ef7a9d2f846820fbe5d/onnxruntime/core/optimizer/nchwc_transformer.cc#L375",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1400996014/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1401005575",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14392#issuecomment-1401005575",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14392",
        "id": 1401005575,
        "node_id": "IC_kwDOCVq1mM5TgaYH",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-23T21:27:38Z",
        "updated_at": "2023-01-23T21:27:38Z",
        "author_association": "MEMBER",
        "body": "> Thanks @yufenglee What Conv format will be used when Channel is not a multiplier of 4? Will NCHWc be better even when the input channel is not a multiplier of 4? If yes, I think my fix will make it work.\r\n\r\nIn most case, Input channel is a multiplier of 4. The example you mentioned above is covered by the special handling: InputChannel < nchwc_block_size. \r\nYour change only makes the reorder works. we also have same assumption in kernel implementation.\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1401005575/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1403064800",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14392#issuecomment-1403064800",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14392",
        "id": 1403064800,
        "node_id": "IC_kwDOCVq1mM5ToRHg",
        "user": {
            "login": "fuhengwu2021",
            "id": 85374689,
            "node_id": "MDQ6VXNlcjg1Mzc0Njg5",
            "avatar_url": "https://avatars.githubusercontent.com/u/85374689?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/fuhengwu2021",
            "html_url": "https://github.com/fuhengwu2021",
            "followers_url": "https://api.github.com/users/fuhengwu2021/followers",
            "following_url": "https://api.github.com/users/fuhengwu2021/following{/other_user}",
            "gists_url": "https://api.github.com/users/fuhengwu2021/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/fuhengwu2021/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/fuhengwu2021/subscriptions",
            "organizations_url": "https://api.github.com/users/fuhengwu2021/orgs",
            "repos_url": "https://api.github.com/users/fuhengwu2021/repos",
            "events_url": "https://api.github.com/users/fuhengwu2021/events{/privacy}",
            "received_events_url": "https://api.github.com/users/fuhengwu2021/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-25T04:02:23Z",
        "updated_at": "2023-01-25T04:03:55Z",
        "author_association": "NONE",
        "body": "Thanks @yufenglee  My point is with my change, it seems we can handle the special case with the same algorithm + zero padding. We can also change the algorithm selection logic accordingly for the kernel(in function `MlasNchwcConv` if I am correct). Why do we have that special handling which uses totally different data format and algorithm? Is it because of performance considerations? Also, may I know what OIHWBo and OIHWBiBo mean?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1403064800/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1406954829",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/14392#issuecomment-1406954829",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/14392",
        "id": 1406954829,
        "node_id": "IC_kwDOCVq1mM5T3G1N",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-01-27T19:04:54Z",
        "updated_at": "2023-01-27T19:04:54Z",
        "author_association": "MEMBER",
        "body": "> Thanks @yufenglee My point is with my change, it seems we can handle the special case with the same algorithm + zero padding. We can also change the algorithm selection logic accordingly for the kernel(in function `MlasNchwcConv` if I am correct). Why do we have that special handling which uses totally different data format and algorithm? Is it because of performance considerations? Also, may I know what OIHWBo and OIHWBiBo mean?\r\n\r\nTo summarize, ORT NCHWc conv has 2 implementations:\r\n- NCHWc with direct input, i.e., input is in NCHW format but output is in NCHWc format.\r\n  - requires C < nchwc_block_size\r\n- NCHWc with reordered input, i.e., both input and output are in NCHWc format. \r\n  - requires C%4 == 0\r\n\r\nIt is developed like this is abased the assumptions(real models):\r\n-  C %4 == 0 in most cases\r\n- Input Conv or 1st Conv layer usually has 3 channels. With NCHWc with direct input, we don't even need to reorder the 1st input.\r\n\r\nFor OIHWBo and OIHWBiBo,\r\n- O: output channel\r\n- I: input channel\r\n- H: kernel size in Height or kH\r\n- W: kernel size in Width or kW\r\n- Bi: block size in input channel\r\n- Bo: block size in output channel",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1406954829/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]