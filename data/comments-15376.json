[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1497803077",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15376#issuecomment-1497803077",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15376",
        "id": 1497803077,
        "node_id": "IC_kwDOCVq1mM5ZRqlF",
        "user": {
            "login": "baijumeswani",
            "id": 12852605,
            "node_id": "MDQ6VXNlcjEyODUyNjA1",
            "avatar_url": "https://avatars.githubusercontent.com/u/12852605?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/baijumeswani",
            "html_url": "https://github.com/baijumeswani",
            "followers_url": "https://api.github.com/users/baijumeswani/followers",
            "following_url": "https://api.github.com/users/baijumeswani/following{/other_user}",
            "gists_url": "https://api.github.com/users/baijumeswani/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/baijumeswani/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/baijumeswani/subscriptions",
            "organizations_url": "https://api.github.com/users/baijumeswani/orgs",
            "repos_url": "https://api.github.com/users/baijumeswani/repos",
            "events_url": "https://api.github.com/users/baijumeswani/events{/privacy}",
            "received_events_url": "https://api.github.com/users/baijumeswani/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-05T16:41:09Z",
        "updated_at": "2023-04-05T16:41:09Z",
        "author_association": "MEMBER",
        "body": "The intention here is to make each node output a graph output? Depending on your model, this might be too many outputs.\r\n\r\nIf this is the intention, you should make changes to the onnx model first before instantiating the `InferenceSession` with the model.\r\n\r\nIf you're building onnxruntime from source, you could enable some debug flags to dump the intermediate activations in the graph.\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1497803077/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1497816649",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15376#issuecomment-1497816649",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15376",
        "id": 1497816649,
        "node_id": "IC_kwDOCVq1mM5ZRt5J",
        "user": {
            "login": "JurajJakubov",
            "id": 43072838,
            "node_id": "MDQ6VXNlcjQzMDcyODM4",
            "avatar_url": "https://avatars.githubusercontent.com/u/43072838?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/JurajJakubov",
            "html_url": "https://github.com/JurajJakubov",
            "followers_url": "https://api.github.com/users/JurajJakubov/followers",
            "following_url": "https://api.github.com/users/JurajJakubov/following{/other_user}",
            "gists_url": "https://api.github.com/users/JurajJakubov/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/JurajJakubov/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/JurajJakubov/subscriptions",
            "organizations_url": "https://api.github.com/users/JurajJakubov/orgs",
            "repos_url": "https://api.github.com/users/JurajJakubov/repos",
            "events_url": "https://api.github.com/users/JurajJakubov/events{/privacy}",
            "received_events_url": "https://api.github.com/users/JurajJakubov/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-05T16:47:58Z",
        "updated_at": "2023-04-05T16:47:58Z",
        "author_association": "NONE",
        "body": "Sorry I edited my post. \r\n\r\nEntire point is to take all feature maps of all layers (yes it can be a lot) or at least lets say first 10 convolution layers of network.\r\nBut i cant find any tutorial on this for onnx.\r\n\r\nAnd  according to your answer of i want to do that i need to edit model and add all for example convolution layers to output?\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1497816649/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1497836148",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15376#issuecomment-1497836148",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15376",
        "id": 1497836148,
        "node_id": "IC_kwDOCVq1mM5ZRyp0",
        "user": {
            "login": "baijumeswani",
            "id": 12852605,
            "node_id": "MDQ6VXNlcjEyODUyNjA1",
            "avatar_url": "https://avatars.githubusercontent.com/u/12852605?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/baijumeswani",
            "html_url": "https://github.com/baijumeswani",
            "followers_url": "https://api.github.com/users/baijumeswani/followers",
            "following_url": "https://api.github.com/users/baijumeswani/following{/other_user}",
            "gists_url": "https://api.github.com/users/baijumeswani/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/baijumeswani/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/baijumeswani/subscriptions",
            "organizations_url": "https://api.github.com/users/baijumeswani/orgs",
            "repos_url": "https://api.github.com/users/baijumeswani/repos",
            "events_url": "https://api.github.com/users/baijumeswani/events{/privacy}",
            "received_events_url": "https://api.github.com/users/baijumeswani/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-05T17:03:54Z",
        "updated_at": "2023-04-05T17:03:54Z",
        "author_association": "MEMBER",
        "body": "> And according to your answer of i want to do that i need to edit model and add all for example convolution layers to output?\r\n\r\nYes, you will need to edit the model such that each feature map that you're interested in is a graph output. \r\n\r\nHere is untested python code that you can use to edit the model.\r\n\r\n```py\r\nmodel = onnx.load(model_path)\r\noriginal_output_names = {output.name for output in model.graph.output}\r\noutputs = model.graph.output\r\nname_value_info_mapping = {value_info.name: value_info for value_info in model.graph.value_info}\r\n\r\nop_types_of_interest = {\"Conv\": [0]} # map from op_type to list of indices of outputs to keep\r\n\r\n\r\nfor node in model.graph.node:\r\n    if node.op_type in op_types_of_interest:\r\n        for output_idx in op_types_of_interest[node.op_type]:\r\n            if node[output_idx] not in original_output_names:\r\n                if not node[output_idx] in name_value_info_mapping:\r\n                    raise ValueError(f\"Output {node[output_idx]} shape not found in value_info\")\r\n                \r\n                outputs.append(name_value_info_mapping[node[output_idx]])\r\n\r\n\r\nmodel.graph.output[:] = outputs\r\n\r\nonnx.save(model, model_path)\r\n\r\n...\r\nsession = InferenceSession(model_path,  ...)\r\n```\r\n\r\nNote that for graph outputs, shape information is needed. So, hopefully the model shape inference is done, or you have knowledge of the shape of the node output.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1497836148/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1497928888",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15376#issuecomment-1497928888",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15376",
        "id": 1497928888,
        "node_id": "IC_kwDOCVq1mM5ZSJS4",
        "user": {
            "login": "JurajJakubov",
            "id": 43072838,
            "node_id": "MDQ6VXNlcjQzMDcyODM4",
            "avatar_url": "https://avatars.githubusercontent.com/u/43072838?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/JurajJakubov",
            "html_url": "https://github.com/JurajJakubov",
            "followers_url": "https://api.github.com/users/JurajJakubov/followers",
            "following_url": "https://api.github.com/users/JurajJakubov/following{/other_user}",
            "gists_url": "https://api.github.com/users/JurajJakubov/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/JurajJakubov/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/JurajJakubov/subscriptions",
            "organizations_url": "https://api.github.com/users/JurajJakubov/orgs",
            "repos_url": "https://api.github.com/users/JurajJakubov/repos",
            "events_url": "https://api.github.com/users/JurajJakubov/events{/privacy}",
            "received_events_url": "https://api.github.com/users/JurajJakubov/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-05T18:23:53Z",
        "updated_at": "2023-04-05T18:23:53Z",
        "author_association": "NONE",
        "body": "> > And according to your answer of i want to do that i need to edit model and add all for example convolution layers to output?\r\n> \r\n> Yes, you will need to edit the model such that each feature map that you're interested in is a graph output.\r\n> \r\n> Here is untested python code that you can use to edit the model.\r\n> \r\n> ```python\r\n> model = onnx.load(model_path)\r\n> original_output_names = {output.name for output in model.graph.output}\r\n> outputs = model.graph.output\r\n> name_value_info_mapping = {value_info.name: value_info for value_info in model.graph.value_info}\r\n> \r\n> op_types_of_interest = {\"Conv\": [0]} # map from op_type to list of indices of outputs to keep\r\n> \r\n> \r\n> for node in model.graph.node:\r\n>     if node.op_type in op_types_of_interest:\r\n>         for output_idx in op_types_of_interest[node.op_type]:\r\n>             if node[output_idx] not in original_output_names:\r\n>                 if not node[output_idx] in name_value_info_mapping:\r\n>                     raise ValueError(f\"Output {node[output_idx]} shape not found in value_info\")\r\n>                 \r\n>                 outputs.append(name_value_info_mapping[node[output_idx]])\r\n> \r\n> \r\n> model.graph.output[:] = outputs\r\n> \r\n> onnx.save(model, model_path)\r\n> \r\n> ...\r\n> session = InferenceSession(model_path,  ...)\r\n> ```\r\n> \r\n> Note that for graph outputs, shape information is needed. So, hopefully the model shape inference is done, or you have knowledge of the shape of the node output.\r\n\r\nThank you it seems to work. I done it earlier too but with all layers and i ended up with error. Now i tried only one layer (conv) and it worked and converted tensor to bitmap and saved to disk. Everythings works. Thank you. You saved my diploma thesis :D",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1497928888/reactions",
            "total_count": 1,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 1,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]