[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/576945876",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2885#issuecomment-576945876",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2885",
        "id": 576945876,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU3Njk0NTg3Ng==",
        "user": {
            "login": "tracysh",
            "id": 42477615,
            "node_id": "MDQ6VXNlcjQyNDc3NjE1",
            "avatar_url": "https://avatars.githubusercontent.com/u/42477615?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tracysh",
            "html_url": "https://github.com/tracysh",
            "followers_url": "https://api.github.com/users/tracysh/followers",
            "following_url": "https://api.github.com/users/tracysh/following{/other_user}",
            "gists_url": "https://api.github.com/users/tracysh/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tracysh/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tracysh/subscriptions",
            "organizations_url": "https://api.github.com/users/tracysh/orgs",
            "repos_url": "https://api.github.com/users/tracysh/repos",
            "events_url": "https://api.github.com/users/tracysh/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tracysh/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-01-22T00:07:36Z",
        "updated_at": "2020-01-22T00:07:36Z",
        "author_association": "CONTRIBUTOR",
        "body": "@kzuiderveld, #2844 was primarily changes for quantized or int8 GEMMs. The hotspot you list is for MlasReorderInput which is a single threaded function used to reorder buffers for the optimized float32 convolution. It's not clear from this why the performance would have changed.\r\n\r\nWhat optimization level is used for SetSessionGraphOptimizationLevel? If ORT_ENABLE_EXTENDED is used instead of ORT_ENABLE_ALL, what performance do you observe?\r\n\r\nCan I get a copy of the model to reproduce the slowdown locally?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/576945876/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/576948303",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2885#issuecomment-576948303",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2885",
        "id": 576948303,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU3Njk0ODMwMw==",
        "user": {
            "login": "kzuiderveld",
            "id": 28074679,
            "node_id": "MDQ6VXNlcjI4MDc0Njc5",
            "avatar_url": "https://avatars.githubusercontent.com/u/28074679?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/kzuiderveld",
            "html_url": "https://github.com/kzuiderveld",
            "followers_url": "https://api.github.com/users/kzuiderveld/followers",
            "following_url": "https://api.github.com/users/kzuiderveld/following{/other_user}",
            "gists_url": "https://api.github.com/users/kzuiderveld/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/kzuiderveld/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/kzuiderveld/subscriptions",
            "organizations_url": "https://api.github.com/users/kzuiderveld/orgs",
            "repos_url": "https://api.github.com/users/kzuiderveld/repos",
            "events_url": "https://api.github.com/users/kzuiderveld/events{/privacy}",
            "received_events_url": "https://api.github.com/users/kzuiderveld/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-01-22T00:16:35Z",
        "updated_at": "2020-01-22T00:17:04Z",
        "author_association": "NONE",
        "body": "Reordering buffers implies copying of data. The MlasReorderInput might be single-threaded, but is used within an OpenMP region so there are 72 threads calling it and each memory operation adds overhead. \r\n\r\nI'll get back to you wrt ORT_ENABLE_EXTENDED. You can have a copy of the model as long it is considered covered under an NDA. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/576948303/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/576949726",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2885#issuecomment-576949726",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2885",
        "id": 576949726,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU3Njk0OTcyNg==",
        "user": {
            "login": "snnn",
            "id": 856316,
            "node_id": "MDQ6VXNlcjg1NjMxNg==",
            "avatar_url": "https://avatars.githubusercontent.com/u/856316?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/snnn",
            "html_url": "https://github.com/snnn",
            "followers_url": "https://api.github.com/users/snnn/followers",
            "following_url": "https://api.github.com/users/snnn/following{/other_user}",
            "gists_url": "https://api.github.com/users/snnn/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/snnn/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/snnn/subscriptions",
            "organizations_url": "https://api.github.com/users/snnn/orgs",
            "repos_url": "https://api.github.com/users/snnn/repos",
            "events_url": "https://api.github.com/users/snnn/events{/privacy}",
            "received_events_url": "https://api.github.com/users/snnn/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-01-22T00:21:23Z",
        "updated_at": "2020-01-22T00:38:53Z",
        "author_association": "MEMBER",
        "body": "BTW we found perf regression on another commit just after Tracy's change. Commit 724ff0753bc3c7a1931e58ccb092df41b262d61f . \r\n\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/576949726/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/576967139",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2885#issuecomment-576967139",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2885",
        "id": 576967139,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU3Njk2NzEzOQ==",
        "user": {
            "login": "kzuiderveld",
            "id": 28074679,
            "node_id": "MDQ6VXNlcjI4MDc0Njc5",
            "avatar_url": "https://avatars.githubusercontent.com/u/28074679?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/kzuiderveld",
            "html_url": "https://github.com/kzuiderveld",
            "followers_url": "https://api.github.com/users/kzuiderveld/followers",
            "following_url": "https://api.github.com/users/kzuiderveld/following{/other_user}",
            "gists_url": "https://api.github.com/users/kzuiderveld/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/kzuiderveld/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/kzuiderveld/subscriptions",
            "organizations_url": "https://api.github.com/users/kzuiderveld/orgs",
            "repos_url": "https://api.github.com/users/kzuiderveld/repos",
            "events_url": "https://api.github.com/users/kzuiderveld/events{/privacy}",
            "received_events_url": "https://api.github.com/users/kzuiderveld/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-01-22T01:33:29Z",
        "updated_at": "2020-01-22T01:33:29Z",
        "author_association": "NONE",
        "body": "sssn, you're absolutely right. I screwed up. The main degradation was indeed caused by 724ff07, although Tracy is not totally out of the woods (but apologies Tracy, you're not the main culprit). \r\n\r\nMy results:\r\nVersion 56030f8d (1/14): 57.3 seconds (3352 seconds). Life is good. \r\n![image](https://user-images.githubusercontent.com/28074679/72857673-919f4680-3c7b-11ea-92ec-fa21c4dff1ec.png)\r\n\r\nVersion 928b6bb2 (1/16, Tracy's): 68.3 seconds (3943 seconds). Performance degradation. \r\n![image](https://user-images.githubusercontent.com/28074679/72857758-d62ae200-3c7b-11ea-9e08-80c511f91229.png)\r\n(memcpy now #1 function, suggesting memory bandwidth issues)\r\n\r\nVersion 724ff075 (1/16, Scott's): 121.3 seconds (6915 seconds). Huge performance degradation with ORT_ENABLE_ALL. \r\n![image](https://user-images.githubusercontent.com/28074679/72857834-0d998e80-3c7c-11ea-9c6f-7dc7a732f230.png)\r\n\r\n724ff075 with ORT_ENABLE_EXTENDED behaves a bit better, but still has issues (108.8 seconds, 5187 CPU seconds). \r\n![image](https://user-images.githubusercontent.com/28074679/72857924-53eeed80-3c7c-11ea-8a32-5c18bb8fb360.png)\r\n\r\nSo 1/15 and 1/16 were not good days for performance, both commits seem to have introduced issues. \r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/576967139/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/577338303",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2885#issuecomment-577338303",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2885",
        "id": 577338303,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU3NzMzODMwMw==",
        "user": {
            "login": "tracysh",
            "id": 42477615,
            "node_id": "MDQ6VXNlcjQyNDc3NjE1",
            "avatar_url": "https://avatars.githubusercontent.com/u/42477615?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tracysh",
            "html_url": "https://github.com/tracysh",
            "followers_url": "https://api.github.com/users/tracysh/followers",
            "following_url": "https://api.github.com/users/tracysh/following{/other_user}",
            "gists_url": "https://api.github.com/users/tracysh/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tracysh/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tracysh/subscriptions",
            "organizations_url": "https://api.github.com/users/tracysh/orgs",
            "repos_url": "https://api.github.com/users/tracysh/repos",
            "events_url": "https://api.github.com/users/tracysh/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tracysh/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-01-22T19:08:38Z",
        "updated_at": "2020-01-22T19:08:38Z",
        "author_association": "CONTRIBUTOR",
        "body": "The samples for 56030f8 are referencing the older convolution algorithm (MlasConvIm2Col). This is odd because the default optimization level was bumped up to ORT_ENABLE_ALL in change 7c6242b (1/13). I wonder if that build failed to fully rebuild everything that used these values and the test continued to use the older algorithm.\r\n\r\nRegarding the model, it would be useful for me to get a copy for internal performance testing only. Barring that, the model consists of Conv + Upsample nodes? What parameters are used for the upsamples? The NCHWc path (via ORT_ENABLE_ALL) should ultimately be faster than the old code path, but some level of support for Upsample needs to be added as well to avoid the reorders.\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/577338303/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/577348793",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2885#issuecomment-577348793",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2885",
        "id": 577348793,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU3NzM0ODc5Mw==",
        "user": {
            "login": "kzuiderveld",
            "id": 28074679,
            "node_id": "MDQ6VXNlcjI4MDc0Njc5",
            "avatar_url": "https://avatars.githubusercontent.com/u/28074679?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/kzuiderveld",
            "html_url": "https://github.com/kzuiderveld",
            "followers_url": "https://api.github.com/users/kzuiderveld/followers",
            "following_url": "https://api.github.com/users/kzuiderveld/following{/other_user}",
            "gists_url": "https://api.github.com/users/kzuiderveld/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/kzuiderveld/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/kzuiderveld/subscriptions",
            "organizations_url": "https://api.github.com/users/kzuiderveld/orgs",
            "repos_url": "https://api.github.com/users/kzuiderveld/repos",
            "events_url": "https://api.github.com/users/kzuiderveld/events{/privacy}",
            "received_events_url": "https://api.github.com/users/kzuiderveld/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-01-22T19:33:35Z",
        "updated_at": "2020-01-22T19:33:35Z",
        "author_association": "NONE",
        "body": "I would have to verify that the \"fast\" benchmark was indeed made with 56030f8 - jumping between all the branches, rebuilding the libs, relinking with my app and benchmarking and then keeping track of everything is asking for trouble. It was a long day yesterday. \r\n\r\nYup, you can get my model (it's an unet). Let me know where to e-mail it (it's about 7MB). ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/577348793/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/577352692",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2885#issuecomment-577352692",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2885",
        "id": 577352692,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU3NzM1MjY5Mg==",
        "user": {
            "login": "tracysh",
            "id": 42477615,
            "node_id": "MDQ6VXNlcjQyNDc3NjE1",
            "avatar_url": "https://avatars.githubusercontent.com/u/42477615?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tracysh",
            "html_url": "https://github.com/tracysh",
            "followers_url": "https://api.github.com/users/tracysh/followers",
            "following_url": "https://api.github.com/users/tracysh/following{/other_user}",
            "gists_url": "https://api.github.com/users/tracysh/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tracysh/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tracysh/subscriptions",
            "organizations_url": "https://api.github.com/users/tracysh/orgs",
            "repos_url": "https://api.github.com/users/tracysh/repos",
            "events_url": "https://api.github.com/users/tracysh/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tracysh/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-01-22T19:41:59Z",
        "updated_at": "2020-01-22T19:41:59Z",
        "author_association": "CONTRIBUTOR",
        "body": "Thanks, I can be reached at tracysh@microsoft.com.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/577352692/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/578965772",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2885#issuecomment-578965772",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2885",
        "id": 578965772,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU3ODk2NTc3Mg==",
        "user": {
            "login": "skottmckay",
            "id": 979079,
            "node_id": "MDQ6VXNlcjk3OTA3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/skottmckay",
            "html_url": "https://github.com/skottmckay",
            "followers_url": "https://api.github.com/users/skottmckay/followers",
            "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
            "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
            "organizations_url": "https://api.github.com/users/skottmckay/orgs",
            "repos_url": "https://api.github.com/users/skottmckay/repos",
            "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
            "received_events_url": "https://api.github.com/users/skottmckay/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-01-27T21:38:27Z",
        "updated_at": "2020-01-27T21:38:27Z",
        "author_association": "MEMBER",
        "body": "a92e924ab29ed71f2176bb04fd9ec3c117c0de5b reverted the change from 724ff0753bc3c7a1931e58ccb092df41b262d61f",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/578965772/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/591215689",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2885#issuecomment-591215689",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2885",
        "id": 591215689,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU5MTIxNTY4OQ==",
        "user": {
            "login": "kzuiderveld",
            "id": 28074679,
            "node_id": "MDQ6VXNlcjI4MDc0Njc5",
            "avatar_url": "https://avatars.githubusercontent.com/u/28074679?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/kzuiderveld",
            "html_url": "https://github.com/kzuiderveld",
            "followers_url": "https://api.github.com/users/kzuiderveld/followers",
            "following_url": "https://api.github.com/users/kzuiderveld/following{/other_user}",
            "gists_url": "https://api.github.com/users/kzuiderveld/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/kzuiderveld/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/kzuiderveld/subscriptions",
            "organizations_url": "https://api.github.com/users/kzuiderveld/orgs",
            "repos_url": "https://api.github.com/users/kzuiderveld/repos",
            "events_url": "https://api.github.com/users/kzuiderveld/events{/privacy}",
            "received_events_url": "https://api.github.com/users/kzuiderveld/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-02-26T03:10:23Z",
        "updated_at": "2020-02-26T03:10:23Z",
        "author_association": "NONE",
        "body": "![image](https://user-images.githubusercontent.com/28074679/75307961-56f47500-580a-11ea-9355-3957d684e99e.png)\r\n\r\nI pulled down the latest version of ONNX runtime and redid my benchmarks. The latest version is a tad faster compared to the version I was using, so whatever caused the performance degradation, it is fixed now and this issue can be considered as resolved. \r\n\r\nNote: in my case, inference becomes completely memory bandwidth limited around 30 threads. If onnx runtime uses intermediate buffers, please make sure they fit into L1/L2 cache...",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/591215689/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]