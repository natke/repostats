[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1502497566",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15446#issuecomment-1502497566",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15446",
        "id": 1502497566,
        "node_id": "IC_kwDOCVq1mM5Zjkse",
        "user": {
            "login": "wschin",
            "id": 3524474,
            "node_id": "MDQ6VXNlcjM1MjQ0NzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3524474?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/wschin",
            "html_url": "https://github.com/wschin",
            "followers_url": "https://api.github.com/users/wschin/followers",
            "following_url": "https://api.github.com/users/wschin/following{/other_user}",
            "gists_url": "https://api.github.com/users/wschin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/wschin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/wschin/subscriptions",
            "organizations_url": "https://api.github.com/users/wschin/orgs",
            "repos_url": "https://api.github.com/users/wschin/repos",
            "events_url": "https://api.github.com/users/wschin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/wschin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-11T00:10:45Z",
        "updated_at": "2023-04-11T00:10:45Z",
        "author_association": "MEMBER",
        "body": "I only found MaxPoolV8 in CPU EP, so it could be a missing op.\r\n```cpp\r\nclass MaxPoolV8 : public OpKernel, public PoolBase {\r\n\r\n template <typename T>\r\n  struct ComputeHelper {\r\n    Status operator()(const MaxPoolV8* inst, OpKernelContext* context) const {\r\n      return inst->ComputeImpl<T>(context);\r\n    }\r\n  };\r\n\r\n public:\r\n  MaxPoolV8(const OpKernelInfo& info) : OpKernel(info), PoolBase(info) {}\r\n  Status Compute(OpKernelContext* context) const override;\r\n private:\r\n  template <typename T>\r\n  Status ComputeImpl(OpKernelContext* context) const;\r\n};\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1502497566/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1503675600",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15446#issuecomment-1503675600",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15446",
        "id": 1503675600,
        "node_id": "IC_kwDOCVq1mM5ZoETQ",
        "user": {
            "login": "justinchuby",
            "id": 11205048,
            "node_id": "MDQ6VXNlcjExMjA1MDQ4",
            "avatar_url": "https://avatars.githubusercontent.com/u/11205048?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/justinchuby",
            "html_url": "https://github.com/justinchuby",
            "followers_url": "https://api.github.com/users/justinchuby/followers",
            "following_url": "https://api.github.com/users/justinchuby/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinchuby/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/justinchuby/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinchuby/subscriptions",
            "organizations_url": "https://api.github.com/users/justinchuby/orgs",
            "repos_url": "https://api.github.com/users/justinchuby/repos",
            "events_url": "https://api.github.com/users/justinchuby/events{/privacy}",
            "received_events_url": "https://api.github.com/users/justinchuby/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-04-11T16:00:52Z",
        "updated_at": "2023-04-21T05:11:04Z",
        "author_association": "MEMBER",
        "body": "I updated the model in the repro",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1503675600/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1574089374",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15446#issuecomment-1574089374",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15446",
        "id": 1574089374,
        "node_id": "IC_kwDOCVq1mM5d0rKe",
        "user": {
            "login": "BowenBao",
            "id": 9376104,
            "node_id": "MDQ6VXNlcjkzNzYxMDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/9376104?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/BowenBao",
            "html_url": "https://github.com/BowenBao",
            "followers_url": "https://api.github.com/users/BowenBao/followers",
            "following_url": "https://api.github.com/users/BowenBao/following{/other_user}",
            "gists_url": "https://api.github.com/users/BowenBao/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/BowenBao/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/BowenBao/subscriptions",
            "organizations_url": "https://api.github.com/users/BowenBao/orgs",
            "repos_url": "https://api.github.com/users/BowenBao/repos",
            "events_url": "https://api.github.com/users/BowenBao/events{/privacy}",
            "received_events_url": "https://api.github.com/users/BowenBao/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-06-02T17:38:11Z",
        "updated_at": "2023-06-02T17:38:11Z",
        "author_association": "MEMBER",
        "body": "Comment says below, it does support MaxPool up to latest version 12.\r\n```c++\r\n// For maxpool v8 and beyond\r\n// version 8: Added storage_order And Indices\r\n// version 10: Added ceil_mode\r\n// version 11: Added dilations\r\n// version 12: Added int8/uint8 support\r\nclass MaxPoolV8 : public OpKernel, public PoolBase {\r\n```\r\n\r\nLooking at the output shapes again, it shows rather that **torch** output shape is incorrect.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1574089374/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1574119993",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15446#issuecomment-1574119993",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15446",
        "id": 1574119993,
        "node_id": "IC_kwDOCVq1mM5d0yo5",
        "user": {
            "login": "BowenBao",
            "id": 9376104,
            "node_id": "MDQ6VXNlcjkzNzYxMDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/9376104?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/BowenBao",
            "html_url": "https://github.com/BowenBao",
            "followers_url": "https://api.github.com/users/BowenBao/followers",
            "following_url": "https://api.github.com/users/BowenBao/following{/other_user}",
            "gists_url": "https://api.github.com/users/BowenBao/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/BowenBao/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/BowenBao/subscriptions",
            "organizations_url": "https://api.github.com/users/BowenBao/orgs",
            "repos_url": "https://api.github.com/users/BowenBao/repos",
            "events_url": "https://api.github.com/users/BowenBao/events{/privacy}",
            "received_events_url": "https://api.github.com/users/BowenBao/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-06-02T18:05:18Z",
        "updated_at": "2023-06-02T18:05:18Z",
        "author_association": "MEMBER",
        "body": "torch is performing special undocumented behavior under ceil_mode.\r\n\r\nhttps://github.com/pytorch/pytorch/blob/624257890e89b3851e0cc0ae1af96b47c09b8055/aten/src/ATen/native/Pool.h#L49-L55\r\n\r\nNot much we can do.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1574119993/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1574128785",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/15446#issuecomment-1574128785",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/15446",
        "id": 1574128785,
        "node_id": "IC_kwDOCVq1mM5d00yR",
        "user": {
            "login": "BowenBao",
            "id": 9376104,
            "node_id": "MDQ6VXNlcjkzNzYxMDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/9376104?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/BowenBao",
            "html_url": "https://github.com/BowenBao",
            "followers_url": "https://api.github.com/users/BowenBao/followers",
            "following_url": "https://api.github.com/users/BowenBao/following{/other_user}",
            "gists_url": "https://api.github.com/users/BowenBao/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/BowenBao/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/BowenBao/subscriptions",
            "organizations_url": "https://api.github.com/users/BowenBao/orgs",
            "repos_url": "https://api.github.com/users/BowenBao/repos",
            "events_url": "https://api.github.com/users/BowenBao/events{/privacy}",
            "received_events_url": "https://api.github.com/users/BowenBao/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-06-02T18:12:37Z",
        "updated_at": "2023-06-02T18:12:37Z",
        "author_association": "MEMBER",
        "body": "This is not only restricted to MaxPool3d. It repros under `ceil_mode=True` and certain combination of `kernel_size`, `pad` and `input_shape`. Below is a repro for MaxPool2d.\r\n\r\n```python\r\nimport torch\r\nimport onnxruntime\r\nimport onnx\r\n\r\n## Only when ceil_mode=True and padding>0, the bug occurs.\r\nmodel = torch.nn.MaxPool2d(kernel_size=3, stride=None, padding=1, dilation=1, return_indices=False, ceil_mode=True)\r\nx = torch.randn(1, 2, 3, 5)\r\n\r\nout_torch = model(x)\r\n# torch.onnx.export(model, (x, ), 'max_pool3d_model.onnx')\r\n\r\n# sess = onnxruntime.InferenceSession('max_pool3d_model.onnx')\r\nmodel_text = \"\"\"\r\n<\r\n   ir_version: 7,\r\n   opset_import: [\"\" : 14],\r\n   producer_name: \"pytorch\",\r\n   producer_version: \"2.1.0\"\r\n>\r\ntorch_jit (float[1,2,3,5] MaxPool_0) => (float[1,2,2,3] output) {\r\n   output = MaxPool <ceil_mode = 1, kernel_shape = [3, 3], pads = [1, 1, 1, 1], strides = [3, 3]> (MaxPool_0)\r\n}\r\n\"\"\"\r\nmodel = onnx.parser.parse_model(model_text)\r\n\r\nsess = onnxruntime.InferenceSession(model.SerializeToString(), providers=['CPUExecutionProvider'])\r\nout_ort = sess.run(None, {sess.get_inputs()[0].name: x.numpy()})\r\n\r\nout_ort = torch.tensor(out_ort[0])\r\nout_torch = (\r\n    out_torch\r\n    if isinstance(out_torch, torch.Tensor)\r\n    else torch.tensor(out_torch)\r\n)\r\n\r\ntorch.testing.assert_close(out_ort, out_torch)\r\n\r\nprint(\"===== End =====\")\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1574128785/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]