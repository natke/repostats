[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/763999139",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6388#issuecomment-763999139",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6388",
        "id": 763999139,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc2Mzk5OTEzOQ==",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-01-20T22:38:47Z",
        "updated_at": "2021-01-20T22:38:47Z",
        "author_association": "MEMBER",
        "body": "It doesn't look like you've implemented GetExecutionProviderType() in your custom op. If you don't implement it, the default is CPU. See this as an example: https://github.com/microsoft/onnxruntime/blob/d761571afcbc50be94b2ffdfcaa09cfd9e2eaf5e/onnxruntime/test/shared_lib/test_inference.cc#L271. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/763999139/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/764055044",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6388#issuecomment-764055044",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6388",
        "id": 764055044,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc2NDA1NTA0NA==",
        "user": {
            "login": "CoderHam",
            "id": 11223643,
            "node_id": "MDQ6VXNlcjExMjIzNjQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/11223643?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/CoderHam",
            "html_url": "https://github.com/CoderHam",
            "followers_url": "https://api.github.com/users/CoderHam/followers",
            "following_url": "https://api.github.com/users/CoderHam/following{/other_user}",
            "gists_url": "https://api.github.com/users/CoderHam/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/CoderHam/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/CoderHam/subscriptions",
            "organizations_url": "https://api.github.com/users/CoderHam/orgs",
            "repos_url": "https://api.github.com/users/CoderHam/repos",
            "events_url": "https://api.github.com/users/CoderHam/events{/privacy}",
            "received_events_url": "https://api.github.com/users/CoderHam/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-01-21T00:10:42Z",
        "updated_at": "2021-01-21T00:10:42Z",
        "author_association": "NONE",
        "body": "The custom op I am using is https://github.com/microsoft/onnxruntime/tree/v1.6.0/onnxruntime/test/testdata/custom_op_library and I pick it up from the build after running the python build script. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/764055044/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/764496371",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6388#issuecomment-764496371",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6388",
        "id": 764496371,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc2NDQ5NjM3MQ==",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-01-21T09:17:39Z",
        "updated_at": "2021-01-21T09:17:39Z",
        "author_association": "MEMBER",
        "body": "So, the warning regarding cuda kernels not found in registries is expected since no execution provider was provided and it defaulted to CPU. As for the segfault, at what point are you dlclosing libcustom_op_library.so? If you're calling dlclose() before the session is destructed, you'll get a segfault with stack trace like below. As stated in the [documentation](https://github.com/microsoft/onnxruntime/blob/d42399e1b07ce61e95aae88bc6b6ea5dcaae2011/include/onnxruntime/core/session/onnxruntime_c_api.h#L421) you should call it after session destruction.\r\n```\r\nThread 1 \"t-ort\" received signal SIGSEGV, Segmentation fault.\r\n0x00007fffee3815d6 in onnxruntime::CustomOpKernel::~CustomOpKernel (this=0x41609e0, __in_chrg=<optimized out>)\r\n    at /bert_ort/pranav/onnxruntime/onnxruntime/core/session/custom_ops.cc:82\r\n82        ~CustomOpKernel() override { op_.KernelDestroy(op_kernel_); }\r\n(gdb) bt\r\n#0  0x00007fffee3815d6 in onnxruntime::CustomOpKernel::~CustomOpKernel (this=0x41609e0, __in_chrg=<optimized out>)\r\n    at /bert_ort/pranav/onnxruntime/onnxruntime/core/session/custom_ops.cc:82\r\n#1  0x00007fffee381628 in onnxruntime::CustomOpKernel::~CustomOpKernel (this=0x41609e0, __in_chrg=<optimized out>)\r\n    at /bert_ort/pranav/onnxruntime/onnxruntime/core/session/custom_ops.cc:82\r\n#2  0x00007fffee3acde5 in onnxruntime::SessionState::~SessionState (this=0x3fcc090, __in_chrg=<optimized out>)\r\n    at /bert_ort/pranav/onnxruntime/onnxruntime/core/framework/session_state.h:98\r\n#3  0x00007fffee3d0de4 in std::default_delete<onnxruntime::SessionState>::operator() (this=0xd226a0, __ptr=0x3fcc090) at /usr/include/c++/5/bits/unique_ptr.h:76\r\n#4  0x00007fffee3c775b in std::unique_ptr<onnxruntime::SessionState, std::default_delete<onnxruntime::SessionState> >::~unique_ptr (this=0xd226a0,\r\n    __in_chrg=<optimized out>) at /usr/include/c++/5/bits/unique_ptr.h:236\r\n#5  0x00007fffee3b6606 in onnxruntime::InferenceSession::~InferenceSession (this=0xd22090, __in_chrg=<optimized out>)\r\n    at /bert_ort/pranav/onnxruntime/onnxruntime/core/session/inference_session.cc:354\r\n#6  0x00007fffee3b6840 in onnxruntime::InferenceSession::~InferenceSession (this=0xd22090, __in_chrg=<optimized out>)\r\n    at /bert_ort/pranav/onnxruntime/onnxruntime/core/session/inference_session.cc:378\r\n#7  0x00007fffee3498dc in OrtApis::ReleaseSession (value=0xd22090) at /bert_ort/pranav/onnxruntime/onnxruntime/core/session/onnxruntime_c_api.cc:2103\r\n#8  0x0000000000401f58 in Ort::OrtRelease(OrtSession*) ()\r\n#9  0x000000000040285d in Ort::Base<OrtSession>::~Base() ()\r\n#10 0x00000000004027ba in Ort::Session::~Session() ()\r\n#11 0x0000000000401bee in main ()\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/764496371/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/764963190",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6388#issuecomment-764963190",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6388",
        "id": 764963190,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc2NDk2MzE5MA==",
        "user": {
            "login": "CoderHam",
            "id": 11223643,
            "node_id": "MDQ6VXNlcjExMjIzNjQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/11223643?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/CoderHam",
            "html_url": "https://github.com/CoderHam",
            "followers_url": "https://api.github.com/users/CoderHam/followers",
            "following_url": "https://api.github.com/users/CoderHam/following{/other_user}",
            "gists_url": "https://api.github.com/users/CoderHam/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/CoderHam/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/CoderHam/subscriptions",
            "organizations_url": "https://api.github.com/users/CoderHam/orgs",
            "repos_url": "https://api.github.com/users/CoderHam/repos",
            "events_url": "https://api.github.com/users/CoderHam/events{/privacy}",
            "received_events_url": "https://api.github.com/users/CoderHam/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-01-21T21:48:44Z",
        "updated_at": "2021-01-21T21:48:44Z",
        "author_association": "NONE",
        "body": "@pranavsharma in 1.5.3 we did not need to dlclose the library handle. Thanks for helping me understand that it is needed. I have a follow up question: If I am loading multiple instances of the model that uses a custom op does the dlclose need to be done after ALL instances of the model have been unloaded? ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/764963190/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/764975032",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6388#issuecomment-764975032",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6388",
        "id": 764975032,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc2NDk3NTAzMg==",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-01-21T22:13:27Z",
        "updated_at": "2021-01-21T22:13:27Z",
        "author_association": "MEMBER",
        "body": "You don't *have* to dlcose the custom op library handle. But if you choose to do so, you should do it after all sessions (that are using this custom op) have been destructed. This behavior has not changed between release 1.5.3 and today.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/764975032/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/765806903",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6388#issuecomment-765806903",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6388",
        "id": 765806903,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc2NTgwNjkwMw==",
        "user": {
            "login": "deadeyegoodwin",
            "id": 5104484,
            "node_id": "MDQ6VXNlcjUxMDQ0ODQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5104484?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/deadeyegoodwin",
            "html_url": "https://github.com/deadeyegoodwin",
            "followers_url": "https://api.github.com/users/deadeyegoodwin/followers",
            "following_url": "https://api.github.com/users/deadeyegoodwin/following{/other_user}",
            "gists_url": "https://api.github.com/users/deadeyegoodwin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/deadeyegoodwin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/deadeyegoodwin/subscriptions",
            "organizations_url": "https://api.github.com/users/deadeyegoodwin/orgs",
            "repos_url": "https://api.github.com/users/deadeyegoodwin/repos",
            "events_url": "https://api.github.com/users/deadeyegoodwin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/deadeyegoodwin/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-01-23T01:07:47Z",
        "updated_at": "2021-01-23T01:07:47Z",
        "author_association": "NONE",
        "body": "We believe the problem is related to general issues with dlopen/dlclose and C++ apps that we have seen before. We have an fix implemented and just waiting for final testing to complete.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/765806903/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/767069923",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6388#issuecomment-767069923",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6388",
        "id": 767069923,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc2NzA2OTkyMw==",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-01-25T19:47:42Z",
        "updated_at": "2021-01-25T19:47:42Z",
        "author_association": "MEMBER",
        "body": "Closing as per comment above. Please re-open if needed. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/767069923/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]