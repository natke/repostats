[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1290116446",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13434#issuecomment-1290116446",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13434",
        "id": 1290116446,
        "node_id": "IC_kwDOCVq1mM5M5Z1e",
        "user": {
            "login": "smistad",
            "id": 176325,
            "node_id": "MDQ6VXNlcjE3NjMyNQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/176325?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/smistad",
            "html_url": "https://github.com/smistad",
            "followers_url": "https://api.github.com/users/smistad/followers",
            "following_url": "https://api.github.com/users/smistad/following{/other_user}",
            "gists_url": "https://api.github.com/users/smistad/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/smistad/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/smistad/subscriptions",
            "organizations_url": "https://api.github.com/users/smistad/orgs",
            "repos_url": "https://api.github.com/users/smistad/repos",
            "events_url": "https://api.github.com/users/smistad/events{/privacy}",
            "received_events_url": "https://api.github.com/users/smistad/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-10-25T07:32:11Z",
        "updated_at": "2022-10-25T07:32:11Z",
        "author_association": "NONE",
        "body": "I tried onnxruntime 1.13.1 and dml 1.9.1 just now as well. Same error.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1290116446/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1291605525",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13434#issuecomment-1291605525",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13434",
        "id": 1291605525,
        "node_id": "IC_kwDOCVq1mM5M_FYV",
        "user": {
            "login": "jstoecker",
            "id": 3835701,
            "node_id": "MDQ6VXNlcjM4MzU3MDE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3835701?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jstoecker",
            "html_url": "https://github.com/jstoecker",
            "followers_url": "https://api.github.com/users/jstoecker/followers",
            "following_url": "https://api.github.com/users/jstoecker/following{/other_user}",
            "gists_url": "https://api.github.com/users/jstoecker/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jstoecker/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jstoecker/subscriptions",
            "organizations_url": "https://api.github.com/users/jstoecker/orgs",
            "repos_url": "https://api.github.com/users/jstoecker/repos",
            "events_url": "https://api.github.com/users/jstoecker/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jstoecker/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-10-26T07:19:58Z",
        "updated_at": "2022-10-26T07:19:58Z",
        "author_association": "MEMBER",
        "body": "It's quite difficult to repro with only a snippet of code. However, I see a few lines that are a bit iffy:\r\n\r\n```cpp\r\nOrtMemoryInfo* info = Ort::MemoryInfo::CreateCpu(OrtAllocatorType::OrtArenaAllocator, OrtMemType::OrtMemTypeCPU); // Must be TypeCPU to work on CPU\r\n```\r\n\r\nYou're using a pointer variable (the ORT C API type) to store a reference to the ORT C++ API type, which is a smart pointer (`Ort::MemoryInfo`). You probably want `Ort::MemoryInfo info = ...`.\r\n\r\nNext, these lines are almost certainly going to bite you at some point:\r\n\r\n```cpp\r\nstd::vector<const char*> inputNames = { m_session->GetInputName(0, allocator) };\r\nstd::vector<const char*> outputNames = { m_session->GetOutputName(0, allocator) };\r\n```\r\n\r\nIf the code snippet you shared is completely accurate then, at worst, I think you'll leak some memory. However, this API seems to be used incorrectly and [was deprecated](https://onnxruntime.ai/docs/api/c/struct_ort_1_1_session.html#a147c44cc42331f7126cb892ec46b812b) as a result. In ORT 1.13.1 you'd want to change those lines to something like this:\r\n\r\n```cpp\r\nstd::string inputName = m_session->GetInputNameAllocated(0, allocator).get(); // keep alive until session::run finishes!\r\nstd::string outputName = m_session->GetOutputNameAllocated(0, allocator).get(); // keep alive until session::run finishes!\r\nstd::vector<const char*> inputNames = { inputName.c_str() };\r\nstd::vector<const char*> outputNames = { outputName.c_str() };\r\n```\r\n\r\nDoing the above should ensure you don't have dangling pointers, so long as the std::string copies don't go out of scope prematurely.\r\n\r\nI'm not certain if those suggestions will fix your problem. A standalone repro that I can compile would make it much easier to diagnose.\r\n\r\n### Checking your model works with DML\r\n\r\nIn case the above doesn't help, and you think it's DML at fault, I'd try running your ONNX model through a tool that is known to work, like onnxruntime_perf_test.exe:\r\n\r\n- Download [Microsoft.ML.OnnxRuntime.DirectML.1.13.1.zip](https://github.com/microsoft/onnxruntime/releases/download/v1.13.1/Microsoft.ML.OnnxRuntime.DirectML.1.13.1.zip)\r\n  - Extract the contents of `runtimes\\win-x64\\native\\` from the .zip to a local test directory, such as `c:\\ort_test`.\r\n- Download [Microsoft.AI.DirectML.1.91](https://www.nuget.org/packages/Microsoft.AI.DirectML/1.9.1)\r\n  - Rename the file from `Microsoft.AI.DirectML.1.9.1.nupkg` to `Microsoft.AI.DirectML.1.9.1.nupkg.zip`\r\n  - Extract the contents of `bin\\x64-win` from the .zip to the same test directory as above (e.g., `c:\\ort_test`)\r\n- Copy your ONNX model to the same test directory (e.g., `c:\\ort_test`)\r\n- You should have a directory (e.g., `c:\\ort_test`) with the following important files (plus others, which are not important for this test): \r\n  - DirectML.dll\r\n  - onnxruntime.dll\r\n  - onnxruntime_perf_test.exe\r\n  - jugular_vein_segmentation.onnx\r\n- Run your ONNX model with DML and make sure it succeeds:\r\n  - In a terminal: `onnxruntime_perf_text.exe -M -I -e dml -r 100 jugular_vein_segmentation.onnx`\r\n  - You should see output summarizing execution time and number of iterations.\r\n  - You can run the .exe without arguments to see what the options do, but in short this command is executing the ONNX model 100 times with the DirectML EP and randomly initialized input tensors.\r\n\r\nIf your model runs correctly with onnxruntime_perf_test.exe then it's strong evidence of a mistake in your application logic.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1291605525/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1291646043",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13434#issuecomment-1291646043",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13434",
        "id": 1291646043,
        "node_id": "IC_kwDOCVq1mM5M_PRb",
        "user": {
            "login": "smistad",
            "id": 176325,
            "node_id": "MDQ6VXNlcjE3NjMyNQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/176325?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/smistad",
            "html_url": "https://github.com/smistad",
            "followers_url": "https://api.github.com/users/smistad/followers",
            "following_url": "https://api.github.com/users/smistad/following{/other_user}",
            "gists_url": "https://api.github.com/users/smistad/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/smistad/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/smistad/subscriptions",
            "organizations_url": "https://api.github.com/users/smistad/orgs",
            "repos_url": "https://api.github.com/users/smistad/repos",
            "events_url": "https://api.github.com/users/smistad/events{/privacy}",
            "received_events_url": "https://api.github.com/users/smistad/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-10-26T08:00:05Z",
        "updated_at": "2022-10-26T08:01:43Z",
        "author_association": "NONE",
        "body": "Thanks @jstoecker I will try what you suggest and come back to you. Note that the same model and code works on the CPU by just removing the Ort::ThrowOnError(OrtSessionOptionsAppendExecutionProvider_DML(session_options, 0)); line.\r\n\r\nAlso, note that the C++ examples for onnxruntime are not up to date, so I had to guess my way forward on which function to use and how to use them. \r\n\r\nFor instance this example https://github.com/microsoft/onnxruntime-inference-examples/blob/main/c_cxx/model-explorer/model-explorer.cpp uses session.GetInputNames() which does not exist anymore..\r\n\r\n\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1291646043/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1291939268",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/13434#issuecomment-1291939268",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/13434",
        "id": 1291939268,
        "node_id": "IC_kwDOCVq1mM5NAW3E",
        "user": {
            "login": "smistad",
            "id": 176325,
            "node_id": "MDQ6VXNlcjE3NjMyNQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/176325?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/smistad",
            "html_url": "https://github.com/smistad",
            "followers_url": "https://api.github.com/users/smistad/followers",
            "following_url": "https://api.github.com/users/smistad/following{/other_user}",
            "gists_url": "https://api.github.com/users/smistad/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/smistad/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/smistad/subscriptions",
            "organizations_url": "https://api.github.com/users/smistad/orgs",
            "repos_url": "https://api.github.com/users/smistad/repos",
            "events_url": "https://api.github.com/users/smistad/events{/privacy}",
            "received_events_url": "https://api.github.com/users/smistad/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-10-26T12:11:48Z",
        "updated_at": "2022-10-26T12:11:48Z",
        "author_association": "NONE",
        "body": "This was fixed by changing OrtMemoryInfo* info to Ort::MemoryInfo info. Thanks for your help!",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1291939268/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]